<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Java Project | 黄金贤的博客</title>
  <meta name="keywords" content="">
  <meta name="description" content="Java Project | 黄金贤的博客">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="概述# PHP是一种运行在服务器端的脚步语言，可以嵌入到HTML中。是一中面向对象的、解释的。7.3版本比较好用 # 1994年   环境准备# 安装 PhpStorm # https:&#x2F;&#x2F;3.jetbra.in&#x2F; 下载安装包 jetbra.zip 解压后放在 PhpStorm 的bin目录下, 为 jetbra 目录 # 双击 \bin\jetbra\scripts\install-all-us">
<meta property="og:type" content="article">
<meta property="og:title" content="Php">
<meta property="og:url" content="https://hjxstart.github.io/2025/09/13/Php/index.html">
<meta property="og:site_name" content="黄金贤的博客">
<meta property="og:description" content="概述# PHP是一种运行在服务器端的脚步语言，可以嵌入到HTML中。是一中面向对象的、解释的。7.3版本比较好用 # 1994年   环境准备# 安装 PhpStorm # https:&#x2F;&#x2F;3.jetbra.in&#x2F; 下载安装包 jetbra.zip 解压后放在 PhpStorm 的bin目录下, 为 jetbra 目录 # 双击 \bin\jetbra\scripts\install-all-us">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/20250913234353519.png">
<meta property="article:published_time" content="2025-09-13T15:10:00.000Z">
<meta property="article:modified_time" content="2025-10-05T03:22:16.168Z">
<meta property="article:author" content="黄金贤">
<meta property="article:tag" content="计算机网络 数据库 操作系统 数据结构 算法 Java Nodejs">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/20250913234353519.png">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-dark.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>


<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 8.0.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.jpg"/>
</a>
<div class="author">
    <span>黄金贤</span>
</div>

<div class="icon">
    
        
            <a title="github"
               href="https://github.com/hjxstart"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="email"
               href="mailto:hjxstart@126.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=1726283687&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
</div>




<ul>
    <li>
        <div class="all active" data-rel="全部文章">全部文章
            
                <small>(66)</small>
            
        </div>
    </li>
    
        
            
                <li>
                    <div data-rel="运维">
                        
                        运维
                        <small>(20)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="开发">
                        
                        开发
                        <small>(12)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="读书">
                        
                        读书
                        <small>(2)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="安全">
                        
                        安全
                        <small>(3)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="工具">
                        
                        工具
                        <small>(10)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="数据库">
                        
                        数据库
                        <small>(5)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="网络">
                        
                        网络
                        <small>(14)</small>
                        
                    </div>
                    
                </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">关于</a>
        
        <a style="width: 50%"
                
                                           class="friends">友链</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="66">
<input type="hidden" id="yelog_site_word_count" value="243.1k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="https://github.com/hjxstart">hjxstart</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">全部文章</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
    </div>

</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        <a id="top" class="全部文章 网络 "
           href="/2024/05/06/HCIE%20Lab/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="HCIE Lab">HCIE Lab</span>
            <span class="post-date" title="2024-05-06 19:42:00">2024/05/06</span>
        </a>
        
        <a id="top" class="全部文章 安全 "
           href="/2025/08/17/CISP-PTE/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="CISP-PTE">CISP-PTE</span>
            <span class="post-date" title="2025-08-17 11:12:00">2025/08/17</span>
        </a>
        
        <a id="top" class="全部文章 运维 "
           href="/2021/09/09/VMware/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="VMware">VMware</span>
            <span class="post-date" title="2021-09-09 15:38:00">2021/09/09</span>
        </a>
        
        <a id="top" class="全部文章 运维 "
           href="/2025/04/04/PXE-Kickstart/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="PXE+Kickstart">PXE+Kickstart</span>
            <span class="post-date" title="2025-04-04 10:45:00">2025/04/04</span>
        </a>
        
        <a id="top" class="全部文章 运维 "
           href="/2025/02/12/KylinOS/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="KylinOS">KylinOS</span>
            <span class="post-date" title="2025-02-12 16:47:00">2025/02/12</span>
        </a>
        
        <a id="top" class="全部文章 运维 "
           href="/2025/08/24/KylinOS-FAQ/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="KylinOS FAQ">KylinOS FAQ</span>
            <span class="post-date" title="2025-08-24 11:07:00">2025/08/24</span>
        </a>
        
        <a id="top" class="全部文章 运维 "
           href="/2025/08/24/Windows/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Windows">Windows</span>
            <span class="post-date" title="2025-08-24 11:19:00">2025/08/24</span>
        </a>
        
        <a id="top" class="全部文章 运维 "
           href="/2022/03/24/Linux/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Linux">Linux</span>
            <span class="post-date" title="2022-03-24 11:53:00">2022/03/24</span>
        </a>
        
        <a id="top" class="全部文章 工具 "
           href="/2024/07/28/NTLite/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="NTLite">NTLite</span>
            <span class="post-date" title="2024-07-28 21:32:00">2024/07/28</span>
        </a>
        
        <a id="top" class="全部文章 数据库 "
           href="/2020/03/19/MySQL/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="MySQL">MySQL</span>
            <span class="post-date" title="2020-03-19 21:51:00">2020/03/19</span>
        </a>
        
        <a id="top" class="全部文章 开发 "
           href="/2025/09/13/Php/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Php">Php</span>
            <span class="post-date" title="2025-09-13 23:10:00">2025/09/13</span>
        </a>
        
        <a  class="全部文章 安全 "
           href="/2025/08/21/cisp-practice/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="cisp-practice">cisp-practice</span>
            <span class="post-date" title="2025-08-21 19:41:00">2025/08/21</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2025/04/24/OpenStack/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="OpenStack">OpenStack</span>
            <span class="post-date" title="2025-04-24 09:04:00">2025/04/24</span>
        </a>
        
        <a  class="全部文章 安全 "
           href="/2024/08/23/CISO/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="CISO">CISO</span>
            <span class="post-date" title="2024-08-23 19:29:00">2024/08/23</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2024/04/16/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%B8%88/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="网络工程师">网络工程师</span>
            <span class="post-date" title="2024-04-16 22:14:00">2024/04/16</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2024/01/27/STP/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="STP">STP</span>
            <span class="post-date" title="2024-01-27 14:01:00">2024/01/27</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2024/01/27/VLAN/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="VLAN">VLAN</span>
            <span class="post-date" title="2024-01-27 11:42:00">2024/01/27</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2024/01/27/LLDP/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="LLDP">LLDP</span>
            <span class="post-date" title="2024-01-27 11:31:00">2024/01/27</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2024/01/27/Telnet/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Telnet">Telnet</span>
            <span class="post-date" title="2024-01-27 10:45:00">2024/01/27</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2024/01/27/SSH/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="SSH">SSH</span>
            <span class="post-date" title="2024-01-27 10:44:00">2024/01/27</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2023/12/22/WireGuard/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="WireGuard">WireGuard</span>
            <span class="post-date" title="2023-12-22 07:40:00">2023/12/22</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2023/12/21/Stack-Port/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Stack Port">Stack Port</span>
            <span class="post-date" title="2023-12-21 19:31:00">2023/12/21</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2023/12/18/RouterOS/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="RouterOS">RouterOS</span>
            <span class="post-date" title="2023-12-18 17:05:00">2023/12/18</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2023/12/18/GIT/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="GIT">GIT</span>
            <span class="post-date" title="2023-12-18 17:00:00">2023/12/18</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2023/11/30/HelpDesk/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="HelpDesk">HelpDesk</span>
            <span class="post-date" title="2023-11-30 21:21:00">2023/11/30</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2023/11/18/OpenWrt/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="OpenWrt">OpenWrt</span>
            <span class="post-date" title="2023-11-18 17:03:00">2023/11/18</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2023/06/01/HCNP-Lab/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="华为NP网络实验">华为NP网络实验</span>
            <span class="post-date" title="2023-06-01 10:46:04">2023/06/01</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2023/06/01/CCNP-Lab/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="CCNP Lab">CCNP Lab</span>
            <span class="post-date" title="2023-06-01 10:46:00">2023/06/01</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2023/05/13/IBMC/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="IBMC">IBMC</span>
            <span class="post-date" title="2023-05-13 21:04:00">2023/05/13</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2023/04/26/1Panel/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="1Panel">1Panel</span>
            <span class="post-date" title="2023-04-26 14:09:00">2023/04/26</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2023/04/08/HCNA-Lab/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="HCNA Lab">HCNA Lab</span>
            <span class="post-date" title="2023-04-08 11:46:00">2023/04/08</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2023/04/07/CCNA-Lab/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="CCNA Lab">CCNA Lab</span>
            <span class="post-date" title="2023-04-07 20:13:29">2023/04/07</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2023/04/07/OSPF/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="OSPF">OSPF</span>
            <span class="post-date" title="2023-04-07 19:19:00">2023/04/07</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2022/08/24/FRP/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="FRP">FRP</span>
            <span class="post-date" title="2022-08-24 12:47:00">2022/08/24</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2022/08/12/HomeLab/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="HomeLab">HomeLab</span>
            <span class="post-date" title="2022-08-12 15:09:00">2022/08/12</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2022/07/28/WDS-MDT/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="WDS+MDT">WDS+MDT</span>
            <span class="post-date" title="2022-07-28 21:33:00">2022/07/28</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2022/06/21/Anaconda/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Anaconda">Anaconda</span>
            <span class="post-date" title="2022-06-21 20:56:00">2022/06/21</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2022/05/25/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E5%B8%88/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="网络规划师">网络规划师</span>
            <span class="post-date" title="2022-05-25 11:57:00">2022/05/25</span>
        </a>
        
        <a  class="全部文章 数据库 "
           href="/2022/03/14/InfluxDB/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="InfluxDB">InfluxDB</span>
            <span class="post-date" title="2022-03-14 13:25:00">2022/03/14</span>
        </a>
        
        <a  class="全部文章 数据库 "
           href="/2022/03/06/MongoDB/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="MongoDB">MongoDB</span>
            <span class="post-date" title="2022-03-06 17:38:00">2022/03/06</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2021/12/27/VIM/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="VIM">VIM</span>
            <span class="post-date" title="2021-12-27 09:15:00">2021/12/27</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2021/12/16/VSFTPD/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="VSFTPD">VSFTPD</span>
            <span class="post-date" title="2021-12-16 08:49:00">2021/12/16</span>
        </a>
        
        <a  class="全部文章 数据库 "
           href="/2021/10/06/REDIS/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="REDIS">REDIS</span>
            <span class="post-date" title="2021-10-06 17:19:00">2021/10/06</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2021/09/20/K8s-lab/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="K8s_lab">K8s_lab</span>
            <span class="post-date" title="2021-09-20 08:04:00">2021/09/20</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2021/09/15/K8s/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="K8s">K8s</span>
            <span class="post-date" title="2021-09-15 20:48:00">2021/09/15</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2021/09/08/Ingress/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Ingress">Ingress</span>
            <span class="post-date" title="2021-09-08 23:56:00">2021/09/08</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2021/09/08/Harbor/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Harbor">Harbor</span>
            <span class="post-date" title="2021-09-08 18:04:00">2021/09/08</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/08/26/Go/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Go">Go</span>
            <span class="post-date" title="2021-08-26 11:50:00">2021/08/26</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/08/15/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Java多线程">Java多线程</span>
            <span class="post-date" title="2021-08-15 14:36:00">2021/08/15</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2021/08/11/Nginx/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Nginx">Nginx</span>
            <span class="post-date" title="2021-08-11 23:28:00">2021/08/11</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/08/06/Maven/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Maven">Maven</span>
            <span class="post-date" title="2021-08-06 09:38:00">2021/08/06</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/07/31/Springboot%E9%A1%B9%E7%9B%AE/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Springboot项目">Springboot项目</span>
            <span class="post-date" title="2021-07-31 19:34:00">2021/07/31</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2021/07/22/Docker/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Docker">Docker</span>
            <span class="post-date" title="2021-07-22 14:53:00">2021/07/22</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/07/19/SpringSecurity/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="SpringSecurity">SpringSecurity</span>
            <span class="post-date" title="2021-07-19 20:58:00">2021/07/19</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/07/13/Mybatis/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Mybatis">Mybatis</span>
            <span class="post-date" title="2021-07-13 10:38:00">2021/07/13</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/07/05/NVM/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="NVM">NVM</span>
            <span class="post-date" title="2021-07-05 08:15:00">2021/07/05</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/06/26/Java-Project/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Java Project">Java Project</span>
            <span class="post-date" title="2021-06-26 07:58:00">2021/06/26</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/06/23/Vue/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Vue">Vue</span>
            <span class="post-date" title="2021-06-23 10:48:00">2021/06/23</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/06/08/SpringBoot2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="SpringBoot2">SpringBoot2</span>
            <span class="post-date" title="2021-06-08 16:51:00">2021/06/08</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2021/06/07/CentOS7/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="CentOS7">CentOS7</span>
            <span class="post-date" title="2021-06-07 23:16:00">2021/06/07</span>
        </a>
        
        <a  class="全部文章 读书 "
           href="/2021/04/18/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="设计模式">设计模式</span>
            <span class="post-date" title="2021-04-18 22:19:00">2021/04/18</span>
        </a>
        
        <a  class="全部文章 数据库 "
           href="/2021/03/22/SQL/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="SQL">SQL</span>
            <span class="post-date" title="2021-03-22 18:33:00">2021/03/22</span>
        </a>
        
        <a  class="全部文章 读书 "
           href="/2021/03/14/%E6%97%B6%E9%97%B4%E7%AE%A1%E7%90%86/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="时间管理">时间管理</span>
            <span class="post-date" title="2021-03-14 21:49:00">2021/03/14</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2021/03/14/Hexo/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hexo">Hexo</span>
            <span class="post-date" title="2021-03-14 08:31:00">2021/03/14</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2020/09/12/UltraISO/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="UltraISO">UltraISO</span>
            <span class="post-date" title="2020-09-12 11:42:00">2020/09/12</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2020/09/12/Ventoy/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Ventoy">Ventoy</span>
            <span class="post-date" title="2020-09-12 11:42:00">2020/09/12</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-Java-Project" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Java Project</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="开发">开发</a>
            
        </span>
        
        
    </div>
    <div class="article-meta">
        
            发布时间 : <time class="date" title='最后更新: 2025-10-08 18:31:14'>2021-06-26 07:58</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:18k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E7%AE%80%E5%8D%95%E7%9A%84-SSM-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-text">第一章 简单的 SSM 项目搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1%E3%80%81%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-text">1.1、环境配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2%E3%80%81%E5%88%9B%E5%BB%BA-Maven-project-%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-text">1.2、创建 Maven project 的步骤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E7%B3%BB%E7%BB%9F%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97"><span class="toc-text">第二章 系统功能模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1%E3%80%81%E6%A8%A1%E5%9D%97%E5%8A%9F%E8%83%BD%E8%AF%B4%E6%98%8E"><span class="toc-text">2.1、模块功能说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1%E3%80%81%E5%89%8D%E7%AB%AF%E5%B1%95%E7%A4%BA%E7%B3%BB%E7%BB%9F"><span class="toc-text">2.1.1、前端展示系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2%E3%80%81%E5%BA%97%E5%AE%B6%E7%B3%BB%E7%BB%9F"><span class="toc-text">2.1.2、店家系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3%E3%80%81%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98%E7%B3%BB%E7%BB%9F"><span class="toc-text">2.1.3、超级管理员系统</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2%E3%80%81%E6%A8%A1%E5%9D%97%E5%8A%9F%E8%83%BD%E5%AF%B9%E8%B1%A1"><span class="toc-text">2.2、模块功能对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1%E3%80%81%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%85%B3%E7%B3%BB%E5%9B%BE"><span class="toc-text">2.2.1、实体类关系图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2%E3%80%81%E5%AE%9E%E4%BD%93%E7%B1%BB%E4%BB%A3%E7%A0%81"><span class="toc-text">2.2.2、实体类代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3%E3%80%81%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">2.3、代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1%E3%80%81%E5%88%9B%E5%BB%BA%E7%9B%B8%E5%BA%94%E7%9A%84%E7%B1%BB"><span class="toc-text">2.3.1、创建相应的类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2%E3%80%81%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8"><span class="toc-text">2.3.2、创建数据库表</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE"><span class="toc-text">第三章 项目配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1%E3%80%81-%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E8%AF%B4%E6%98%8E"><span class="toc-text">3.1、 项目目录说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2%E3%80%81%E5%88%9B%E5%BB%BA-sources-%E8%B5%84%E6%BA%90%E5%8C%85"><span class="toc-text">3.2、创建 sources 资源包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3%E3%80%81%E5%88%9B%E5%BB%BA-package"><span class="toc-text">3.3、创建 package</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4%E3%80%81%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE"><span class="toc-text">3.4、项目配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-1%E3%80%81%E9%85%8D%E7%BD%AE%E6%80%9D%E8%B7%AF%EF%BC%9A%E8%87%AA%E4%B8%8B%E8%80%8C%E4%B8%8A%E7%9A%84%E9%85%8D%E7%BD%AE%E3%80%82"><span class="toc-text">3.4.1、配置思路：自下而上的配置。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-2%E3%80%81%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86"><span class="toc-text">3.4.2、依赖管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-3%E3%80%81-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E9%85%8D%E7%BD%AE%E6%93%8D%E4%BD%9C"><span class="toc-text">3.4.3、 数据库的配置操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-4%E3%80%81-Spring-%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="toc-text">3.4.4、 Spring 相关配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-logback-%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="toc-text">3.5 logback 日志配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">第四章 代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1%E3%80%81%E7%AE%80%E5%8D%95%E7%9A%84-SSM-%E6%A1%88%E4%BE%8B-Area"><span class="toc-text">4.1、简单的 SSM 案例-Area</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1%E3%80%81dao-%E5%B1%82"><span class="toc-text">4.1.1、dao 层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2%E3%80%81Service-%E5%B1%82"><span class="toc-text">4.1.2、Service 层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-3%E3%80%81web-%E5%B1%82"><span class="toc-text">4.1.3、web 层</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E5%BA%97%E9%93%BA%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">第五章 店铺系统的实现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1%E3%80%81%E5%BA%97%E9%93%BA%E7%9A%84%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%9D%97"><span class="toc-text">5.1、店铺的注册模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1%E3%80%81dao-%E5%B1%82%E4%BB%A3%E7%A0%81"><span class="toc-text">5.1.1、dao 层代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2%E3%80%81service-%E5%B1%82%E4%BB%A3%E7%A0%81"><span class="toc-text">5.1.2、service 层代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-3%E3%80%81-Controller-%E5%B1%82"><span class="toc-text">5.1.3、 Controller 层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-4%E3%80%81-%E6%8B%93%E5%B1%95"><span class="toc-text">5.1.4、 拓展</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E5%BA%97%E9%93%BA%E4%BF%A1%E6%81%AF%E7%BC%96%E8%BE%91%E6%A8%A1%E5%9D%97"><span class="toc-text">5.2 店铺信息编辑模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1-Dao-%E5%B1%82"><span class="toc-text">5.2.1 Dao 层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-Service-%E5%B1%82"><span class="toc-text">5.2.2 Service 层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-3-Controller-%E5%B1%82"><span class="toc-text">5.2.3 Controller 层</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E5%95%86%E5%93%81%E7%B1%BB%E5%88%AB%E5%88%97%E8%A1%A8%E5%B1%95%E7%A4%BA"><span class="toc-text">5.3 商品类别列表展示</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-1-dao-%E5%B1%82"><span class="toc-text">5.3.1 dao 层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-2-service-%E5%B1%82"><span class="toc-text">5.3.2 service 层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-3-controller-%E5%B1%82-ProductCategoryManagementController-java"><span class="toc-text">5.3.3 controller 层 ProductCategoryManagementController.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-3-Controller-%E5%B1%82"><span class="toc-text">5.3.3 Controller 层</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8"><span class="toc-text">5.4 批量添加商品列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-1-dao-%E5%B1%82"><span class="toc-text">5.4.1 dao 层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-2-Service-%E5%B1%82"><span class="toc-text">5.4.2 Service 层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-3-Controller-%E5%B1%82"><span class="toc-text">5.4.3 Controller 层</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-%E5%88%A0%E9%99%A4%E5%95%86%E5%93%81%E7%B1%BB%E5%88%AB"><span class="toc-text">5.5 删除商品类别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-1-dao-%E5%B1%82"><span class="toc-text">5.5.1 dao 层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-2-Serivce-%E5%B1%82"><span class="toc-text">5.5.2 Serivce 层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-3-Controller-%E5%B1%82"><span class="toc-text">5.5.3 Controller 层</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6%E3%80%81%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86"><span class="toc-text">6、商品管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%95%86%E5%93%81%E6%B7%BB%E5%8A%A0%EF%BC%8C-%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E5%9B%BE%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0"><span class="toc-text">6.1 商品添加， 商品详情图批量添加</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-1"><span class="toc-text">6.1.1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-2-service-%E5%B1%82"><span class="toc-text">6.1.2 service 层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-3-controller-%E5%B1%82"><span class="toc-text">6.1.3 controller 层</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E5%95%86%E5%93%81%E7%BC%96%E8%BE%91"><span class="toc-text">6.2 商品编辑</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1%E3%80%81dao-%E5%B1%82"><span class="toc-text">6.2.1、dao 层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2%E3%80%81Service-%E5%B1%82"><span class="toc-text">6.2.2、Service 层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-3-Controller-%E5%B1%82-ProductCategoryManagementController-java"><span class="toc-text">6.2.3 Controller 层 ProductCategoryManagementController.java</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8%E5%B1%95%E7%A4%BA"><span class="toc-text">6.3 商品列表展示</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0-%E9%A6%96%E9%A1%B5"><span class="toc-text">第七章 首页</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1"><span class="toc-text">7.1</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SSM-%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E5%8A%9F%E8%83%BD%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-text">SSM 框架实现功能的步骤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Junit"><span class="toc-text">Junit</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Junit-%E6%B5%8B%E8%AF%95%E6%AD%A5%E9%AA%A4"><span class="toc-text">Junit 测试步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E5%9F%BA%E7%B1%BB"><span class="toc-text">1、定义一个基类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-text">2、定义一个实现类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Junit-%E6%8B%93%E5%B1%95"><span class="toc-text">Junit 拓展</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Junit-%E6%B5%8B%E8%AF%95%E5%9B%9E%E7%8E%AF"><span class="toc-text">Junit 测试回环</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Junit-%E9%A1%BA%E5%BA%8F%E6%89%A7%E8%A1%8C"><span class="toc-text">Junit 顺序执行</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSM-%E9%87%8D%E7%82%B9%E7%9F%A5%E8%AF%86"><span class="toc-text">SSM 重点知识</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="第一章-简单的-SSM-项目搭建"><a href="#第一章-简单的-SSM-项目搭建" class="headerlink" title="第一章 简单的 SSM 项目搭建"></a>第一章 简单的 SSM 项目搭建</h1><h2 id="1-1、环境配置"><a href="#1-1、环境配置" class="headerlink" title="1.1、环境配置"></a>1.1、环境配置</h2><p>JDK8, Maven3.3.9, MySQL8.0.12, Tomcat8, Eclipse</p>
<hr>
<h2 id="1-2、创建-Maven-project-的步骤"><a href="#1-2、创建-Maven-project-的步骤" class="headerlink" title="1.2、创建 Maven project 的步骤"></a>1.2、创建 Maven project 的步骤</h2><ol>
<li>选择 maven-archetype-webapp 类型。</li>
<li>输入项目名称。</li>
<li>引入 tomcat 的一个 jar 包。选择项目&gt;属性&gt;Java Build Path&gt;Libraries&gt;Add Library&gt;Server Runtime&gt;Apache Tomcat v8.0。</li>
<li>修改 pom.xml 的 JRE 版本为 1.8，再 updata 项目。</li>
</ol>
<pre><code class="hljs xml">    <span class="hljs-tag">&lt;<span class="hljs-name">finalName</span>&gt;</span>o2o<span class="hljs-tag">&lt;/<span class="hljs-name">finalName</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
            	<span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span>
            	<span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
            	<span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
language-xml复制代码</code></pre>

<ol>
<li>创建一个 maven 结构的文件夹,并修改属性。创建 src&#x2F;test&#x2F;resources 文件夹，并修改工程属性&gt;Java Build Path&gt; Source &gt; resources 的 output 属性。</li>
<li>修改 Dynamic Web Module 的版本，提高性能。查看,项目属性&gt;Project Facetes；修改, vim “projectsrc”&#x2F;.settings&#x2F;org.eclipse.wst.common.project.facet.core.xml；修改, jst.web 的 version。</li>
<li>修改 web.xml 的规范头(因为 DWM 版本提高了)。</li>
</ol>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="hljs-tag">    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span>
<span class="hljs-tag">    <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;3.1&quot;</span> <span class="hljs-attr">metadata-complete</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>
language-xml复制代码</code></pre>

<ol>
<li>运行项目。在 Tomcat 中 add 项目；再 Tomcat 中 clean 项目；start 项目.</li>
<li>在 web.xml 指定默认的页面。</li>
</ol>
<pre><code class="hljs xml">  <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file-list</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>index.js<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>index.html<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file-list</span>&gt;</span>
language-xml复制代码</code></pre>

<hr>
<h1 id="第二章-系统功能模块"><a href="#第二章-系统功能模块" class="headerlink" title="第二章 系统功能模块"></a>第二章 系统功能模块</h1><h2 id="2-1、模块功能说明"><a href="#2-1、模块功能说明" class="headerlink" title="2.1、模块功能说明"></a>2.1、模块功能说明</h2><h4 id="2-1-1、前端展示系统"><a href="#2-1-1、前端展示系统" class="headerlink" title="2.1.1、前端展示系统"></a>2.1.1、前端展示系统</h4><ol>
<li>头条展示</li>
<li>店铺类别展示</li>
<li>区域展示</li>
<li>店铺（列表展示，查询，详情）</li>
<li>商品（列表展示，查询，详情）</li>
</ol>
<hr>
<h4 id="2-1-2、店家系统"><a href="#2-1-2、店家系统" class="headerlink" title="2.1.2、店家系统"></a>2.1.2、店家系统</h4><ol>
<li>Local 账号维护</li>
<li>微信账号维护</li>
<li>店铺信息维护</li>
<li>权限验证</li>
<li>商品类别维护</li>
</ol>
<hr>
<h4 id="2-1-3、超级管理员系统"><a href="#2-1-3、超级管理员系统" class="headerlink" title="2.1.3、超级管理员系统"></a>2.1.3、超级管理员系统</h4><ol>
<li>头条信息维护</li>
<li>店铺类别信息维护</li>
<li>区域信息维护</li>
<li>权限验证</li>
<li>店铺管理</li>
<li>用户管理</li>
</ol>
<hr>
<h2 id="2-2、模块功能对象"><a href="#2-2、模块功能对象" class="headerlink" title="2.2、模块功能对象"></a>2.2、模块功能对象</h2><h4 id="2-2-1、实体类关系图"><a href="#2-2-1、实体类关系图" class="headerlink" title="2.2.1、实体类关系图"></a>2.2.1、实体类关系图</h4><hr>
<h4 id="2-2-2、实体类代码"><a href="#2-2-2、实体类代码" class="headerlink" title="2.2.2、实体类代码"></a>2.2.2、实体类代码</h4><ol>
<li>区域</li>
<li>用户信息</li>
<li>微信账号</li>
<li>本地账号</li>
<li>头条</li>
<li>店铺类别</li>
<li>店铺</li>
<li>商品</li>
<li>详情图片</li>
<li>商品类别</li>
</ol>
<hr>
<h2 id="2-3、代码实现"><a href="#2-3、代码实现" class="headerlink" title="2.3、代码实现"></a>2.3、代码实现</h2><h4 id="2-3-1、创建相应的类"><a href="#2-3-1、创建相应的类" class="headerlink" title="2.3.1、创建相应的类"></a>2.3.1、创建相应的类</h4><h4 id="2-3-2、创建数据库表"><a href="#2-3-2、创建数据库表" class="headerlink" title="2.3.2、创建数据库表"></a>2.3.2、创建数据库表</h4><hr>
<h1 id="第三章-项目配置"><a href="#第三章-项目配置" class="headerlink" title="第三章 项目配置"></a>第三章 项目配置</h1><h2 id="3-1、-项目目录说明"><a href="#3-1、-项目目录说明" class="headerlink" title="3.1、 项目目录说明"></a>3.1、 项目目录说明</h2><ol>
<li>src&#x2F;main&#x2F;java:业务代码</li>
<li>src&#x2F;main&#x2F;resources:项目资源文件.例如:spring, mapper 等。</li>
<li>src&#x2F;test&#x2F;java:单元测试代码</li>
<li>src&#x2F;test&#x2F;resources:单元测试的配置文件:</li>
<li>src&#x2F;main&#x2F;webapp:存放前端的静态资源。例如 jsp,html,js,css 等</li>
<li>src&#x2F;main&#x2F;webapp&#x2F;resources:静态资源文件。例如 js,css,img</li>
<li>src&#x2F;main&#x2F;webapp&#x2F;WEB-INF:外部浏览器无法访问的目录</li>
<li>src&#x2F;main&#x2F;webapp&#x2F;WEB-INF&#x2F;web.xml:用于初始化配置信息。例如 welcoml page,初始化 sevlet,servlet mapper</li>
<li>target:存放项目构建后的文件和目录，jar,war,编译的 class 文件等。</li>
</ol>
<hr>
<h2 id="3-2、创建-sources-资源包"><a href="#3-2、创建-sources-资源包" class="headerlink" title="3.2、创建 sources 资源包"></a>3.2、创建 sources 资源包</h2><ol>
<li>src&#x2F;main&#x2F;resources&#x2F;spring:存放 spring 相关的配置信息</li>
<li>src&#x2F;main&#x2F;resources&#x2F;mapper:存放 dao 中每个方法对应的 service,不需要写 dao 的实现类,由 mybatis 自动实现,日志配置文件。</li>
</ol>
<hr>
<h2 id="3-3、创建-package"><a href="#3-3、创建-package" class="headerlink" title="3.3、创建 package"></a>3.3、创建 package</h2><ol>
<li>com.imooc.o2o.entity:实体类包</li>
<li>com.imooc.o2o.web:controller 层，存放 controller 控制器</li>
<li>com.imooc.o2o.service:业务逻辑层，</li>
<li>com.imooc.o2o.service.impl:业务逻辑层的实现</li>
<li>com.imooc.o2o.dao:dao 层，与数据库打交道，存放数据库的操作，也可以是文件的对象操作或者缓存等。与数据相关的操作。</li>
<li>com.imooc.o2o.dto:弥补 entity 的不足，例如 entity&#x2F;Product 需要返回一个商品列表和是否返回成功地标识，那这个时候就 7. 需要 dto 进行二次封装，流入 status,productlist</li>
<li>com.imooc.o2o.enums:枚举</li>
<li>com.imooc.o2o.intercaptor:拦截器代码</li>
<li>com.imooc.o2o.util:通用工具类</li>
</ol>
<hr>
<h2 id="3-4、项目配置"><a href="#3-4、项目配置" class="headerlink" title="3.4、项目配置"></a>3.4、项目配置</h2><h4 id="3-4-1、配置思路：自下而上的配置。"><a href="#3-4-1、配置思路：自下而上的配置。" class="headerlink" title="3.4.1、配置思路：自下而上的配置。"></a>3.4.1、配置思路：自下而上的配置。</h4><ol>
<li>在 pom.xml 指定项目所需要的 jar 包；</li>
<li>在 jdbc.properties 指定数据库的连接方式和创建 mybatis-config.xml 对 mybatis 进行配置；</li>
<li>创建 spring-dao.xml 将 jdbc.proerties 和 mybatis-config.xml 加载进来了并创建连接池同时配置好 mybatis 和数据库交互的方式；</li>
<li>创建 spring-service.xml 做事务管理，将 spring 在 dao 层配置好的 dataSource 连接池给注入到事务管理器中，便于 service 层做操作；</li>
<li>创建 spring-web.xmlding 定义 controller 的行为；</li>
<li>在 web.xml 将 spring-dispatcher 当做一个 servlet 注册到里面去来相应请求，同时将 spring-*.xml 的配置文件注册进来整合在一起。</li>
</ol>
<hr>
<h4 id="3-4-2、依赖管理"><a href="#3-4-2、依赖管理" class="headerlink" title="3.4.2、依赖管理"></a>3.4.2、依赖管理</h4><ol>
<li>Maven jar <a target="_blank" rel="noopener" href="https://mvnrepository.com/">链接</a></li>
<li>pom.xml</li>
</ol>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.imooc<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>o2o<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>o2o Maven Webapp<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://maven.apache.org<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">spring.version</span>&gt;</span>4.3.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">spring.version</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
  	<span class="hljs-comment">&lt;!-- 测试相关的jar包 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 作用于test环境 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 日志相关的jar包 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- Spring --&gt;</span>
	<span class="hljs-comment">&lt;!-- 1）包含Spring 框架基本的核心工具类。Spring 其他组件都要使用到这个包里的类，是其他组件的基本核心 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.3.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	    <span class="hljs-comment">&lt;!-- &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; --&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 2）这个jar 文件是所有应用都要使用的，它包含访问配置文件，创建和管理bean 以及进行Inversion of Context</span>
<span class="hljs-comment">		/ Dependency Injection（Ioc/DI）操作相关的所有类。如果应用只需基本的Ioc/DI支持，引入spring-core及spring-beans.jar文件就可以了 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-beans<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 3）这个jar 文件为Spring 核心提供了大量拓展。可以找到使用Spring ApplicationContext 特效时所需的全部</span>
<span class="hljs-comment">		所需的全部类，instrumentation 组件以及校验Validation 方面的相关类。 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.3.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 4）这个jar 文件包含对SPring 对JDBC 数据访问进行封装的所有类。 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.3.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 5）为JDBC、Hibernate、JDO、JPA 等提供的一致性的声明式和编程式事务管理。 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-tx<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.3.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 6）Spring web 包含Web 应用开发时，用到Spring 框架时所需的核心类，包括自动载入WebApplicationContext</span>
<span class="hljs-comment">		 文件上传的支持类，filter类，和大量的工作辅助类--&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.3.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 7）包含Spring MVC框架相关的所有类。dispathservlet --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.3.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 8）Spring test 对Junit 等测试框架的简单封装 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.3.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- Servlet web --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- json解析 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.8.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- Map工具类 对标准java Collection的扩展 spring-core.jar需commons-collections.jar --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- DAO:MyBatis --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 数据库，支持JDBC --&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 链接池 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>c3p0<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>c3p0<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9.1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">finalName</span>&gt;</span>o2o<span class="hljs-tag">&lt;/<span class="hljs-name">finalName</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
language-xml复制代码</code></pre>

<hr>
<h4 id="3-4-3、-数据库的配置操作"><a href="#3-4-3、-数据库的配置操作" class="headerlink" title="3.4.3、 数据库的配置操作"></a>3.4.3、 数据库的配置操作</h4><ol>
<li>创建 src&#x2F;main&#x2F;resources&#x2F;jdbc.properties</li>
</ol>
<pre><code class="hljs properties"><span class="hljs-attr">jdbc.driver</span>=<span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
<span class="hljs-attr">jdbc.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/o2o?useUnicode=true&amp;characterEncoding=utf8&amp;verifyServerCertificate=false&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span>
<span class="hljs-attr">jdbc.username</span>=<span class="hljs-string">root</span>
<span class="hljs-attr">jdbc.password</span>=<span class="hljs-string">&quot;密码&quot;</span>
<span class="hljs-attr">language-properties复制代码</span></code></pre>

<ol>
<li>配置 src&#x2F;main&#x2F;resources&#x2F;mybatis-config.xml</li>
</ol>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">configuration</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 配置全局属性 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 使用jdbc多的getGeneratedKeys获取数据库自增主键值 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;useGeneratedKeys&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span>

        <span class="hljs-comment">&lt;!-- 使用列标签替换列别名 默认:true--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;useColumnLabel&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 开启驼峰命名转换：Table&#123;create_time&#125; -&gt; Entity&#123;createTime&#125;  --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
language-xml复制代码</code></pre>

<hr>
<h4 id="3-4-4、-Spring-相关配置"><a href="#3-4-4、-Spring-相关配置" class="headerlink" title="3.4.4、 Spring 相关配置"></a>3.4.4、 Spring 相关配置</h4><ol>
<li>Dao 层: src&#x2F;main&#x2F;resources&#x2F;spring&#x2F;spring-dao.xml</li>
</ol>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span>
<span class="hljs-tag">	<span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span>
<span class="hljs-tag">	<span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span>
<span class="hljs-string"><span class="hljs-tag">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span>
<span class="hljs-string"><span class="hljs-tag">    http://www.springframework.org/schema/context</span></span>
<span class="hljs-string"><span class="hljs-tag">    http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 配置整合mybatis过程 --&gt;</span>
	<span class="hljs-comment">&lt;!-- 1.配置数据库相关参数properties的属性：$&#123;url&#125; --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;classpath:jdbc.properties&quot;</span> /&gt;</span>

	<span class="hljs-comment">&lt;!-- 2.数据库连接池 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span>
		<span class="hljs-comment">&lt;!-- 配置连接池属性 --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driverClass&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.driver&#125;&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jdbcUrl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span>
		<span class="hljs-comment">&lt;!-- c3p0连接池的私有属性 --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;maxPoolSize&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;30&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;minPoolSize&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;10&quot;</span> /&gt;</span>
		<span class="hljs-comment">&lt;!-- 关闭连接后不自动commit --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;autoCommitOnClose&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;false&quot;</span> /&gt;</span>
		<span class="hljs-comment">&lt;!-- 获取连接超时时间 --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;checkoutTimeout&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;10000&quot;</span> /&gt;</span>
		<span class="hljs-comment">&lt;!-- 当获取连接失败重试次数 --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;acquireRetryAttempts&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;2&quot;</span> /&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

	<span class="hljs-comment">&lt;!-- 3.配置SqlSessionFactory对象,用于创建数据库连接池的对象 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sqlSessionFactory&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span>
		<span class="hljs-comment">&lt;!-- 注入数据库连接池 --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span> /&gt;</span>
		<span class="hljs-comment">&lt;!-- 配置MyBaties全局配置文件:mybatis-config.xml --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;configLocation&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;classpath:mybatis-config.xml&quot;</span> /&gt;</span>
		<span class="hljs-comment">&lt;!-- 扫描entity包 使用别名 --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;typeAliasesPackage&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.imooc.o2o.entity&quot;</span> /&gt;</span>
		<span class="hljs-comment">&lt;!-- 扫描sql配置文件:mapper需要的xml文件 --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mapperLocations&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;classpath:mapper/*.xml&quot;</span> /&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

	<span class="hljs-comment">&lt;!-- 4.配置扫描Dao接口包，动态实现Dao接口，注入到spring容器中 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span>
		<span class="hljs-comment">&lt;!-- 注入sqlSessionFactory --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;sqlSessionFactory&quot;</span> /&gt;</span>
		<span class="hljs-comment">&lt;!-- 给出需要扫描Dao接口包 --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;basePackage&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.imooc.o2o.dao&quot;</span> /&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span>
language-xml复制代码</code></pre>

<ol>
<li>Service 层: src&#x2F;main&#x2F;resources&#x2F;spring&#x2F;spring-service.xml</li>
</ol>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span>
<span class="hljs-tag">    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="hljs-tag">    <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span>
<span class="hljs-tag">    <span class="hljs-attr">xmlns:tx</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/tx&quot;</span></span>
<span class="hljs-tag">    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span>
<span class="hljs-string"><span class="hljs-tag">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span>
<span class="hljs-string"><span class="hljs-tag">    http://www.springframework.org/schema/context</span></span>
<span class="hljs-string"><span class="hljs-tag">    http://www.springframework.org/schema/context/spring-context.xsd</span></span>
<span class="hljs-string"><span class="hljs-tag">    http://www.springframework.org/schema/tx</span></span>
<span class="hljs-string"><span class="hljs-tag">    http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 扫描service包下所有使用注解的类型 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.imooc.o2o.service&quot;</span> /&gt;</span>

    <span class="hljs-comment">&lt;!-- 配置事务管理器,事务原子性等 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;transactionManager&quot;</span></span>
<span class="hljs-tag">        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 注入数据库连接池 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 配置基于注解的声明式事务 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tx:annotation-driven</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;transactionManager&quot;</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span>
language-xml复制代码</code></pre>

<ol>
<li>Web 层: src&#x2F;main&#x2F;resources&#x2F;spring&#x2F;spring-web.xml</li>
</ol>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span>
<span class="hljs-tag">	<span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="hljs-tag">	<span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span>
<span class="hljs-tag">	<span class="hljs-attr">xmlns:mvc</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span>
<span class="hljs-tag">	<span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span>
<span class="hljs-string"><span class="hljs-tag">	http://www.springframework.org/schema/beans/spring-beans.xsd</span></span>
<span class="hljs-string"><span class="hljs-tag">	http://www.springframework.org/schema/context</span></span>
<span class="hljs-string"><span class="hljs-tag">	http://www.springframework.org/schema/context/spring-context.xsd</span></span>
<span class="hljs-string"><span class="hljs-tag">	http://www.springframework.org/schema/mvc</span></span>
<span class="hljs-string"><span class="hljs-tag">	http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd&quot;</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- HandlerMapping 无需配置，SpringMVC可以默认启动，DefaultAnnotationHandlerMapping annotation-driven HandlerMapping --&gt;</span>
	<span class="hljs-comment">&lt;!-- 配置SpringMVC --&gt;</span>
	<span class="hljs-comment">&lt;!-- 1.开启SpringMVC注解模式 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>/&gt;</span>

	<span class="hljs-comment">&lt;!-- 2.静态资源默认servlet配置 (1)加入对静态资源的处理：js,gif,png (2)允许使用&quot;/&quot;做整体映射 , 不会拦截，当为静态资源。 这两个都是处理静态资源的，区别可以理解成一个是指定一个自定义的serlvet来专门处理相应的静态资源，如果不指定 会默认找default名字的servlet 而&lt;mvc:resources&gt;的好处可以理解成是静态资源可以在我们项目中的任意位置配置，只需要将对应的位置声明即可 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/resources/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/resources/&quot;</span>/&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">mvc:default-servlet-handler</span>/&gt;</span>

	<span class="hljs-comment">&lt;!-- 3.定义视图解析器 --&gt;</span>
	<span class="hljs-comment">&lt;!-- ViewResolver:视图解析器。可以配置多个 但是一定要将这个ViewResolver(InternalResourceViewResolver) 放到最后 --&gt;</span>
	<span class="hljs-comment">&lt;!-- 解析json格式的传参和封装数据到页面，注意spring的版本和对应的配置方式 --&gt;</span>
	<span class="hljs-comment">&lt;!-- spring-4.2以后 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;viewResolver&quot;</span></span>
<span class="hljs-tag">		<span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;prefix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/WEB-INF/html/&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;suffix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;.html&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

	<span class="hljs-comment">&lt;!-- 4.扫描web相关的bean --&gt;</span>
	<span class="hljs-comment">&lt;!-- 激活组件扫描功能,扫描aop的相关组件组件 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.imooc.o2o.web&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span>
language-xml复制代码</code></pre>

<ol>
<li>将 sping 的配置整合在一起，web.xml</li>
</ol>
<pre><code class="hljs xml"> <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>spring-dispatcher<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>classpath:spring/spring-*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
  	<span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>spring-dispatcher<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>
  	<span class="hljs-comment">&lt;!-- 默认匹配所有的请求 --&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span>
language-xml复制代码</code></pre>

<hr>
<h2 id="3-5-logback-日志配置"><a href="#3-5-logback-日志配置" class="headerlink" title="3.5 logback 日志配置"></a>3.5 logback 日志配置</h2><ol>
<li>src&#x2F;main&#x2F;resources&#x2F;logback.xml</li>
</ol>
<pre><code class="hljs dust"><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span> <span class="hljs-attr">scan</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">scanPeriod</span>=<span class="hljs-string">&quot;60 seconds&quot;</span></span></span>
<span class="hljs-tag"><span class="language-xml">	<span class="hljs-attr">debug</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span></span>
<span class="language-xml">	<span class="hljs-comment">&lt;!-- 定义参数常liang --&gt;</span></span>
<span class="language-xml">	<span class="hljs-comment">&lt;!-- TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR --&gt;</span></span>
<span class="language-xml">	<span class="hljs-comment">&lt;!-- 常用 DEBUG、INFO 和 ERROR 就可以了 --&gt;</span></span>
<span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;log.level&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;debug&quot;</span>/&gt;</span></span>
<span class="language-xml">	<span class="hljs-comment">&lt;!-- 文件保留时间 --&gt;</span></span>
<span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;log.maxHistory&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;30&quot;</span> /&gt;</span></span>
<span class="language-xml">	<span class="hljs-comment">&lt;!-- 日志存储的位置 --&gt;</span></span>
<span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;log.filePath&quot;</span></span></span>
<span class="hljs-tag"><span class="language-xml">		<span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;catalina.base&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">/logs/webapps&quot;</span> /&gt;</span></span>
<span class="language-xml">	<span class="hljs-comment">&lt;!-- 日志格式：时间 线程 级别 那个类输出的日志信息 换行 --&gt;</span></span>
<span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;log.pattern&quot;</span></span></span>
<span class="hljs-tag"><span class="language-xml">		<span class="hljs-attr">value</span>=<span class="hljs-string">&quot;%d</span></span></span><span class="hljs-template-variable">&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string"> [%thread] %-5level %logger</span></span></span><span class="hljs-template-variable">&#123;55&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string"> - %msg%n&quot;</span>/&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml">	<span class="hljs-comment">&lt;!-- 输出到控制台的。日志输出媒介，控制台输出 --&gt;</span></span>
<span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;consoleAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;log.pattern&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span></span>
<span class="language-xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml">	<span class="hljs-comment">&lt;!-- 以下是输出日志文件的 --&gt;</span></span>
<span class="language-xml">	<span class="hljs-comment">&lt;!-- DEBUG --&gt;</span></span>
<span class="language-xml">	<span class="hljs-comment">&lt;!-- 滚动日志 --&gt;</span></span>
<span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;debugAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-comment">&lt;!-- 文件路径 --&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;log.filePath&#125;</span><span class="language-xml">/debug.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-comment">&lt;!-- 基于时间滚动，按天 --&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-comment">&lt;!-- 文件名称,在log.filePath路径下生产以 debug.日期.log.gz结尾的文件 --&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;log.filePath&#125;</span><span class="language-xml">/debug/debug.%d</span><span class="hljs-template-variable">&#123;yyyy-MM-dd&#125;</span><span class="language-xml">.log.gz<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-comment">&lt;!-- 文件最大保存数量，轮询 --&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;log.maxHistory&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-comment">&lt;!-- 将日志信息转化为字符串，将字符串输出到文件里 --&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;log.pattern&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-comment">&lt;!-- 过滤器：过滤不是 debug.level的日志 --&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>DEBUG<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-comment">&lt;!-- 如何时debug日志就记录下来 --&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-comment">&lt;!-- 如果不是debug日志就否定掉 --&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span></span>
<span class="language-xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml">	<span class="hljs-comment">&lt;!-- INFO --&gt;</span></span>
<span class="language-xml">	<span class="hljs-comment">&lt;!-- 文件滚动日志 --&gt;</span></span>
<span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;infoAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-comment">&lt;!-- 文件路径 --&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;log.filePath&#125;</span><span class="language-xml">/info.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-comment">&lt;!-- 上面写满了，就使用下面的滚动文件 --&gt;</span></span>
<span class="language-xml">		<span class="hljs-comment">&lt;!-- 基于时间滚动，按天 --&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-comment">&lt;!-- 文件名称,在log.filePath路径下生产以 debug.日期.log.gz结尾的文件 --&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;log.filePath&#125;</span><span class="language-xml">/info/info.%d</span><span class="hljs-template-variable">&#123;yyyy-MM-dd&#125;</span><span class="language-xml">.log.gz<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-comment">&lt;!-- 文件最大保存数量，轮询 --&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;log.maxHistory&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-comment">&lt;!-- 将日志信息转化为字符串，将字符串输出到文件里 --&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;log.pattern&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-comment">&lt;!-- 过滤器：过滤不是 debug.level的日志 --&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>INFO<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-comment">&lt;!-- 如何时debug日志就记录下来 --&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-comment">&lt;!-- 如果不是debug日志就否定掉 --&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span></span>
<span class="language-xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml">	<span class="hljs-comment">&lt;!-- ERROR --&gt;</span></span>
<span class="language-xml">	<span class="hljs-comment">&lt;!-- 文件滚动日志 --&gt;</span></span>
<span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;errorAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-comment">&lt;!-- 文件路径 --&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;log.filePath&#125;</span><span class="language-xml">/error.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-comment">&lt;!-- 上面写满了，就使用下面的滚动文件 --&gt;</span></span>
<span class="language-xml">		<span class="hljs-comment">&lt;!-- 基于时间滚动，按天 --&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-comment">&lt;!-- 文件名称,在log.filePath路径下生产以 debug.日期.log.gz结尾的文件 --&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;log.filePath&#125;</span><span class="language-xml">/error/error.%d</span><span class="hljs-template-variable">&#123;yyyy-MM-dd&#125;</span><span class="language-xml">.log.gz<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-comment">&lt;!-- 文件最大保存数量，轮询 --&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;log.maxHistory&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-comment">&lt;!-- 将日志信息转化为字符串，将字符串输出到文件里 --&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;log.pattern&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-comment">&lt;!-- 过滤器：过滤不是 debug.level的日志 --&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>ERROR<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-comment">&lt;!-- 如何时debug日志就记录下来 --&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span></span>
<span class="language-xml">			<span class="hljs-comment">&lt;!-- 如果不是debug日志就否定掉 --&gt;</span></span>
<span class="language-xml">			<span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span></span>
<span class="language-xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml"></span>
<span class="language-xml">	<span class="hljs-comment">&lt;!-- 告诉logback 需要关注那个包下面的信息 只记录那个日记级别的信息 additivity(将root日志的信息也放在这个 logger 里面来)  --&gt;</span></span>
<span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.imooc.o2o&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;log.level&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-comment">&lt;!-- 绑定 appender, 往这个鞋appender输出信息 --&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;debugAppender&quot;</span>/&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;infoAppender&quot;</span>/&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;errorAppender&quot;</span>/&gt;</span></span>
<span class="language-xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">logger</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml">	<span class="hljs-comment">&lt;!-- 根 root, 如果没有指定 level 会继承 root 的level --&gt;</span></span>
<span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span></span>
<span class="language-xml">		<span class="hljs-comment">&lt;!-- 往下面的 consoleAppender 输出信息 --&gt;</span></span>
<span class="language-xml">		<span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;consoleAppender&quot;</span>/&gt;</span></span>
<span class="language-xml">	<span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></span>
<span class="language-xml">复制代码</span></code></pre>

<hr>
<h1 id="第四章-代码实现"><a href="#第四章-代码实现" class="headerlink" title="第四章 代码实现"></a>第四章 代码实现</h1><h2 id="4-1、简单的-SSM-案例-Area"><a href="#4-1、简单的-SSM-案例-Area" class="headerlink" title="4.1、简单的 SSM 案例-Area"></a>4.1、简单的 SSM 案例-Area</h2><h4 id="4-1-1、dao-层"><a href="#4-1-1、dao-层" class="headerlink" title="4.1.1、dao 层"></a>4.1.1、dao 层</h4><ol>
<li>在 dao 层创建一个 AreaDao 接口，代码如下</li>
</ol>
<pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.imooc.o2o.dao;

<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> com.imooc.o2o.entity.Area;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AreaDao</span> &#123;
	<span class="hljs-comment">/**</span>
<span class="hljs-comment">	 * 列出区域列表</span>
<span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> areaList</span>
<span class="hljs-comment">	 */</span>
	List&lt;Area&gt; <span class="hljs-title function_">queryArea</span><span class="hljs-params">()</span>;
&#125;
language-Java复制代码</code></pre>

<hr>
<ol>
<li>在 mapper 配置，创建 AreaDao.xml, 代码如下</li>
</ol>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.imooc.o2o.dao.AreaDao&quot;</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryArea&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.imooc.o2o.entity.Area&quot;</span>&gt;</span>
		SELECT
		area_id,area_name,priority,create_time,last_edit_time
		FROM tb_area
		ORDER BY priority DESC
	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
language-xml复制代码</code></pre>

<hr>
<ol>
<li>dao 层单元测试，com.imooc.o2o.dao</li>
</ol>
<ul>
<li>BaseTest.java 基类，初始化 spring 的配置</li>
</ul>
<pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.imooc.o2o;

<span class="hljs-keyword">import</span> org.junit.runner.RunWith;
<span class="hljs-keyword">import</span> org.springframework.test.context.ContextConfiguration;
<span class="hljs-keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 初始化spring和junit整合，junit启动时加载springIOC容器</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> jxh</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@RunWith(SpringJUnit4ClassRunner.class)</span>
<span class="hljs-comment">// 告诉Junit spring配置文件的位置</span>
<span class="hljs-meta">@ContextConfiguration(&#123;&quot;classpath:spring/spring-dao.xml&quot;, &quot;classpath:spring/spring-service.xml&quot;&#125;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseTest</span> &#123;

&#125;
language-Java复制代码</code></pre>

<ul>
<li>测试类</li>
</ul>
<pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.imooc.o2o.dao;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.junit.Assert.assertEquals;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> org.junit.Test;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> com.imooc.o2o.BaseTest;
<span class="hljs-keyword">import</span> com.imooc.o2o.entity.Area;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AreaDaoTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTest</span> &#123;
	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> AreaDao areaDao;

	<span class="hljs-meta">@Test</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testQueryArea</span><span class="hljs-params">()</span> &#123;
		List&lt;Area&gt; areaList = areaDao.queryArea();
		assertEquals(<span class="hljs-number">2</span>, areaList.size());
	&#125;
&#125;
language-Java复制代码</code></pre>

<hr>
<h4 id="4-1-2、Service-层"><a href="#4-1-2、Service-层" class="headerlink" title="4.1.2、Service 层"></a>4.1.2、Service 层</h4><ol>
<li>service AreaService.java 接口类</li>
</ol>
<pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.imooc.o2o.service;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">import</span> com.imooc.o2o.entity.Area;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AreaService</span> &#123;
	List&lt;Area&gt; <span class="hljs-title function_">getAreaList</span><span class="hljs-params">()</span>;
&#125;
language-Java复制代码</code></pre>

<ol>
<li>service.impl AreaServiceImpl.java 实现类</li>
</ol>
<pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.imooc.o2o.service.impi;

<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> com.imooc.o2o.dao.AreaDao;
<span class="hljs-keyword">import</span> com.imooc.o2o.entity.Area;
<span class="hljs-keyword">import</span> com.imooc.o2o.service.AreaService;

<span class="hljs-meta">@Service</span> <span class="hljs-comment">// Spring IOC 托管</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AreaServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AreaService</span> &#123;

	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> AreaDao areaDao;

	<span class="hljs-meta">@Override</span>
	<span class="hljs-keyword">public</span> List&lt;Area&gt; <span class="hljs-title function_">getAreaList</span><span class="hljs-params">()</span> &#123; <span class="hljs-comment">// 从数据库取出数据</span>
		<span class="hljs-keyword">return</span> areaDao.queryArea();
	&#125;
&#125;
language-Java复制代码</code></pre>

<ol>
<li>service 层单元测试</li>
</ol>
<ul>
<li>AreaServiceTest.java 代码</li>
</ul>
<pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.imooc.o2o.service;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.junit.Assert.assertEquals;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> org.junit.Test;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> com.imooc.o2o.BaseTest;
<span class="hljs-keyword">import</span> com.imooc.o2o.entity.Area;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AreaServiceTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTest</span> &#123;
	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> AreaService areaService;

	<span class="hljs-meta">@Test</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGetArealist</span><span class="hljs-params">()</span> &#123;
		List&lt;Area&gt; areaList = areaService.getAreaList();
		assertEquals(<span class="hljs-string">&quot;西苑&quot;</span>, areaList.get(<span class="hljs-number">0</span>).getAreaName());
	&#125;
&#125;
language-Java复制代码</code></pre>

<h4 id="4-1-3、web-层"><a href="#4-1-3、web-层" class="headerlink" title="4.1.3、web 层"></a>4.1.3、web 层</h4><ol>
<li>AreaController.java</li>
</ol>
<pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.imooc.o2o.web.superadmin;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;
<span class="hljs-keyword">import</span> com.imooc.o2o.entity.Area;
<span class="hljs-keyword">import</span> com.imooc.o2o.service.AreaService;

<span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping(&quot;/superadmin&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AreaController</span> &#123;

	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> AreaService areaService;

	<span class="hljs-meta">@RequestMapping(value = &quot;/listarea&quot;, method = RequestMethod.GET)</span>
	<span class="hljs-meta">@ResponseBody</span>
	<span class="hljs-keyword">private</span> Map&lt;String, Object&gt; <span class="hljs-title function_">listArea</span><span class="hljs-params">()</span> &#123;
		Map&lt;String, Object&gt; modelMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Object&gt;();
		List&lt;Area&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Area&gt;();
		<span class="hljs-keyword">try</span> &#123;
			list = areaService.getAreaList();
			modelMap.put(<span class="hljs-string">&quot;rows&quot;</span>, list);
			modelMap.put(<span class="hljs-string">&quot;total&quot;</span>, list.size());
		&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
			e.printStackTrace();
			modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
			modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, e.toString());
		&#125;
		<span class="hljs-keyword">return</span> modelMap;
	&#125;
&#125;
language-Java复制代码</code></pre>

<hr>
<hr>
<h1 id="第五章-店铺系统的实现"><a href="#第五章-店铺系统的实现" class="headerlink" title="第五章 店铺系统的实现"></a>第五章 店铺系统的实现</h1><h2 id="5-1、店铺的注册模块"><a href="#5-1、店铺的注册模块" class="headerlink" title="5.1、店铺的注册模块"></a>5.1、店铺的注册模块</h2><h4 id="5-1-1、dao-层代码"><a href="#5-1-1、dao-层代码" class="headerlink" title="5.1.1、dao 层代码"></a>5.1.1、dao 层代码</h4><ol>
<li>ShopDao.java 接口</li>
</ol>
<pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.imooc.o2o.dao;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ShopDao</span> &#123;
	<span class="hljs-comment">// 新增店铺，return 0 &amp; 1</span>
	<span class="hljs-type">int</span> <span class="hljs-title function_">insertShop</span><span class="hljs-params">(Shop shop)</span>;
	<span class="hljs-comment">// 更新店铺信息</span>
	<span class="hljs-type">int</span> <span class="hljs-title function_">updateShop</span><span class="hljs-params">(Shop shop)</span>;
&#125;
language-Java复制代码</code></pre>

<ol>
<li>mapper 的配置 ShopDao.xml</li>
</ol>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.imooc.o2o.dao.ShopDao&quot;</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 使用JDBC的getGeneratedKeys获取数据库自增主键值 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertShop&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span></span>
<span class="hljs-tag">		<span class="hljs-attr">keyColumn</span>=<span class="hljs-string">&quot;shop_id&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;shopId&quot;</span>&gt;</span>
		INSERT INTO
		tb_shop(owner_id,area_id,shop_category_id,shop_name,shop_desc,shop_addr,phone,shop_img,priority,create_time,last_edit_time,enable_status,advice)
		VALUES
		(#&#123;owner.userId&#125;,#&#123;area.areaId&#125;,#&#123;shopCategory.shopCategoryId&#125;,#&#123;shopName&#125;,#&#123;shopDesc&#125;,#&#123;shopAddr&#125;,#&#123;phone&#125;,#&#123;shopImg&#125;,#&#123;priority&#125;,#&#123;createTime&#125;,#&#123;lastEditTime&#125;,#&#123;enableStatus&#125;,#&#123;advice&#125;)
	<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- Mybatis支持动态SQ, set标签里面是动态的SQL语句，<span class="hljs-doctag">xxx:</span>是实体类的成员变量; xxx_<span class="hljs-doctag">xxx:</span>数据库表中的字段名,例如&lt;if test=&quot;xxx != null&quot;&gt;xxx_xxx=#&#123;xxx&#125;&lt;/if&gt; --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateShop&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.imooc.o2o.entity.Shop&quot;</span>&gt;</span>
		update tb_shop
		<span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;shopName != null&quot;</span>&gt;</span>shop_name=#&#123;shopName&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;shopDesc != null&quot;</span>&gt;</span>shop_desc=#&#123;shopDesc&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;shopAddr != null&quot;</span>&gt;</span>shop_addr=#&#123;shopAddr&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;phone != null&quot;</span>&gt;</span>phone=#&#123;phone&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;shopImg != null&quot;</span>&gt;</span>shop_img=#&#123;shopImg&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;priority != null&quot;</span>&gt;</span>priority=#&#123;priority&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;lastEditTime != null&quot;</span>&gt;</span>last_edit_time=#&#123;lastEditTime&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;enableStatus != null&quot;</span>&gt;</span>enable_status=#&#123;enableStatus&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;advice != null&quot;</span>&gt;</span>advice=#&#123;advice&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;area != null&quot;</span>&gt;</span>area_id = #&#123;area.areaId&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;shopCategory != null&quot;</span>&gt;</span>shop_category_id=#&#123;shopCategory.shopCategoryId&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span>
		where shop_id=#&#123;shopId&#125;
	<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
language-xml复制代码</code></pre>

<ol>
<li>单元测试</li>
</ol>
<pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.imooc.o2o.dao;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShopDaoTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTest</span> &#123;
	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> ShopDao shopDao;
	<span class="hljs-meta">@Test</span>
	<span class="hljs-comment">// @Ignore // 忽略当前方法的测试</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInsertShop</span><span class="hljs-params">()</span> &#123;
		<span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shop</span>();
		<span class="hljs-type">PersonInfo</span>  <span class="hljs-variable">owner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PersonInfo</span>();
		<span class="hljs-type">Area</span> <span class="hljs-variable">area</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Area</span>();
		<span class="hljs-type">ShopCategory</span> <span class="hljs-variable">shopCategory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShopCategory</span>();
		<span class="hljs-comment">// 由于该shop涉及其他表，所以给其他表设置了一些测试值，现在初始化这些值，才可以正常的添加店铺</span>
		owner.setUserId(<span class="hljs-number">1L</span>);
		area.setAreaId(<span class="hljs-number">2</span>);
		shopCategory.setShopCategoryId(<span class="hljs-number">1L</span>);
		shop.setOwner(owner);
		shop.setArea(area);
		shop.setShopCategory(shopCategory);
		shop.setShopName(<span class="hljs-string">&quot;测试的店铺&quot;</span>);
		shop.setShopDesc(<span class="hljs-string">&quot;test&quot;</span>);
		shop.setShopAddr(<span class="hljs-string">&quot;test&quot;</span>);
		shop.setPhone(<span class="hljs-string">&quot;test&quot;</span>);
		shop.setShopImg(<span class="hljs-string">&quot;test&quot;</span>);
		shop.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		shop.setEnableStatus(<span class="hljs-number">1</span>);
		shop.setAdvice(<span class="hljs-string">&quot;审核中&quot;</span>);
		<span class="hljs-comment">// 影响行数</span>
		<span class="hljs-type">int</span> <span class="hljs-variable">effectedNum</span> <span class="hljs-operator">=</span> shopDao.insertShop(shop);
		assertEquals(<span class="hljs-number">1</span>,effectedNum);
	&#125;
	<span class="hljs-meta">@Test</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testUpdateShop</span><span class="hljs-params">()</span> &#123;
		<span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shop</span>();
		<span class="hljs-comment">// 需要指定ID</span>
		shop.setShopId(<span class="hljs-number">1L</span>);
		<span class="hljs-type">PersonInfo</span>  <span class="hljs-variable">owner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PersonInfo</span>();
		<span class="hljs-type">Area</span> <span class="hljs-variable">area</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Area</span>();
		<span class="hljs-type">ShopCategory</span> <span class="hljs-variable">shopCategory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShopCategory</span>();
		<span class="hljs-comment">// 由于该shop涉及其他表，所以给其他表设置了一些测试值，现在初始化这些值，才可以正常的添加店铺</span>
		owner.setUserId(<span class="hljs-number">1L</span>);
		area.setAreaId(<span class="hljs-number">2</span>);
		shop.setShopDesc(<span class="hljs-string">&quot;测试描述&quot;</span>);
		shop.setShopAddr(<span class="hljs-string">&quot;测试地址&quot;</span>);
		shop.setLastEditTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		<span class="hljs-comment">// 影响行数</span>
		<span class="hljs-type">int</span> <span class="hljs-variable">effectedNum</span> <span class="hljs-operator">=</span> shopDao.updateShop(shop);
		assertEquals(<span class="hljs-number">1</span>,effectedNum);
	&#125;
&#125;
language-Java复制代码</code></pre>

<h4 id="5-1-2、service-层代码"><a href="#5-1-2、service-层代码" class="headerlink" title="5.1.2、service 层代码"></a>5.1.2、service 层代码</h4><ol>
<li>ShopService 接口，定义操作方法和返回值</li>
</ol>
<pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.imooc.o2o.service;

<span class="hljs-keyword">import</span> java.io.File;
<span class="hljs-keyword">import</span> com.imooc.o2o.dto.ShopExecution;
<span class="hljs-keyword">import</span> com.imooc.o2o.entity.Shop;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ShopService</span> &#123;
	ShopExecution <span class="hljs-title function_">addShop</span><span class="hljs-params">(Shop shop, File shopImg)</span>;
&#125;
language-Java复制代码</code></pre>

<ol>
<li>dto，对返回值进行二次封装，添加 status 等参数</li>
</ol>
<pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.imooc.o2o.dto;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShopExecution</span> &#123;
	<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> state; <span class="hljs-comment">// 结果状态</span>
	<span class="hljs-keyword">private</span> String stateInfo; <span class="hljs-comment">// 状态标识,接受 state的说明</span>
	<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> count; <span class="hljs-comment">// 店铺数量</span>
	<span class="hljs-keyword">private</span> Shop shop; <span class="hljs-comment">// 操作的shop (增删改店铺的时候用到)</span>
	<span class="hljs-keyword">private</span> List&lt;Shop&gt; shopList; <span class="hljs-comment">// shop列表(查询店铺列表的时候使用)</span>
	<span class="hljs-keyword">public</span> <span class="hljs-title function_">ShopExecution</span><span class="hljs-params">()</span> &#123;&#125;
	<span class="hljs-comment">// 店铺操作失败的时候使用的构造器</span>
	<span class="hljs-keyword">public</span> <span class="hljs-title function_">ShopExecution</span><span class="hljs-params">(ShopStateEnum stateEnum)</span> &#123;
		<span class="hljs-built_in">this</span>.state = stateEnum.getState();
		<span class="hljs-built_in">this</span>.stateInfo = stateEnum.getStateInfo();
	&#125;
	<span class="hljs-comment">// 店铺操作成功时使用的构造器，同时返回单个shop</span>
	<span class="hljs-keyword">public</span> <span class="hljs-title function_">ShopExecution</span><span class="hljs-params">(ShopStateEnum stateEnum, Shop shop)</span> &#123;
		<span class="hljs-built_in">this</span>.state = stateEnum.getState();
		<span class="hljs-built_in">this</span>.stateInfo = stateEnum.getStateInfo();
		<span class="hljs-built_in">this</span>.shop = shop;
	&#125;
	<span class="hljs-comment">// 店铺操作成功时使用的构造器，同时返回一个shop 列表</span>
	<span class="hljs-keyword">public</span> <span class="hljs-title function_">ShopExecution</span><span class="hljs-params">(ShopStateEnum stateEnum, List&lt;Shop&gt; shopList)</span> &#123;
		<span class="hljs-built_in">this</span>.state = stateEnum.getState();
		<span class="hljs-built_in">this</span>.stateInfo = stateEnum.getStateInfo();
		<span class="hljs-built_in">this</span>.shopList = shopList;
	&#125;
	<span class="hljs-comment">// Getter &amp; Setter</span>
&#125;
language-Java复制代码</code></pre>

<ol>
<li>Service 实现类</li>
</ol>
<pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.imooc.o2o.service.impi;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShopServicelmpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ShopService</span>&#123;
	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> ShopDao shopDao;
	<span class="hljs-meta">@Override</span>
	<span class="hljs-keyword">public</span> ShopExecution <span class="hljs-title function_">addShop</span><span class="hljs-params">(Shop shop, File shopImg)</span> &#123;
		<span class="hljs-keyword">if</span>(shop == <span class="hljs-literal">null</span>) &#123;
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShopExecution</span>(ShopStateEnum.NULL_SHOP);
		&#125;
		<span class="hljs-keyword">try</span> &#123;
			<span class="hljs-comment">// 给店铺信息赋初始值</span>
			shop.setEnableStatus(<span class="hljs-number">0</span>);
			shop.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
			shop.setLastEditTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
			<span class="hljs-comment">// 添加店铺信息</span>
			<span class="hljs-type">int</span> <span class="hljs-variable">effectedNum</span> <span class="hljs-operator">=</span> shopDao.insertShop(shop);
			<span class="hljs-keyword">if</span>(effectedNum &lt;= <span class="hljs-number">0</span>) &#123;
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShopOperationException</span>(<span class="hljs-string">&quot;店铺创建失败&quot;</span>);
			&#125;<span class="hljs-keyword">else</span> &#123;
				<span class="hljs-keyword">if</span>(shopImg != <span class="hljs-literal">null</span>) &#123;
					<span class="hljs-comment">// 存储图片</span>
					<span class="hljs-keyword">try</span> &#123;
						addShopImg(shop, shopImg);
					&#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;
						<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShopOperationException</span>(<span class="hljs-string">&quot;添加店铺图片失败：&quot;</span> + e.getMessage());
					&#125;
					<span class="hljs-comment">// 更新店铺的图片地址</span>
					effectedNum = shopDao.updateShop(shop);
					<span class="hljs-keyword">if</span>(effectedNum &lt;= <span class="hljs-number">0</span>) &#123;
						<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShopOperationException</span>(<span class="hljs-string">&quot;更新图片地址失败&quot;</span>);
					&#125;
				&#125;
			&#125;
		&#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShopOperationException</span>(<span class="hljs-string">&quot;addShop error:&quot;</span> + e.getMessage());
		&#125;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShopExecution</span>(ShopStateEnum.CHECK, shop);
	&#125;
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addShopImg</span><span class="hljs-params">(Shop shop, File shopImg)</span> &#123;
		<span class="hljs-comment">// TODO Auto-generated method stub</span>
		<span class="hljs-type">String</span> <span class="hljs-variable">dest</span> <span class="hljs-operator">=</span> PathUtil.getShopImagePath(shop.getShopId());
		<span class="hljs-type">String</span> <span class="hljs-variable">shopImgAddr</span> <span class="hljs-operator">=</span> ImageUtil.generateThumbnail(shopImg, dest);
		shop.setShopImg(shopImgAddr);
	&#125;
&#125;
language-Java复制代码</code></pre>

<ol>
<li>Service 层 单元测试</li>
</ol>
<pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.imooc.o2o.service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShopServiceTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTest</span> &#123;
	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> ShopService shopService;
	<span class="hljs-meta">@Test</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAddShop</span><span class="hljs-params">()</span> &#123;
		<span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shop</span>();
		<span class="hljs-type">PersonInfo</span>  <span class="hljs-variable">owner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PersonInfo</span>();
		<span class="hljs-type">Area</span> <span class="hljs-variable">area</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Area</span>();
		<span class="hljs-type">ShopCategory</span> <span class="hljs-variable">shopCategory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShopCategory</span>();
		<span class="hljs-comment">// 由于该shop涉及其他表，所以给其他表设置了一些测试值，现在初始化这些值，才可以正常的添加店铺</span>
		owner.setUserId(<span class="hljs-number">1L</span>);
		area.setAreaId(<span class="hljs-number">2</span>);
		shopCategory.setShopCategoryId(<span class="hljs-number">1L</span>);
		shop.setOwner(owner);
		shop.setArea(area);
		shop.setShopCategory(shopCategory);
		shop.setShopName(<span class="hljs-string">&quot;测试的店铺1&quot;</span>);
		shop.setShopDesc(<span class="hljs-string">&quot;test1&quot;</span>);
		shop.setShopAddr(<span class="hljs-string">&quot;test1&quot;</span>);
		shop.setPhone(<span class="hljs-string">&quot;test1&quot;</span>);
		shop.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		shop.setEnableStatus(ShopStateEnum.CHECK.getState()); <span class="hljs-comment">// 0</span>
		shop.setAdvice(<span class="hljs-string">&quot;审核中&quot;</span>);
		<span class="hljs-type">File</span> <span class="hljs-variable">shopImg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;/Users/jxh/Downloads/xiaohuangren.jpeg&quot;</span>);
		<span class="hljs-type">ShopExecution</span> <span class="hljs-variable">se</span> <span class="hljs-operator">=</span> shopService.addShop(shop,shopImg);
		assertEquals(ShopStateEnum.CHECK.getState(), se.getState());
	&#125;
&#125;
language-Java复制代码</code></pre>

<hr>
<h4 id="5-1-3、-Controller-层"><a href="#5-1-3、-Controller-层" class="headerlink" title="5.1.3、 Controller 层"></a>5.1.3、 Controller 层</h4><ol>
<li>ShopManagementController.java</li>
</ol>
<pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.imooc.o2o.web.shopadmin;

<span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping(&quot;/shopadmin&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShopManagementController</span> &#123;
	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> ShopService shopService;
	<span class="hljs-meta">@RequestMapping(value=&quot;/registershop&quot;, method = RequestMethod.POST)</span>
	<span class="hljs-meta">@ResponseBody</span>
	<span class="hljs-keyword">private</span> Map&lt;String, Object&gt; <span class="hljs-title function_">registerShop</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> ShopOperationException, IOException &#123;
		Map&lt;String, Object&gt; modelMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Object&gt;();

		<span class="hljs-comment">// 验证码</span>
		<span class="hljs-keyword">if</span>(!CodeUtil.checkVerifyCode(request)) &#123;
			modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
			modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, <span class="hljs-string">&quot;输入了错误的验证码&quot;</span>);
			<span class="hljs-keyword">return</span> modelMap;
		&#125;
		<span class="hljs-comment">// 1.接受并转化相应的参数，思路：获取前端传过来的店铺信息，将数据转换为实体类，同时获取前端传过来的文件流，将图片存放在shopImg里面去。</span>
		<span class="hljs-comment">// 使用工具类，将相应的参数转化为字符串</span>
		<span class="hljs-type">String</span> <span class="hljs-variable">shopStr</span> <span class="hljs-operator">=</span> HttpServletRequestUtil.getString(request, <span class="hljs-string">&quot;shopStr&quot;</span>);
		<span class="hljs-comment">// 使用 jackson-databind库 将字符串转化为实体类，JSON to POJO and back</span>
		<span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
		<span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
		<span class="hljs-keyword">try</span> &#123;
			shop = mapper.readValue(shopStr, Shop.class);
		&#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;
			modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
			modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, e.getMessage());
			<span class="hljs-keyword">return</span> modelMap;
		&#125;
		<span class="hljs-comment">// 获取前端文件流，保存上传图片的文件流</span>
		<span class="hljs-type">CommonsMultipartFile</span> <span class="hljs-variable">shopImg</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// 保存上传图片的文件流</span>
		<span class="hljs-comment">// 从 request session 的上下文获取相关文件上传的内容</span>
		<span class="hljs-type">CommonsMultipartResolver</span> <span class="hljs-variable">commmonsMultipartResolver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonsMultipartResolver</span>(
				request.getSession().getServletContext());
		<span class="hljs-keyword">if</span>(commmonsMultipartResolver.isMultipart(request)) &#123; <span class="hljs-comment">// 判断是否有上传的文件流</span>
			<span class="hljs-comment">// 如果有上传的文件流，就进行转换 MultipartHttpServletRequest 类型的对象，该对象可以被spring处理文件流对象</span>
			<span class="hljs-type">MultipartHttpServletRequest</span> <span class="hljs-variable">multipartHttpServletRequest</span> <span class="hljs-operator">=</span> (MultipartHttpServletRequest) request;
			<span class="hljs-comment">// 从该上传对象中提取出图片的文件流，（shopImg 是与前端协商的名称）</span>
			shopImg = (CommonsMultipartFile) multipartHttpServletRequest.getFile(<span class="hljs-string">&quot;shopImg&quot;</span>);
		&#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// 如果没有图片就报错，因为图片是必须的</span>
			modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
			modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, <span class="hljs-string">&quot;上传图片不能为空&quot;</span>);
			<span class="hljs-keyword">return</span> modelMap;
		&#125;
		<span class="hljs-comment">// 2.注册店铺</span>
		<span class="hljs-keyword">if</span>(shop != <span class="hljs-literal">null</span> &amp;&amp; shopImg != <span class="hljs-literal">null</span>) &#123;
			<span class="hljs-type">PersonInfo</span> <span class="hljs-variable">owner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PersonInfo</span>();
			owner.setUserId(<span class="hljs-number">1L</span>);
			shop.setOwner(owner);
			<span class="hljs-type">ShopExecution</span> <span class="hljs-variable">se</span> <span class="hljs-operator">=</span> shopService.addShop(shop, shopImg.getInputStream(), shopImg.getOriginalFilename());
			<span class="hljs-keyword">if</span>(se.getState() == ShopStateEnum.CHECK.getState()) &#123;
				modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">true</span>);
			&#125;<span class="hljs-keyword">else</span> &#123;
				modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
				modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, se.getStateInfo());
			&#125;
			<span class="hljs-keyword">return</span> modelMap;
		&#125; <span class="hljs-keyword">else</span> &#123;
			modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
			modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, <span class="hljs-string">&quot;请输入店铺信息&quot;</span>);
			<span class="hljs-keyword">return</span> modelMap;
		&#125;
	&#125;
&#125;
language-Java复制代码</code></pre>

<ol>
<li>kaptcha 验证码的使用</li>
</ol>
<ul>
<li>引入依赖</li>
</ul>
<pre><code class="hljs XML">	<span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.github.penggle/kaptcha --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.penggle<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>kaptcha<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
language-XML复制代码</code></pre>

<ul>
<li>web.xml 配置</li>
</ul>
<pre><code class="hljs xml">  <span class="hljs-comment">&lt;!-- 验证码配置 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>Kaptcha<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.google.code.kaptcha.servlet.KaptchaServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>
  	<span class="hljs-comment">&lt;!-- 是否有边框 --&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>kaptcha.border<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>no<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
  	<span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>
  	<span class="hljs-comment">&lt;!-- 字体颜色 --&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>kaptcha.textproducer.font.color<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>red<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
  	<span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>
  	<span class="hljs-comment">&lt;!-- 字体大小 --&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>kaptcha.textproducer.font.size<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>43<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
  	<span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>
  	 <span class="hljs-comment">&lt;!-- 字体样式 --&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>kaptcha.textproducer.font.names<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>Arial<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
  	<span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>
  	<span class="hljs-comment">&lt;!-- 图片宽度 --&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>kaptcha.image.width<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>135<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
  	<span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>
  	<span class="hljs-comment">&lt;!-- 图片高度 --&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>kaptcha.image.width<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>50<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
  	<span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>
  	<span class="hljs-comment">&lt;!-- 使用那些字符生产验证码 --&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>kaptcha.textproducer.char.string<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>ACDEFHKPRSTWX345679<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
  	<span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>
  	<span class="hljs-comment">&lt;!-- 干扰线的颜色 --&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>kaptcha.noise.color<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>black<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
  	<span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>
  	<span class="hljs-comment">&lt;!-- 验证码字符个数 --&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>kaptcha.textproducer.char.length<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
  		<span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
  	<span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>Kaptcha<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/Kaptcha<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span>
language-xml复制代码</code></pre>

<ul>
<li>判断验证码是否正确</li>
</ul>
<pre><code class="hljs JAVA"><span class="hljs-keyword">package</span> com.imooc.o2o.util;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CodeUtil</span> &#123;
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkVerifyCode</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;
		<span class="hljs-type">String</span> <span class="hljs-variable">verifyCodeExpected</span> <span class="hljs-operator">=</span> (String) request.getSession().getAttribute(com.google.code.kaptcha.Constants.KAPTCHA_SESSION_KEY);
		<span class="hljs-type">String</span> <span class="hljs-variable">verifyCodeActual</span> <span class="hljs-operator">=</span> HttpServletRequestUtil.getString(request, <span class="hljs-string">&quot;verifyCodeActual&quot;</span>);
		<span class="hljs-keyword">if</span>(verifyCodeActual == <span class="hljs-literal">null</span> || !verifyCodeActual.equals(verifyCodeExpected)) &#123;
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		&#125;
		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
	&#125;
&#125;
language-JAVA复制代码</code></pre>

<ul>
<li>举个栗子</li>
</ul>
<pre><code class="hljs Java"><span class="hljs-meta">@RequestMapping(value=&quot;/registershop&quot;, method = RequestMethod.POST)</span>
<span class="hljs-meta">@ResponseBody</span>
<span class="hljs-keyword">private</span> Map&lt;String, Object&gt; <span class="hljs-title function_">registerShop</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> ShopOperationException, IOException &#123;
	Map&lt;String, Object&gt; modelMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Object&gt;();
	<span class="hljs-comment">// 验证码</span>
	<span class="hljs-keyword">if</span>(!CodeUtil.checkVerifyCode(request)) &#123;
		modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
		modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, <span class="hljs-string">&quot;输入了错误的验证码&quot;</span>);
		<span class="hljs-keyword">return</span> modelMap;
	&#125;
language-Java复制代码
&lt;div class=<span class="hljs-string">&quot;item-inner&quot;</span>&gt;
  &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;j_captcha&quot;</span> class=<span class="hljs-string">&quot;item-title label&quot;</span>&gt;验证码&lt;/label&gt;
  &lt;input
    id=<span class="hljs-string">&quot;j_captcha&quot;</span>
    name=<span class="hljs-string">&quot;j_captcha&quot;</span>
    type=<span class="hljs-string">&quot;text&quot;</span>
    class=<span class="hljs-string">&quot;form-control in&quot;</span>
    placeholder=<span class="hljs-string">&quot;验证码&quot;</span>
  /&gt;
  &lt;div class=<span class="hljs-string">&quot;item-input&quot;</span>&gt;
    &lt;img
      id=<span class="hljs-string">&quot;captcha_img&quot;</span>
      alt=<span class="hljs-string">&quot;点击更换&quot;</span>
      title=<span class="hljs-string">&quot;点击更换&quot;</span>
      onclick=<span class="hljs-string">&quot;changeVerifyCode(this)&quot;</span>
      src=<span class="hljs-string">&quot;../Kaptcha&quot;</span>
    /&gt;
  &lt;/div&gt;
&lt;/div&gt;
language-html复制代码
$(<span class="hljs-string">&#x27;#submit&#x27;</span>).click(function () &#123;
	<span class="hljs-type">var</span> <span class="hljs-variable">formData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
	<span class="hljs-type">var</span> <span class="hljs-variable">verifyCodeActual</span> <span class="hljs-operator">=</span> $(<span class="hljs-string">&#x27;#j_captcha&#x27;</span>).val();
	formData.append(<span class="hljs-string">&#x27;verifyCodeActual&#x27;</span>, verifyCodeActual);
language-js复制代码</code></pre>

<hr>
<h4 id="5-1-4、-拓展"><a href="#5-1-4、-拓展" class="headerlink" title="5.1.4、 拓展"></a>5.1.4、 拓展</h4><ol>
<li>工具类 ImageUtil.该工具类用于处理预先定义好的图片,该处使用了浓缩图。</li>
</ol>
<pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.imooc.o2o.util;

<span class="hljs-keyword">import</span> java.io.File;
<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.text.SimpleDateFormat;
<span class="hljs-keyword">import</span> java.util.Date;
<span class="hljs-keyword">import</span> java.util.Random;
<span class="hljs-keyword">import</span> javax.imageio.ImageIO;
<span class="hljs-keyword">import</span> org.springframework.web.multipart.commons.CommonsMultipartFile;
<span class="hljs-keyword">import</span> net.coobird.thumbnailator.Thumbnails;
<span class="hljs-keyword">import</span> net.coobird.thumbnailator.geometry.Positions;
<span class="hljs-keyword">import</span> net.coobird.thumbnailator.name.Rename;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 该工具类用于处理预先定义好的图片</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> jxh</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageUtil</span> &#123;
	<span class="hljs-comment">// 获取classpath的绝对值路径</span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">basePath</span> <span class="hljs-operator">=</span> Thread.currentThread().getContextClassLoader().getResource(<span class="hljs-string">&quot;&quot;</span>).getPath();
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sDateFormat</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyMMddHHmmss&quot;</span>);
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Random</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>();
	<span class="hljs-comment">// 缩略图</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generateThumbnail</span><span class="hljs-params">(File thumbnail, String targetAddr)</span> &#123;
		<span class="hljs-comment">// 自定义图片名称，由于用户可能有重复的图片名称</span>
		<span class="hljs-type">String</span> <span class="hljs-variable">realFileName</span> <span class="hljs-operator">=</span> getRandomFileName();
		<span class="hljs-comment">// 获取图片的后缀</span>
		<span class="hljs-type">String</span> <span class="hljs-variable">extension</span> <span class="hljs-operator">=</span> getFileExtension(thumbnail);
		System.out.print(<span class="hljs-string">&quot;=================================&quot;</span> + extension);
		<span class="hljs-comment">// 用于处理路径不存在的情况</span>
		makeDirPath(targetAddr);
		<span class="hljs-comment">// 图片相对路径</span>
		<span class="hljs-type">String</span> <span class="hljs-variable">relativeAddr</span> <span class="hljs-operator">=</span> targetAddr + realFileName + extension;
		<span class="hljs-comment">// 文件：相对路径 + 文件组成</span>
		<span class="hljs-type">File</span> <span class="hljs-variable">dest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(PathUtil.getImgBasePath() + relativeAddr);
		<span class="hljs-comment">// 创建缩略图</span>
		<span class="hljs-keyword">try</span> &#123;
			Thumbnails.of(thumbnail).size(<span class="hljs-number">200</span>, <span class="hljs-number">200</span>)
			.watermark(Positions.BOTTOM_RIGHT, ImageIO.read(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(basePath + <span class="hljs-string">&quot;/watermark.png&quot;</span>)), <span class="hljs-number">0.25f</span>)
			.outputQuality(<span class="hljs-number">0.8f</span>).toFile(dest); <span class="hljs-comment">// 压缩和输出路径</span>
		&#125; <span class="hljs-keyword">catch</span>(IOException e) &#123;
			e.printStackTrace();
		&#125;
		<span class="hljs-keyword">return</span> relativeAddr;
	&#125;
	<span class="hljs-comment">/**</span>
<span class="hljs-comment">	 * 创建目标路径所涉及的目录，即 /home/work/hjxstart/xxx.jpg, 那么 home work hjxstart 这三个文件夹都得自动创建</span>
<span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> targetAddr</span>
<span class="hljs-comment">	 */</span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeDirPath</span><span class="hljs-params">(String targetAddr)</span> &#123;
		<span class="hljs-comment">// TODO Auto-generated method stub</span>
		<span class="hljs-type">String</span> <span class="hljs-variable">realFileParentPath</span> <span class="hljs-operator">=</span> PathUtil.getImgBasePath() + targetAddr;
		<span class="hljs-type">File</span> <span class="hljs-variable">dirPath</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(realFileParentPath);
		<span class="hljs-keyword">if</span>(!dirPath.exists()) &#123;
			dirPath.mkdirs();
		&#125;
	&#125;
	<span class="hljs-comment">/**</span>
<span class="hljs-comment">	 * 获取输入文件流的拓展名,获取最后一个.的字符</span>
<span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> thumbnail</span>
<span class="hljs-comment">	 * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">	 */</span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getFileExtension</span><span class="hljs-params">(File file)</span> &#123;
	    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> file.getName();
	    <span class="hljs-type">int</span> <span class="hljs-variable">lastIndexOf</span> <span class="hljs-operator">=</span> name.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>);
	    <span class="hljs-keyword">if</span> (lastIndexOf == -<span class="hljs-number">1</span>) &#123;
	        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>; <span class="hljs-comment">// empty extension</span>
	    &#125;
	    <span class="hljs-keyword">return</span> name.substring(lastIndexOf);
	&#125;
	<span class="hljs-comment">/**</span>
<span class="hljs-comment">	 * 生成随机文件名，当前年月日小时分钟秒钟 + 五位随机数</span>
<span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> 随机文件名称</span>
<span class="hljs-comment">	 */</span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getRandomFileName</span><span class="hljs-params">()</span> &#123;
		<span class="hljs-comment">// 获取随机的五位数</span>
		<span class="hljs-type">int</span> <span class="hljs-variable">rannum</span> <span class="hljs-operator">=</span> r.nextInt(<span class="hljs-number">89999</span>) + <span class="hljs-number">10000</span>;
		<span class="hljs-type">String</span> <span class="hljs-variable">nowTimeStr</span> <span class="hljs-operator">=</span> sDateFormat.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		<span class="hljs-keyword">return</span> nowTimeStr + rannum;
	&#125;
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;
		<span class="hljs-comment">// 获取classpath的绝对值路径，由于这个方法是通过线程去执行的，可以通过线程逆推到类加载器，从而从类加载器得到资源路径</span>
		<span class="hljs-type">String</span> <span class="hljs-variable">basePath</span> <span class="hljs-operator">=</span> Thread.currentThread().getContextClassLoader().getResource(<span class="hljs-string">&quot;&quot;</span>).getPath();
		Thumbnails.of(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;/Users/jxh/Downloads/src.jpeg&quot;</span>)) <span class="hljs-comment">// 需要处理的文件</span>
		.size(<span class="hljs-number">200</span>, <span class="hljs-number">200</span>) <span class="hljs-comment">// 处理后的文件大小</span>
		.watermark(Positions.BOTTOM_RIGHT, ImageIO.read(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(basePath + <span class="hljs-string">&quot;/hjxstart.png&quot;</span>)), <span class="hljs-number">0.25f</span>) <span class="hljs-comment">// 添</span>
		.outputQuality(<span class="hljs-number">0.8f</span>).toFile(<span class="hljs-string">&quot;/Users/jxh/Downloads/det.jpeg&quot;</span>);
	&#125;
&#125;
language-Java复制代码</code></pre>

<ol>
<li>工具类 PathUtil。用于处理在不同系统下的路径问题。</li>
</ol>
<pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.imooc.o2o.util;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PathUtil</span> &#123;
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">seperator</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;file.separator&quot;</span>);
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getImgBasePath</span><span class="hljs-params">()</span> &#123;
		<span class="hljs-type">String</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;os.name&quot;</span>);
		String basePath=<span class="hljs-string">&quot;&quot;</span>;
		<span class="hljs-keyword">if</span>(os.toLowerCase().startsWith(<span class="hljs-string">&quot;win&quot;</span>)) &#123;
			basePath = <span class="hljs-string">&quot;D:/projectdev/image/&quot;</span>;
		&#125;<span class="hljs-keyword">else</span> &#123;
			basePath = <span class="hljs-string">&quot;/Users/jxh/Downloads/image/&quot;</span>;
		&#125;
		basePath = basePath.replace(<span class="hljs-string">&quot;/&quot;</span>, seperator);
		<span class="hljs-keyword">return</span> basePath;
	&#125;
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getShopImagePath</span><span class="hljs-params">(<span class="hljs-type">long</span> shopId)</span> &#123;
		<span class="hljs-type">String</span> <span class="hljs-variable">imagePath</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;upload/item/shop/&quot;</span> + shopId + <span class="hljs-string">&quot;/&quot;</span>;
		<span class="hljs-keyword">return</span> imagePath.replace(<span class="hljs-string">&quot;/&quot;</span>, seperator);
	&#125;
&#125;
language-Java复制代码</code></pre>

<ol>
<li>Session，图片处理工具<a target="_blank" rel="noopener" href="https://github.com/coobird/thumbnailator">Thumbnailator</a>的使用</li>
</ol>
<ul>
<li>导入依赖</li>
</ul>
<pre><code class="hljs xml">	<span class="hljs-comment">&lt;!-- 图片处理 --&gt;</span>
	<span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/net.coobird/thumbnailator --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.coobird<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>thumbnailator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.4.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
language-xml复制代码</code></pre>

<ul>
<li>简单的例子</li>
</ul>
<pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;
	<span class="hljs-comment">// 获取class path的绝对值路径，由于这个方法是通过线程去执行的，可以通过线程逆推到类加载器，从而从类加载器得到资源路径</span>
	<span class="hljs-type">String</span> <span class="hljs-variable">basePath</span> <span class="hljs-operator">=</span> Thread.currentThread().getContextClassLoader().getResource(<span class="hljs-string">&quot;&quot;</span>).getPath();
	Thumbnails.of(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;/Users/jxh/Downloads/src.jpeg&quot;</span>))
	.size(<span class="hljs-number">200</span>, <span class="hljs-number">200</span>).watermark(Positions.BOTTOM_RIGHT, ImageIO.read(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(basePath + <span class="hljs-string">&quot;/hjxstart.png&quot;</span>)), <span class="hljs-number">0.25f</span>)
	.outputQuality(<span class="hljs-number">0.8f</span>).toFile(<span class="hljs-string">&quot;/Users/jxh/Downloads/det.jpeg&quot;</span>);
&#125;
language-Java复制代码</code></pre>

<hr>
<h2 id="5-2-店铺信息编辑模块"><a href="#5-2-店铺信息编辑模块" class="headerlink" title="5.2 店铺信息编辑模块"></a>5.2 店铺信息编辑模块</h2><p>目标：实现单个店铺信息的获取，实现对店铺信息进行修改。</p>
<h4 id="5-2-1-Dao-层"><a href="#5-2-1-Dao-层" class="headerlink" title="5.2.1 Dao 层"></a>5.2.1 Dao 层</h4><ol>
<li>ShopDao.java 接口</li>
</ol>
<pre><code class="hljs Java">	<span class="hljs-comment">// 查询店铺接口，根据 shopId 进行查询</span>
	Shop <span class="hljs-title function_">queryByShopId</span><span class="hljs-params">(<span class="hljs-type">long</span> shopId)</span>;
	<span class="hljs-comment">// 更新店铺接口，</span>
	<span class="hljs-type">int</span> <span class="hljs-title function_">updateShop</span><span class="hljs-params">(Shop shop)</span>;
language-Java复制代码</code></pre>

<ol>
<li>shopDao.xml</li>
</ol>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.imooc.o2o.dao.ShopDao&quot;</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 符合对象。扩展外键的值。涉及其他表的数据，比如原表只包含了其他ID，但是想要其他表的name。所有就要定义新的返回类型 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.imooc.o2o.entity.Shop&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;shopMap&quot;</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;shop_id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;shopId&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;shop_name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;shopName&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;shop_desc&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;shopDesc&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;shop_addr&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;shopAddr&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;phone&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;phone&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;shop_img&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;shopImg&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;priority&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;priority&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;create_time&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;createTime&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;last_edit_time&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;lastEditTime&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;enable_status&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;enableStatus&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;advice&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;advice&quot;</span> /&gt;</span>
		<span class="hljs-comment">&lt;!-- 复合数据类型 --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;area&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;area_id&quot;</span></span>
<span class="hljs-tag">			<span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;com.imooc.o2o.entity.Area&quot;</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;area_id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;areaId&quot;</span> /&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;area_name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;areaName&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;shopCategory&quot;</span></span>
<span class="hljs-tag">			<span class="hljs-attr">column</span>=<span class="hljs-string">&quot;shop_category_id&quot;</span></span>
<span class="hljs-tag">			<span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;com.imooc.o2o.entity.ShopCategory&quot;</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;shop_category_id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;shopCategoryId&quot;</span> /&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;shop_category_name&quot;</span></span>
<span class="hljs-tag">				<span class="hljs-attr">property</span>=<span class="hljs-string">&quot;shopCategoryName&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;owner&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_id&quot;</span></span>
<span class="hljs-tag">			<span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;com.imooc.o2o.entity.PersonInfo&quot;</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;userId&quot;</span> /&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>

	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryByShopId&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;shopMap&quot;</span></span>
<span class="hljs-tag">		<span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Long&quot;</span>&gt;</span>
		SELECT
		s.shop_id,
		s.shop_name,
		s.shop_desc,
		s.shop_addr,
		s.phone,
		s.shop_img,
		s.priority,
		s.create_time,
		s.last_edit_time,
		s.enable_status,
		s.advice,
		a.area_id,
		a.area_name,
		sc.shop_category_id,
		sc.shop_category_name
		FROM
		tb_shop s,
		tb_area a,
		tb_shop_category sc
		WHERE
		s.area_id=a.area_id
		AND
		s.shop_category_id = sc.shop_category_id
		AND
		s.shop_id = #&#123;shopId&#125;
	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
language-xml复制代码</code></pre>

<ol>
<li>单元测试</li>
</ol>
<pre><code class="hljs Java">	<span class="hljs-meta">@Test</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testQueryShopList</span><span class="hljs-params">()</span> &#123;
		<span class="hljs-type">Shop</span> <span class="hljs-variable">shopCondition</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shop</span>();
		<span class="hljs-type">PersonInfo</span> <span class="hljs-variable">owner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PersonInfo</span>();
		owner.setUserId(<span class="hljs-number">1L</span>);
		shopCondition.setOwner(owner);
		List&lt;Shop&gt; shopList = shopDao.queryShopList(shopCondition, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>);
		System.out.println(<span class="hljs-string">&quot;店铺列表的大小：&quot;</span> + shopList.size());
	&#125;
language-Java复制代码</code></pre>

<hr>
<h4 id="5-2-2-Service-层"><a href="#5-2-2-Service-层" class="headerlink" title="5.2.2 Service 层"></a>5.2.2 Service 层</h4><ol>
<li>ShopService.java 接口</li>
</ol>
<pre><code class="hljs Java">	<span class="hljs-comment">// 通过店铺ID获取店铺信息</span>
	Shop <span class="hljs-title function_">getByShopId</span><span class="hljs-params">(<span class="hljs-type">long</span> shopId)</span>;
	<span class="hljs-comment">// 更新店铺信息，包括对图片的处理，ShopExecution 封装了状态信息和店铺信息，对店铺的操作都会返回这个类</span>
	ShopExecution <span class="hljs-title function_">modifyShop</span><span class="hljs-params">(Shop shop, InputStream shopImgInputStream, String fileName)</span> <span class="hljs-keyword">throws</span> ShopOperationException;
language-Java复制代码</code></pre>

<ol>
<li>ShopServiceImpl.java 实现</li>
</ol>
<pre><code class="hljs Java">	<span class="hljs-comment">// 返回shop</span>
	<span class="hljs-meta">@Override</span>
	<span class="hljs-keyword">public</span> Shop <span class="hljs-title function_">getByShopId</span><span class="hljs-params">(<span class="hljs-type">long</span> shopId)</span> &#123;
		<span class="hljs-comment">// TODO Auto-generated method stub</span>
		<span class="hljs-keyword">return</span> shopDao.queryByShopId(shopId);
	&#125;

	<span class="hljs-meta">@Override</span>
	<span class="hljs-keyword">public</span> ShopExecution <span class="hljs-title function_">modifyShop</span><span class="hljs-params">(Shop shop, InputStream shopImgInputStream, String fileName)</span>
			<span class="hljs-keyword">throws</span> ShopOperationException &#123;

		<span class="hljs-keyword">try</span> &#123;
			<span class="hljs-comment">// 1.判断是否要修改图片，使用新的图片，删除就的图片 deleteFileOrPath</span>
			<span class="hljs-keyword">if</span>(shop == <span class="hljs-literal">null</span> || shop.getShopId() ==  <span class="hljs-literal">null</span> &amp;&amp; fileName != <span class="hljs-literal">null</span> &amp;&amp; !<span class="hljs-string">&quot;&quot;</span>.equals(fileName)) &#123;
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShopExecution</span>(ShopStateEnum.NULL_SHOP);
			&#125; <span class="hljs-keyword">else</span> &#123;
				 <span class="hljs-keyword">if</span>(shopImgInputStream != <span class="hljs-literal">null</span>) &#123;
					 <span class="hljs-type">Shop</span> <span class="hljs-variable">tempShop</span> <span class="hljs-operator">=</span> shopDao.queryByShopId(shop.getShopId());
					 <span class="hljs-keyword">if</span>(tempShop.getShopImg() != <span class="hljs-literal">null</span>) &#123;
						 ImageUtil.deleteFileOrPath(tempShop.getShopImg());
					 &#125;
					 addShopImg(shop, shopImgInputStream, fileName);
				 &#125;
			&#125;
			<span class="hljs-comment">// 2.更新店铺信息</span>
			shop.setLastEditTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
			<span class="hljs-type">int</span> <span class="hljs-variable">effectedNum</span> <span class="hljs-operator">=</span> shopDao.updateShop(shop);
			<span class="hljs-keyword">if</span>(effectedNum &lt;= <span class="hljs-number">0</span>) &#123;
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShopExecution</span>(ShopStateEnum.INNER_ERROR);
			&#125;<span class="hljs-keyword">else</span> &#123;
				shop = shopDao.queryByShopId(shop.getShopId());
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShopExecution</span>(ShopStateEnum.SUCCESS, shop);
			&#125;

		&#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShopOperationException</span>(<span class="hljs-string">&quot;modifyShop error&quot;</span> + e.getMessage());
		&#125;
	&#125;
language-Java复制代码</code></pre>

<ol>
<li>单元测试</li>
</ol>
<pre><code class="hljs java">	<span class="hljs-meta">@Test</span>
	<span class="hljs-meta">@Ignore</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testModifyShop</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> FileNotFoundException &#123;
		<span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shop</span>();
		shop.setShopId(<span class="hljs-number">1L</span>);
		shop.setShopName(<span class="hljs-string">&quot;修改后的店铺名称&quot;</span>);
		<span class="hljs-type">File</span> <span class="hljs-variable">shopImg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;/Users/jxh/Downloads/src.jpeg&quot;</span>);
		<span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(shopImg);
		<span class="hljs-type">ShopExecution</span> <span class="hljs-variable">shopExecution</span> <span class="hljs-operator">=</span>  shopService.modifyShop(shop, is, <span class="hljs-string">&quot;src.jpeg&quot;</span>);
		System.out.println(<span class="hljs-string">&quot;新的图片地址为：&quot;</span> + shopExecution.getShop().getShopImg());
	&#125;
language-java复制代码</code></pre>

<ol>
<li>拓展</li>
</ol>
<ul>
<li>ImageUtil.java 删除就图片文件或路径。生成新的图片路径</li>
</ul>
<pre><code class="hljs java">	<span class="hljs-comment">/**</span>
<span class="hljs-comment">	 * storePath是文件的路径还是目录的路径，</span>
<span class="hljs-comment">	 * 如果storePath是文件路径则删除改文件</span>
<span class="hljs-comment">	 * 如果storePath是目录路径则删除改目录下的所有文件</span>
<span class="hljs-comment">	 */</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteFileOrPath</span><span class="hljs-params">(String storePath)</span> &#123;
		<span class="hljs-type">File</span> <span class="hljs-variable">fileOrPath</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(PathUtil.getImgBasePath() + storePath);
		<span class="hljs-keyword">if</span>(fileOrPath.exists()) &#123;
			<span class="hljs-keyword">if</span>(fileOrPath.isDirectory()) &#123;
				File files[] = fileOrPath.listFiles();
				<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; files.length; i++) &#123;
					files[i].delete();
				&#125;
			&#125;
			fileOrPath.delete();
		&#125;
	&#125;
language-java复制代码</code></pre>

<hr>
<h4 id="5-2-3-Controller-层"><a href="#5-2-3-Controller-层" class="headerlink" title="5.2.3 Controller 层"></a>5.2.3 Controller 层</h4><ol>
<li>afsd</li>
</ol>
<h2 id="5-3-商品类别列表展示"><a href="#5-3-商品类别列表展示" class="headerlink" title="5.3 商品类别列表展示"></a>5.3 商品类别列表展示</h2><h4 id="5-3-1-dao-层"><a href="#5-3-1-dao-层" class="headerlink" title="5.3.1 dao 层"></a>5.3.1 dao 层</h4><ol>
<li>ProductCategoryDao.java 接口</li>
</ol>
<pre><code class="hljs java"><span class="hljs-keyword">import</span> com.imooc.o2o.entity.ProductCategory;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProductCategoryDao</span> &#123;
	<span class="hljs-comment">/**</span>
<span class="hljs-comment">	 * 通过shop id 查询店铺商品类别</span>
<span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> shopId</span>
<span class="hljs-comment">	 * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">	 */</span>
	List&lt;ProductCategory&gt; <span class="hljs-title function_">queryProductCategoryList</span><span class="hljs-params">(<span class="hljs-type">long</span> shopId)</span>;
&#125;
language-java复制代码</code></pre>

<ol>
<li>Mapper 用于实现 dao 接口的 ProductCategoryDao.xml</li>
</ol>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.imooc.o2o.dao.ProductCategoryDao&quot;</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 目的：为dao接口方法题哦功能sql语句配置 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryProductCategory&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.imooc.o2o.entity.ProductCategory&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Long&quot;</span>&gt;</span>
		SELECT
		product_category_id,product_category_name,priority,create_time,shop_id
		FROM tb_product_category
		WHERE
		shop_id = #&#123;shopId&#125;
		ORDER BY priority DESC
	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
language-xml复制代码</code></pre>

<ol>
<li>单元测试 ProductCategoryDaoTest.java</li>
</ol>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductCategoryDaoTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTest</span> &#123;
	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> ProductCategoryDao productCategoryDao;

	<span class="hljs-meta">@Test</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testProductCategoryDao</span><span class="hljs-params">()</span> &#123;
		<span class="hljs-type">long</span> <span class="hljs-variable">shopId</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
		List&lt;ProductCategory&gt; productCategoryList = productCategoryDao.queryProductCategoryList(shopId);
		System.out.println(<span class="hljs-string">&quot;该店铺自定义类别数为：&quot;</span> + productCategoryList.size());
	&#125;
&#125;
language-java复制代码</code></pre>

<h4 id="5-3-2-service-层"><a href="#5-3-2-service-层" class="headerlink" title="5.3.2 service 层"></a>5.3.2 service 层</h4><ol>
<li>接口</li>
</ol>
<pre><code class="hljs java"><span class="hljs-keyword">import</span> com.imooc.o2o.entity.ProductCategory;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProductCategoryService</span> &#123;
	<span class="hljs-comment">// 查询指定某个店铺下的所有商品类别信息</span>
	List&lt;ProductCategory&gt; <span class="hljs-title function_">getProductCategoryList</span><span class="hljs-params">(<span class="hljs-type">long</span> shopId)</span>;
&#125;
language-java复制代码</code></pre>

<ol>
<li>实现类</li>
</ol>
<pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductCategoryServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ProductCategoryService</span> &#123;
	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> ProductCategoryDao productCategoryDao;

	<span class="hljs-meta">@Override</span>
	<span class="hljs-keyword">public</span> List&lt;ProductCategory&gt; <span class="hljs-title function_">getProductCategoryList</span><span class="hljs-params">(<span class="hljs-type">long</span> shopId)</span> &#123;
		<span class="hljs-keyword">return</span> productCategoryDao.queryProductCategoryList(shopId);
	&#125;
&#125;
language-java复制代码</code></pre>

<ol>
<li>单元测试</li>
</ol>
<h4 id="5-3-3-controller-层-ProductCategoryManagementController-java"><a href="#5-3-3-controller-层-ProductCategoryManagementController-java" class="headerlink" title="5.3.3 controller 层 ProductCategoryManagementController.java"></a>5.3.3 controller 层 ProductCategoryManagementController.java</h4><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.imooc.o2o.dao.Result;
<span class="hljs-keyword">import</span> com.imooc.o2o.entity.ProductCategory;
<span class="hljs-keyword">import</span> com.imooc.o2o.entity.Shop;
<span class="hljs-keyword">import</span> com.imooc.o2o.enums.ProductCategoryStateEnum;
<span class="hljs-keyword">import</span> com.imooc.o2o.service.ProductCategoryService;

<span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping(&quot;/shopadmin&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductCategoryManagementController</span> &#123;
	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> ProductCategoryService productCategoryService;

	<span class="hljs-meta">@RequestMapping(value = &quot;/getproductcategorylist&quot;, method=RequestMethod.GET)</span>
	<span class="hljs-meta">@ResponseBody</span>
	<span class="hljs-keyword">private</span> Result&lt;List&lt;ProductCategory&gt;&gt; <span class="hljs-title function_">getProductCategoryList</span><span class="hljs-params">(HttpServletRequest request)</span> &#123; <span class="hljs-comment">// 返回一个对象，所有使用Result也可以</span>

		<span class="hljs-type">Shop</span> <span class="hljs-variable">currentShop</span> <span class="hljs-operator">=</span> (Shop) request.getSession().getAttribute(<span class="hljs-string">&quot;currentShop&quot;</span>);
		List&lt;ProductCategory&gt; list = <span class="hljs-literal">null</span>;
		<span class="hljs-keyword">if</span>(currentShop != <span class="hljs-literal">null</span> &amp;&amp; currentShop.getShopId() &gt; <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// 如果为空就是店铺没有操作的权限</span>
			list = productCategoryService.getProductCategoryList(currentShop.getShopId());
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>&lt;List&lt;ProductCategory&gt;&gt;(<span class="hljs-literal">true</span>, list);
		&#125; <span class="hljs-keyword">else</span> &#123;
			<span class="hljs-type">ProductCategoryStateEnum</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span> ProductCategoryStateEnum.INNER_ERROR;
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>&lt;List&lt;ProductCategory&gt;&gt;(<span class="hljs-literal">false</span>, ps.getState(), ps.getStateInfo());
		&#125;
	&#125;
&#125;
language-java复制代码</code></pre>

<h4 id="5-3-3-Controller-层"><a href="#5-3-3-Controller-层" class="headerlink" title="5.3.3 Controller 层"></a>5.3.3 Controller 层</h4><pre><code class="hljs java"><span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping(&quot;/shopadmin&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductCategoryManagementController</span> &#123;
	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> ProductCategoryService productCategoryService;

	<span class="hljs-meta">@RequestMapping(value = &quot;/getproductcategorylist&quot;, method=RequestMethod.GET)</span>
	<span class="hljs-meta">@ResponseBody</span>
	<span class="hljs-keyword">private</span> Result&lt;List&lt;ProductCategory&gt;&gt; <span class="hljs-title function_">getProductCategoryList</span><span class="hljs-params">(HttpServletRequest request)</span> &#123; <span class="hljs-comment">// 返回一个对象，所有使用Result也可以</span>

		<span class="hljs-type">Shop</span> <span class="hljs-variable">currentShop</span> <span class="hljs-operator">=</span> (Shop) request.getSession().getAttribute(<span class="hljs-string">&quot;currentShop&quot;</span>);
		List&lt;ProductCategory&gt; list = <span class="hljs-literal">null</span>;
		<span class="hljs-keyword">if</span>(currentShop != <span class="hljs-literal">null</span> &amp;&amp; currentShop.getShopId() &gt; <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// 如果为空就是店铺没有操作的权限</span>
			list = productCategoryService.getProductCategoryList(currentShop.getShopId());
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>&lt;List&lt;ProductCategory&gt;&gt;(<span class="hljs-literal">true</span>, list);
		&#125; <span class="hljs-keyword">else</span> &#123;
			<span class="hljs-type">ProductCategoryStateEnum</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span> ProductCategoryStateEnum.INNER_ERROR;
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>&lt;List&lt;ProductCategory&gt;&gt;(<span class="hljs-literal">false</span>, ps.getState(), ps.getStateInfo());
		&#125;
	&#125;
&#125;
language-java复制代码</code></pre>

<hr>
<h2 id="5-4-批量添加商品列表"><a href="#5-4-批量添加商品列表" class="headerlink" title="5.4 批量添加商品列表"></a>5.4 批量添加商品列表</h2><h4 id="5-4-1-dao-层"><a href="#5-4-1-dao-层" class="headerlink" title="5.4.1 dao 层"></a>5.4.1 dao 层</h4><ol>
<li>ProductCategoryDao.java 接口</li>
</ol>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProductCategoryDao</span> &#123;
	<span class="hljs-comment">// 批量新增商品类标</span>
	<span class="hljs-type">int</span> <span class="hljs-title function_">batchInsertProductCategory</span><span class="hljs-params">(List&lt;ProductCategory&gt; productCategoryList)</span>;
&#125;
language-java复制代码</code></pre>

<ol>
<li>mapper ProductCategoryDao.xml</li>
</ol>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.imooc.o2o.dao.ProductCategoryDao&quot;</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;batchInsertProductCategory&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;java.util.List&quot;</span>&gt;</span>
		INSERT INTO
		tb_product_category(product_category_name, priority, create_time, shop_id)
		VALUES
		<span class="hljs-comment">&lt;!-- collection:遍历 list。separator分隔符:value(xxx),(xxx)  --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;list&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;productCategory&quot;</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&quot;index&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span>
			(
				#&#123;productCategory.productCategoryName&#125;,
				#&#123;productCategory.priority&#125;,
				#&#123;productCategory.createTime&#125;,
				#&#123;productCategory.shopId&#125;
			)
		<span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
language-xml复制代码</code></pre>

<ol>
<li>单元测试 ProductCategoryDaoTest.java</li>
</ol>
<pre><code class="hljs java">	<span class="hljs-meta">@Test</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testBatchInsertProductCategory</span><span class="hljs-params">()</span> &#123;
		<span class="hljs-type">ProductCategory</span> <span class="hljs-variable">productCategory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductCategory</span>();
		productCategory.setProductCategoryName(<span class="hljs-string">&quot;商品类别1&quot;</span>);
		productCategory.setPriority(<span class="hljs-number">1</span>);
		productCategory.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		productCategory.setShopId(<span class="hljs-number">1L</span>);

		<span class="hljs-type">ProductCategory</span> <span class="hljs-variable">productCategory2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductCategory</span>();
		productCategory2.setProductCategoryName(<span class="hljs-string">&quot;商品类别2&quot;</span>);
		productCategory2.setPriority(<span class="hljs-number">2</span>);
		productCategory2.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		productCategory2.setShopId(<span class="hljs-number">1L</span>);

		List&lt;ProductCategory&gt; productCategoryList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;ProductCategory&gt;();
		productCategoryList.add(productCategory);
		productCategoryList.add(productCategory2);
		<span class="hljs-type">int</span> <span class="hljs-variable">effectedNum</span> <span class="hljs-operator">=</span> productCategoryDao.batchInsertProductCategory(productCategoryList);
		assertEquals(<span class="hljs-number">2</span>, effectedNum);

	&#125;
language-java复制代码</code></pre>

<h4 id="5-4-2-Service-层"><a href="#5-4-2-Service-层" class="headerlink" title="5.4.2 Service 层"></a>5.4.2 Service 层</h4><ol>
<li>接口 ProductCategoryService.java</li>
</ol>
<pre><code class="hljs java"><span class="hljs-keyword">import</span> com.imooc.o2o.dto.ProductCategoryExecution;
<span class="hljs-keyword">import</span> com.imooc.o2o.entity.ProductCategory;
<span class="hljs-keyword">import</span> com.imooc.o2o.exceptions.ProductCategoryOperationException;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProductCategoryService</span> &#123;
	<span class="hljs-comment">// 查询指定某个店铺下的所有商品类别信息</span>
	List&lt;ProductCategory&gt; <span class="hljs-title function_">getProductCategoryList</span><span class="hljs-params">(<span class="hljs-type">long</span> shopId)</span>;

	ProductCategoryExecution <span class="hljs-title function_">batchAddProductCategory</span><span class="hljs-params">(List&lt;ProductCategory&gt; productCategoryList)</span> <span class="hljs-keyword">throws</span> ProductCategoryOperationException;
&#125;
language-java复制代码</code></pre>

<ol>
<li>实现类 ProductCategoryServiceImpl.java</li>
</ol>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductCategoryServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ProductCategoryService</span> &#123;
	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> ProductCategoryDao productCategoryDao;
	<span class="hljs-meta">@Override</span>
	<span class="hljs-keyword">public</span> ProductCategoryExecution <span class="hljs-title function_">batchAddProductCategory</span><span class="hljs-params">(List&lt;ProductCategory&gt; productCategoryList)</span>
			<span class="hljs-keyword">throws</span> ProductCategoryOperationException &#123;
		<span class="hljs-comment">// TODO Auto-generated method stub</span>
		<span class="hljs-keyword">if</span>(productCategoryList != <span class="hljs-literal">null</span> &amp;&amp; productCategoryList.size() &gt; <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// 空值判断</span>
			<span class="hljs-keyword">try</span> &#123;
				<span class="hljs-type">int</span> <span class="hljs-variable">effectedNum</span> <span class="hljs-operator">=</span> productCategoryDao.batchInsertProductCategory(productCategoryList);
				<span class="hljs-keyword">if</span>(effectedNum &lt;= <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// 添加成功</span>
					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductCategoryOperationException</span>(<span class="hljs-string">&quot;店铺类别创建失败&quot;</span>);
				&#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// 添加失败</span>
					<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductCategoryExecution</span>(ProductCategoryStateEnum.SUCCESS);
				&#125;
			&#125;<span class="hljs-keyword">catch</span>(Exception e) &#123;
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductCategoryOperationException</span>(<span class="hljs-string">&quot;batchAddProductCategory error: &quot;</span> + e.getMessage());
			&#125;
		&#125;<span class="hljs-keyword">else</span> &#123;
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductCategoryExecution</span>(ProductCategoryStateEnum.EMPTY_LIST);
		&#125;
	&#125;
&#125;
language-java复制代码</code></pre>

<h4 id="5-4-3-Controller-层"><a href="#5-4-3-Controller-层" class="headerlink" title="5.4.3 Controller 层"></a>5.4.3 Controller 层</h4><pre><code class="hljs java">	<span class="hljs-meta">@RequestMapping(value = &quot;/addproductcategorys&quot;, method = RequestMethod.POST)</span>
	<span class="hljs-meta">@ResponseBody</span>
	<span class="hljs-keyword">private</span> Map&lt;String, Object&gt; <span class="hljs-title function_">addProductCategorys</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> List&lt;ProductCategory&gt; productCategoryList,</span>
<span class="hljs-params">			HttpServletRequest request)</span> &#123;
		Map&lt;String, Object&gt; modelMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Object&gt;();
		<span class="hljs-type">Shop</span> <span class="hljs-variable">currentShop</span> <span class="hljs-operator">=</span> (Shop) request.getSession().getAttribute(<span class="hljs-string">&quot;currentShop&quot;</span>);
		<span class="hljs-keyword">for</span> (ProductCategory pc : productCategoryList) &#123;
			pc.setShopId(currentShop.getShopId());
		&#125;
		<span class="hljs-keyword">if</span> (productCategoryList != <span class="hljs-literal">null</span> &amp;&amp; productCategoryList.size() &gt; <span class="hljs-number">0</span>) &#123;
			<span class="hljs-keyword">try</span> &#123;
				<span class="hljs-type">ProductCategoryExecution</span> <span class="hljs-variable">pe</span> <span class="hljs-operator">=</span> productCategoryService.batchAddProductCategory(productCategoryList);
				<span class="hljs-keyword">if</span> (pe.getState() == ProductCategoryStateEnum.SUCCESS.getState()) &#123;
					modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">true</span>);
				&#125; <span class="hljs-keyword">else</span> &#123;
					modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
					modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, pe.getStateInfo());
				&#125;
			&#125; <span class="hljs-keyword">catch</span> (ProductCategoryOperationException e) &#123;
				modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
				modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, e.toString());
				<span class="hljs-keyword">return</span> modelMap;
			&#125;
		&#125; <span class="hljs-keyword">else</span> &#123;
			modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
			modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, <span class="hljs-string">&quot;请至少输入一个商品类别&quot;</span>);
		&#125;
		<span class="hljs-keyword">return</span> modelMap;
	&#125;
language-java复制代码</code></pre>

<h2 id="5-5-删除商品类别"><a href="#5-5-删除商品类别" class="headerlink" title="5.5 删除商品类别"></a>5.5 删除商品类别</h2><h4 id="5-5-1-dao-层"><a href="#5-5-1-dao-层" class="headerlink" title="5.5.1 dao 层"></a>5.5.1 dao 层</h4><ol>
<li>接口 ProductCategoryDao.java</li>
</ol>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProductCategoryDao</span> &#123;
	<span class="hljs-comment">// 删除指定商品类别, 如果有两个参数，mybatis认不出来，必须使用@param注解来标识</span>
	<span class="hljs-comment">// 加多参数 shopId 是为了防止不是本店铺的对商品列表的操作</span>
	<span class="hljs-type">int</span> <span class="hljs-title function_">deleteProductCategory</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;productCategoryId&quot;)</span> <span class="hljs-type">long</span> productCategoryId, <span class="hljs-meta">@Param(&quot;shopId&quot;)</span> <span class="hljs-type">long</span> shopId)</span>;
&#125;
language-java复制代码</code></pre>

<ol>
<li>mapper ProductCategory.xml</li>
</ol>
<pre><code class="hljs xml">	<span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteProductCategory&quot;</span>&gt;</span>
		DELETE FROM
		tb_product_category
		WHERE
		product_category_id = #&#123;productCategoryId&#125;
		AND shop_id = #&#123;shopId&#125;
	<span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span>
language-xml复制代码</code></pre>

<ol>
<li>单元测试 ProductCategoryDaoTest.java</li>
</ol>
<pre><code class="hljs java">	<span class="hljs-comment">// junit回环，测试添加测试数据，和删除测试数据。对数据库没有影响。推荐设计 junit 回环</span>
	<span class="hljs-meta">@Test</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCDeleteProductCategory</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;
		<span class="hljs-type">long</span> <span class="hljs-variable">shopId</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
		List&lt;ProductCategory&gt; productCategoryList = productCategoryDao.queryProductCategoryList(shopId);
		<span class="hljs-keyword">for</span>(ProductCategory pc : productCategoryList) &#123;
			<span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;商品类别1&quot;</span>.equals(pc.getProductCategoryName()) || <span class="hljs-string">&quot;商品类别2&quot;</span>.equals(pc.getProductCategoryName())) &#123;
				<span class="hljs-type">int</span> <span class="hljs-variable">effectedNum</span> <span class="hljs-operator">=</span> productCategoryDao.deleteProductCategory(pc.getProductCategoryId(), shopId);
				assertEquals(<span class="hljs-number">1</span>, effectedNum);
			&#125;
		&#125;
	&#125;
language-java复制代码</code></pre>

<h4 id="5-5-2-Serivce-层"><a href="#5-5-2-Serivce-层" class="headerlink" title="5.5.2 Serivce 层"></a>5.5.2 Serivce 层</h4><ol>
<li>接口 ProductCategoryService.java</li>
</ol>
<pre><code class="hljs java">	<span class="hljs-comment">// 将此类别下的商品里的类别id置为空，再删除掉该商品类别</span>
	ProductCategoryExecution <span class="hljs-title function_">deleteProductCategory</span><span class="hljs-params">(<span class="hljs-type">long</span> productCategoryId, <span class="hljs-type">long</span> shopId)</span> <span class="hljs-keyword">throws</span> ProductCategoryOperationException;
language-java复制代码</code></pre>

<ol>
<li>实现类 ProductCategoryServiceImpl.java</li>
</ol>
<pre><code class="hljs java">	<span class="hljs-comment">// 删除商品类别</span>
	<span class="hljs-meta">@Override</span>
	<span class="hljs-meta">@Transactional</span> <span class="hljs-comment">//事务管理注解：该方法进行有2步操作：删除商品类别，将此商品类别下的商品id置为空，同时操作完成后再提交。</span>
	<span class="hljs-keyword">public</span> ProductCategoryExecution <span class="hljs-title function_">deleteProductCategory</span><span class="hljs-params">(<span class="hljs-type">long</span> productCategoryId, <span class="hljs-type">long</span> shopId)</span>
			<span class="hljs-keyword">throws</span> ProductCategoryOperationException &#123;
		<span class="hljs-keyword">try</span> &#123;
			<span class="hljs-type">int</span> <span class="hljs-variable">effectedNum</span> <span class="hljs-operator">=</span> productCategoryDao.deleteProductCategory(productCategoryId, shopId);
			<span class="hljs-keyword">if</span>(effectedNum &lt;= <span class="hljs-number">0</span>) &#123;
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductCategoryOperationException</span>(<span class="hljs-string">&quot;商品类别删除失败&quot;</span>);
			&#125;<span class="hljs-keyword">else</span> &#123;
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductCategoryExecution</span>(ProductCategoryStateEnum.SUCCESS);
			&#125;
		&#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductCategoryOperationException</span>(<span class="hljs-string">&quot;deleteProductCategory error: &quot;</span> + e.getMessage());
		&#125;
	&#125;
language-java复制代码</code></pre>

<h4 id="5-5-3-Controller-层"><a href="#5-5-3-Controller-层" class="headerlink" title="5.5.3 Controller 层"></a>5.5.3 Controller 层</h4><pre><code class="hljs java">	<span class="hljs-meta">@RequestMapping(value = &quot;/removeproductcategorys&quot;, method = RequestMethod.POST)</span>
	<span class="hljs-meta">@ResponseBody</span>
	<span class="hljs-keyword">private</span> Map&lt;String, Object&gt; <span class="hljs-title function_">removeProductCategorys</span><span class="hljs-params">(Long productCategoryId, HttpServletRequest request)</span> &#123;
		Map&lt;String, Object&gt; modelMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Object&gt;();

		<span class="hljs-keyword">if</span> (productCategoryId != <span class="hljs-literal">null</span> &amp;&amp; productCategoryId &gt; <span class="hljs-number">0</span>) &#123;
			<span class="hljs-keyword">try</span> &#123;
				<span class="hljs-type">Shop</span> <span class="hljs-variable">currentShop</span> <span class="hljs-operator">=</span> (Shop) request.getSession().getAttribute(<span class="hljs-string">&quot;currentShop&quot;</span>);
				<span class="hljs-type">ProductCategoryExecution</span> <span class="hljs-variable">pe</span> <span class="hljs-operator">=</span> productCategoryService.deleteProductCategory(productCategoryId, currentShop.getShopId());
				<span class="hljs-keyword">if</span> (pe.getState() == ProductCategoryStateEnum.SUCCESS.getState()) &#123;
					modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">true</span>);
				&#125; <span class="hljs-keyword">else</span> &#123;
					modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
					modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, pe.getStateInfo());
				&#125;
			&#125; <span class="hljs-keyword">catch</span> (ProductCategoryOperationException e) &#123;
				modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
				modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, e.toString());
				<span class="hljs-keyword">return</span> modelMap;
			&#125;
		&#125; <span class="hljs-keyword">else</span> &#123;
			modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
			modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, <span class="hljs-string">&quot;请至少选择一个商品类别&quot;</span>);
		&#125;
		<span class="hljs-keyword">return</span> modelMap;
	&#125;
language-java复制代码</code></pre>

<hr>
<h1 id="6、商品管理"><a href="#6、商品管理" class="headerlink" title="6、商品管理"></a>6、商品管理</h1><h2 id="6-1-商品添加，-商品详情图批量添加"><a href="#6-1-商品添加，-商品详情图批量添加" class="headerlink" title="6.1 商品添加， 商品详情图批量添加"></a>6.1 商品添加， 商品详情图批量添加</h2><p>实现商品添加，掌握批量图片添加</p>
<h4 id="6-1-1"><a href="#6-1-1" class="headerlink" title="6.1.1"></a>6.1.1</h4><ol>
<li>接口 ProductImgDao.java &amp; ProductDao.java</li>
</ol>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProductImgDao</span> &#123;
	<span class="hljs-comment">// 批量添加商品详情图片</span>
	<span class="hljs-type">int</span> <span class="hljs-title function_">batchInsertProductImg</span><span class="hljs-params">(List&lt;ProductImg&gt; productImgList)</span>;
&#125;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProductDao</span> &#123;
	<span class="hljs-comment">// 添加商品</span>
	<span class="hljs-type">int</span> <span class="hljs-title function_">insertProduct</span><span class="hljs-params">(Product product)</span>;
&#125;
language-java复制代码</code></pre>

<ol>
<li>mapper ProductImgDao.xml &amp; ProductDao.xml</li>
</ol>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.imooc.o2o.dao.ProductImgDao&quot;</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 参数类型是List --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;batchInsertProductImg&quot;</span></span>
<span class="hljs-tag">		<span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;java.util.List&quot;</span>&gt;</span>
		INSERT INTO
		tb_product_img(img_addr, img_desc, priority, create_time,
		product_id)
		VALUES
		<span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;list&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;productImg&quot;</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&quot;index&quot;</span></span>
<span class="hljs-tag">			<span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span>
			(
			#&#123;productImg.imgAddr&#125;,
			#&#123;productImg.imgDesc&#125;,
			#&#123;productImg.priority&#125;,
			#&#123;productImg.createTime&#125;,
			#&#123;productImg.productId&#125;
			)
		<span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>

<span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.imooc.o2o.dao.ProductDao&quot;</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertProduct&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.imooc.o2o.entity.Product&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;productId&quot;</span> <span class="hljs-attr">keyColumn</span>=<span class="hljs-string">&quot;product_id&quot;</span>&gt;</span>
		INSERT INTO
		tb_product(product_name, product_desc, img_addr, normal_price, promotion_price, priority, create_time, last_edit_time,
		enable_status, product_category_id, shop_id)
		VALUES
		(#&#123;productName&#125;, #&#123;productDesc&#125;, #&#123;imgAddr&#125;, #&#123;normalPrice&#125;, #&#123;promotionPrice&#125;, #&#123;priority&#125;, #&#123;createTime&#125;, #&#123;lastEditTime&#125;,
		#&#123;enableStatus&#125;, #&#123;productCategory.productCategoryId&#125;, #&#123;shop.shopId&#125;)
	<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
language-xml复制代码</code></pre>

<ol>
<li>单元测试 ProductImgDaoTest.java &amp; ProductDaoTest.java</li>
</ol>
<pre><code class="hljs java"><span class="hljs-meta">@FixMethodOrder(MethodSorters.NAME_ASCENDING)</span> <span class="hljs-comment">// 按照名字顺序执行测试方法</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductImgDaoTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTest</span>&#123;

	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> ProductImgDao productImgDao;

	<span class="hljs-meta">@Test</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testABatchInsertProductImgDao</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;
		<span class="hljs-comment">// productId 为1的商品里添加两个详情图记录</span>
		ProductImg productImg1= <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductImg</span>();
		productImg1.setImgAddr(<span class="hljs-string">&quot;图片1&quot;</span>);
		productImg1.setImgDesc(<span class="hljs-string">&quot;测试图片1&quot;</span>);
		productImg1.setPriority(<span class="hljs-number">1</span>);
		productImg1.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		productImg1.setProductId(<span class="hljs-number">1L</span>);

		ProductImg productImg2= <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductImg</span>();
		productImg2.setImgAddr(<span class="hljs-string">&quot;图片2&quot;</span>);
		productImg2.setImgDesc(<span class="hljs-string">&quot;测试图片2&quot;</span>);
		productImg2.setPriority(<span class="hljs-number">1</span>);
		productImg2.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		productImg2.setProductId(<span class="hljs-number">1L</span>);

		List&lt;ProductImg&gt; productImgList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;ProductImg&gt;();
		productImgList.add(productImg1);
		productImgList.add(productImg2);
		<span class="hljs-type">int</span> <span class="hljs-variable">effectedNum</span> <span class="hljs-operator">=</span> productImgDao.batchInsertProductImg(productImgList);
		assertEquals(<span class="hljs-number">2</span>, effectedNum);
	&#125;
&#125;

FixMethodOrder(MethodSorters.NAME_ASCENDING) <span class="hljs-comment">// 按测试方法名字的顺序执行测试</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductDaoTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTest</span> &#123;

	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> ProductDao productDao;
	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> ProductImgDao productImgDao;

	<span class="hljs-meta">@Test</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAInsertProduct</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;
		<span class="hljs-type">Shop</span> <span class="hljs-variable">shop1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shop</span>();
		shop1.setShopId(<span class="hljs-number">1L</span>);
		<span class="hljs-type">ProductCategory</span> <span class="hljs-variable">pc1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductCategory</span>();
		pc1.setProductCategoryId(<span class="hljs-number">1L</span>);
		<span class="hljs-comment">// 初始化三个商品实例并添加进shopId为1的店铺里，同时商品类别Id也为1</span>
		<span class="hljs-type">Product</span> <span class="hljs-variable">product1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>();
		product1.setProductName(<span class="hljs-string">&quot;测试1&quot;</span>);
		product1.setProductDesc(<span class="hljs-string">&quot;测试Desc1&quot;</span>);
		product1.setImgAddr(<span class="hljs-string">&quot;test1&quot;</span>);
		product1.setPriority(<span class="hljs-number">1</span>);
		product1.setEnableStatus(<span class="hljs-number">1</span>);
		product1.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		product1.setLastEditTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		product1.setShop(shop1);
		product1.setProductCategory(pc1);

		<span class="hljs-type">Product</span> <span class="hljs-variable">product2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>();
		product2.setProductName(<span class="hljs-string">&quot;测试2&quot;</span>);
		product2.setProductDesc(<span class="hljs-string">&quot;测试Desc2&quot;</span>);
		product2.setImgAddr(<span class="hljs-string">&quot;test2&quot;</span>);
		product2.setPriority(<span class="hljs-number">2</span>);
		product2.setEnableStatus(<span class="hljs-number">0</span>);
		product2.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		product2.setLastEditTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		product2.setShop(shop1);
		product2.setProductCategory(pc1);

		<span class="hljs-type">Product</span> <span class="hljs-variable">product3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>();
		product3.setProductName(<span class="hljs-string">&quot;test3&quot;</span>);
		product3.setProductDesc(<span class="hljs-string">&quot;测试Desc3&quot;</span>);
		product3.setImgAddr(<span class="hljs-string">&quot;test3&quot;</span>);
		product3.setPriority(<span class="hljs-number">3</span>);
		product3.setEnableStatus(<span class="hljs-number">1</span>);
		product3.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		product3.setLastEditTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		product3.setShop(shop1);
		product3.setProductCategory(pc1);

		<span class="hljs-comment">// 判断添加是否成功</span>
		<span class="hljs-type">int</span> <span class="hljs-variable">effectedNum</span> <span class="hljs-operator">=</span> productDao.insertProduct(product1);
		assertEquals(<span class="hljs-number">1</span>, effectedNum);
		effectedNum = productDao.insertProduct(product2);
		assertEquals(<span class="hljs-number">1</span>, effectedNum);
		effectedNum = productDao.insertProduct(product3);
		assertEquals(<span class="hljs-number">1</span>, effectedNum);
	&#125;
&#125;
language-java复制代码</code></pre>

<h4 id="6-1-2-service-层"><a href="#6-1-2-service-层" class="headerlink" title="6.1.2 service 层"></a>6.1.2 service 层</h4><ol>
<li>接口 ProductService.java</li>
</ol>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProductService</span> &#123;
	<span class="hljs-comment">// 添加商品信息以及图片处理。思路：1.处理缩略图;2.处理商品详情图片;3.添加商品信息</span>
	<span class="hljs-comment">//ProductExecution addProduct(Product product, InputStream thumbnail, String thumbnailName, List&lt;InputStream&gt; productImgList, List&lt;String&gt; productImgNameList) throws ProductOperationException;</span>
	<span class="hljs-comment">// 封装 图片和图片名</span>
	ProductExecution <span class="hljs-title function_">addProduct</span><span class="hljs-params">(Product product, ImageHolder thumbnail, List&lt;ImageHolder&gt; productImgList)</span> <span class="hljs-keyword">throws</span> ProductOperationException;
&#125;
language-java复制代码</code></pre>

<ol>
<li>实现类</li>
</ol>
<pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ProductService</span>&#123;

	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> ProductDao productDao;
	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> ProductImgDao productImgDao;
	<span class="hljs-comment">/**</span>
<span class="hljs-comment">	 * 添加缩略图(和店铺注册一样)</span>
<span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> product</span>
<span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> thumbnail</span>
<span class="hljs-comment">	 */</span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addThumbnail</span><span class="hljs-params">(Product product, ImageHolder thumbnail)</span> &#123;
		<span class="hljs-type">String</span> <span class="hljs-variable">dest</span> <span class="hljs-operator">=</span> PathUtil.getShopImagePath(product.getShop().getShopId());
		<span class="hljs-type">String</span> <span class="hljs-variable">thumbnailAddr</span> <span class="hljs-operator">=</span> ImageUtil.generateThumbnail(thumbnail, dest);
		product.setImgAddr(thumbnailAddr);
	&#125;
	<span class="hljs-comment">/**</span>
<span class="hljs-comment">	 * 批量添加图片</span>
<span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> product</span>
<span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> productImgHolder</span>
<span class="hljs-comment">	 */</span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addProductImgList</span><span class="hljs-params">(Product product, List&lt;ImageHolder&gt; productImgHolderList)</span> &#123;
		<span class="hljs-comment">// 获取图片存储路径，这里直接存放到相应店铺的文件夹地下</span>
		<span class="hljs-type">String</span> <span class="hljs-variable">dest</span> <span class="hljs-operator">=</span> PathUtil.getShopImagePath(product.getShop().getShopId());
		List&lt;ProductImg&gt; productImgList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;ProductImg&gt;();
		<span class="hljs-comment">// 遍历图片一次去处理，并添加进 productImg 实体类里</span>
		<span class="hljs-keyword">for</span>(ImageHolder productImgHolder: productImgHolderList) &#123;
			<span class="hljs-type">String</span> <span class="hljs-variable">imgAddr</span> <span class="hljs-operator">=</span> ImageUtil.generateNormalImg(productImgHolder, dest);
			<span class="hljs-type">ProductImg</span> <span class="hljs-variable">productImg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductImg</span>();
			productImg.setImgAddr(imgAddr);
			productImg.setProductId(product.getProductId());
			productImg.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
			productImgList.add(productImg);
		&#125;
		<span class="hljs-comment">// 如果确实是有图片需要添加的，就执行批量添加操作</span>
		<span class="hljs-keyword">if</span>(productImgList.size() &gt; <span class="hljs-number">0</span>) &#123;
			<span class="hljs-keyword">try</span> &#123;
				<span class="hljs-type">int</span> <span class="hljs-variable">effectedNum</span> <span class="hljs-operator">=</span> productImgDao.batchInsertProductImg(productImgList);
				<span class="hljs-keyword">if</span>(effectedNum &lt;= <span class="hljs-number">0</span>) &#123;
					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductOperationException</span>(<span class="hljs-string">&quot;创建商品详情图片失败&quot;</span>);
				&#125;
			&#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductOperationException</span>(<span class="hljs-string">&quot;创建商品详情图片失败:&quot;</span> + e.toString());
			&#125;
		&#125;
	&#125;

	<span class="hljs-meta">@Override</span>
	<span class="hljs-meta">@Transactional</span> <span class="hljs-comment">// 通过spring的事务管理，去管理以下4个步骤，其中任何一步出错了就会回滚数据</span>
	<span class="hljs-comment">/**</span>
<span class="hljs-comment">	 * 方法步骤：</span>
<span class="hljs-comment">	 * 1. 处理缩略图，获取缩略图相对路径并赋值给product(和注册店铺差不多)</span>
<span class="hljs-comment">	 * 2. 往 tb_product 写入商品信息，成功获取 productId(因为在mapper 使用了 useGeneratedKeys=&quot;true&quot;)</span>
<span class="hljs-comment">	 * 3. 结合 productId 批量处理商品详情图</span>
<span class="hljs-comment">	 * 4. 将商品详情列表批量插入 tb_product_img中</span>
<span class="hljs-comment">	 */</span>
	<span class="hljs-keyword">public</span> ProductExecution <span class="hljs-title function_">addProduct</span><span class="hljs-params">(Product product, ImageHolder thumbnail, List&lt;ImageHolder&gt; productImgHolderList)</span>
			<span class="hljs-keyword">throws</span> ProductOperationException &#123;
		<span class="hljs-comment">// 空值判断</span>
		<span class="hljs-keyword">if</span>(product != <span class="hljs-literal">null</span> &amp;&amp; product.getShop() != <span class="hljs-literal">null</span> &amp;&amp; product.getShop().getShopId() != <span class="hljs-literal">null</span>) &#123;
			<span class="hljs-comment">// 给商品设置上默认属性</span>
			product.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
			product.setLastEditTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
			<span class="hljs-comment">// 默认为上架的状态</span>
			product.setEnableStatus(<span class="hljs-number">1</span>);
			<span class="hljs-comment">// 若商品缩略图不为空则添加</span>
			<span class="hljs-keyword">if</span>(thumbnail != <span class="hljs-literal">null</span>) &#123;
				addThumbnail(product, thumbnail);
			&#125;
			<span class="hljs-keyword">try</span> &#123;
				<span class="hljs-comment">// 创建商品信息</span>
				<span class="hljs-type">int</span> <span class="hljs-variable">effectedNum</span> <span class="hljs-operator">=</span> productDao.insertProduct(product);
				<span class="hljs-keyword">if</span>(effectedNum &lt;= <span class="hljs-number">0</span>) &#123;
					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductOperationException</span>(<span class="hljs-string">&quot;创建商品失败&quot;</span>);
				&#125;
			&#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductOperationException</span>(<span class="hljs-string">&quot;创建商品失败:&quot;</span> + e.toString());
			&#125;
			<span class="hljs-comment">// 若商品详情图不为空则添加</span>
			<span class="hljs-keyword">if</span>(productImgHolderList != <span class="hljs-literal">null</span> &amp;&amp; productImgHolderList.size() &gt; <span class="hljs-number">0</span>) &#123;
				addProductImgList(product, productImgHolderList);
			&#125;
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductExecution</span>(ProductStateEnum.SUCCESS, product);
		&#125; <span class="hljs-keyword">else</span> &#123;
			<span class="hljs-comment">// 传参为空则返回空值错误信息</span>
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductExecution</span>(ProductStateEnum.EMPTY_LIST);
		&#125;
	&#125;

&#125;
language-java复制代码</code></pre>

<ol>
<li>单元测试</li>
</ol>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductServiceTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTest</span> &#123;

	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> ProductService productService;

	<span class="hljs-meta">@Test</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAddProduct</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ShopOperationException, FileNotFoundException&#123;
		<span class="hljs-comment">// 创建shopId 为1且productCategoryId为1的商品实例并给其成员变量赋值</span>
		<span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>();
		<span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shop</span>();
		shop.setShopId(<span class="hljs-number">1L</span>);
		<span class="hljs-type">ProductCategory</span> <span class="hljs-variable">pc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductCategory</span>();
		pc.setProductCategoryId(<span class="hljs-number">1L</span>);
		product.setShop(shop);
		product.setProductCategory(pc);
		product.setProductName(<span class="hljs-string">&quot;测试商品1&quot;</span>);
		product.setProductDesc(<span class="hljs-string">&quot;测试商品1&quot;</span>);
		product.setPriority(<span class="hljs-number">20</span>);
		product.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		product.setEnableStatus(ProductStateEnum.SUCCESS.getState());
		<span class="hljs-comment">// 创建缩略图文件流</span>
		<span class="hljs-type">File</span> <span class="hljs-variable">thumbnailFile</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;/Users/jxh/Downloads/src.jpeg&quot;</span>);
		<span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(thumbnailFile);
		<span class="hljs-type">ImageHolder</span> <span class="hljs-variable">thumbnail</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageHolder</span>(thumbnailFile.getName(), is);
		<span class="hljs-comment">// 创建两个商品详情图片文件流并将他们添加到详情图列表中</span>
		<span class="hljs-type">File</span> <span class="hljs-variable">productImg1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;/Users/jxh/Downloads/src.jpeg&quot;</span>);
		<span class="hljs-type">InputStream</span> <span class="hljs-variable">is1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(productImg1);
		<span class="hljs-type">File</span> <span class="hljs-variable">productImg2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;/Users/jxh/Downloads/src2.jpeg&quot;</span>);
		<span class="hljs-type">InputStream</span> <span class="hljs-variable">is2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(productImg1);
		List&lt;ImageHolder&gt; productImgList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;ImageHolder&gt;();
		productImgList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageHolder</span>(productImg1.getName(),is1));
		productImgList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageHolder</span>(productImg2.getName(),is2));
		<span class="hljs-comment">// 添加商品并验证</span>
		<span class="hljs-type">ProductExecution</span> <span class="hljs-variable">pe</span> <span class="hljs-operator">=</span> productService.addProduct(product, thumbnail, productImgList);
		assertEquals(ProductStateEnum.SUCCESS.getState(), pe.getState());

	&#125;
&#125;
language-java复制代码</code></pre>

<h4 id="6-1-3-controller-层"><a href="#6-1-3-controller-层" class="headerlink" title="6.1.3 controller 层"></a>6.1.3 controller 层</h4><pre><code class="hljs java"><span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping(&quot;/shopadmin&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductManagementController</span> &#123;
	<span class="hljs-meta">@Autowired</span>
	<span class="hljs-keyword">private</span> ProductService productService;

	<span class="hljs-comment">// 支持上次商品详情图的最大数量</span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">IMAGEMAXCOUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;

	<span class="hljs-meta">@RequestMapping(value = &quot;/addproduct&quot;, method = RequestMethod.POST)</span>
	<span class="hljs-meta">@ResponseBody</span>
	<span class="hljs-keyword">private</span> Map&lt;String, Object&gt; <span class="hljs-title function_">addProduct</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;
		Map&lt;String, Object&gt; modelMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Object&gt;();
		<span class="hljs-comment">// 验证码校验</span>
		<span class="hljs-keyword">if</span>(!CodeUtil.checkVerifyCode(request)) &#123;
			modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
			modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, <span class="hljs-string">&quot;输入了错误的验证码&quot;</span>);
			<span class="hljs-keyword">return</span> modelMap;
		&#125;
		<span class="hljs-comment">// 接受前端参数的变量的初始化，包括商品，缩略图，详情图列表实体类</span>
		<span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
		<span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
		<span class="hljs-type">String</span> <span class="hljs-variable">productStr</span> <span class="hljs-operator">=</span> HttpServletRequestUtil.getString(request, <span class="hljs-string">&quot;productStr&quot;</span>);
		<span class="hljs-type">MultipartHttpServletRequest</span> <span class="hljs-variable">multipartRequest</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
		<span class="hljs-type">ImageHolder</span> <span class="hljs-variable">thumbnail</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
		List&lt;ImageHolder&gt; productImgList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;ImageHolder&gt;();
		<span class="hljs-type">CommonsMultipartResolver</span> <span class="hljs-variable">multipartResolver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonsMultipartResolver</span>(request.getSession().getServletContext());
		<span class="hljs-keyword">try</span> &#123;
			<span class="hljs-comment">// 若请求中存在文件流，则取出相关的文件（包括缩略图和详情图）</span>
			<span class="hljs-keyword">if</span>(multipartResolver.isMultipart(request)) &#123;
				multipartRequest = (MultipartHttpServletRequest) request;
				<span class="hljs-comment">// 取出缩略图并构建 ImageHolder对象</span>
				<span class="hljs-type">CommonsMultipartFile</span> <span class="hljs-variable">thumbnailFile</span> <span class="hljs-operator">=</span> (CommonsMultipartFile) multipartRequest.getFile(<span class="hljs-string">&quot;thumbnail&quot;</span>);
				thumbnail = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageHolder</span>(thumbnailFile.getOriginalFilename(), thumbnailFile.getInputStream());
				<span class="hljs-comment">// 取出详情图列表并构建List&lt;ImageHolder&gt;列表对象，最多支持六张图片上传</span>
				<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; IMAGEMAXCOUNT; i++) &#123;
					<span class="hljs-type">CommonsMultipartFile</span> <span class="hljs-variable">productImgFile</span> <span class="hljs-operator">=</span> (CommonsMultipartFile) multipartRequest.getFile(<span class="hljs-string">&quot;productImg&quot;</span> + i);
					<span class="hljs-keyword">if</span>(productImgFile != <span class="hljs-literal">null</span>) &#123;
						<span class="hljs-comment">// 若取出的第i个详情图片文件流不为空，则将其加入详情图列表</span>
						<span class="hljs-type">ImageHolder</span> <span class="hljs-variable">productImg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageHolder</span>(productImgFile.getOriginalFilename(), productImgFile.getInputStream());
						productImgList.add(productImg);
					&#125;<span class="hljs-keyword">else</span> &#123;
						<span class="hljs-comment">// 若取出的第i个详情图片文件流为空，则终止循环</span>
						<span class="hljs-keyword">break</span>;
					&#125;
				&#125;
			&#125;<span class="hljs-keyword">else</span> &#123;
				modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
				modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, <span class="hljs-string">&quot;上传图片不能为空&quot;</span>);
				<span class="hljs-keyword">return</span> modelMap;
			&#125;

		&#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;
			modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
			modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, e.toString());
			<span class="hljs-keyword">return</span> modelMap;
		&#125;

		<span class="hljs-keyword">try</span> &#123;
			<span class="hljs-comment">// 尝试获取前端传过来的表单string流并将其转换成 Product实体类</span>
			product = mapper.readValue(productStr, Product.class);
		&#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;
			modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
			modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, e.toString());
			<span class="hljs-keyword">return</span> modelMap;
		&#125;
		<span class="hljs-comment">// 若Product信息，缩略图以及详情图聊表为空，则开始进行商品添加操作</span>
		<span class="hljs-keyword">if</span>(product != <span class="hljs-literal">null</span> &amp;&amp; thumbnail != <span class="hljs-literal">null</span> &amp;&amp; productImgList.size() &gt; <span class="hljs-number">0</span>) &#123;
			<span class="hljs-keyword">try</span> &#123;
				<span class="hljs-comment">// 从session 中获取当前店铺的Id 并赋值给 product, 减少对前端数据的依赖</span>
				<span class="hljs-type">Shop</span> <span class="hljs-variable">currentShop</span> <span class="hljs-operator">=</span> (Shop) request.getSession().getAttribute(<span class="hljs-string">&quot;currentShop&quot;</span>);
				<span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shop</span>();
				shop.setShopId(currentShop.getShopId());
				product.setShop(shop);
				<span class="hljs-comment">// 执行添加操作</span>
				<span class="hljs-type">ProductExecution</span> <span class="hljs-variable">pe</span> <span class="hljs-operator">=</span> productService.addProduct(product, thumbnail, productImgList);
				<span class="hljs-keyword">if</span>(pe.getState() == ProductStateEnum.SUCCESS.getState()) &#123;
					modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">true</span>);
				&#125;<span class="hljs-keyword">else</span> &#123;
					modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
					modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, pe.getStateInfo());
				&#125;
			&#125; <span class="hljs-keyword">catch</span>(ProductOperationException e) &#123;
				modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
				modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, e.toString());
				<span class="hljs-keyword">return</span> modelMap;
			&#125;
		&#125; <span class="hljs-keyword">else</span> &#123;
			modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
			modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, <span class="hljs-string">&quot;请输入商品信息&quot;</span>);
		&#125;

		<span class="hljs-keyword">return</span> modelMap;
	&#125;
&#125;
language-java复制代码</code></pre>

<h2 id="6-2-商品编辑"><a href="#6-2-商品编辑" class="headerlink" title="6.2 商品编辑"></a>6.2 商品编辑</h2><p>目标：实现商品的编辑功能（可以借鉴商品的添加和店铺的编辑）；明确如何处理已存在的图片(如果有上传新的缩略图或详情图，就把之前的图片删除掉)。<br>思路：获取商品信息，传入新的图片就把之前的图片删除，提交按钮修改商品信息。</p>
<h4 id="6-2-1、dao-层"><a href="#6-2-1、dao-层" class="headerlink" title="6.2.1、dao 层"></a>6.2.1、dao 层</h4><ol>
<li>接口 ProductDoa.java; ProductImgDao.java</li>
</ol>
<p>获取商品信息：Product queryProductById(long productId),<br>修改商品信息：int updateProduct(Product product);</p>
<p>删除商品图片：int deleteProductImgByProductId(long productId); 2. mapper ProductDao.xml &amp; ProductImgDao.xml</p>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.imooc.o2o.dao.ProductDao&quot;</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 复合数据类型(返回商品的信息和商品详情图的信息) 接口:Product queryProductById(long productId) --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.imooc.o2o.entity.Product&quot;</span></span>
<span class="hljs-tag">		<span class="hljs-attr">id</span>=<span class="hljs-string">&quot;productMap&quot;</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productId&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productName&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_desc&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productDesc&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;img_addr&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;imgAddr&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;normal_price&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;normalPrice&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;promotion_price&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;promotionPrice&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;priority&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;priority&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;create_time&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;createTime&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;last_edit_time&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;lastEditTime&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;enable_status&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;enableStatus&quot;</span> /&gt;</span>
		<span class="hljs-comment">&lt;!--assocication可以指定联合的JavaBean对象; property=&quot;role&quot;指定哪个属性是联合的对象; javaType:指定这个属性对象的类型 --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_category_id&quot;</span></span>
<span class="hljs-tag">			<span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productCategory&quot;</span></span>
<span class="hljs-tag">			<span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;com.imooc.o2o.entity.ProductCategory&quot;</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_category_id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productCategoryId&quot;</span> /&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_category_name&quot;</span></span>
<span class="hljs-tag">				<span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productCategoryName&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;shop&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;shpo_id&quot;</span></span>
<span class="hljs-tag">			<span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;com.imooc.o2o.entity.Shop&quot;</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;shop_id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;shopId&quot;</span> /&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;owner_id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;ownerId&quot;</span> /&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;shop_name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;shopName&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span>
		<span class="hljs-comment">&lt;!-- 一对多的关系 List&lt;ProductImgList&gt; --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productImgList&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_id&quot;</span></span>
<span class="hljs-tag">			<span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;com.imooc.o2o.entity.ProductImg&quot;</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_img_id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productImgId&quot;</span> /&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;detail_img&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;imgAddr&quot;</span> /&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;img_desc&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;imgDesc&quot;</span> /&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;priority&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;priority&quot;</span> /&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;create_time&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;createTime&quot;</span> /&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productId&quot;</span> /&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>

	<span class="hljs-comment">&lt;!-- 根据 product id 查询商品信息 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryProductById&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;productMap&quot;</span></span>
<span class="hljs-tag">		<span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Long&quot;</span>&gt;</span>
		SELECT
		p.product_id,
		p.product_name,
		p.product_desc,
		p.img_addr,
		p.normal_price,
		p.promotion_price,
		p.priority,
		p.create_time,
		p.last_edit_time,
		p.enable_status,
		p.product_category_id,
		p.shop_id,
		pm.product_img_id,
		pm.img_addr AS detail_img,
		pm.img_desc,
		pm.priority,
		pm.create_time
		FROM
		tb_product p
		LEFT JOIN
		tb_product_img pm
		ON
		p.product_id=pm.product_id
		WHERE
		p.product_id=#&#123;productId&#125;
		ORDER BY
		pm.priority DESC
	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 更新店铺的信息 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateProduct&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.imooc.o2o.entity.Product&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;product_id&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>
		UPDATE tb_product
		<span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;productName != null&quot;</span>&gt;</span>product_name=#&#123;productName&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;productDesc != null&quot;</span>&gt;</span>product_desc=#&#123;productDesc&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;imgAddr != null&quot;</span>&gt;</span>img_addr=#&#123;imgAddr&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;normalPrice != null&quot;</span>&gt;</span>normal_price=#&#123;normalPrice&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;promotionPrice != null&quot;</span>&gt;</span>promotion_price=#&#123;promotionPrice&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;priority != null&quot;</span>&gt;</span>priority=#&#123;priority&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;lastEditTime != null&quot;</span>&gt;</span>last_edit_time=#&#123;lastEditTime&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;enableStatus != null&quot;</span>&gt;</span>enable_status=#&#123;enableStatus&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;productCategory != null and productCategory.productCategoryId != null&quot;</span>&gt;</span>
				product_category_id=#&#123;productCategory.productCategoryId&#125;
			<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span>
		WHERE product_id=#&#123;productId&#125; AND shop_id=#&#123;shop.shopId&#125;
	<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>

<span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.imooc.o2o.dao.ProductImgDao&quot;</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 根据 product id 删除商品 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteProductImgByProductId&quot;</span>&gt;</span>
		DELETE FROM
		tb_product_img
		WHERE
		product_id=#&#123;productId&#125;
	<span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
language-xml复制代码</code></pre>

<ol>
<li>JUnit 单元测试</li>
</ol>
<pre><code class="hljs java">	&lt;!-- PorductTest.java --&gt;
	<span class="hljs-meta">@Test</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCQueryPorductByProductId</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;
		<span class="hljs-type">long</span> <span class="hljs-variable">productId</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
		<span class="hljs-comment">// 初始化两个商品详情图实例作为 productId 为 1 的商品的详情图片</span>
		<span class="hljs-comment">// 批量插入到商品详情图中</span>
		<span class="hljs-type">ProductImg</span> <span class="hljs-variable">productImg1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductImg</span>();
		productImg1.setImgAddr(<span class="hljs-string">&quot;图片1&quot;</span>);
		productImg1.setImgDesc(<span class="hljs-string">&quot;测试图片1&quot;</span>);
		productImg1.setPriority(<span class="hljs-number">1</span>);
		productImg1.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		productImg1.setProductId(productId);

		<span class="hljs-type">ProductImg</span> <span class="hljs-variable">productImg2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductImg</span>();
		productImg2.setImgAddr(<span class="hljs-string">&quot;图片1&quot;</span>);
		productImg2.setImgDesc(<span class="hljs-string">&quot;测试图片1&quot;</span>);
		productImg2.setPriority(<span class="hljs-number">1</span>);
		productImg2.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
		productImg2.setProductId(productId);
		List&lt;ProductImg&gt; productImgList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;ProductImg&gt;();
		productImgList.add(productImg1);
		productImgList.add(productImg2);
		<span class="hljs-type">int</span> <span class="hljs-variable">effectedNum</span> <span class="hljs-operator">=</span> productImgDao.batchInsertProductImg(productImgList);
		assertEquals(<span class="hljs-number">2</span>, effectedNum);
		<span class="hljs-comment">// 查询productId 为1的商品信息并校验返回的详情图实例列表size 是否为2</span>
		<span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productDao.queryProductById(productId);
		assertEquals(<span class="hljs-number">2</span>, product.getProductImgList().size());
		<span class="hljs-comment">// 删除新增的这两个商品详情图实例</span>
		effectedNum = productImgDao.deleteProductImgByProductId(productId);
		assertEquals(<span class="hljs-number">2</span>, effectedNum);
	&#125;

	<span class="hljs-meta">@Test</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDUpdateProduct</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;
		<span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>();
		<span class="hljs-type">ProductCategory</span> <span class="hljs-variable">pc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductCategory</span>();
		<span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shop</span>();
		shop.setShopId(<span class="hljs-number">1L</span>);
		pc.setProductCategoryId(<span class="hljs-number">2L</span>);
		product.setProductId(<span class="hljs-number">1L</span>);
		product.setShop(shop);
		product.setProductName(<span class="hljs-string">&quot;第二个产品&quot;</span>);
		product.setProductCategory(pc);
		<span class="hljs-comment">// 修改 productId 为1的商品的名称</span>
		<span class="hljs-comment">// 以及商品类别并校验影响的行数是否为 1</span>
		<span class="hljs-type">int</span> <span class="hljs-variable">effectedNum</span> <span class="hljs-operator">=</span> productDao.updateProduct(product);
		assertEquals(<span class="hljs-number">1</span>, effectedNum);
	&#125;
	&lt;!-- ProductImgDaoTest.java --&gt;
	<span class="hljs-meta">@Test</span>
	<span class="hljs-meta">@Ignore</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCDeleteProductImgByProductId</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;
		<span class="hljs-comment">// 删除新增的两条商品详情图片记录</span>
		<span class="hljs-type">long</span> <span class="hljs-variable">productId</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
		<span class="hljs-type">int</span> <span class="hljs-variable">effectedNum</span> <span class="hljs-operator">=</span> productImgDao.deleteProductImgByProductId(productId);
		assertEquals(<span class="hljs-number">2</span>, effectedNum);
	&#125;
language-java复制代码</code></pre>

<h4 id="6-2-2、Service-层"><a href="#6-2-2、Service-层" class="headerlink" title="6.2.2、Service 层"></a>6.2.2、Service 层</h4><ol>
<li>接口 ProductService.java</li>
</ol>
<pre><code class="hljs java"><span class="hljs-comment">// 通过商品 Id 查询唯一的商品信息(商品编辑)</span>
	Product <span class="hljs-title function_">getProductById</span><span class="hljs-params">(<span class="hljs-type">long</span> productId)</span>;
	<span class="hljs-comment">// 修改商品信息以及图片处理(商品编辑)</span>
	ProductExecution <span class="hljs-title function_">modifyProduct</span><span class="hljs-params">(Product product, ImageHolder thumbnail, List&lt;ImageHolder&gt; productImgList)</span> <span class="hljs-keyword">throws</span> ProductOperationException;
language-java复制代码</code></pre>

<ol>
<li>实现类 ProductServiceImpl.java</li>
</ol>
<pre><code class="hljs java">	<span class="hljs-comment">// 商品编辑，获取商品信息</span>
	<span class="hljs-meta">@Override</span>
	<span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProductById</span><span class="hljs-params">(<span class="hljs-type">long</span> productId)</span> &#123;
		<span class="hljs-keyword">return</span> productDao.queryProductById(productId);
	&#125;

	<span class="hljs-comment">// 商品编辑，修改商品信息</span>
	<span class="hljs-meta">@Override</span>
	<span class="hljs-meta">@Transactional</span>
	<span class="hljs-comment">/**</span>
<span class="hljs-comment">	 * 思路：1.若缩略图参数有值，则处理缩略图，若原先存在缩略图则先删除再添加新图，之后获取缩略图相对路径并赋值给product</span>
<span class="hljs-comment">	 * 		2.若商品详情图列表参数有值，对商品详情图片列表进行同样的操作</span>
<span class="hljs-comment">	 * 		3.将tb_product_img下面的该商品原先的商品详情图记录全部清除</span>
<span class="hljs-comment">	 * 		4.更新tb_product_img 以及 tb_product的信息</span>
<span class="hljs-comment">	 */</span>
	<span class="hljs-keyword">public</span> ProductExecution <span class="hljs-title function_">modifyProduct</span><span class="hljs-params">(Product product, ImageHolder thumbnail, List&lt;ImageHolder&gt; productImgHolderList)</span>
			<span class="hljs-keyword">throws</span> ProductOperationException &#123;
		<span class="hljs-comment">// 空值判断</span>
		<span class="hljs-keyword">if</span>(product != <span class="hljs-literal">null</span> &amp;&amp; product.getShop() != <span class="hljs-literal">null</span> &amp;&amp; product.getShop().getShopId() != <span class="hljs-literal">null</span>) &#123;
			<span class="hljs-comment">// 给商品设置上默认属性</span>
			product.setLastEditTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
			<span class="hljs-comment">// 若商品缩略图不为空且原有缩略图不为空则删除原有缩略图并添加</span>
			<span class="hljs-keyword">if</span>(thumbnail != <span class="hljs-literal">null</span>) &#123;
				<span class="hljs-comment">// 先获取一遍原有信息，因为原来的信息里有图片地址</span>
				<span class="hljs-type">Product</span> <span class="hljs-variable">tempProduct</span> <span class="hljs-operator">=</span> productDao.queryProductById(product.getProductId());
				<span class="hljs-keyword">if</span>(tempProduct.getImgAddr() != <span class="hljs-literal">null</span>) &#123;
					ImageUtil.deleteFileOrPath(tempProduct.getImgAddr());
				&#125;
				addThumbnail(product, thumbnail);
			&#125;
			<span class="hljs-comment">// 如果有新存入的商品详情图，则将原来的删除，并添加新的图片</span>
			<span class="hljs-keyword">if</span>(productImgHolderList != <span class="hljs-literal">null</span> &amp;&amp; productImgHolderList.size() &gt; <span class="hljs-number">0</span>) &#123;
				deleteProductImgList(product.getProductId());
				addProductImgList(product, productImgHolderList);
			&#125;
			<span class="hljs-keyword">try</span> &#123;
				<span class="hljs-comment">// 更新商品信息</span>
				<span class="hljs-type">int</span> <span class="hljs-variable">effentedNum</span> <span class="hljs-operator">=</span> productDao.updateProduct(product);
				<span class="hljs-keyword">if</span>(effentedNum &lt;= <span class="hljs-number">0</span>) &#123;
					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductOperationException</span>(<span class="hljs-string">&quot;更新商品信息失败&quot;</span>);
				&#125;
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductExecution</span>(ProductStateEnum.SUCCESS, product);
			&#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductOperationException</span>(<span class="hljs-string">&quot;更新商品信息失败:&quot;</span> + e.toString());
			&#125;
		&#125;<span class="hljs-keyword">else</span> &#123;
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductExecution</span>(ProductStateEnum.EMPTY_LIST);
		&#125;
	&#125;

	<span class="hljs-comment">// 根据 product id 删除商品详情图</span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteProductImgList</span><span class="hljs-params">(Long productId)</span> &#123;
		<span class="hljs-comment">// 根据 productId 获取原来的图片</span>
		List&lt;ProductImg&gt; productImgList = productImgDao.queryProductImgList(productId);
		<span class="hljs-comment">// 删除原来的图片</span>
		<span class="hljs-keyword">for</span>(ProductImg productImg : productImgList) &#123;
			ImageUtil.deleteFileOrPath(productImg.getImgAddr());
		&#125;
		<span class="hljs-comment">// 删除数据库里原有图片的信息</span>
		productImgDao.deleteProductImgByProductId(productId);
language-java复制代码</code></pre>

<ol>
<li>测试 ProductServiceTest.java</li>
</ol>
<pre><code class="hljs java">	<span class="hljs-meta">@Test</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testModifyProduct</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ShopOperationException, FileNotFoundException &#123;
		<span class="hljs-comment">// 创建shopId 为1 且productCategoryId 为 1的商品实例并给其成员变量赋值</span>
		<span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>();
		<span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shop</span>();
		shop.setShopId(<span class="hljs-number">1L</span>);
		<span class="hljs-type">ProductCategory</span> <span class="hljs-variable">pc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductCategory</span>();
		pc.setProductCategoryId(<span class="hljs-number">1L</span>);
		product.setProductId(<span class="hljs-number">1L</span>);
		product.setShop(shop);
		product.setProductCategory(pc);
		product.setProductName(<span class="hljs-string">&quot;正式的商品Test&quot;</span>);
		product.setProductDesc(<span class="hljs-string">&quot;正式的商品Test&quot;</span>);
		<span class="hljs-comment">// 创建缩略图文件流</span>
		<span class="hljs-type">File</span> <span class="hljs-variable">thumbnailFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;/Users/jxh/Downloads/src.jpeg&quot;</span>);
		<span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(thumbnailFile);
		<span class="hljs-type">ImageHolder</span> <span class="hljs-variable">thumbnail</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageHolder</span>(thumbnailFile.getName(), is);
		<span class="hljs-comment">// 创建两个商品详情图文件流并将他们添加到详情图列表中</span>
		<span class="hljs-type">File</span> <span class="hljs-variable">productImg1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;/Users/jxh/Downloads/src.jpeg&quot;</span>);
		<span class="hljs-type">InputStream</span> <span class="hljs-variable">is1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(productImg1);
		<span class="hljs-type">File</span> <span class="hljs-variable">productImg2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;/Users/jxh/Downloads/src2.jpeg&quot;</span>);
		<span class="hljs-type">InputStream</span> <span class="hljs-variable">is2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(productImg2);
		List&lt;ImageHolder&gt; productImgList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;ImageHolder&gt;();
		productImgList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageHolder</span>(productImg1.getName(), is1));
		productImgList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageHolder</span>(productImg2.getName(), is2));
		<span class="hljs-comment">// 添加商品并验证</span>
		<span class="hljs-type">ProductExecution</span> <span class="hljs-variable">pe</span> <span class="hljs-operator">=</span> productService.modifyProduct(product, thumbnail, productImgList);
		assertEquals(ProductStateEnum.SUCCESS.getState(), pe.getState());
	&#125;
language-java复制代码</code></pre>

<h4 id="6-2-3-Controller-层-ProductCategoryManagementController-java"><a href="#6-2-3-Controller-层-ProductCategoryManagementController-java" class="headerlink" title="6.2.3 Controller 层 ProductCategoryManagementController.java"></a>6.2.3 Controller 层 ProductCategoryManagementController.java</h4><pre><code class="hljs java"><span class="hljs-comment">// 商品编辑</span>
	<span class="hljs-meta">@RequestMapping(value=&quot;/modifyproduct&quot;, method=RequestMethod.POST)</span>
	<span class="hljs-meta">@ResponseBody</span>
	<span class="hljs-keyword">private</span> Map&lt;String, Object&gt; <span class="hljs-title function_">modifyProduct</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;
		Map&lt;String, Object&gt; modelMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Object&gt;();
		<span class="hljs-comment">//是商品编辑时候嗲用还是上下架操作的时候调用</span>
		<span class="hljs-comment">//若为前者则进行验证码判断，后者则跳过验证码判断</span>
		<span class="hljs-type">boolean</span> <span class="hljs-variable">statusChange</span> <span class="hljs-operator">=</span> HttpServletRequestUtil.getBoolean(request, <span class="hljs-string">&quot;statusChange&quot;</span>);
		<span class="hljs-comment">// 验证码判断</span>
		<span class="hljs-keyword">if</span>(!statusChange &amp;&amp; !CodeUtil.checkVerifyCode(request)) &#123;
			modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
			modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, <span class="hljs-string">&quot;输入了错误的验证码&quot;</span>);
			<span class="hljs-keyword">return</span> modelMap;
		&#125;
		<span class="hljs-comment">// 接受前端参数的变量的初始化，包括商品，缩略图，详情图列表实体类</span>
		<span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
		<span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
		<span class="hljs-type">ImageHolder</span> <span class="hljs-variable">thumbnail</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
		List&lt;ImageHolder&gt; productImgList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;ImageHolder&gt;();
		<span class="hljs-type">CommonsMultipartResolver</span> <span class="hljs-variable">multipartResolver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonsMultipartResolver</span>(request.getSession().getServletContext());
		<span class="hljs-comment">// 若请求中存在文件流，则取相关的文件（包括缩略图和详情图）</span>
		<span class="hljs-keyword">try</span> &#123;
			<span class="hljs-keyword">if</span>(multipartResolver.isMultipart(request)) &#123;
				handleImage(request, productImgList);
			&#125;
		&#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;
			modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
			modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, <span class="hljs-string">&quot;上传图片不能为空&quot;</span>);
			<span class="hljs-keyword">return</span> modelMap;
		&#125;
		<span class="hljs-keyword">try</span> &#123;
			<span class="hljs-type">String</span> <span class="hljs-variable">productStr</span> <span class="hljs-operator">=</span> HttpServletRequestUtil.getString(request, <span class="hljs-string">&quot;productStr&quot;</span>);
			<span class="hljs-comment">// 尝试获取前端传过来的表单string流并将其转成Product实体类</span>
			product = mapper.readValue(productStr, Product.class);
		&#125;<span class="hljs-keyword">catch</span>(Exception e) &#123;
			modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
			modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, e.toString());
			<span class="hljs-keyword">return</span> modelMap;
		&#125;
		<span class="hljs-comment">// 非空判断</span>
		<span class="hljs-keyword">if</span>(product != <span class="hljs-literal">null</span>) &#123;
			<span class="hljs-keyword">try</span> &#123;
				<span class="hljs-comment">// 从session中获取当前店铺的Id并赋值给product, 减少对前端数据的依赖</span>
				<span class="hljs-type">Shop</span> <span class="hljs-variable">currentShop</span> <span class="hljs-operator">=</span> (Shop) request.getSession().getAttribute(<span class="hljs-string">&quot;currentShop&quot;</span>);
				<span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shop</span>();
				shop.setShopId(currentShop.getShopId());
				product.setShop(shop);
				<span class="hljs-comment">// 开始进行商品信息变更操作</span>
				<span class="hljs-type">ProductExecution</span> <span class="hljs-variable">pe</span> <span class="hljs-operator">=</span> productService.modifyProduct(product, thumbnail, productImgList);
				<span class="hljs-keyword">if</span>(pe.getState() == ProductStateEnum.SUCCESS.getState()) &#123;
					modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">true</span>);
				&#125;<span class="hljs-keyword">else</span> &#123;
					modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
					modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, pe.getStateInfo());
				&#125;
			&#125; <span class="hljs-keyword">catch</span>(RuntimeException e) &#123;
				modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
				modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, e.toString());
				<span class="hljs-keyword">return</span> modelMap;
			&#125;
		&#125; <span class="hljs-keyword">else</span> &#123;
			modelMap.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">false</span>);
			modelMap.put(<span class="hljs-string">&quot;errMsg&quot;</span>, <span class="hljs-string">&quot;请输入商品信息&quot;</span>);
		&#125;
		<span class="hljs-keyword">return</span> modelMap;
	&#125;

	<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleImage</span><span class="hljs-params">(HttpServletRequest request, List&lt;ImageHolder&gt; productImgList)</span> <span class="hljs-keyword">throws</span> IOException &#123;
		ImageHolder thumbnail;
		<span class="hljs-type">MultipartHttpServletRequest</span> <span class="hljs-variable">multipartRequest</span> <span class="hljs-operator">=</span> (MultipartHttpServletRequest) request;
		<span class="hljs-comment">// 取出缩略图并构建ImageHolder对象</span>
		<span class="hljs-type">CommonsMultipartFile</span> <span class="hljs-variable">thumbnailFile</span> <span class="hljs-operator">=</span> (CommonsMultipartFile) multipartRequest.getFile(<span class="hljs-string">&quot;thumbnailFile&quot;</span>);
		<span class="hljs-keyword">if</span>(thumbnailFile != <span class="hljs-literal">null</span>) &#123;
			thumbnail = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageHolder</span>(thumbnailFile.getOriginalFilename(), thumbnailFile.getInputStream());
		&#125;
		<span class="hljs-comment">// 取出详情图列表并构建List&lt;ImageHolder&gt;列表对象，最多支持六张图片上传</span>
		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; IMAGEMAXCOUNT; i++) &#123;
			<span class="hljs-type">CommonsMultipartFile</span> <span class="hljs-variable">productImgFile</span> <span class="hljs-operator">=</span> (CommonsMultipartFile) multipartRequest.getFile(<span class="hljs-string">&quot;productImg&quot;</span> + i);
			<span class="hljs-keyword">if</span>(productImgFile != <span class="hljs-literal">null</span>) &#123;
				<span class="hljs-comment">// 若取出的第i个详情图片文件流不为空，则将其加入详情图列表</span>
				<span class="hljs-type">ImageHolder</span> <span class="hljs-variable">productImg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageHolder</span>(productImgFile.getOriginalFilename(), productImgFile.getInputStream());
				productImgList.add(productImg);
			&#125;<span class="hljs-keyword">else</span> &#123;
				<span class="hljs-comment">// 若取出的第i个详情图片文件流为空，则终止循环</span>
				<span class="hljs-keyword">break</span>;
			&#125;
		&#125;
	&#125;
language-java复制代码</code></pre>

<h2 id="6-3-商品列表展示"><a href="#6-3-商品列表展示" class="headerlink" title="6.3 商品列表展示"></a>6.3 商品列表展示</h2><h1 id="第七章-首页"><a href="#第七章-首页" class="headerlink" title="第七章 首页"></a>第七章 首页</h1><p>目标: 头条读取以及滚动播放；一级类别列表的获取</p>
<h2 id="7-1"><a href="#7-1" class="headerlink" title="7.1"></a>7.1</h2><hr>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h2 id="SSM-框架实现功能的步骤"><a href="#SSM-框架实现功能的步骤" class="headerlink" title="SSM 框架实现功能的步骤"></a>SSM 框架实现功能的步骤</h2><ol>
<li>在 dao 层</li>
</ol>
<ul>
<li>创建出相应的接口</li>
<li>定义相关的方法</li>
</ul>
<ol>
<li>在 mapper 中</li>
</ol>
<ul>
<li>在 resources&#x2F;mapper 下面创建出与 dao 层一一对应的 xml 文件</li>
<li>在 xml 文件中定义出方法所需要的 SQL</li>
</ul>
<ol>
<li>在 service 层</li>
</ol>
<ul>
<li>实现类继承接口，包含类注解(@Service)，</li>
<li>使用注解(@Autowired)将 dao 层接口注入进来</li>
<li>调用 dao 层的方法，将我们需要的数据返回到 Controller 去</li>
</ul>
<ol>
<li>在 controller 层</li>
</ol>
<ul>
<li>包含有注解(@Controller，@RequestMapping(“&#x2F;url”))的类</li>
<li>使用注解(@Autowired)将 dao 层接口注入进来</li>
<li>创建包含有注解(@RequestMapping, @ResponseBody)的方法。</li>
<li>调用 dao 层接口的方法获取数据后，直接将数据返回前台。</li>
</ul>
<hr>
<h1 id="Junit"><a href="#Junit" class="headerlink" title="Junit"></a>Junit</h1><h2 id="Junit-测试步骤"><a href="#Junit-测试步骤" class="headerlink" title="Junit 测试步骤"></a>Junit 测试步骤</h2><h4 id="1、定义一个基类"><a href="#1、定义一个基类" class="headerlink" title="1、定义一个基类"></a>1、定义一个基类</h4><ol>
<li>一个包含类注解(@RunWith(SpringJunit4ClassRunner.class))的类,指定使用那个类来单元测试</li>
<li>一个包含类注解(@ContextConfiguration({“1.xml”,”2.xml”}))的类,指定 junit spring 配置文件的文件，1.xml 为 junit 的 dao 层做服务的，2.xml 为 service 单元测试做服务配置的。</li>
</ol>
<h4 id="2、定义一个实现类"><a href="#2、定义一个实现类" class="headerlink" title="2、定义一个实现类"></a>2、定义一个实现类</h4><ol>
<li>定义一个方法，包含注解(@Test)的测试方法。</li>
</ol>
<h2 id="Junit-拓展"><a href="#Junit-拓展" class="headerlink" title="Junit 拓展"></a>Junit 拓展</h2><h4 id="Junit-测试回环"><a href="#Junit-测试回环" class="headerlink" title="Junit 测试回环"></a>Junit 测试回环</h4><p>测试回环是通过测试进行的数据插入，再通过测试进行数据的删除，在测试中推荐使用，这样对数据库基本没影响</p>
<h4 id="Junit-顺序执行"><a href="#Junit-顺序执行" class="headerlink" title="Junit 顺序执行"></a>Junit 顺序执行</h4><p>做单元测试是，默认是不一定安装顺序执行测试的，但是有时候需要按顺序的执行测试，所以该注解是安装名字的顺序来执行测试。可在测试方法名字添加顺序:testAxxx, testBxxx</p>
<hr>
<h2 id="SSM-重点知识"><a href="#SSM-重点知识" class="headerlink" title="SSM 重点知识"></a>SSM 重点知识</h2><ol>
<li>SpringMVC: DispatcherServlet</li>
<li>Spring: IOC 和 AOP</li>
</ol>
<ul>
<li>IOC</li>
<li>Aop<br>例如，增删改查的操作，都需要做权限验证，我们并不希望权限验证的代码杂糅在我们增删改查的方法里，我们可以通过 AOP 在程序运行时候动态的将我们权限代码植入到我们的增删改查方法的前面，以完成权限的验证。AOP 的实现方式，就是动态代理。动态代理有 JDK 和 CJL 两种方式实现。</li>
</ul>
<ol>
<li>MyBatis:ORM</li>
</ol>
<ul>
<li>ORM 就是通过使用描述对象和数据库之间映射的元数据，将程序中的对象自动持久化到关系数据库中。</li>
<li>关系映射的实现方式。</li>
</ul>
<hr>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以邮件至 hjxstart@126.com </span>
    </div>
</article>








    




    </div>
    <div class="copyright">
        <p class="footer-entry"><span class="miit">
                <img src="/img/gov.png" title="中华人民共和国工业和信息化部">
                <a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">粤ICP备2021170625号-1</a>
        </span>
    
    ©2019-2022 hjxstart
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("/img/article-list-bg-img.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
