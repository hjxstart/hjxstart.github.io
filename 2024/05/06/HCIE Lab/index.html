<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>HCIE Lab | 黄金贤的博客</title>
  <meta name="keywords" content="">
  <meta name="description" content="HCIE Lab | 黄金贤的博客">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="概述# PHP是一种运行在服务器端的脚步语言，可以嵌入到HTML中。是一中面向对象的、解释的。7.3版本比较好用 # 1994年   环境准备# 安装 PhpStorm # https:&#x2F;&#x2F;3.jetbra.in&#x2F; 下载安装包 jetbra.zip 解压后放在 PhpStorm 的bin目录下, 为 jetbra 目录 # 双击 \bin\jetbra\scripts\install-all-us">
<meta property="og:type" content="article">
<meta property="og:title" content="Php">
<meta property="og:url" content="https://hjxstart.github.io/2025/09/13/Php/index.html">
<meta property="og:site_name" content="黄金贤的博客">
<meta property="og:description" content="概述# PHP是一种运行在服务器端的脚步语言，可以嵌入到HTML中。是一中面向对象的、解释的。7.3版本比较好用 # 1994年   环境准备# 安装 PhpStorm # https:&#x2F;&#x2F;3.jetbra.in&#x2F; 下载安装包 jetbra.zip 解压后放在 PhpStorm 的bin目录下, 为 jetbra 目录 # 双击 \bin\jetbra\scripts\install-all-us">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/20250913234353519.png">
<meta property="article:published_time" content="2025-09-13T15:10:00.000Z">
<meta property="article:modified_time" content="2025-10-08T11:23:27.820Z">
<meta property="article:author" content="黄金贤">
<meta property="article:tag" content="计算机网络 数据库 操作系统 数据结构 算法 Java Nodejs">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/20250913234353519.png">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-dark.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>


<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 8.0.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.jpg"/>
</a>
<div class="author">
    <span>黄金贤</span>
</div>

<div class="icon">
    
        
            <a title="github"
               href="https://github.com/hjxstart"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="email"
               href="mailto:hjxstart@126.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=1726283687&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
</div>




<ul>
    <li>
        <div class="all active" data-rel="全部文章">全部文章
            
                <small>(66)</small>
            
        </div>
    </li>
    
        
            
                <li>
                    <div data-rel="运维">
                        
                        运维
                        <small>(20)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="开发">
                        
                        开发
                        <small>(12)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="读书">
                        
                        读书
                        <small>(2)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="安全">
                        
                        安全
                        <small>(3)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="工具">
                        
                        工具
                        <small>(10)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="数据库">
                        
                        数据库
                        <small>(5)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="网络">
                        
                        网络
                        <small>(14)</small>
                        
                    </div>
                    
                </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">关于</a>
        
        <a style="width: 50%"
                
                                           class="friends">友链</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="66">
<input type="hidden" id="yelog_site_word_count" value="244.3k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="https://github.com/hjxstart">hjxstart</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">全部文章</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
    </div>

</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        <a id="top" class="全部文章 网络 "
           href="/2024/05/06/HCIE%20Lab/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="HCIE Lab">HCIE Lab</span>
            <span class="post-date" title="2024-05-06 19:42:00">2024/05/06</span>
        </a>
        
        <a id="top" class="全部文章 安全 "
           href="/2025/08/17/CISP-PTE/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="CISP-PTE">CISP-PTE</span>
            <span class="post-date" title="2025-08-17 11:12:00">2025/08/17</span>
        </a>
        
        <a id="top" class="全部文章 运维 "
           href="/2021/09/09/VMware/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="VMware">VMware</span>
            <span class="post-date" title="2021-09-09 15:38:00">2021/09/09</span>
        </a>
        
        <a id="top" class="全部文章 运维 "
           href="/2025/04/04/PXE-Kickstart/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="PXE+Kickstart">PXE+Kickstart</span>
            <span class="post-date" title="2025-04-04 10:45:00">2025/04/04</span>
        </a>
        
        <a id="top" class="全部文章 运维 "
           href="/2025/02/12/KylinOS/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="KylinOS">KylinOS</span>
            <span class="post-date" title="2025-02-12 16:47:00">2025/02/12</span>
        </a>
        
        <a id="top" class="全部文章 运维 "
           href="/2025/08/24/KylinOS-FAQ/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="KylinOS FAQ">KylinOS FAQ</span>
            <span class="post-date" title="2025-08-24 11:07:00">2025/08/24</span>
        </a>
        
        <a id="top" class="全部文章 运维 "
           href="/2025/08/24/Windows/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Windows">Windows</span>
            <span class="post-date" title="2025-08-24 11:19:00">2025/08/24</span>
        </a>
        
        <a id="top" class="全部文章 运维 "
           href="/2022/03/24/Linux/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Linux">Linux</span>
            <span class="post-date" title="2022-03-24 11:53:00">2022/03/24</span>
        </a>
        
        <a id="top" class="全部文章 工具 "
           href="/2024/07/28/NTLite/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="NTLite">NTLite</span>
            <span class="post-date" title="2024-07-28 21:32:00">2024/07/28</span>
        </a>
        
        <a id="top" class="全部文章 数据库 "
           href="/2020/03/19/MySQL/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="MySQL">MySQL</span>
            <span class="post-date" title="2020-03-19 21:51:00">2020/03/19</span>
        </a>
        
        <a id="top" class="全部文章 开发 "
           href="/2025/09/13/Php/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Php">Php</span>
            <span class="post-date" title="2025-09-13 23:10:00">2025/09/13</span>
        </a>
        
        <a id="top" class="全部文章 运维 "
           href="/2023/05/13/IBMC/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="IBMC">IBMC</span>
            <span class="post-date" title="2023-05-13 21:04:00">2023/05/13</span>
        </a>
        
        <a  class="全部文章 安全 "
           href="/2025/08/21/cisp-practice/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="cisp-practice">cisp-practice</span>
            <span class="post-date" title="2025-08-21 19:41:00">2025/08/21</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2025/04/24/OpenStack/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="OpenStack">OpenStack</span>
            <span class="post-date" title="2025-04-24 09:04:00">2025/04/24</span>
        </a>
        
        <a  class="全部文章 安全 "
           href="/2024/08/23/CISO/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="CISO">CISO</span>
            <span class="post-date" title="2024-08-23 19:29:00">2024/08/23</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2024/04/16/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%B8%88/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="网络工程师">网络工程师</span>
            <span class="post-date" title="2024-04-16 22:14:00">2024/04/16</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2024/01/27/STP/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="STP">STP</span>
            <span class="post-date" title="2024-01-27 14:01:00">2024/01/27</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2024/01/27/VLAN/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="VLAN">VLAN</span>
            <span class="post-date" title="2024-01-27 11:42:00">2024/01/27</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2024/01/27/LLDP/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="LLDP">LLDP</span>
            <span class="post-date" title="2024-01-27 11:31:00">2024/01/27</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2024/01/27/Telnet/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Telnet">Telnet</span>
            <span class="post-date" title="2024-01-27 10:45:00">2024/01/27</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2024/01/27/SSH/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="SSH">SSH</span>
            <span class="post-date" title="2024-01-27 10:44:00">2024/01/27</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2023/12/22/WireGuard/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="WireGuard">WireGuard</span>
            <span class="post-date" title="2023-12-22 07:40:00">2023/12/22</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2023/12/21/Stack-Port/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Stack Port">Stack Port</span>
            <span class="post-date" title="2023-12-21 19:31:00">2023/12/21</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2023/12/18/RouterOS/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="RouterOS">RouterOS</span>
            <span class="post-date" title="2023-12-18 17:05:00">2023/12/18</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2023/12/18/Git/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="GIT">GIT</span>
            <span class="post-date" title="2023-12-18 17:00:00">2023/12/18</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2023/11/30/HelpDesk/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="HelpDesk">HelpDesk</span>
            <span class="post-date" title="2023-11-30 21:21:00">2023/11/30</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2023/11/18/OpenWrt/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="OpenWrt">OpenWrt</span>
            <span class="post-date" title="2023-11-18 17:03:00">2023/11/18</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2023/06/01/HCNP-Lab/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="华为NP网络实验">华为NP网络实验</span>
            <span class="post-date" title="2023-06-01 10:46:04">2023/06/01</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2023/06/01/CCNP-Lab/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="CCNP Lab">CCNP Lab</span>
            <span class="post-date" title="2023-06-01 10:46:00">2023/06/01</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2023/04/26/1Panel/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="1Panel">1Panel</span>
            <span class="post-date" title="2023-04-26 14:09:00">2023/04/26</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2023/04/08/HCNA-Lab/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="HCNA Lab">HCNA Lab</span>
            <span class="post-date" title="2023-04-08 11:46:00">2023/04/08</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2023/04/07/CCNA-Lab/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="CCNA Lab">CCNA Lab</span>
            <span class="post-date" title="2023-04-07 20:13:29">2023/04/07</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2023/04/07/OSPF/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="OSPF">OSPF</span>
            <span class="post-date" title="2023-04-07 19:19:00">2023/04/07</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2022/08/12/HomeLab/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="HomeLab">HomeLab</span>
            <span class="post-date" title="2022-08-12 15:09:00">2022/08/12</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2022/08/10/FRP/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="FRP">FRP</span>
            <span class="post-date" title="2022-08-10 10:22:24">2022/08/10</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2022/07/28/WDS-MDT/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="WDS+MDT">WDS+MDT</span>
            <span class="post-date" title="2022-07-28 21:33:00">2022/07/28</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2022/06/21/Anaconda/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Anaconda">Anaconda</span>
            <span class="post-date" title="2022-06-21 20:56:00">2022/06/21</span>
        </a>
        
        <a  class="全部文章 网络 "
           href="/2022/05/25/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E5%B8%88/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="网络规划师">网络规划师</span>
            <span class="post-date" title="2022-05-25 11:57:00">2022/05/25</span>
        </a>
        
        <a  class="全部文章 数据库 "
           href="/2022/03/14/influxDB/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="InfluxDB">InfluxDB</span>
            <span class="post-date" title="2022-03-14 13:25:00">2022/03/14</span>
        </a>
        
        <a  class="全部文章 数据库 "
           href="/2022/03/06/MongoDB/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="MongoDB">MongoDB</span>
            <span class="post-date" title="2022-03-06 17:38:00">2022/03/06</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2021/12/27/VIM/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="VIM">VIM</span>
            <span class="post-date" title="2021-12-27 09:15:00">2021/12/27</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2021/12/16/vsftpd/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="VSFTPD">VSFTPD</span>
            <span class="post-date" title="2021-12-16 08:49:00">2021/12/16</span>
        </a>
        
        <a  class="全部文章 数据库 "
           href="/2021/10/06/Redis/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="REDIS">REDIS</span>
            <span class="post-date" title="2021-10-06 17:19:00">2021/10/06</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2021/09/20/K8s-lab/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="K8s_lab">K8s_lab</span>
            <span class="post-date" title="2021-09-20 08:04:00">2021/09/20</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2021/09/15/K8s/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="K8s">K8s</span>
            <span class="post-date" title="2021-09-15 20:48:00">2021/09/15</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2021/09/08/Ingress/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Ingress">Ingress</span>
            <span class="post-date" title="2021-09-08 23:56:00">2021/09/08</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2021/09/08/Harbor/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Harbor">Harbor</span>
            <span class="post-date" title="2021-09-08 18:04:00">2021/09/08</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/08/26/GO/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Go">Go</span>
            <span class="post-date" title="2021-08-26 11:50:00">2021/08/26</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/08/15/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Java多线程">Java多线程</span>
            <span class="post-date" title="2021-08-15 14:36:00">2021/08/15</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2021/08/11/Nginx/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Nginx">Nginx</span>
            <span class="post-date" title="2021-08-11 23:28:00">2021/08/11</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/08/06/Maven/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Maven">Maven</span>
            <span class="post-date" title="2021-08-06 09:38:00">2021/08/06</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/07/31/Springboot%E9%A1%B9%E7%9B%AE/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Springboot项目">Springboot项目</span>
            <span class="post-date" title="2021-07-31 19:34:00">2021/07/31</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2021/07/22/Docker/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Docker">Docker</span>
            <span class="post-date" title="2021-07-22 14:53:00">2021/07/22</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/07/19/SpringSecurity/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="SpringSecurity">SpringSecurity</span>
            <span class="post-date" title="2021-07-19 20:58:00">2021/07/19</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/07/13/Mybatis/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Mybatis">Mybatis</span>
            <span class="post-date" title="2021-07-13 10:38:00">2021/07/13</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/07/05/NVM/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="NVM">NVM</span>
            <span class="post-date" title="2021-07-05 08:15:00">2021/07/05</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/06/26/Java-Project/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Java Project">Java Project</span>
            <span class="post-date" title="2021-06-26 07:58:00">2021/06/26</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/06/23/Vue/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Vue">Vue</span>
            <span class="post-date" title="2021-06-23 10:48:00">2021/06/23</span>
        </a>
        
        <a  class="全部文章 开发 "
           href="/2021/06/08/SpringBoot2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="SpringBoot2">SpringBoot2</span>
            <span class="post-date" title="2021-06-08 16:51:00">2021/06/08</span>
        </a>
        
        <a  class="全部文章 运维 "
           href="/2021/06/07/CentOS7/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="CentOS7">CentOS7</span>
            <span class="post-date" title="2021-06-07 23:16:00">2021/06/07</span>
        </a>
        
        <a  class="全部文章 读书 "
           href="/2021/04/18/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="设计模式">设计模式</span>
            <span class="post-date" title="2021-04-18 22:19:00">2021/04/18</span>
        </a>
        
        <a  class="全部文章 数据库 "
           href="/2021/03/22/SQL/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="SQL">SQL</span>
            <span class="post-date" title="2021-03-22 18:33:00">2021/03/22</span>
        </a>
        
        <a  class="全部文章 读书 "
           href="/2021/03/14/%E6%97%B6%E9%97%B4%E7%AE%A1%E7%90%86/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="时间管理">时间管理</span>
            <span class="post-date" title="2021-03-14 21:49:00">2021/03/14</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2021/03/14/Hexo/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hexo">Hexo</span>
            <span class="post-date" title="2021-03-14 08:31:00">2021/03/14</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2020/09/12/UltraISO/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="UltraISO">UltraISO</span>
            <span class="post-date" title="2020-09-12 11:42:00">2020/09/12</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2020/09/12/Ventoy/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Ventoy">Ventoy</span>
            <span class="post-date" title="2020-09-12 11:42:00">2020/09/12</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-HCIE Lab" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">HCIE Lab</h1>
    
    <div class="article-meta">
        
        <span class="top"><a>置顶</a></span>
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="网络">网络</a>
            
        </span>
        
        
    </div>
    <div class="article-meta">
        
            发布时间 : <time class="date" title='最后更新: 2025-10-08 19:24:07'>2024-05-06 19:42</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:53.5k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HCIE-LAB%EF%BC%88%E6%9C%89%E4%BB%B7%E5%80%BC%E7%9A%84%E9%A1%B9%E7%9B%AE%EF%BC%89"><span class="toc-text">HCIE LAB（有价值的项目）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#X%E5%9B%AD%E5%8C%BA%EF%BC%9A%E4%BC%A0%E7%BB%9F%E7%BD%91%E6%94%B9%E9%80%A0%E5%8F%8A%E5%8D%87%E7%BA%A7"><span class="toc-text">X园区：传统网改造及升级</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF"><span class="toc-text">环境信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81%E5%92%8C%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">1. 设置密码和初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E9%85%8D%E7%BD%AEEth-Trunk-Trunk-Hybrid-Access-Loopback%E6%8E%A5%E5%8F%A3"><span class="toc-text">2.1 配置Eth-Trunk &#x2F; Trunk &#x2F; Hybrid &#x2F; Access &#x2F; Loopback接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E7%BB%91%E5%AE%9Avpn-instance-%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%8F%A3IP%E5%9C%B0%E5%9D%80-%E5%BC%80%E5%90%AFDHCP"><span class="toc-text">2.2 绑定vpn-instance &#x2F; 配置接口IP地址 &#x2F; 开启DHCP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E9%85%8D%E7%BD%AE-%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1-ip-prefix-vpn-instance-vsys"><span class="toc-text">3.1 配置 静态路由 &#x2F; ip-prefix &#x2F; vpn-instance &#x2F; vsys</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E9%85%8D%E7%BD%AE-OSPF"><span class="toc-text">3.2 配置 OSPF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E9%85%8D%E7%BD%AE-%E6%97%A0%E7%BA%BF-802-1X-%E8%AE%A4%E8%AF%81-AP-%E5%BC%BA%E5%88%B6%E4%B8%8D%E8%AE%A4%E8%AF%81"><span class="toc-text">4.1 配置 无线 &#x2F; 802.1X 认证 &#x2F; AP 强制不认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E9%85%8D%E7%BD%AE-802-1X-MAC-%E6%8E%A5%E5%85%A5%E6%A8%A1%E7%89%88%EF%BC%8C%E5%B9%B6%E7%BB%91%E5%AE%9A%E5%88%B0%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E6%A8%A1%E7%89%88%E4%B8%AD"><span class="toc-text">4.2 配置 802.1X &#x2F; MAC 接入模版，并绑定到身份认证模版中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%9C%A8%E6%B1%87%E8%81%9A%E8%AE%BE%E5%A4%87%E7%9A%84%E7%9B%B8%E5%BA%94%E7%AB%AF%E5%8F%A3%E4%B8%8A%E5%BC%80%E5%90%AF%E8%AE%A4%E8%AF%81%E6%A8%A1%E7%89%88"><span class="toc-text">4.3 在汇聚设备的相应端口上开启认证模版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%85%8D%E7%BD%AE-FW-%E7%AD%96%E7%95%A5"><span class="toc-text">5. 配置 FW 策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-ACL-NAT-Traffic"><span class="toc-text">6. ACL &#x2F; NAT &#x2F; Traffic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%B5%8B%E8%AF%95"><span class="toc-text">7. 测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Y%E5%9B%AD%E5%8C%BA%EF%BC%9AiMaster-NCE-Campus-SD-WAN-%E9%83%A8%E7%BD%B2"><span class="toc-text">Y园区：iMaster NCE-Campus SD-WAN 部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NCE-%E7%BA%B3%E7%AE%A1%E8%AE%BE%E5%A4%87"><span class="toc-text">NCE 纳管设备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0-%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF"><span class="toc-text">0 - 环境信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%87%E6%8D%A2-EVPN-%E7%BD%91%E7%BB%9C%E9%9A%A7%E9%81%93%E6%A8%A1%E5%BC%8F"><span class="toc-text">1 - 切换 EVPN 网络隧道模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%85%B3%E9%97%AD-%E7%89%A9%E7%90%86%E7%BD%91%E7%BB%9C-%E5%BC%80%E5%B1%80%E9%82%AE%E4%BB%B6%E5%8A%A0%E5%AF%86"><span class="toc-text">2 - 关闭 物理网络 开局邮件加密</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%A1%AE%E5%AE%9A-BGP-AS-65003-IP%E5%9C%B0%E5%9D%80%E6%B1%A0-10-99-0-0-16"><span class="toc-text">3 - 确定 BGP AS 65003 &amp; IP地址池 10.99.0.0&#x2F;16</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BA-Site-Y-Site-Store1"><span class="toc-text">4 - 创建 Site_Y &amp; Site_Store1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%B7%BB%E5%8A%A0%E8%AE%BE%E5%A4%87"><span class="toc-text">5 - 添加设备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%88%9B%E5%BB%BA-WAN%E9%93%BE%E8%B7%AF%E6%A8%A1%E7%89%88"><span class="toc-text">6 - 创建 WAN链路模版</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E9%9B%B6%E9%85%8D%E7%BD%AE%E5%BC%80%E5%B1%80-%E8%B7%AF%E7%94%B1%E5%99%A8%E6%89%98%E7%AE%A1%E9%85%8D%E7%BD%AE-%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%92%8C%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">7 - 零配置开局 路由器托管配置(手动配置和自动配置)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E7%AB%99%E7%82%B9%E9%97%B4%E7%BB%84%E7%BD%91-RR%E5%8F%8D%E5%B0%84%E5%99%A8"><span class="toc-text">8 - 站点间组网 RR反射器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%89%98%E7%AE%A1%E9%85%8D%E7%BD%AE-%E5%B9%B6%E9%83%A8%E7%BD%B2-Management-VN"><span class="toc-text">9 - 交换机托管配置 并部署 Management VN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-%E7%BA%B3%E7%AE%A1%E6%A3%80%E6%9F%A5"><span class="toc-text">10 - 纳管检查</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fabric-%E6%B1%A0-%E8%B5%84%E6%BA%90%E7%BD%91%E7%BB%9C"><span class="toc-text">Fabric(池)资源网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E8%A7%84%E5%88%92%E8%B5%84%E6%BA%90%E6%B1%A0"><span class="toc-text">1、规划资源池</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AEVXLAN%E7%BB%84%E7%BD%91%E6%96%B9%E5%BC%8F"><span class="toc-text">2、配置VXLAN组网方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E9%85%8D%E7%BD%AEDHCP%E6%9C%8D"><span class="toc-text">3、配置DHCP服</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E9%85%8D%E7%BD%AE%E5%A4%96%E9%83%A8%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3"><span class="toc-text">4、配置外部网络接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E9%85%8D%E7%BD%AE%E5%A4%96%E9%83%A8%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3"><span class="toc-text">5、配置外部网络接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E9%85%8D%E7%BD%AEVN%E9%83%A8%E7%BD%B2"><span class="toc-text">6、配置VN部署</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81%E9%85%8D%E7%BD%AEVN%E4%B9%8B%E9%97%B4%E4%BA%92%E9%80%9A"><span class="toc-text">7、配置VN之间互通</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8%E3%80%81%E9%85%8D%E7%BD%AE%E8%AE%A4%E8%AF%81%E7%AD%96%E7%95%A5"><span class="toc-text">8、配置认证策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9%E3%80%81%E9%85%8D%E7%BD%AE%E6%8E%88%E6%9D%83%E8%A7%84%E5%88%99-%E6%8E%88%E6%9D%83%E7%BB%93%E6%9E%9C"><span class="toc-text">9、配置授权规则&#x2F;授权结果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10%E3%80%81%E9%85%8D%E7%BD%AE%E6%97%A0%E7%BA%BF"><span class="toc-text">10、配置无线</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SD-WAN"><span class="toc-text">SD-WAN</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BAWAN%E4%BE%A7VN%EF%BC%88Y-OA-TO-Sites-Guest-To-Internet-OA-HUB-Spoke%E7%BB%84%E7%BD%91%EF%BC%89"><span class="toc-text">1、创建WAN侧VN（Y_OA_TO_Sites &#x2F; Guest_To_Internet &#x2F; OA HUB-Spoke组网）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81LAN-WAN%E8%9E%8D%E5%90%88"><span class="toc-text">2、LAN&#x2F;WAN融合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81WAN%E7%BB%84%E7%BD%91"><span class="toc-text">3、WAN组网</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81Internet%E8%AE%BF%E9%97%AE"><span class="toc-text">4、Internet访问</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E7%9B%91%E6%8E%A7"><span class="toc-text">5、监控</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E8%AE%A2%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%B5%81%E9%87%8F%E5%81%9A%E4%BD%8E%E5%BB%B6%E8%BF%9F%E5%A4%84%E7%90%86"><span class="toc-text">6、订单业务流量做低延迟处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81%E4%BC%98%E5%8C%96%E8%B7%AF%E7%94%B1"><span class="toc-text">7、优化路由</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Z%E5%9B%AD%E5%8C%BA%EF%BC%9A%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%89%BF%E8%BD%BD%E5%8F%8A%E8%AE%BE%E8%AE%A1"><span class="toc-text">Z园区：广域网承载及设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%85%A8%E5%B1%80ISIS%E9%85%8D%E7%BD%AE-IGB%E6%89%93%E9%80%9A"><span class="toc-text">1、全局ISIS配置(IGB打通)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81-%E5%85%A8%E5%B1%80MPLS%E9%85%8D%E7%BD%AE"><span class="toc-text">2、 全局MPLS配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81-BGP-65000-group-IBGP-vpnv4%E9%85%8D%E7%BD%AE"><span class="toc-text">3、 BGP 65000 &#x2F; group IBGP &#x2F; vpnv4配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81-65000-65001-VPN-Instance-IP-BGP"><span class="toc-text">4、 [65000, 65001] VPN-Instance&#x2F;IP&#x2F;BGP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81-65000-65003-VPN-Instance-IP-BGP"><span class="toc-text">5、 [65000, 65003] VPN-Instance&#x2F;IP&#x2F;BGP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81-65000-65004-VPN-Instance-IP-BGP"><span class="toc-text">6、 [65000, 65004] VPN-Instance&#x2F;IP&#x2F;BGP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E9%85%8D%E7%BD%AEPE-BGP-export-route-policy"><span class="toc-text">7、配置PE BGP export route-policy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81Y%E8%BF%87%E6%BB%A4%E8%B7%AF%E7%94%B1-X%E5%8F%8C%E7%82%B9%E5%8F%8C%E8%B7%AF%E8%B7%AF%E7%94%B1%E9%87%8D%E5%8F%91%E5%B8%83"><span class="toc-text">8、Y过滤路由,X双点双路路由重发布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81VPN-FRR%E4%B8%8E-MPLS-MTU"><span class="toc-text">9、VPN FRR与 MPLS MTU</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81QOS-FW-Test"><span class="toc-text">10、QOS &amp; FW &amp; Test</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Python%E7%BD%91%E7%BB%9C%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-text">Python网络自动化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%89%8D5%E4%B8%AA%E9%9C%80%E6%B1%82"><span class="toc-text">1、前5个需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%88%9B%E5%BB%BA%E2%80%9Ccommand-txt%E2%80%9D%E6%96%87%E4%BB%B6%EF%BC%8C%E5%AE%8C%E6%88%901%E5%92%8C4%E9%9C%80%E6%B1%82"><span class="toc-text">2、创建“command.txt”文件，完成1和4需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%9B%B8%E5%85%B3%E9%9C%80%E6%B1%82%E7%9A%84Python%E7%A8%8B%E5%BA%8F"><span class="toc-text">3、相关需求的Python程序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%85%AB%E8%82%A1%E6%96%87"><span class="toc-text">网络八股文</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%86%85%E7%BD%91%E6%94%BB%E5%87%BB%E5%9C%BA%E6%99%AF"><span class="toc-text">1、内网攻击场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81CloudCampus-%E5%85%A8%E7%BD%91%E4%B8%9A%E5%8A%A1%E9%9A%8F%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="toc-text">2、CloudCampus 全网业务随行原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81FRR-%E7%8E%AF%E8%B7%AF%E6%8A%80%E6%9C%AF"><span class="toc-text">3、FRR 环路技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81FRR-TI-LFA%E7%8E%AF%E8%B7%AF%E9%A3%8E%E9%99%A9"><span class="toc-text">4、FRR TI-LFA环路风险</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81LDP%E3%80%81RSVP-TE-%E8%B7%9FSR-%E6%AF%94%E8%BE%83"><span class="toc-text">5、LDP、RSVP-TE 跟SR 比较</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%A4%96%E7%BD%91%E6%94%BB%E5%87%BB%E5%9C%BA%E6%99%AF"><span class="toc-text">6、外网攻击场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81CloudCampus-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%9A%8F%E8%A1%8C%E5%A4%9A%E8%AE%A4%E8%AF%81%E7%82%B9"><span class="toc-text">7、CloudCampus 解决方案的业务随行多认证点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-text">其他</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E4%B8%8E%E6%8A%80%E5%B7%A7"><span class="toc-text">常用命令与技巧</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%92%E6%9F%A5%E5%91%BD%E4%BB%A4"><span class="toc-text">排查命令</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="HCIE-LAB（有价值的项目）"><a href="#HCIE-LAB（有价值的项目）" class="headerlink" title="HCIE LAB（有价值的项目）"></a>HCIE LAB（有价值的项目）</h1><blockquote>
<ol>
<li>X园区：传统网改造及升级</li>
<li>Y园区：iMaster NCE-Campus SD-WAN 部署</li>
<li>Z园区：广域网承载及设计</li>
<li>Python网络自动化</li>
<li>网络八股文</li>
</ol>
</blockquote>
<h2 id="X园区：传统网改造及升级"><a href="#X园区：传统网改造及升级" class="headerlink" title="X园区：传统网改造及升级"></a>X园区：传统网改造及升级</h2><h3 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h3><ol>
<li>账号密码</li>
</ol>
<pre><code class="hljs bash"><span class="hljs-comment"># 通用的密码</span>
admin/Admin@123
<span class="hljs-comment"># 防火墙 X_T1_FW1</span>
admin/Huawei@123</code></pre>

<ol start="2">
<li>IP规划</li>
</ol>
<pre><code class="hljs bash"><span class="hljs-comment">## 公网 网段:10.255.X.0/24 8根线, x取值1-8, 本段.1, 对端的地址都是.254</span>
<span class="hljs-comment"># X_Export1 X_Export2   Y_Export    Store_Export</span>
10.255.1.1  10.255.3.1  10.255.5.1  10.255.7.1
10.255.2.1  10.255.4.1  10.255.6.1  10.255.8.1

<span class="hljs-comment">## X园区内部 网段:10.1.X.X/X</span>
<span class="hljs-comment"># loopback接口  10.1.0.X/32</span>
<span class="hljs-comment"># X_Export1 X_Export2   X_Core&#123;P,E,G&#125;   X_T1_AGG1   X_T1_AGG2   X_FW&#123;E,G&#125;       X_AC</span>
10.1.0.1    10.1.0.2    10.1.0.&#123;3,4,5&#125;  10.1.0.6    10.1.0.7    10.1.0.&#123;8.9&#125;    10.1.0.11

<span class="hljs-comment"># 设备互联地址  10.1.200.X/30 从上到下 从左到右 网段0,4,8,12,16,20,24,28,32</span>
<span class="hljs-comment"># E1_C=1_2  E2_C=5_6    C_AC=9_10   C_FW=&#123;13_14,17_18,21_22,25_26&#125;  C_T1AGG1=29_30      C_T2AGG1=33_34</span>
<span class="hljs-comment"># vlan201   vlan202     vlan203     vlan&#123;204,205,206,207&#125;           vlan208             vlan209   </span>
服务器 10.1.60.0/24   vlan60
</code></pre>


<h3 id="1-设置密码和初始化"><a href="#1-设置密码和初始化" class="headerlink" title="1. 设置密码和初始化"></a>1. 设置密码和初始化</h3><pre><code class="hljs bash"><span class="hljs-comment"># X_T1_AC</span>
system-view
user-interface console 0
  idle-time 0 0
  authentication-mode password
  <span class="hljs-built_in">set</span> authentication password cipher
  Enter New Password...
  <span class="hljs-built_in">return</span>
  quit
<span class="hljs-comment"># X_T2_ACC1 / X_T2_ACC2 / X_T2_AGG1</span>
system-view
user-interface console 0
  idle-time 0 0
  authentication-mode password
  <span class="hljs-built_in">set</span> authentication password cipher Huawei@123
  <span class="hljs-built_in">return</span>
  quit
<span class="hljs-comment"># Other</span>
system-view
user-interface console 0
  idle-time 0 0
  quit
lldp <span class="hljs-built_in">enable</span>
undo info <span class="hljs-built_in">enable</span></code></pre>

<h3 id="2-1-配置Eth-Trunk-Trunk-Hybrid-Access-Loopback接口"><a href="#2-1-配置Eth-Trunk-Trunk-Hybrid-Access-Loopback接口" class="headerlink" title="2.1 配置Eth-Trunk &#x2F; Trunk &#x2F; Hybrid &#x2F; Access &#x2F; Loopback接口"></a>2.1 配置Eth-Trunk &#x2F; Trunk &#x2F; Hybrid &#x2F; Access &#x2F; Loopback接口</h3><h3 id="2-2-绑定vpn-instance-配置接口IP地址-开启DHCP"><a href="#2-2-绑定vpn-instance-配置接口IP地址-开启DHCP" class="headerlink" title="2.2 绑定vpn-instance &#x2F; 配置接口IP地址 &#x2F; 开启DHCP"></a>2.2 绑定vpn-instance &#x2F; 配置接口IP地址 &#x2F; 开启DHCP</h3><ol>
<li>X_T_Export</li>
</ol>
<pre><code class="hljs bash"><span class="hljs-comment"># X_T_Export2</span>
dis lldp nei brief
interface LoopBack 0
  ip add 10.1.0.2 32
interface GigabitEthernet 0/0/1
  ip add 10.1.200.5 30
interface GigabitEthernet 0/0/0
  ip add 10.255.3.1 24
interface GigabitEthernet 0/0/2
  ip add 10.255.4.1 24
dis ip int brief</code></pre>

<ol start="2">
<li>X_T_CROE</li>
</ol>
<pre><code class="hljs bash">dhcp <span class="hljs-built_in">enable</span>
vlan batch 51 to 55 60 100 to 105 201 to 209
dis port vlan
interface GigabitEthernet 0/0/2
  port link-type access
  port default vlan 202
interface GigabitEthernet 0/0/3
  port trunk allow-pass vlan 51 to 55 101 to 105
interface GigabitEthernet 0/0/4
  port link-type trunk
  port trunk allow-pass vlan 204 205
  undo port trunk allow-pass vlan 1
interface GigabitEthernet 0/0/5
  port link-type trunk
  port trunk allow-pass vlan 206 207
  undo port trunk allow-pass vlan 1
interface GigabitEthernet 0/0/6
  port link-type access
  port default vlan 60
interface Eth-Trunk 2
  mode lacp-static
  port link-type trunk
  port trunk allow-pass vlan 100 209
  dis lldp nei brief
  trunkport GigabitEthernet 0/0/9 to 0/0/10
<span class="hljs-comment">#</span>
ip vpn-instance Employee
  route-distinguisher 65001:1
    quit
  quit
ip vpn-instance Guest
  route-distinguisher 65001:2
    quit
  quit
<span class="hljs-comment"># </span>
display current-configuration configuration ip-pool
...
ip pool wired_finance1
  vpn-instance Employee
  ...
<span class="hljs-comment">#</span>
interface lo1
  ip binding vpn-instance Employee
  ip add 10.1.0.4 32
interface lo2
  ip binding vpn-instance Guest
  ip add 10.1.0.5 32
interface vlanif 202
  ip add 10.1.200.6 30
interface vlanif 204
  ip add 10.1.200.13 30
interface vlanif 205
  ip add 10.1.200.17 30
interface vlanif 206
  ip binding vpn-instance Employee
  ip add 10.1.200.21 30
interface vlanif 207
  ip binding vpn-instance Guest
  ip add 10.1.200.25 30
interface vlanif 208
  ip binding vpn-instance Employee
  ip add 10.1.200.29 30
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 209
  ip binding vpn-instance Employee
  ip add 10.1.200.33 30
  dhcp <span class="hljs-keyword">select</span> global
<span class="hljs-comment">#</span>
interface vlanif 51
  ip binding vpn-instance Employee
  ip add 10.1.51.254 24
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 52
  ip binding vpn-instance Employee
  ip add 10.1.52.254 24
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 53
  ip binding vpn-instance Employee
  ip add 10.1.53.254 24
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 54
  ip binding vpn-instance Employee
  ip add 10.1.54.254 24
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 55
  ip binding vpn-instance Employee
  ip add 10.1.55.254 24
  dhcp <span class="hljs-keyword">select</span> global
<span class="hljs-comment">#</span>
interface vlanif 60
  ip binding vpn-instance Employee
  ip add 10.1.60.254 24
<span class="hljs-comment">#</span>
interface vlanif 101
  ip binding vpn-instance Guest
  ip add 10.1.101.254 24
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 102
  ip binding vpn-instance Guest
  ip add 10.1.102.254 24
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 103
  ip binding vpn-instance Guest
  ip add 10.1.103.254 24
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 104
  ip binding vpn-instance Guest
  ip add 10.1.104.254 24
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 105
  ip binding vpn-instance Guest
  ip add 10.1.105.254 24
  dhcp <span class="hljs-keyword">select</span> global</code></pre>

<ol start="3">
<li>X_T1</li>
</ol>
<pre><code class="hljs bash"><span class="hljs-comment"># X_T1_AGG1 </span>
dhcp <span class="hljs-built_in">enable</span>
vlan batch 11 to 15 21 to 25
dis port vlan
interface Eth-trunk 2
  port hybrid tagged vlan 11 to 15 21 to 25 100
interface Eth-trunk 3
  port hybrid tagged vlan 11 to 15 21 to 25 100
<span class="hljs-comment">#</span>
dis ip int brief
interface vlanif 11
  ip add 10.1.11.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 12
  ip add 10.1.12.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 13
  ip add 10.1.13.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 14
  ip add 10.1.14.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 15
  ip add 10.1.15.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 21
  ip add 10.1.21.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 22
  ip add 10.1.22.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 23
  ip add 10.1.23.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 24
  ip add 10.1.24.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 25
  ip add 10.1.25.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
dis ip int  brief
<span class="hljs-comment"># X_T1_ACC1</span>
vlan batch 11 to 15 21 to 25 100
interface Eth-trunk 1
  port trunk allow-pass vlan 11 to 15 21 to 25 100
dis port vlan
<span class="hljs-comment"># X_T1_ACC2</span>
vlan batch 11 to 15 21 to 25 100
interface Eth-trunk 1
  port trunk allow-pass vlan 11 to 15 21 to 25 100 
interface GigabitEthernet 0/0/1
 port hybrid pvid vlan 24
 port hybrid untagged vlan 24
dis port vlan</code></pre>

<ol start="4">
<li>X_T2</li>
</ol>
<pre><code class="hljs bash"><span class="hljs-comment"># X_T2_AGG1</span>
dhcp <span class="hljs-built_in">enable</span>
vlan batch 31 to 35 41 to 45 100 209
interface Eth-Trunk 1
  mode lacp-static
  port link-type trunk
  port trunk allow-pass vlan 100 209
  dis lldp nei brief
  trunkport GigabitEthernet 0/0/5 to 0/0/6
interface Eth-Trunk 2
  mode lacp-static
  port hybrid tagged vlan 31 to 35 41 to 45 100
  trunkport GigabitEthernet 0/0/1 to 0/0/2
interface Eth_Trunk 3
  mode lacp-static
  port hybrid tagged vlan 31 to 35 41 to 45 100
  trunkport GigabitEthernet 0/0/3 to 0/0/4
dis port vlan
<span class="hljs-comment">#</span>
dis ip int brier
interface vlanif 209
  ip add 10.1.200.34 30
interface vlanif 31
  ip add 10.1.31.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 32
  ip add 10.1.32.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 33
  ip add 10.1.33.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 34
  ip add 10.1.34.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 35
  ip add 10.1.35.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 41
  ip add 10.1.41.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 42
  ip add 10.1.42.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 43
  ip add 10.1.43.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 44
  ip add 10.1.44.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 45
  ip add 10.1.45.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
<span class="hljs-comment"># X_T2_ACC1</span>
vlan batch 31 to 35 41 to 45 100
interface Eth-Trunk 1
  mode lacp-static
  port link-type trunk
  port trunk allow-pass vlan 31 to 35 41 to 45 100
  dis lldp nei brief
  trunkport GigabitEthernet 0/0/23 to 0/0/24
interface GigabitEthernet 0/0/1
 port hybrid pvid vlan 33
 port hybrid untagged vlan 33
<span class="hljs-comment"># X_T2_ACC2</span>
vlan batch 31 to 35 41 to 45 100
interface Eth-Trunk 1
  mode lacp-static
  port link-type trunk
  port trunk allow-pass vlan 31 to 35 41 to 45 100
  dis lldp nei brief
  trunkport GigabitEthernet 0/0/23 to 0/0/24
interface GigabitEthernet 0/0/22
  port link-type access
  port default vlan 100</code></pre>

<ol start="5">
<li>X_T1_FW</li>
</ol>
<pre><code class="hljs bash"><span class="hljs-comment"># X_T1_FW</span>
vlan batch 204 to 207
interface GigabitEthernet 1/0/1
  portswitch
  port link-type trunk
  port trunk allow-pass vlan 204 205
  undo port trunk allow-pass vlan 1
interface GigabitEthernet 1/0/2
  portswitch
  port link-type trunk
  port trunk allow-pass vlan 206 207
  undo port trunk allow-pass valn 1
interface lo1
interface lo2
vsys <span class="hljs-built_in">enable</span>
vsys name Employee
  assign vlan 204
  assign vlan 206
  assign interface LoopBack 1
vsys name Guest
  assign vlan 205
  assign vlan 207
  assingn interface LoopBack 2
interface lo1
  ip add 10.1.0.8 32
interface lo2
  ip add 10.1.0.9 32
interface vlanif 204
  ip add 10.1.200.14 30
interface vlanif 205
  ip add 10.1.200.18 30
interface vlanif 206
  ip add 10.1.200.22 30
interface vlanif 207
  ip add 10.1.200.26 30
interface Virtual-<span class="hljs-keyword">if</span> 1
  ip add 10.1.200.254 32
interface Virtual-<span class="hljs-keyword">if</span> 2
  ip add 10.1.200.253 32
switch vsys Guest
  sys
    firewall zone trust
      add interface vlanif 207
    firewall zone untrust
      add interface vlanif 205
      add interface virtual-if 2
    security-policy
      rule name ospf
        source-zone trust
        source-zone untrust
        source-zone <span class="hljs-built_in">local</span>
        destination-zone <span class="hljs-built_in">local</span>
        destination-zone untrust
        destination-zone trust
        service ospf
        action permit
switch vsys Employee
  sys
    firewall zone trust
      add interface vlanif 206 
    firewall zone untrust
      add interface vlanif 204 
      add interface virtual-if 1
    security-policy
      rule name ospf
        source-zone trust
        source-zone untrust
        source-zone <span class="hljs-built_in">local</span>
        destination-zone <span class="hljs-built_in">local</span>
        destination-zone untrust
        destination-zone trust
        service ospf
        action permit</code></pre>

<h3 id="3-1-配置-静态路由-ip-prefix-vpn-instance-vsys"><a href="#3-1-配置-静态路由-ip-prefix-vpn-instance-vsys" class="headerlink" title="3.1 配置 静态路由 &#x2F; ip-prefix &#x2F; vpn-instance &#x2F; vsys"></a>3.1 配置 静态路由 &#x2F; ip-prefix &#x2F; vpn-instance &#x2F; vsys</h3><h3 id="3-2-配置-OSPF"><a href="#3-2-配置-OSPF" class="headerlink" title="3.2 配置 OSPF"></a>3.2 配置 OSPF</h3><ol>
<li>X_T_Export</li>
</ol>
<pre><code class="hljs bash">&lt;
&gt;
HCIE Lab
置顶  网络
发布时间 : 2024-05-06 19:42
字数:34.7k 阅读 :398
HCIE LAB（有价值的项目）
X园区：传统网改造及升级
Y园区：iMaster NCE-Campus SD-WAN 部署
Z园区：广域网承载及设计
Python网络自动化
网络八股文
X园区：传统网改造及升级
环境信息
账号密码
<span class="hljs-comment"># 通用的密码</span>
admin/Huawei@123
<span class="hljs-comment"># 防火墙 X_T1_FW1</span>
admin/Admin@123

IP规划
<span class="hljs-comment">## 公网 网段:10.255.X.0/24 8根线, x取值1-8, 本段.1, 对端的地址都是.254</span>
<span class="hljs-comment"># X_Export1 X_Export2   Y_Export    Store_Export</span>
10.255.1.1  10.255.3.1  10.255.5.1  10.255.7.1
10.255.2.1  10.255.4.1  10.255.6.1  10.255.8.1

<span class="hljs-comment">## X园区内部 网段:10.1.X.X/X</span>
<span class="hljs-comment"># loopback接口  10.1.0.X/32</span>
<span class="hljs-comment"># X_Export1 X_Export2   X_Core&#123;P,E,G&#125;   X_T1_AGG1   X_T1_AGG2   X_FW&#123;E,G&#125;       X_AC</span>
10.1.0.1    10.1.0.2    10.1.0.&#123;3,4,5&#125;  10.1.0.6    10.1.0.7    10.1.0.&#123;8.9&#125;    10.1.0.11

<span class="hljs-comment"># 设备互联地址  10.1.200.X/30 从上到下 从左到右 网段0,4,8,12,16,20,24,28,32</span>
<span class="hljs-comment"># E1_C=1_2  E2_C=5_6    C_AC=9_10   C_FW=&#123;13_14,17_18,21_22,25_26&#125;  C_T1AGG1=29_30      C_T2AGG1=33_34</span>
<span class="hljs-comment"># vlan201   vlan202     vlan203     vlan&#123;204,205,206,207&#125;           vlan208             vlan209   </span>
服务器 10.1.60.0/24   vlan60

1. 设置密码和初始化
<span class="hljs-comment"># X_T1_AC</span>
system-view
user-interface console 0
  idle-time 0 0
  authentication-mode password
  <span class="hljs-built_in">set</span> authentication password cipher
  Enter New Password...
  <span class="hljs-built_in">return</span>
  quit
<span class="hljs-comment"># X_T2_ACC1 / X_T2_ACC2 / X_T2_AGG1</span>
system-view
user-interface console 0
  idle-time 0 0
  authentication-mode password
  <span class="hljs-built_in">set</span> authentication password cipher Huawei@123
  <span class="hljs-built_in">return</span>
  quit
<span class="hljs-comment"># Other</span>
system-view
user-interface console 0
  idle-time 0 0
  quit
lldp <span class="hljs-built_in">enable</span>
undo info <span class="hljs-built_in">enable</span>

2.1 配置Eth-Trunk / Trunk / Hybrid / Access / Loopback接口
2.2 绑定vpn-instance / 配置接口IP地址 / 开启DHCP
X_T_Export
<span class="hljs-comment"># X_T_Export2</span>
dis lldp nei brief
interface LoopBack 0
  ip add 10.1.0.2 32
interface GigabitEthernet 0/0/1
  ip add 10.1.200.5 30
interface GigabitEthernet 0/0/0
  ip add 10.255.3.1 24
interface GigabitEthernet 0/0/2
  ip add 10.255.4.1 24
dis ip int brief

X_T_CROE
dhcp <span class="hljs-built_in">enable</span>
vlan batch 51 to 55 60 100 to 105 201 to 209
dis port vlan
interface GigabitEthernet 0/0/2
  port link-type access
  port default vlan 202
interface GigabitEthernet 0/0/3
  port trunk allow-pass vlan 51 to 55 101 to 105
interface GigabitEthernet 0/0/4
  port link-type trunk
  port trunk allow-pass vlan 204 205
  undo port trunk allow-pass vlan 1
interface GigabitEthernet 0/0/5
  port link-type trunk
  port trunk allow-pass vlan 206 207
  undo port trunk allow-pass vlan 1
interface GigabitEthernet 0/0/6
  port link-type access
  port default vlan 60
interface Eth-Trunk 2
  mode lacp-static
  port link-type trunk
  port trunk allow-pass vlan 100 209
  dis lldp nei brief
  trunkport GigabitEthernet 0/0/9 to 0/0/10
<span class="hljs-comment">#</span>
ip vpn-instance Employee
  route-distinguisher 65001:1
    quit
  quit
ip vpn-instance Guest
  route-distinguisher 65001:2
    quit
  quit
<span class="hljs-comment"># </span>
display current-configuration configuration ip-pool
...
ip pool wired_finance1
  vpn-instance Employee
  ...
<span class="hljs-comment">#</span>
interface lo1
  ip binding vpn-instance Employee
  ip add 10.1.0.4 32
interface lo2
  ip binding vpn-instance Guest
  ip add 10.1.0.5 32
interface vlanif 202
  ip add 10.1.200.6 30
interface vlanif 204
  ip add 10.1.200.13 30
interface vlanif 205
  ip add 10.1.200.17 30
interface vlanif 206
  ip binding vpn-instance Employee
  ip add 10.1.200.21 30
interface vlanif 207
  ip binding vpn-instance Guest
  ip add 10.1.200.25 30
interface vlanif 208
  ip binding vpn-instance Employee
  ip add 10.1.200.29 30
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 209
  ip binding vpn-instance Employee
  ip add 10.1.200.33 30
  dhcp <span class="hljs-keyword">select</span> global
<span class="hljs-comment">#</span>
interface vlanif 51
  ip binding vpn-instance Employee
  ip add 10.1.51.254 24
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 52
  ip binding vpn-instance Employee
  ip add 10.1.52.254 24
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 53
  ip binding vpn-instance Employee
  ip add 10.1.53.254 24
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 54
  ip binding vpn-instance Employee
  ip add 10.1.54.254 24
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 55
  ip binding vpn-instance Employee
  ip add 10.1.55.254 24
  dhcp <span class="hljs-keyword">select</span> global
<span class="hljs-comment">#</span>
interface vlanif 60
  ip binding vpn-instance Employee
  ip add 10.1.60.254 24
<span class="hljs-comment">#</span>
interface vlanif 101
  ip binding vpn-instance Guest
  ip add 10.1.101.254 24
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 102
  ip binding vpn-instance Guest
  ip add 10.1.102.254 24
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 103
  ip binding vpn-instance Guest
  ip add 10.1.103.254 24
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 104
  ip binding vpn-instance Guest
  ip add 10.1.104.254 24
  dhcp <span class="hljs-keyword">select</span> global
interface vlanif 105
  ip binding vpn-instance Guest
  ip add 10.1.105.254 24
  dhcp <span class="hljs-keyword">select</span> global

X_T1
<span class="hljs-comment"># X_T1_AGG1 </span>
dhcp <span class="hljs-built_in">enable</span>
vlan batch 11 to 15 21 to 25
dis port vlan
interface Eth-trunk 2
  port hybrid tagged vlan 11 to 15 21 to 25 100
interface Eth-trunk 3
  port hybrid tagged vlan 11 to 15 21 to 25 100
<span class="hljs-comment">#</span>
dis ip int brief
interface lo0
  ip add 10.1.0.6 32
interface vlanif 11
  ip add 10.1.11.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 12
  ip add 10.1.12.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 13
  ip add 10.1.13.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 14
  ip add 10.1.14.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 15
  ip add 10.1.15.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 21
  ip add 10.1.21.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 22
  ip add 10.1.22.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 23
  ip add 10.1.23.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 24
  ip add 10.1.24.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
interface vlanif 25
  ip add 10.1.25.254 24
  dhcp <span class="hljs-keyword">select</span> relay
  dhcp relay server-ip 10.1.200.29
dis ip int  brief
<span class="hljs-comment"># X_T1_ACC1</span>
vlan batch 11 to 15 21 to 25 100
interface Eth-trunk 1
  port trunk allow-pass vlan 11 to 15 21 to 25 100
dis port vlan
<span class="hljs-comment"># X_T1_ACC2</span>
vlan batch 11 to 15 21 to 25 100
interface Eth-trunk 1
  port trunk allow-pass vlan 11 to 15 21 to 25 100 
interface GigabitEthernet 0/0/1
 port hybrid pvid vlan 24
 port hybrid untagged vlan 24
dis port vlan

X_T2
<span class="hljs-comment"># X_T2_AGG1</span>
dhcp <span class="hljs-built_in">enable</span>
vlan batch 31 to 35 41 to 45 100 209
interface Eth-Trunk 1
  mode lacp-static
  port link-type trunk
  port trunk allow-pass vlan 100 209
  dis lldp nei brief
  trunkport GigabitEthernet 0/0/5 to 0/0/6
interface Eth-Trunk 2
  mode lacp-static
  port hybrid tagged vlan 31 to 35 41 to 45 100
  trunkport GigabitEthernet 0/0/1 to 0/0/2
interface Eth_Trunk 3
  mode lacp-static
  port hybrid tagged vlan 31 to 35 41 to 45 100
  trunkport GigabitEthernet 0/0/3 to 0/0/4
dis port vlan
<span class="hljs-comment">#</span>
dis ip int brier
interface vlanif 209
  ip add 10.1.200.34 30
interface vlanif 31
  ip add 10.1.31.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 32
  ip add 10.1.32.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 33
  ip add 10.1.33.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 34
  ip add 10.1.34.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 35
  ip add 10.1.35.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 41
  ip add 10.1.41.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 42
  ip add 10.1.42.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 43
  ip add 10.1.43.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 44
  ip add 10.1.44.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
interface vlanif 45
  ip add 10.1.45.254 24
  dhcp <span class="hljs-keyword">select</span> realy
  dhcp realy server-ip 10.1.200.33
<span class="hljs-comment"># X_T2_ACC1</span>
vlan batch 31 to 35 41 to 45 100
interface Eth-Trunk 1
  mode lacp-static
  port link-type trunk
  port trunk allow-pass vlan 31 to 35 41 to 45 100
  dis lldp nei brief
  trunkport GigabitEthernet 0/0/23 to 0/0/24
interface GigabitEthernet 0/0/1
 port hybrid pvid vlan 33
 port hybrid untagged vlan 33
<span class="hljs-comment"># X_T2_ACC2</span>
vlan batch 31 to 35 41 to 45 100
interface Eth-Trunk 1
  mode lacp-static
  port link-type trunk
  port trunk allow-pass vlan 31 to 35 41 to 45 100
  dis lldp nei brief
  trunkport GigabitEthernet 0/0/23 to 0/0/24
interface GigabitEthernet 0/0/22
  port link-type access
  port default vlan 100

X_T1_FW
<span class="hljs-comment"># X_T1_FW</span>
vlan batch 204 to 207
interface GigabitEthernet 1/0/1
  portswitch
  port link-type trunk
  port trunk allow-pass vlan 204 205
  undo port trunk allow-pass vlan 1
interface GigabitEthernet 1/0/2
  portswitch
  port link-type trunk
  port trunk allow-pass vlan 206 207
  undo port trunk allow-pass valn 1
interface lo1
interface lo2
vsys <span class="hljs-built_in">enable</span>
vsys name Employee
  assign vlan 204
  assign vlan 206
  assign interface LoopBack 1
vsys name Guest
  assign vlan 205
  assign vlan 207
  assingn interface LoopBack 2
interface lo1
  ip add 10.1.0.8 32
interface lo2
  ip add 10.1.0.9 32
interface vlanif 204
  ip add 10.1.200.14 30
interface vlanif 205
  ip add 10.1.200.18 30
interface vlanif 206
  ip add 10.1.200.22 30
interface vlanif 207
  ip add 10.1.200.26 30
interface Virtual-<span class="hljs-keyword">if</span> 1
  ip add 10.1.200.254 32
interface Virtual-<span class="hljs-keyword">if</span> 2
  ip add 10.1.200.253 32
switch vsys Guest
  sys
    firewall zone trust
      add interface vlanif 207
    firewall zone untrust
      add interface vlanif 205
      add interface virtual-if 2
    security-policy
      rule name ospf
        source-zone trust
        source-zone untrust
        source-zone <span class="hljs-built_in">local</span>
        destination-zone <span class="hljs-built_in">local</span>
        destination-zone untrust
        destination-zone trust
        service ospf
        action permit
switch vsys Employee
  sys
    firewall zone trust
      add interface vlanif 206 
    firewall zone untrust
      add interface vlanif 204 
      add interface virtual-if 1
    security-policy
      rule name ospf
        source-zone trust
        source-zone untrust
        source-zone <span class="hljs-built_in">local</span>
        destination-zone <span class="hljs-built_in">local</span>
        destination-zone untrust
        destination-zone trust
        service ospf
        action permit 

3.1 配置 静态路由 / ip-prefix / vpn-instance / vsys
3.2 配置 OSPF
X_T_Export
<span class="hljs-comment"># X_T_Export1</span>
ip route-static 0.0.0.0 0 GigabitEthernet 0/0/0 10.255.1.254
ip route-static 0.0.0.0 0 GigabitEthernet 0/0/2 10.255.2.254
ospf 1 router-id 10.1.0.1
  default-route-advertise
  area 0
    network 10.1.0.1 0.0.0.0
    network 10.1.200.1 0.0.0.0
<span class="hljs-comment"># X_T_Export2</span>
ip route-static 0.0.0.0 0 GigabitEthernet 0/0/0 10.255.3.254
ip route-static 0.0.0.0 0 GigabitEthernet 0/0/2 10.255.4.254
ospf 1 router-id 10.1.0.2
  default-route-advertise
  area 0
    network 10.1.0.2 0.0.0.0
    network 10.1.200.5 0.0.0.0
<span class="hljs-comment"># X_T1_AC</span>
ospf 1 router-id 10.1.0.11
  area 0 
    network 10.1.0.11 0.0.0.0
    network 10.1.100.254 0.0.0.0
    network 10.1.200.10 0.0.0.0
<span class="hljs-comment"># X_T1_CORE</span>
ip ip-prefix Guest deny 10.1.101.0 24
ip ip-prefix Guest deny 10.1.102.0 24
ip ip-prefix Guest deny 10.1.103.0 24
ip ip-prefix Guest deny 10.1.104.0 24
ip ip-prefix Guest deny 10.1.105.0 24
ip ip-prefix Guest permit 0.0.0.0 0 less-equal 32
ip ip-prefix Employee deny 10.1.11.0 24
ip ip-prefix Employee deny 10.1.12.0 24
ip ip-prefix Employee deny 10.1.13.0 24
ip ip-prefix Employee deny 10.1.14.0 24
ip ip-prefix Employee deny 10.1.15.0 24
ip ip-prefix Employee deny 10.1.21.0 24
ip ip-prefix Employee deny 10.1.22.0 24
ip ip-prefix Employee deny 10.1.23.0 24
ip ip-prefix Employee deny 10.1.24.0 24
ip ip-prefix Employee deny 10.1.25.0 24
ip ip-prefix Employee deny 10.1.31.0 24
ip ip-prefix Employee deny 10.1.32.0 24
ip ip-prefix Employee deny 10.1.33.0 24
ip ip-prefix Employee deny 10.1.34.0 24
ip ip-prefix Employee deny 10.1.35.0 24
ip ip-prefix Employee deny 10.1.41.0 24
ip ip-prefix Employee deny 10.1.42.0 24
ip ip-prefix Employee deny 10.1.43.0 24
ip ip-prefix Employee deny 10.1.44.0 24
ip ip-prefix Employee deny 10.1.45.0 24
ip ip-prefix Employee deny 10.1.51.0 24
ip ip-prefix Employee deny 10.1.52.0 24
ip ip-prefix Employee deny 10.1.53.0 24
ip ip-prefix Employee deny 10.1.54.0 24
ip ip-prefix Employee deny 10.1.55.0 24
ip ip-prefix Employee deny 10.1.60.0 24
ip ip-prefix Employee permit 0.0.0.0 0 less-equal 32
dis ip int brief
ospf 1 router-id 10.1.0.3
  area 0
    network 10.1.0.3 0.0.0.0
    network 10.1.200.2 0.0.0.0
    network 10.1.200.6 0.0.0.0
    network 10.1.200.9 0.0.0.0
  area 1
    network 10.1.200.13 0.0.0.0
    filter ip-prefix Guest import
  area 2
    stub
    network 10.1.200.17 0.0.0.0
    filter ip-prefix Employee import
ospf 65001 vpn-instance Employee router-id 10.1.0.4
  vpn-instance-capability simple
  area 1
    network 10.1.0.0 0.0.255.255
  silent-interface vlanif 51
  silent-interface vlanif 52
  silent-interface vlanif 53
  silent-interface vlanif 54
  silent-interface vlanif 55
  silent-interface vlanif 60
ospf 65002 vpn-instance Guest router-id 10.1.0.5
  vpn-instance-capability simple
  area 2
    stub
    network 10.1.0.0 0.0.255.255
  silent-interface vlanif 101
  silent-interface vlanif 102
  silent-interface vlanif 103
  silent-interface vlanif 104
  silent-interface vlanif 105
<span class="hljs-comment"># X_T1_AGG1</span>
ospf 1 router-id 10.1.0.6
  silent-interface all
  udno silent-interface vlanif 208
  area 1
    network 10.1.0.0 0.0.255.255
<span class="hljs-comment"># X_T2_AGG1</span>
ospf 1 router-id 10.1.0.7
  silent-interface all
  udno silent-interface vlanif 209
  area 1
    network 10.1.0.0 0.0.255.255
<span class="hljs-comment"># X_T1_FW</span>
ospf 65001 vpn-instance Employee router-id 10.1.0.8
  vpn-instance-capability simple
  area 1
    network 10.1.0.8 0.0.0.0
    network 10.1.200.14 0.0.0.0
    network 10.1.200.22 0.0.0.0
ospf 65002 vpn-instance Guest router-id 10.1.0.9
  vpn-instance-capability simple
  area 2
    stub
    network 10.1.0.9 0.0.0.0
    network 10.1.200.18 0.0.0.0
    network 10.1.200.26 0.0.0.0

4.1 配置 无线 / 802.1X 认证 / AP 强制不认证
4.2 配置 802.1X / MAC 接入模版，并绑定到身份认证模版中
4.3 在汇聚设备的相应端口上开启认证模版
<span class="hljs-comment"># X_T1_AC</span>
vlan 51 to 55 101 to 105
int g 0/0/1
  port trunk allow-pass vlan 51 to 55 101 to 105
  quit
vlan pool wireless_Employee
  vlan 51 to 55
  assignment <span class="hljs-built_in">hash</span>
vlan pool wireless_Guest
  vlan 101 to 105
  assignment <span class="hljs-built_in">hash</span>
wlan
  ssid-profile name Guest
    ssid X_Guest010
    y
  ssid-profile name Employee
    ssid X_Employee010
    y
  vap-profile name Employee
    service-vlan vlan-pool wireless_Employee
    y
  vap-profile name Guest
    service-vlan vlan-pool wireless_Guest
    y
  ap-id 1 ap-mac 00e0-fca9-6ac0
    ap-name X_T2_AP
    ap-group X
    y

<span class="hljs-comment"># X_T_ACC1/ACC2 </span>
l2protocol-tunnel user-defined-protocol 802.1X protocol-mac 0180-c200-0003 group-mac  0100-0000-0002
port-group group-number GigabitEthernet 0/0/1 to GigabitEthernet 0/0/22
  l2protocol-tunnel user-defined-protocol 802.1X <span class="hljs-built_in">enable</span>
interface Eth-trunk 1
  l2protocol-tunnel user-defined-protocol 802.1X <span class="hljs-built_in">enable</span>
<span class="hljs-comment"># X_T_AGG1</span>
radius-server template Employee
  radius-server authentication 10.1.60.2 1812
  radius-server accounting 10.1.60.2 1813
  radius-server shared-key cipher Huawei@123
radius authorization 10.1.60.2 shared-key cipher Huawei@123
aaa
  authentication-scheme Employee
    authentication-mode radius
  authentication-scheme ap_noauthen
    authentication-mode none
  accounting-scheme Employee
    accounting-mode radius
  domain Employee
    authentication-scheme Employee
    accounting-scheme Employee
    radius-server Employee
  domain ap_noauthen
    authenticaton-scheme ap_noauthen
domain Employee

<span class="hljs-comment"># X_T1_AGG1</span>
<span class="hljs-comment"># 模拟器不用敲</span>
domain ap_noauthen mac-authentication force mac-address 00e0-fcb7-2890 mask ffff-ffff-ffff
<span class="hljs-comment"># X_T2_AGG1</span>
domain ap_noauthen mac-authentication force mac-address 00e0-fca9-6ac0 mask ffff-ffff-ffff
<span class="hljs-comment"># X_T1/2_AGG1 </span>
dot1x-access-profile name Employee
mac-access-profile name Employee
authentication-profile name Employee
  dot1x-access-profile Employee
  mac-access-profile Employee
interface Eth-trunk 2
  authentication-profile Employee
interface Eth-trunk 3
  authentication-profile Employee
<span class="hljs-comment"># X_T1_AGG1 </span>
vlan pool market
  vlan 11 to 15
vlan pool procure
  vlan 21 to 25
<span class="hljs-comment"># X_T2_AGG1</span>
vlan pool finance
  vlan 31 to 35
vlan pool hr
  vlan 41 to 45

5. 配置 FW 策略
<span class="hljs-comment"># X_T1_FW</span>
ip route-static vpn-instance Guest 10.1.60.99 32 vpn-instance Employee
switch vsys Guest
  sys
    ip service-set Guest_Service <span class="hljs-built_in">type</span> object
      service protocol tcp source-port 0 to 65535 destination-port 3389
    security-policy
      rule name Guest_Service //外部无线用户访问HTTP 服务3389
        source-zone trust
        destination-zone untrust
        source-address range 10.1.101.0 10.1.105.255
        destination-address 10.1.60.99 mask 255.255.255.255
        service Guest_Service
        action permit
      rule name Deny_other_Servcie
        source-zone trust
        destination-zone untrust
        source-address range 10.1.101.0 10.1.105.255
        destination-address 10.1.60.0 mask 255.255.255.0
        action deny
      rule name Guest_to_Internet //访问Internet 的策略最后配置
        source-zone trust
        destination-zone untrust
        source-address range 10.1.101.0 10.1.105.255
        destination-address any
        action permit
switch vsys Employee
  sys
    ip service-set Guest_Service <span class="hljs-built_in">type</span> object
      service protocol tcp source-port 0 to 65535 destination-port 3389
     ip address-set X <span class="hljs-built_in">type</span> object
      add range 10.1.11.0 10.1.15.255
      add range 10.1.21.0 10.1.25.255
      add range 10.1.31.0 10.1.35.255
      add range 10.1.41.0 10.1.45.255
      add range 10.1.51.0 10.1.55.255
    ip address-set Y <span class="hljs-built_in">type</span> object
      add range 10.2.31.0 10.2.35.255
      add range 10.2.41.0 10.2.45.255
      add range 10.2.51.0 10.2.55.255
    ip address-set Z&amp;Store <span class="hljs-built_in">type</span> object
      add range 10.2.101.0 10.3.101.255
      add range 10.100.2.0 10.100.2.255
    quit
    security-policy
      rule name Wireless_to_Service //内部无线访问服务器
        source-zone trust
        destination-zone trust
        source-address range 10.1.51.0 10.1.55.255
        destination-address 10.1.60.100 0.0.0.0
        action permit
      rule name Deny_other_Service
        source-zone trust
        destination-zone trust
        source-address range 10.1.51.0 10.1.55.255
        destination-address 10.1.60.0 0.0.0.255
        action deny
      rule name Guest_Service //放行Guest 到服务器区域的流量
        source-zone untrust
        destination-zone trust
        source-address range 10.1.101.0 10.1.105.255
        destination-address 10.1.60.99 0.0.0.0
        service Guest_Service
        action permit
      rule name Service_http_10.1.60.101 //放行NAT_Service 流量
        source-zone untrust
        destination-zone trust
        source-address any
        destination-address 10.1.60.101 0.0.0.0
        service http
        action permit
      rule name X_to_Y&amp;Z&amp;Store
        source-zone trust
        destination-zone untrust
        source-address address-set X
        destination-address address-set Y
        destination-address address-set Z&amp;Store
        action permit
      rule name Y&amp;Z&amp;Store_to_X
        source-zone untrust
        destination-zone trust
        source-address address-set Y
        source-address address-set Z&amp;Store
        destination-address address-set X
        action permit
      rule name Employee_to_Internet //访问Internet 的策略最后配置
        source-zone trust
        destination-zone untrust
        source-address range 10.1.11.0 10.1.15.255
        source-address range 10.1.21.0 10.1.25.255
        source-address range 10.1.51.0 10.1.55.255
        action permit

6. ACL / NAT / Traffic
<span class="hljs-comment">## X_T1_CORE</span>
<span class="hljs-comment"># 模拟器不用敲</span>
acl 3000 
  rule permit ip <span class="hljs-built_in">source</span> 10.1.51.0 0.0.0.255 destination 10.1.60.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.1.52.0 0.0.0.255 destination 10.1.60.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.1.53.0 0.0.0.255 destination 10.1.60.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.1.54.0 0.0.0.255 destination 10.1.60.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.1.55.0 0.0.0.255 destination 10.1.60.0 0.0.0.255
<span class="hljs-comment"># 连接AC 的物理口,记住即可，无法配置 拟器不用敲。将Employee无线访问服务器60的流量下一跳直接扔给vlan 206</span>
interface g0/0/3 
  traffic-redirect inbound acl 3000 vpn-instance Employee ip-nexthop 10.1.200.22
<span class="hljs-comment"># 将源10.1.60.101的tcp 80 流量，直接扔给10.1.200.5</span>
acl number 3001
  rule permit tcp <span class="hljs-built_in">source</span> 10.1.60.101 0.0.0.0 source-port eq 80 destination any
interface vlan 204
  traffic-redirect inbound acl 3001 ip-nexthop 10.1.200.5

<span class="hljs-comment">## X_T_Export1</span>
acl 2000
  udno rule 5
  rule permit <span class="hljs-built_in">source</span> 10.1.11.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.12.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.13.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.14.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.15.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.21.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.22.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.23.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.24.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.25.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.51.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.52.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.53.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.54.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.55.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.101.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.102.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.103.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.104.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.105.0 0.0.0.255
<span class="hljs-comment">## X_T_Export2</span>
acl 2000 
  rule permit <span class="hljs-built_in">source</span> 10.1.11.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.12.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.13.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.14.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.15.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.21.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.22.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.23.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.24.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.25.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.51.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.52.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.53.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.54.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.55.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.101.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.102.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.103.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.104.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.105.0 0.0.0.255
nat address-group 1 10.255.4.2 10.255.4.100 
interface GigabitEthernet 0/0/0
  nat outbound 2000
interface GigabitEthernet 0/0/2
  nat outbound 2000 address-group 1
  nat server protocol tcp global current-interface 8081 inside 10.1.60.101 wwww
acl number 3001
  rule permit tcp <span class="hljs-built_in">source</span> 10.1.60.101 0.0.0.0 source-port eq 80 destination any
traffic classifier web
  if-match acl 3001
traffic behavior web
  redirect ip-nexthop 10.255.4.254
traffic policy web
  classifier web behavior web
interface GigabitEthernet 0/0/1
  traffic-policy web inbound

7. 测试
<span class="hljs-comment"># X_T1_ACC2</span>
interface GigabitEthernet 0/0/1
  port hybrid untagged vlan 24
  port hybrid pvid vlan 24
<span class="hljs-comment"># X_T2_ACC1</span>
interface GigabitEthernet 0/0/1
  port hybrid untagged vlan 33
  port hybrid pvid vlan 33

<span class="hljs-comment"># 使用 STA 设备连接到T1 X_Guest010 WIFI</span>
ping 10.255.1.254
ping 10.1.60.99 [不通]

<span class="hljs-comment"># 使用 STA 设备连接到T2 X_Employee010 WIFI</span>
ping 10.255.1.254
ping 10.1.60.100

<span class="hljs-comment"># Terminal01测试</span>
ping 10.255.1.254
ping 10.1.60.100
ping 10.1.60.99

<span class="hljs-comment"># Terminal02测试</span>
ping 10.1.60.100
ping 10.255.1.254 [不通]

<span class="hljs-comment"># X_T1_AC</span>
interface GigabitEthernet 0/0/2
  port hybrid untagged vlan 103
  port hybrid pvid vlan 103

<span class="hljs-comment"># 60.99 模拟终端</span>
sys
  telnet server <span class="hljs-built_in">enable</span>
  telnet server port 3389

<span class="hljs-comment"># 模拟Guest</span>
telnet 10.1.60.99 3389

Y园区：iMaster NCE-Campus SD-WAN 部署
概述
OSPF / BGP 65003 / VXLAN

NCE 纳管设备
0 - 环境信息
<span class="hljs-comment"># 考试环境</span>
NCE-Web地址: 172.22.8.71/171
NCE-南向地址: 172.22.8.72/172

<span class="hljs-comment"># FZ-Rack</span>
NCE-Web地址: 172.22.8.71
NCE-南向地址: 172.22.8.72
快照地址(FC界面): 192.168.10.110

<span class="hljs-comment"># NJ-Rack</span>
NCE-Web地址: 172.22.8.70
NCE-南向地址: 172.22.8.71
快照地址(FC界面): 10.1.10.21

<span class="hljs-comment"># FZMN-Rack</span>
NCE-Web地址: 172.22.8.172

<span class="hljs-comment"># NJMN-Rack</span>
NCE-Web地址: 172.22.8.81
NCE-南向地址: 172.22.8.82
快照地址(FC界面): 192.168.130.22
user001/Huawei@123


admin/Huawei@123
<span class="hljs-comment"># 设备清空</span>
<span class="hljs-comment"># 路由器设备清空&gt; reset saved-configuration</span>
<span class="hljs-comment"># 路由器设备清空&gt; reboot fast</span>
<span class="hljs-comment"># 交换机设备清空# reset netconf db-configureation </span>

纳管路由器
<span class="hljs-comment"># 清除残留netconf</span>
&gt; factory-configuration reset
<span class="hljs-comment"># Ping通南向地址</span>
ping 172.22.8.72

<span class="hljs-comment"># Y_Export1</span>
int G0/0/8
undo portswitch
ip address 10.255.5.1 24
<span class="hljs-comment">#</span>
int g0/0/9
undo portswitch
ip address 10.255.6.1 24
<span class="hljs-comment">#</span>
ip route-static 0.0.0.0 0 10.255.5.254
ip route-static 0.0.0.0 0 10.255.6.254

<span class="hljs-comment"># Store_Export1</span>
int G0/0/8
undo portswitch
ip address 10.255.7.1 24
<span class="hljs-comment">#</span>
int g0/0/9
undo portswitch
ip address 10.255.8.1 24
<span class="hljs-comment">#</span>
ip route-static 0.0.0.0 0 10.255.7.254
ip route-static 0.0.0.0 0 10.255.8.254

<span class="hljs-comment"># Y_Export1/Store1_Export1 设备设置控制器地址（预配没有）</span>
agile controller host 172.22.8.72 port 10020

<span class="hljs-comment"># esn</span>
dis esn
<span class="hljs-comment"># 查看注册设备的上线上线</span>
dis agile-controller status

纳管交换机

<span class="hljs-comment"># reset netconf db-configuration</span>

1 - 切换 EVPN 网络隧道模式
设计 / 基础网络设计 / 网络设置 / 隧道模式 / EVPN

切换EVPN
切换EVPN

2 - 关闭 物理网络 开局邮件加密
多分支互联 / 全局配置 / 物理网络 / 设备激活安全配置 / 加密使能

多分支互联
多分支互联

关闭加密使能
关闭加密使能

3 - 确定 BGP AS 65003 &amp; IP地址池 10.99.0.0/16
多分支互联 / 全局配置 / 虚拟网络 / 路由 &amp; IP地址池



4 - 创建 Site_Y &amp; Site_Store1
多分支互联 / 站点设置 / 创建 / Site_Y 和 Store 站点

Site_Y/Site_Store1: 勾选 AR / LSW / WAC

参数说明: WAC – 随绑/带AC的交换机; AP – 云AP





5 - 添加设备
多分支互联 / 设备管理 / 添加设备 / 批量导入 / 选择对应的设备exce模版 / 开始导入 / 确定







6 - 创建 WAN链路模版
多分支互联 / WAN链路模版





7 - 零配置开局 路由器托管配置(手动配置和自动配置)
多分支互联 / 零配置开局 / 点击开局 / 站点 / DHCP Option / 模版导入 / 配置地址 / 接口编号 IP GW Mb/s

多分支互联 / WAN Underlay / WALN路由（静态路由）

























配置静态路由和NAT













8 - 站点间组网 RR反射器




9 - 交换机托管配置 并部署 Management VN








































91’ Y_Core -&gt; web -&gt; 配置 -&gt; 无线业务管理 -&gt; vlan 3996 -&gt; 应用

10 - 纳管检查
Fabric(池)资源网络
1 - Fabric网络规划

配置IGP 协议的地址和VLAN 创建Radius服务 Rrotal认证服务器 802.1X认证模版

















3 - 创建Fabric网络







4 - 配置网络中的设备角色（边缘节点和边界网关节点）

5 - 添加DHCP服务器



6 - 创建 OA/R&amp;D 业务网络的L3独占外部接口





















7 - 创建 Guest 业务三层出口













8 - 配置Y_AGG和Y_ACC的接入认证

9 - 执行点配置

10 - 创建LAN侧VN（地址池）













11 - 创建OA虚拟网络，分配地址和网关，添加有线认证部分





12 - 创建RD虚拟网络，分配网段11-15和21-25

13 - 创建Guest虚拟网络

14 - 部署VN之间的互通

15 - 部署无线用户认证（组/用户）及授权（密码）

16 - 创建优秀用户认证（组/用户）及授权（密码）

17 - 创建安全组，资源组（IP/掩码）

18 - 根据要求部署策略矩阵

19 - 部署准入认证

20 - 配置授权结果

21 - 绑定站点

22 - 创建有线用户的授权规则

23 - 创建无线用户的授权规则

24 - 部署无线网络

25 - 创建无线认证模版

26 - 交换机的WEB界面中国呢，新建两个SSID模版

27 - 创建 Guest/Employee VAP模版，并调用SSID模版，选择安全模版

28 - 配置AP组，添加VAP模版

1、规划资源池
2、配置VXLAN组网方式
3、配置DHCP服
4、配置外部网络接口
5、配置外部网络接口
6、配置VN部署
7、配置VN之间互通
8、配置认证策略
9、配置授权规则/授权结果
10、配置无线
SD-WAN
1、创建WAN侧VN（Y_OA_TO_Sites / Guest_To_Internet / OA HUB-Spoke组网）
2、LAN/WAN融合
3、WAN组网
4、Internet访问
5、监控
6、订单业务流量做低延迟处理
7、优化路由
Z园区：广域网承载及设计
0、概述
<span class="hljs-comment"># FC00: 环回口地址</span>
<span class="hljs-comment"># FC01: 链路互联地址</span>
<span class="hljs-comment"># FC02: 标签地址</span>

1、全局ISIS配置(IGB打通)
<span class="hljs-comment"># X/Y/Z_PE1/2</span>
<span class="hljs-comment">#  network-entity 49.0001.00X0.0000.000X.00</span>
bfd
 quit
isis 1
 is-level level-2
 cost-style wide
 bfd all-interfaces <span class="hljs-built_in">enable</span>
 bfd all-interfaces min-tx-interval 500 min-rx-interval 500
 network-entity 49.0001.0010.0000.0001.00
 domain-authentication-mode md5 plain Huawei@123
 frr
  loop-free-alternate level-2 <span class="hljs-comment"># 循环-免费-备用</span>
  quit
 quit
int lo0
 isis <span class="hljs-built_in">enable</span> 1
interface GigabitEthernet0/0/0
 isis <span class="hljs-built_in">enable</span> 1
 isis circuit-type p2p <span class="hljs-comment"># 线路类型</span>
 isis ppp-negotiation 2-way <span class="hljs-comment"># ppp 协商</span>
 isis authentication-mode md5 plain Huawei@123
interface GigabitEthernet0/0/1
 isis <span class="hljs-built_in">enable</span> 1
 isis circuit-type p2p
 isis ppp-negotiation 2-way
 isis authentication-mode md5 plain Huawei@123
interface GigabitEthernet0/0/2
 isis <span class="hljs-built_in">enable</span> 1
 isis cost 4
 isis circuit-type p2p
 isis ppp-negotiation 2-way
 isis authentication-mode md5 plain Huawei@123
 quit
<span class="hljs-comment"># X_PEX 多开窗口</span>
dis isis peer <span class="hljs-comment"># 3个</span>
dis isis bfd session all <span class="hljs-comment"># 3个</span>
<span class="hljs-comment"># X_PE1</span>
dis ip routing-table 5.0.0.5 verbose
int GigabitEthernet 0/0/1
 shutdown
 tracert -a 1.0.0.1 5.0.0.5
 undo shutdown
 quit

2、 全局MPLS配置
<span class="hljs-comment"># X/Y/Z_PE1/2</span>
<span class="hljs-comment"># mpls lsr-id X.0.0.X</span>
bfd
 mpls-passive
 quit
mpls lsr-id 1.0.0.1
mpls
 mpls bfd <span class="hljs-built_in">enable</span>
 mpls bfd-trigger host
 mpls bfd min-tx-interval 500 min-rx-interval 500
 quit
mpls ldp
 quit
interface GigabitEthernet0/0/0
 mpls
 mpls ldp
 mpls mtu 1382
 isis ldp-sync
interface GigabitEthernet0/0/1
 mpls
 mpls ldp
 mpls mtu 1382
 isis ldp-sync
interface GigabitEthernet0/0/2
 mpls
 mpls ldp
 mpls mtu 1382
 isis ldp-sync
 quit
<span class="hljs-comment"># 检查</span>
dis mpls ldp peer <span class="hljs-comment"># 3个</span>
dis mpls bfd session <span class="hljs-comment"># 7个</span>
display bfd session all <span class="hljs-comment"># 17个</span>
dis isis ldp-sync interface <span class="hljs-comment"># 3个</span>

3、 BGP 65000 / group IBGP / vpnv4配置
<span class="hljs-comment"># X_PE1/2</span>
<span class="hljs-comment"># router-id 2.0.0.2</span>
<span class="hljs-comment"># peer 2.0.0.2 as-number 65000</span>
<span class="hljs-comment"># peer 2.0.0.2 group IBGP</span>
<span class="hljs-comment"># peer 2.0.0.2 enable</span>
bgp 65000
 router-id 1.0.0.1
 undo default ipv4-unicast <span class="hljs-comment"># 配置BGP对等体默认不在任何地址族下使能</span>
 group IBGP internal <span class="hljs-comment"># 创建IBGP对等体组</span>
 peer IBGP connect-interface Loopback 0 <span class="hljs-comment"># 使用loopback0接口建立BGP邻居关系</span>
 peer IBGP bfd min-rx-interval 500 min-tx-interval 500
 peer IBGP bfd <span class="hljs-built_in">enable</span>
 peer IBGP password cipher Huawei@123
 peer 2.0.0.2 as-number 65000
 peer 2.0.0.2 group IBGP
 peer 3.0.0.3 as-number 65000
 peer 3.0.0.3 group IBGP
 peer 4.0.0.4 as-number 65000
 peer 4.0.0.4 group IBGP
 peer 4.0.0.4 as-number 65000
 peer 5.0.0.5 group IBGP
 peer 5.0.0.5 as-number 65000
 peer 6.0.0.6 group IBGP
 ipv4-family vpnv4
  undo policy vpn-target <span class="hljs-comment"># (RR)用来取消对接收的VPN路由或者标签块进行VPN-Target过滤的,保证所有的VPN路由或者标签块都能被接收和处理。</span>
  reflector cluster-id 65000 <span class="hljs-comment"># 配置反射器集群ID，所有RR配置相同，建议使用AS号作为集群ID</span>
  peer 2.0.0.2 <span class="hljs-built_in">enable</span>
  peer 3.0.0.3 <span class="hljs-built_in">enable</span>
  peer 3.0.0.3 reflect-client <span class="hljs-comment"># 本机作为路由反射器，并将指定的对等体（组）作为路由反射器的客户。</span>
  peer 4.0.0.4 <span class="hljs-built_in">enable</span>
  peer 4.0.0.4 reflect-client
  peer 5.0.0.5 <span class="hljs-built_in">enable</span>
  peer 5.0.0.5 reflect-client
  peer 6.0.0.6 <span class="hljs-built_in">enable</span>
  peer 6.0.0.6 reflect-client
  quit
 quit
<span class="hljs-comment"># Y/Z_PE1/2</span>
<span class="hljs-comment"># router-id X.0.0.X # 3,4,5,6</span>
bgp 65000
 router-id 3.0.0.3
 undo default ipv4-unicast
 peer 1.0.0.1 as-number 65000
 peer 1.0.0.1 connect-interface LoopBack0
 peer 1.0.0.1 bfd <span class="hljs-built_in">enable</span>
 peer 1.0.0.1 bfd min-tx-interval 500 min-rx-interval 500
 peer 1.0.0.1 password cipher Huawei@123
 peer 2.0.0.2 as-number 65000
 peer 2.0.0.2 connect-interface LoopBack0
 peer 2.0.0.2 bfd <span class="hljs-built_in">enable</span>
 peer 2.0.0.2 bfd min-tx-interval 500 min-rx-interval 500
 peer 2.0.0.2 password cipher Huawei@123
 <span class="hljs-comment">#</span>
 ipv4-family vpnv4
  peer 1.0.0.1 <span class="hljs-built_in">enable</span>
  peer 2.0.0.2 <span class="hljs-built_in">enable</span>
  quit
<span class="hljs-comment"># 检查</span>
dis bgp vpnv4 all peer <span class="hljs-comment"># X5个 Y2个 Z2个</span>
dis bgp bfd session all <span class="hljs-comment"># X5个 </span>

4、 [65000, 65001] VPN-Instance / IP / route-policy / BGP
<span class="hljs-comment">## X_PE1/2</span>
<span class="hljs-comment"># vpn-instance</span>
<span class="hljs-comment">#  route-distinguisher 65001:2</span>
ip vpn-instance OA
 ipv4-family
  route-distinguisher 65001:1 <span class="hljs-comment"># 配置VPN实例IPv4地址族的RD</span>
  vpn-target 1:1 export-extcommunity <span class="hljs-comment"># 必须将对方的export-extcommunity的VPN Target值配置为自己的import-extcommunity的VPN Target值</span>
  vpn-target 2:2 import-extcommunity
  quit
 quit
<span class="hljs-comment"># ip binding vpn-instance</span>
<span class="hljs-comment">#   ip address 10.20.1.10 30</span>
dis ip int brief
interface GigabitEthernet2/0/0
 ip binding vpn-instance OA
 ip address 10.20.1.2 30
 quit
<span class="hljs-comment"># X_PE1 oa主路径</span>
<span class="hljs-comment">#  apply cost 12</span>
route-policy oa_med permit node 10
 apply cost-type internal <span class="hljs-comment"># 继承</span>
 quit
<span class="hljs-comment"># BGP绑定VPN-instance</span>
<span class="hljs-comment">#   peer 10.20.1.9 as-number 65001</span>
<span class="hljs-comment">#   peer 10.20.1.9 route-policy oa_med export</span>
bgp 65000
 ipv4-family vpn-instance OA
  peer 10.20.1.1 as-number 65001
  peer 10.20.1.1 route-policy oa_med <span class="hljs-built_in">export</span>
  quit
 quit

<span class="hljs-comment">## X_T1_Export1</span>
<span class="hljs-comment"># ip</span>
<span class="hljs-comment">#  ip address 10.20.1.9 30</span>
<span class="hljs-comment">#  ip address 10.20.1.6 30</span>
interface GigabitEthernet2/0/0
 ip address 10.20.1.1 30
interface GigabitEthernet2/0/1
 ip address 10.20.1.5 30
 quit
<span class="hljs-comment"># X双点双路路由重发布</span>
acl 2001
 rule permit <span class="hljs-built_in">source</span> 10.1.11.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.12.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.13.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.14.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.15.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.21.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.22.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.23.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.24.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.25.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.31.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.32.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.33.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.34.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.35.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.41.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.42.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.43.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.44.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.45.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.51.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.52.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.53.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.54.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.55.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.20.1.4 0
 quit
route-policy b2o permit node 10
 apply tag 10
 quit
route-policy o2b deny node 10
 if-match tag 20
 quit
route-policy o2b permit node 20
 if-match acl 2001
 quit
dis cur config route-policy
<span class="hljs-comment"># OSPF</span>
ospf 1
 import-route bgp route-policy b2o
 default cost inherit-metric
 quit
<span class="hljs-comment">#</span>
<span class="hljs-comment"># BGP</span>
<span class="hljs-comment">#  router-id 10.1.0.2</span>
<span class="hljs-comment">#  peer 10.20.1.10 as-number 65000</span>
bgp 65001
 router-id 10.1.0.1
 dis ip int brief
 peer 10.20.1.2 as-number 65000
 network 10.20.1.4 30
 preference 120 255 255
 import-route ospf 1 route-policy o2b
 quit
<span class="hljs-comment"># 检查</span>
dis ip routing-table 10.2.31.0
dis ip routing-table 10.2.51.0
dis ip routing-table protocol ospf  <span class="hljs-comment"># 70 49 21</span>
<span class="hljs-comment">## X_PE1</span>
dis ip routing-table vpn-instance OA <span class="hljs-comment"># 51</span>
dis bgp vpnv4 vpn-instance OA routing-table <span class="hljs-comment"># 120</span>
<span class="hljs-comment">## X_PE1</span>
dis bgp vpnv4 vpn-instance OA routing-table <span class="hljs-comment"># 112</span>
<span class="hljs-comment">## X_T1_CORE</span>
dis ip routing-table protocol ospf <span class="hljs-comment"># 67</span>
<span class="hljs-comment">## Y_PE1</span>
dis ip routing-table vpn-instance OA 10.3.101.0 verbose

5、 [65000, 65003] VPN-Instance / IP / route-policy / BGP
<span class="hljs-comment">## Y_PE1/2</span>
<span class="hljs-comment"># VPN-Instance</span>
<span class="hljs-comment">#  route-distinguisher 65003:2</span>
<span class="hljs-comment">#  route-distinguisher 65003:4</span>
ip vpn-instance OA
 ipv4-family
  route-distinguisher 65003:1
  vpn-target 1:1 export-extcommunity
  vpn-target 2:2 import-extcommunity
  quit
 quit
ip vpn-instance R&amp;D
 ipv4-family
  route-distinguisher 65003:3
  vpn-target 3:3 export-extcommunity
  vpn-target 4:4 import-extcommunity
  quit
 quit
<span class="hljs-comment"># IP binding vpn-instance</span>
<span class="hljs-comment">#  ip address 10.20.2.10 30</span>
<span class="hljs-comment">#  ip address 10.20.2.14 30</span>
interface GigabitEthernet2/0/0.10
 dot1q termination vid 10 <span class="hljs-comment"># 开启识别802.1Q数据帧，同时将子接口划分给相应的vlan</span>
 ip binding vpn-instance OA
 ip address 10.20.2.2 30
 arp broadcast <span class="hljs-built_in">enable</span>
interface GigabitEthernet2/0/0.20
 dot1q termination vid 20
 ip binding vpn-instance R&amp;D
 ip address 10.20.2.6 30
 arp broadcast <span class="hljs-built_in">enable</span>
 quit
<span class="hljs-comment">## Y_PE1 oa主路径，rd备路径</span>
<span class="hljs-comment"># apply cost 12</span>
<span class="hljs-comment"># apply cost-type internal</span>
route-policy oa_med permit node 10
 apply cost-type internal
 quit
route-policy rd_med permit node 10
 apply cost 12
 quit
<span class="hljs-comment"># BGP绑定VPN-instance</span>
<span class="hljs-comment">#  peer 10.20.2.9 as-number 65003</span>
<span class="hljs-comment">#  peer 10.20.2.9 route-policy oa_med export</span>
<span class="hljs-comment">#  peer 10.20.2.13 as-number 65003</span>
<span class="hljs-comment">#  peer 10.20.2.13 route-policy rd_med export</span>
bgp 65000
 ipv4-family vpn-instance OA
  peer 10.20.2.1 as-number 65003
  peer 10.20.2.1 route-policy oa_med <span class="hljs-built_in">export</span>
 ipv4-family vpn-instance R&amp;D
  peer 10.20.2.5 as-number 65003
  peer 10.20.2.5 route-policy rd_med <span class="hljs-built_in">export</span>
  quit
 quit

<span class="hljs-comment">## Y_Export1</span>
interface GigabitEthernet0/0/7
undo portswitch
interface GigabitEthernet0/0/6
undo portswitch
<span class="hljs-comment"># ip binding vpn-instance</span>
<span class="hljs-comment">#  interface GigabitEthernet2/0/1.10</span>
<span class="hljs-comment">#   ip address 10.20.2.9 30</span>
<span class="hljs-comment">#  interface GigabitEthernet2/0/1.20</span>
<span class="hljs-comment">#   ip address 10.20.2.13 30</span>
interface GigabitEthernet2/0/0.10
 dot1q termination vid 10
 ip binding vpn-instance vpn2
 ip address 10.20.2.1 30
 arp broadcast <span class="hljs-built_in">enable</span>
interface GigabitEthernet2/0/0.20
 dot1q termination vid 20
 ip binding vpn-instance vpn3
 ip address 10.20.2.5 30
 arp broadcast <span class="hljs-built_in">enable</span>
 quit
<span class="hljs-comment"># Y过滤路由</span>
ip ip-prefix deny_Default deny 0.0.0.0 0
ip ip-prefix deny_Default permit 0.0.0.0 0 less-equal 32
ip ip-prefix OA permit 10.2.0.0 16 greater-equal 24 less-equal 24 
ip ip-prefix OA permit 10.100.2.0 24
ip ip-prefix R&amp;D permit 10.2.0.0 16 greater-equal 24 less-equal 24
ip ip-prefix R&amp;D permit 10.100.3.0 24
<span class="hljs-comment"># BGP绑定VPN-instance</span>
bgp 65003
 ipv4-family vpn-instance vpn2
  peer 10.20.2.2 as-number 65000
  peer 10.20.2.2 ip-prefix deny_default <span class="hljs-built_in">export</span>
  peer 10.20.2.2 ip-prefix OA <span class="hljs-built_in">export</span>
  peer 10.20.2.10 as-number 65000
  peer 10.20.2.10 ip-prefix deny_default <span class="hljs-built_in">export</span> 
  peer 10.20.2.10 ip-prefix OA <span class="hljs-built_in">export</span>
 ipv4-family vpn-instance vpn3
  peer 10.20.2.6 as-number 65000
  peer 10.20.2.6 ip-prefix R&amp;D <span class="hljs-built_in">export</span>
  peer 10.20.2.14 as-number 65000
  peer 10.20.2.14 ip-prefix R&amp;D <span class="hljs-built_in">export</span>
  quit
 quit
<span class="hljs-comment"># 配置RD业务QOS</span>
acl number 3001
  rule permit ip <span class="hljs-built_in">source</span> 10.2.11.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.2.12.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.2.13.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.2.14.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.2.15.0 0.0.0.255
  description rd
acl number 3002
  rule permit ip <span class="hljs-built_in">source</span> 10.2.21.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.2.22.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.2.23.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.2.24.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.2.25.0 0.0.0.255
  description product
traffic classifier rd
  if-match acl 3001
traffic classifier pro
  if-match acl 3002
traffic behavior pro
  remark dscp ef
  queue llq bandwidth 100000
traffic behavior rd
  remark dscp af41
  queue af bandwidth 300000
traffic policy RD
  classifier rd behavior rd
  classifier pro behavior pro
interface GigabitEthernet0/0/6.20
  traffic-policy RD outbound
interface GigabitEthernet0/0/7.20
  traffic-policy RD outbound

6、 [65000, 65004] VPN-Instance/IP/BGP
<span class="hljs-comment">## Z_PE1/2</span>
<span class="hljs-comment"># vpn-instance</span>
<span class="hljs-comment">#  route-distinguisher 65004:3</span>
<span class="hljs-comment">#  route-distinguisher 65004:4</span>
<span class="hljs-comment">#  route-distinguisher 65004:6</span>
ip vpn-instance OA_In
 ipv4-family
  route-distinguisher 65004:1
  vpn-target 1:1 import-extcommunity
ip vpn-instance OA_Out
 ipv4-family
  route-distinguisher 65004:2
  vpn-target 2:2 export-extcommunity
ip vpn-instance R&amp;D
 ipv4-family
  route-distinguisher 65004:5
  vpn-target 3:3 import-extcommunity
  vpn-target 4:4 export-extcommunity
  quit
 quit
<span class="hljs-comment">#</span>
dis bgp vpnv4 all peer <span class="hljs-comment"># Y=4</span>
<span class="hljs-comment"># ip binding vpn-instance</span>
<span class="hljs-comment">#  ip add 10.20.3.14 30</span>
<span class="hljs-comment">#  ip add 10.20.3.18 30</span>
<span class="hljs-comment">#  ip add 10.20.3.22 30</span>
int g 2/0/0.10
 dot1q termination vid 10
 ip binding vpn-instance OA_In
 ip add 10.20.3.2 30
 arp broadcast <span class="hljs-built_in">enable</span>
int g 2/0/0.11
 dot1q termination vid 11
 ip binding vpn-instance OA_Out
 ip add 10.20.3.6 30
 arp broadcast <span class="hljs-built_in">enable</span>
int g 2/0/0.20
 dot1q termination vid 20
 ip binding vpn-instance R&amp;D
 ip add 10.20.3.10 30
 arp broadcast <span class="hljs-built_in">enable</span>
 quit
<span class="hljs-comment">## Z_PE1 oa主路径，rd备路径</span>
<span class="hljs-comment"># apply cost 12</span>
<span class="hljs-comment"># apply cost-type internal</span>
route-policy oa_med permit node 10
 apply cost-type internal
 quit
route-policy rd_med permit node 10
 apply cost 12
 quit
<span class="hljs-comment"># BGP绑定VPN-instance</span>
<span class="hljs-comment">#  peer 10.20.3.13 as-number 65004</span>
<span class="hljs-comment">#  peer 10.20.3.13 route-policy oa_med export</span>
<span class="hljs-comment">#  peer 10.20.3.17 as-number 65004</span>
<span class="hljs-comment">#  peer 10.20.3.21 as-number 65004</span>
<span class="hljs-comment">#  peer 10.20.3.21 route-policy rd_med export</span>
bgp 65000
 ipv4-family vpn-instance OA_In
  peer 10.20.3.1 as-number 65004
  peer 10.20.3.1 route-policy oa_med <span class="hljs-built_in">export</span>
 ipv4-family vpn-instance OA_Out
  peer 10.20.3.5 as-number 65004
  peer 10.20.3.5 allow-as-loop
 ipv4-family vpn-instance R&amp;D
  peer 10.20.3.9 as-number 65004
  peer 10.20.3.9 route-policy rd_med <span class="hljs-built_in">export</span>
  quit
 quit

<span class="hljs-comment">## Z_Export1</span>
<span class="hljs-comment"># vpn-instance</span>
ip vpn-instance OA
 route-distinguisher 65004:10
  quit
ip vpn-instance R&amp;D
 route-distinguisher 65004:20
  quit
<span class="hljs-comment">#</span>
int lo0
 ip binding vpn-instance OA
 ip add 10.3.101.254 24
int lo1
 ip binding vpn-instance R&amp;D
 ip add 10.3.99.254 24
int lo2
 ip binding vpn-instance R&amp;D
 ip add 10.3.100.254 24
 quit
<span class="hljs-comment"># ip binding vpn-instance</span>
<span class="hljs-comment">#  int g 0/0/1.10</span>
<span class="hljs-comment">#   ip add 10.20.3.13 30</span>
<span class="hljs-comment">#  int g 0/0/1.11</span>
<span class="hljs-comment">#   ip add 10.20.3.17 30</span>
<span class="hljs-comment">#  int g 0/0/1.20</span>
<span class="hljs-comment">#   ip add 10.20.3.21 30</span>
int g 0/0/0.10
 dot1q termination vid 10
 ip binding vpn-instance OA
 ip add 10.20.3.1 30
 arp broadcast <span class="hljs-built_in">enable</span>
int g 0/0/0.11
 dot1q termination vid 11
 ip binding vpn-instance OA
 ip add 10.20.3.5 30
 arp broadcast <span class="hljs-built_in">enable</span>
int g 0/0/0.20
 dot1q termination vid 20
 ip binding vpn-instance R&amp;D
 ip add 10.20.3.9 30
 arp broadcast <span class="hljs-built_in">enable</span>
 quit
dis ip int brief
<span class="hljs-comment"># BGP绑定VPN-Instance</span>
bgp 65004
 router-id 10.3.99.254
 undo default ipv4-unicast
 ipv4-family vpn-instance OA
  network 10.3.101.0 24
  peer 10.20.3.2 as-number 65000
  peer 10.20.3.6 as-number 65000
  peer 10.20.3.14 as-number 65000
  peer 10.20.3.18 as-number 65000
 ipv4-family vpn-instance R&amp;D
   network 10.3.99.0 24
  network 10.3.100.0 24
  peer 10.20.3.10 as-number 65000
  peer 10.20.3.22 as-number 65000
  quit
 quit

 <span class="hljs-comment"># 检查</span>
<span class="hljs-comment">## Z_Export1</span>
dis bgp vpnv4 all peer <span class="hljs-comment"># 6</span>
<span class="hljs-comment">## X_T_Export1/2</span>
dis bgp routing-table <span class="hljs-comment"># 21</span>
<span class="hljs-comment">## Y_Export1</span>
dis ip routing-table vpn-instance vpn2 <span class="hljs-comment"># 64 63</span>
dis bgp vpnv4 vpn-instance vpn2 routing-table <span class="hljs-comment"># 42</span>
dis bgp vpnv4 vpn-instance vpn3 routing-table <span class="hljs-comment"># 30 -------to do</span>
<span class="hljs-comment">## Z_Export1</span>
dis bgp vpnv4 vpn-instance OA routing-table <span class="hljs-comment"># 41</span>
dis bgp vpnv4 vpn-instance R&amp;D routing-table <span class="hljs-comment"># 28</span>
<span class="hljs-comment">## Z_PE1</span>
dis bgp vpnv4 vpn-instance OA_In routing-table <span class="hljs-comment"># 41 --- to do 21</span>
dis bgp vpnv4 vpn-instance OA_Out routing-table <span class="hljs-comment"># 21</span>

7、VPN FRR / QOS / 防止OA路由倒灌
<span class="hljs-comment">## VPN FRR</span>
<span class="hljs-comment"># X/Y_PE1</span>
route-policy vpnfrr permit node 10
 apply backup-interface g 0/0/2 
 apply backup-nexthop 6.0.0.6
 quit
ip vpn-instance OA
 vpn frr route-policy vpnfrr
 quit
<span class="hljs-comment"># X_PE1</span>
dis ip routing-table vpn-instance OA 10.2.31.0 verbose
<span class="hljs-comment"># Y_PE1</span>
dis ip routing-table vpn-instance OA 10.3.101.0 verbose

<span class="hljs-comment">## QOS</span>
<span class="hljs-comment">## X/Y/Z_PE1/2</span>
drop-profile rd
 wred dscp
 dscp af41 low-limit 50 high-limit 90 discard-percentage 50
traffic classifier rd
 if-match dscp af41
 traffic classifier product
 if-match dscp ef
traffic behavior rd
 queue af bandwidth 300000
 drop-profile discover
traffic behavior product
 queue llq bandwidth 100000
traffic policy R&amp;D
 classifier discover behavior rd
 classifier product behavior product
int g 0/0/0
 traffic-policy R&amp;D outbound
int g 0/0/1
 traffic-policy R&amp;D outbound
int g 0/0/2
 traffic-policy R&amp;D outbound
<span class="hljs-comment">## Z_PE1/2</span>
int g 2/0/0.20
 traffic-policy R&amp;D outbound
 quit
<span class="hljs-comment">## X_T_Export1</span>
tracert  -a 10.20.1.5 10.100.2.1
<span class="hljs-comment">## Y_Export1</span>
ping -vpn-instance vpn3 -a 10.100.3.1 10.3.99.254
<span class="hljs-comment">## </span>

<span class="hljs-comment">## 防止OA路由倒灌</span>
<span class="hljs-comment"># X_PE1/PE2</span>
ip ip-prefix YZ index 10 deny 10.1.0.0 16 greater-equal 16 less-equal 32
ip ip-prefix YZ index 20 deny 10.20.1.4 30
ip ip-prefix YZ index 30 permit 0.0.0.0 0 less-equal 32
route-policy YZ permit node 10
if-match ip-prefix YZ
ip vpn-instance OA
import route-policy YZ
<span class="hljs-comment"># Y_PE1/PE2</span>
ip ip-prefix XZ index 10 deny 10.2.0.0 16 greater-equal 16 less-equal 32
ip ip-prefix XZ index 20 deny 10.100.2.0 24
ip ip-prefix XZ index 30 permit 0.0.0.0 0 less-equal 32
route-policy XZ permit node 10
if-match ip-prefix XZ
ip vpn-instance OA
import route-policy XZ

Z园区: SRv6
1、全局ISIS IPv6配置（IBG打通）
<span class="hljs-comment">## PEX</span>
bfd
<span class="hljs-comment">#</span>
isis 1
  is-level level-2
  cost-style wide
  network-entity 49.0001.00X0.0000.000X.00
  ipv6 <span class="hljs-built_in">enable</span> topology ipv6
  ipv6 bfd all-interfaces <span class="hljs-built_in">enable</span>
  ipv6 bfd all-interfaces min-tx-interval 15 min-rx-interval 15 //模拟器 300
  domain-authentication-mode md5 plain Huawei@123
<span class="hljs-comment">#</span>
interface loopback0
  isis ipv6 <span class="hljs-built_in">enable</span> 1
<span class="hljs-comment">#</span>
interface G0/2/28
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis authentication-mode md5 cipher Huawei@123
  isis ppp-negotiation 2-way
<span class="hljs-comment">#</span>
interface G0/2/29
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis authentication-mode md5 cipher Huawei@123
  isis ppp-negotiation 2-way
<span class="hljs-comment">#</span>
interface G0/2/30
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis authentication-mode md5 cipher Huawei@123
  isis ppp-negotiation 2-way
  isis ipv6 cost 4

<span class="hljs-comment">## 检查</span>
dis ipv6 routing-table fc00::5:5 verbose <span class="hljs-comment"># X_PE1</span>
dis isis route ipv6 <span class="hljs-comment"># X_PE1</span>

2、部署SRv6 Locator 和 Opcode静态
<span class="hljs-comment">## PEX </span>
<span class="hljs-comment">## 部署 SRv6 Locator</span>
segment-routing ipv6
  sr-te frr <span class="hljs-built_in">enable</span>
  encapsulation source-address FC00::X:X //Loopback0 ipv6 地址
  locator HCIE ipv6-prefix FC02:X:: 96 static 16 //注意考场有没要求特点前缀
<span class="hljs-comment">#</span>
isis 1
  segment-routing ipv6 locator HCIE
  avoid-microloop frr-protected
  ipv6 avoid-microloop segment-routing
  ipv6 frr
    loop-free-alternate level-2

<span class="hljs-comment">## Opcode静态部署</span>
<span class="hljs-comment"># X_PE1</span>
segment-routing ipv6
  locator HCIE
    opcode ::1 end psp
    opcode ::10 end-x interface G0/2/30 nexthop FC01:10::A psp
    opcode ::20 end-x interface G0/2/28 nexthop FC01:10::2 psp
    opcode ::30 end-x interface G0/2/29 nexthop FC01:10::6 psp
    opcode ::100 end-op
<span class="hljs-comment"># X_PE2</span>
segment-routing ipv6
  locator HCIE
    opcode ::1 end psp
    opcode ::10 end-x interface G0/2/30 nexthop FC01:10::9 psp
    opcode ::20 end-x interface G0/2/28 nexthop FC01:10::E psp
    opcode ::30 end-x interface G0/2/29 nexthop FC01:10::12 psp
<span class="hljs-comment"># Y_PE1</span>
segment-routing ipv6
  locator HCIE
    opcode ::1 end psp
    opcode ::10 end-x interface G0/2/30 nexthop FC01:10::1A psp
    opcode ::20 end-x interface G0/2/28 nexthop FC01:10::1 psp
    opcode ::30 end-x interface G0/2/29 nexthop FC01:10::16 psp
    opcode ::100 end-op
<span class="hljs-comment"># Y_PE2</span>
segment-routing ipv6
  locator HCIE
    opcode ::1 end psp
    opcode ::10 end-x interface G0/2/30 nexthop FC01:10::19 psp
    opcode ::20 end-x interface G0/2/28 nexthop FC01:10::D psp
    opcode ::30 end-x interface G0/2/29 nexthop FC01:10::1E psp
    opcode ::100 end-op
<span class="hljs-comment"># Z_PE1</span>
segment-routing ipv6
  locator HCIE
    opcode ::1 end psp
    opcode ::10 end-x interface G0/2/30 nexthop FC01:10::22 psp
    opcode ::20 end-x interface G0/2/28 nexthop FC01:10::5 psp
    opcode ::30 end-x interface G0/2/29 nexthop FC01:10::15 psp
    opcode ::100 end-op
<span class="hljs-comment"># Z_PE2</span>
segment-routing ipv6
  locator HCIE
    opcode ::1 end psp
    opcode ::10 end-x interface G0/2/30 nexthop FC01:10::21 psp
    opcode ::20 end-x interface G0/2/28 nexthop FC01:10::11 psp
    opcode ::30 end-x interface G0/2/29 nexthop FC01:10::1D psp
    opcode ::100 end-op

<span class="hljs-comment">## 检查</span>
ping ipv6-sid segment-by-segment fc02:2::10 <span class="hljs-comment"># X_PE1</span>
ping ipv6-sid segment-by-segment fc02:2::20 <span class="hljs-comment"># X_PE1</span>
ping ipv6-sid segment-by-segment fc02:2::30 <span class="hljs-comment"># X_PE1</span>
ping ipv6-sid segment-by-segment fc02:3::10 <span class="hljs-comment"># X_PE1</span>
ping ipv6-sid segment-by-segment fc02:3::20 <span class="hljs-comment"># X_PE1</span>
ping ipv6-sid segment-by-segment fc02:3::30 <span class="hljs-comment"># X_PE1</span>
ping ipv6-sid segment-by-segment fc02:4::10 <span class="hljs-comment"># X_PE1</span>
ping ipv6-sid segment-by-segment fc02:4::20 <span class="hljs-comment"># X_PE1</span>
ping ipv6-sid segment-by-segment fc02:4::30 <span class="hljs-comment"># X_PE1</span>
ping ipv6-sid segment-by-segment fc02:5::10 <span class="hljs-comment"># X_PE1</span>
ping ipv6-sid segment-by-segment fc02:5::20 <span class="hljs-comment"># X_PE1</span>
ping ipv6-sid segment-by-segment fc02:5::30 <span class="hljs-comment"># X_PE1</span>
ping ipv6-sid segment-by-segment fc02:6::10 <span class="hljs-comment"># X_PE1</span>
ping ipv6-sid segment-by-segment fc02:6::20 <span class="hljs-comment"># X_PE1</span>
ping ipv6-sid segment-by-segment fc02:6::30 <span class="hljs-comment"># X_PE1</span>

ping ipv6-sid segment-by-segment fc02:1::10 <span class="hljs-comment"># X_PE2</span>
ping ipv6-sid segment-by-segment fc02:1::20 <span class="hljs-comment"># X_PE2</span>
ping ipv6-sid segment-by-segment fc02:1::30 <span class="hljs-comment"># X_PE2</span>

dis segment-routing ipv6 local-sid locator HCIE forwarding

3、BGP 65000 / EVPN 配置
<span class="hljs-comment">## Z_PE1/2</span>
bgp 65000
  router-id X.0.0.X //手动配置 RID
  peer FC00::1 as-number 65000
  peer FC00::1 connect-interface loopback 0
  peer FC00::1 password simple Huawei@123
  peer FC00::2 as-number 65000
  peer FC00::2 connect-interface loopback 0
  peer FC00::2 password simple Huawei@123
  peer FC00::3 as-number 65000
  peer FC00::3 connect-interface loopback 0
  peer FC00::3 password simple Huawei@123
  peer FC00::4 as-number 65000
  peer FC00::4 connect-interface loopback 0
  peer FC00::4 password simple Huawei@123 (考场看需求配置)
  l2vpn-family evpn
    policy vpn-target
    peer FC00::1 <span class="hljs-built_in">enable</span>
    y
    peer FC00::1 advertise encap-type srv6
    peer FC00::2 <span class="hljs-built_in">enable</span>
    y
    peer FC00::2 advertise encap-type srv6
    peer FC00::3 <span class="hljs-built_in">enable</span>
    y
    peer FC00::3 advertise encap-type srv6
    peer FC00::4 <span class="hljs-built_in">enable</span>
    y
    peer FC00::4 advertise encap-type srv6
    quit
  quit

<span class="hljs-comment">## X/Y_PE1/2</span>
bgp 65000
  router-id X.0.0.X 手动配置 RID
  peer FC00::5 as-number 65000
  peer FC00::5 connect-interface loopback 0
  peer FC00::5 password simple Huawei@123
  peer FC00::6 as-number 65000
  peer FC00::6 connect-interface loopback 0
  peer FC00::6 password simple Huawei@123
  l2vpn-family evpn
    policy vpn-target
    peer FC00::5 <span class="hljs-built_in">enable</span>
    y
    peer FC00::5 advertise encap-type srv6
    peer FC00::6 <span class="hljs-built_in">enable</span>
    y
    peer FC00::6 advertise encap-type srv6
    quit
  quit

<span class="hljs-comment">## 检查</span>
dis bgp evpn peer

4、[65000, 65001] vpn-instance / IP / BGP EVPN / 双点双站路由重分布
<span class="hljs-comment">## X_PE1</span>
ip vpn-instance OA
  route-distinguisher 65001:1
  vpn-target 1:4 export-extcommunity evpn
  vpn-target 4:1 import-extcommunity evpn
<span class="hljs-comment">#</span>
interface G0/2/31
  ip binding vpn-instance OA
  ip address 10.20.1.2 30
<span class="hljs-comment">#</span>
bgp 65000
  ipv4-family vpn-instance OA
    advertise l2vpn evpn
    segment-routing ipv6 traffic-engineer best-effort evpn
    segment-routing ipv6 locator HCIE evpn
    peer 10.20.1.1 as-number 65001
    quit
  quit

<span class="hljs-comment"># SRv6 Policy部署</span>
segment-routing ipv6
  srv6-te-policy locator HCIE
  segment-list x1-z1-zhu
    index 10 sid ipv6 FC02:1::30
  segment-list x1-z1-bei
    index 10 sid ipv6 FC02:1::10
    index 20 sid ipv6 FC02:2::30
    index 30 sid ipv6 FC02:6::10
srv6-te policy x1-z1 endpoint FC00::5 Color 101
  candidate-path preference 200
    segment-list x1-z1-zhu
  candidate-path preference 100
    segment-list x1-z1-bei
<span class="hljs-comment">#</span>
route-policy fz1 permit node 10
  apply extcommunity color 0:101
<span class="hljs-comment">#</span>
route-policy fz2 permit node 10
  apply cost 10
<span class="hljs-comment">#</span>
bgp 65000
l2vpn-family evpn
  peer FC00::5 route-policy fz1 import
  peer FC00::6 route-policy fz2 import
<span class="hljs-comment">#</span>
tunnel-policy x1-z1
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
<span class="hljs-comment">#</span>
ip vpn-instance OA
  ipv4-family
  tnl-policy x1-z1 evpn

<span class="hljs-comment"># SRv6 SBFD部署</span>
te ipv6-router-id FC00::X
bfd
sbfd
  reflector discriminator X.0.0.X 对应自己的 Router-ID
  destination ipv6 FC00::5 remote-discriminator 5.0.0.5
te ipv6-router-id FC00::X
segment-routing ipv6
srv6-te-policy backup hot-standby <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd seamless <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd no-bypass
  srv6-te-policy bfd min-tx-interval 50
<span class="hljs-comment">#考场配置如下：</span>
srv6-te-policy seamless-bfd <span class="hljs-built_in">enable</span>
srv6-te-policy seamless-bfd min-tx-interval 50
<span class="hljs-comment"># 检查</span>
dis bfd session all
dis srv6-te policy

<span class="hljs-comment"># 路径规划实现， OA主路径</span>
route-policy MED_OA permit node 10
  apply cost 10
<span class="hljs-comment">#</span>
bgp 65000
  ipv4-family vpn-instance OA
    peer 10.20.1.1 route-policy MED_OA <span class="hljs-built_in">export</span>


<span class="hljs-comment">## X_PE2</span>
ip vpn-instance OA
  route-distinguisher 65001:2
  vpn-target 1:4 export-extcommunity evpn
  vpn-target 4:1 import-extcommunity evpn
<span class="hljs-comment">#</span>
interface G0/2/31
  ip binding vpn-instance OA
  ip address 10.20.1.10 30
<span class="hljs-comment">#</span>
bgp 65000
  ipv4-family vpn-instance OA
    advertise l2vpn evpn
    segment-routing ipv6 traffic-engineer best-effort evpn
    segment-routing ipv6 locator HCIE evpn
    peer 10.20.1.9 as-number 65001

<span class="hljs-comment"># SRv6 Policy部署</span>
segment-routing ipv6
  srv6-te-policy locator HCIE
  segment-list x2-z2-zhu
    index 10 sid ipv6 FC02:2::30
  segment-list x2-z2-bei
    index 10 sid ipv6 FC02:2::10
    index 20 sid ipv6 FC02:1::30
    index 30 sid ipv6 FC02:5::10
srv6-te policy x2-z2 endpoint FC00::6 Color 102
  candidate-path preference 200
    segment-list x2-z2-zhu
  candidate-path preference 100
    segment-list x2-z2-bei
<span class="hljs-comment">#</span>
route-policy fz1 permit node 10
  apply cost 10
<span class="hljs-comment">#</span>
route-policy fz2 permit node 10
  apply extcommunity color 0:102
<span class="hljs-comment">#</span>
bgp 65000
l2vpn-family evpn
  peer FC00::5 route-policy fz1 import
  peer FC00::6 route-policy fz2 import
<span class="hljs-comment">#</span>
tunnel-policy x2-z2
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
<span class="hljs-comment">#</span>
ip vpn-instance OA
  ipv4-family
  tnl-policy x2-z2 evpn

<span class="hljs-comment"># SRv6 SBFD部署</span>
te ipv6-router-id FC00::X
bfd
sbfd
  reflector discriminator X.0.0.X 对应自己的 Router-ID
  destination ipv6 FC00::6 remote-discriminator 6.0.0.6
segment-routing ipv6
srv6-te-policy backup hot-standby <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd seamless <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd no-bypass
  srv6-te-policy bfd min-tx-interval 50
<span class="hljs-comment"># 考场配置如下：</span>
srv6-te-policy seamless-bfd <span class="hljs-built_in">enable</span>
srv6-te-policy seamless-bfd min-tx-interval 50
<span class="hljs-comment"># 检查</span>
dis bfd session all
dis srv6-te policy

<span class="hljs-comment"># 路径规划实现， OA主路径</span>
route-policy MED_OA permit node 10
  apply cost 12
bgp 65000 
  ipv4-family vpn-instance OA 
    peer 10.20.1.9 route-policy MED_OA <span class="hljs-built_in">export</span> 


<span class="hljs-comment">## X_Export1</span>
inter G0/0/7
  undo portswitch
  ip add 10.20.1.1 30
inter G0/0/8
  ip add 10.20.1.5 30
  quit

acl 2001
  rule permit <span class="hljs-built_in">source</span> 10.1.11.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.12.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.13.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.14.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.15.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.21.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.22.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.23.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.24.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.25.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.31.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.32.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.33.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.34.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.35.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.41.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.42.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.43.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.44.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.45.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.51.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.52.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.53.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.54.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.55.0 0.0.0.255
 quit

route-policy b2o permit node 10
  apply tag 10
route-policy o2b deny node 10
  if-match tag 20
route-policy o2b permit node 20
  if-match acl 2001
  quit

bgp 65001
  router-id 10.1.0.1
  peer 10.20.1.2 as 65000
  preference 120 255 255
  import ospf 1 route-policy o2b
  quit


ospf 1
  import bgp route-policy b2o
  default cost inherit-metric
  area 0
    network 10.20.1.5 0.0.0.0
    quit
  quit


<span class="hljs-comment">## X_Export2</span>
inter G0/0/7
  undo portswitch
  ip add 10.20.1.9 30
inter G0/0/8
  ip add 10.20.1.6 30
  quit

acl 2001
  rule permit <span class="hljs-built_in">source</span> 10.1.11.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.12.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.13.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.14.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.15.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.21.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.22.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.23.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.24.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.25.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.31.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.32.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.33.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.34.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.35.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.41.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.42.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.43.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.44.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.45.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.51.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.52.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.53.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.54.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.55.0 0.0.0.255
 quit

route-policy b2o permit node 10
  apply tag 20
route-policy o2b deny node 10
  if-match tag 10
route-policy o2b permit node 20
  if-match acl 2001
  quit

bgp 65001
  router-id 10.1.0.2
  peer 10.20.1.10 as 65000 
  preference 120 255 255
  import ospf 1 route-policy o2b
  quit

ospf 1
  import bgp route-policy b2o
  default cost inherit-metric
  area 0
    network 10.20.1.6 0.0.0.0
    quit
  quit

5、[65000, 65003] vpn-instance / IP / BGP EVPN
<span class="hljs-comment">## Y_PE1</span>
ip vpn-instance OA
  route-distinguisher 65003:1
  vpn-target 3:4 export-extcommunity evpn
  vpn-target 4:3 import-extcommunity evpn
<span class="hljs-comment">#</span>
ip vpn-instance R&amp;D
  route-distinguisher 65003:3
  vpn-target 33:44 export-extcommunity evpn
  vpn-target 44:33 import-extcommunity evpn
<span class="hljs-comment">#</span>
interface G0/2/31.10
  vlan-type dot1q 10
  ip binding vpn-instance OA
  ip address 10.20.2.2 30
<span class="hljs-comment">#</span>
interface G0/2/31.20
  vlan-type dot1q 20
  ip binding vpn-instance R&amp;D
  ip address 10.20.2.6 30
<span class="hljs-comment">#</span>
bgp 65000
  ipv4-family vpn-instance OA
    advertise l2vpn evpn
    segment-routing ipv6 traffic-engineer best-effort evpn
    segment-routing ipv6 locator HCIE evpn
    peer 10.20.2.1 as-number 65003
  ipv4-family vpn-instance R&amp;D
    advertise l2vpn evpn
    segment-routing ipv6 traffic-engineer best-effort evpn
    segment-routing ipv6 locator HCIE evpn
    peer 10.20.2.5 as-number 65003

<span class="hljs-comment"># SRv6 Policy部署</span>
segment-routing ipv6
  srv6-te-policy locator HCIE
  segment-list y1-z1-zhu
    index 10 sid ipv6 FC02:3::30
  segment-list y1-z1-bei
    index 10 sid ipv6 FC02:3::10
    index 20 sid ipv6 FC02:4::30
    index 30 sid ipv6 FC02:6::10
srv6-te policy y1-z1 endpoint FC00::5 Color 103
  candidate-path preference 200
    segment-list y1-z1-zhu
    candidate-path preference 100
      segment-list y1-z1-bei
<span class="hljs-comment">#</span>
route-policy fz1 permit node 10
  apply extcommunity color 0:103
<span class="hljs-comment">#</span>
route-policy fz2 permit node 10
  apply cost 10
<span class="hljs-comment">#</span>
bgp 65000
l2vpn-family evpn
  peer FC00::5 route-policy fz1 import
  peer FC00::6 route-policy fz2 import
<span class="hljs-comment">#</span>
tunnel-policy y1-z1
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
<span class="hljs-comment">#</span>
ip vpn-instance OA
  ipv4-family
  tnl-policy y1-z1 evpn
<span class="hljs-comment">#</span>
ip vpn-instance R&amp;D
  ipv4-family
  tnl-policy y1-z1 evpn

<span class="hljs-comment"># SRv6 SBFD部署</span>
te ipv6-router-id FC00::X
bfd
sbfd
  reflector discriminator X.0.0.X 对应自己的 Router-ID
  destination ipv6 FC00::5 remote-discriminator 5.0.0.5
te ipv6-router-id FC00::X
segment-routing ipv6
srv6-te-policy backup hot-standby <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd seamless <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd no-bypass
  srv6-te-policy bfd min-tx-interval 50
考场配置如下：
srv6-te-policy seamless-bfd <span class="hljs-built_in">enable</span>
srv6-te-policy seamless-bfd min-tx-interval 50
<span class="hljs-comment"># 检查</span>
dis bfd session all
dis srv6-te policy

<span class="hljs-comment"># 路径规划实现， OA主路径，RD备路径</span>
route-policy MED_OA permit node 10 
  apply cost 10 
route-policy MED_RD permit node 10 
  apply cost 12
bgp 65000 
  ipv4-family vpn-instance OA 
    peer 10.20.2.1 route-policy MED_OA <span class="hljs-built_in">export</span>
  ipv4-family vpn-instance R&amp;D 
    peer 10.20.2.5 route-policy MED_RD <span class="hljs-built_in">export</span>

  

<span class="hljs-comment">## Y_PE2</span>
ip vpn-instance OA
  route-distinguisher 65003:2
  vpn-target 3:4 export-extcommunity evpn
  vpn-target 4:3 import-extcommunity evpn
<span class="hljs-comment">#</span>
ip vpn-instance R&amp;D
  route-distinguisher 65003:4
  vpn-target 33:44 export-extcommunity evpn
  vpn-target 44:33 import-extcommunity evpn
<span class="hljs-comment">#</span>
interface G0/2/31.10
  vlan-type dot1q 10
  ip binding vpn-instance OA
  ip address 10.20.2.10 30
<span class="hljs-comment">#</span>
interface G0/2/31.20
  vlan-type dot1q 20
  ip binding vpn-instance R&amp;D
  ip address 10.20.2.14 30
<span class="hljs-comment">#</span>
bgp 65000
  ipv4-family vpn-instance OA
    advertise l2vpn evpn
    segment-routing ipv6 traffic-engineer best-effort evpn
    segment-routing ipv6 locator HCIE evpn
    peer 10.20.2.9 as-number 65003
  ipv4-family vpn-instance R&amp;D
    advertise l2vpn evpn
    segment-routing ipv6 traffic-engineer best-effort evpn
    segment-routing ipv6 locator HCIE evpn
    peer 10.20.2.13 as-number 65003

<span class="hljs-comment"># SRv6 Policy部署</span>
segment-routing ipv6
  srv6-te-policy locator HCIE
  segment-list y2-z2-zhu
    index 10 sid ipv6 FC02:4::30
  segment-list y2-z2-bei
    index 10 sid ipv6 FC02:4::10
    index 20 sid ipv6 FC02:3::30
    index 30 sid ipv6 FC02:5::10
srv6-te policy y2-z2 endpoint FC00::6 Color 104
  candidate-path preference 200
    segment-list y2-z2-zhu
  candidate-path preference 100
    segment-list y2-z2-bei
<span class="hljs-comment">#</span>
route-policy fz2 permit node 10
  apply extcommunity color 0:104
<span class="hljs-comment">#</span>
route-policy fz1 permit node 10
  apply cost 10
<span class="hljs-comment">#</span>
bgp 65000
l2vpn-family evpn
  peer FC00::5 route-policy fz1 import
  peer FC00::6 route-policy fz2 import
<span class="hljs-comment">#</span>
tunnel-policy y2-z2
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
<span class="hljs-comment">#</span>
ip vpn-instance OA
  ipv4-family
  tnl-policy y2-z2 evpn
<span class="hljs-comment">#</span>
ip vpn-instance R&amp;D
  ipv4-family
  tnl-policy y2-z2 evpn


<span class="hljs-comment"># SRv6 SBFD部署</span>
te ipv6-router-id FC00::X
bfd
sbfd
  reflector discriminator X.0.0.X 对应自己的 Router-ID
  destination ipv6 FC00::6 remote-discriminator 6.0.0.6
segment-routing ipv6
srv6-te-policy backup hot-standby <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd seamless <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd no-bypass
  srv6-te-policy bfd min-tx-interval 50
<span class="hljs-comment"># 考场配置如下：</span>
srv6-te-policy seamless-bfd <span class="hljs-built_in">enable</span>
srv6-te-policy seamless-bfd min-tx-interval 50
<span class="hljs-comment">## 检查</span>
dis bfd session all
dis srv6-te policy

<span class="hljs-comment"># 路径规划实现， OA备路径，RD主路径</span>
route-policy MED_OA permit node 10 
  apply cost 12 
route-policy MED_RD permit node 10 
  apply cost 10
bgp 65000 
  ipv4-family vpn-instance OA 
    peer 10.20.2.9 route-policy MED_OA <span class="hljs-built_in">export</span>
  ipv4-family vpn-instance R&amp;D 
    peer 10.20.2.13 route-policy MED_RD <span class="hljs-built_in">export</span> 



<span class="hljs-comment">## Y_Export</span>
ip ip-prefix OA index 10 permit 10.2.0.0 16 greater-equal 24 less-equal 24
ip ip-prefix OA index 20 permit 10.100.2.0 24
<span class="hljs-comment">#</span>
ip ip-prefix RD index 10 permit 10.2.0.0 16 greater-equal 24 less-equal 24
ip ip-prefix RD index 20 permit 10.100.3.0 24
<span class="hljs-comment">#</span>
interface G0/0/7
  undo portswitch
interface G0/0/6
  undo portswitch
interface G0/0/7.10
  dot1q termination vid 10
  ip binding vpn-instance vpn2
  ip address 10.20.2.1 255.255.255.252
interface G0/0/7.20
  dot1q termination vid 20
  ip binding vpn-instance vpn3
  ip address 10.20.2.5 255.255.255.252
interface G0/0/6.10
  dot1q termination vid 10
  ip binding vpn-instance vpn2
  ip address 10.20.2.9 255.255.255.252
interface G0/0/6.20
  dot1q termination vid 20
  ip binding vpn-instance vpn3
  ip address 10.20.2.13 255.255.255.252
<span class="hljs-comment">#</span>
bgp 65003
  ipv4-family vpn-instance vpn2
    peer 10.20.2.2 as-number 65000
    peer 10.20.2.2 ip-prefix OA <span class="hljs-built_in">export</span>
    peer 10.20.2.10 as-number 65000
    peer 10.20.2.10 ip-prefix OA <span class="hljs-built_in">export</span>
  ipv4-family vpn-instance vpn3
    peer 10.20.2.6 as-number 65000
    peer 10.20.2.6 ip-prefix RD <span class="hljs-built_in">export</span>
    peer 10.20.2.14 as-number 65000
    peer 10.20.2.14 ip-prefix RD <span class="hljs-built_in">export</span>

6、[65000, 65004] vpn-instance / IP / BGP EVPN
<span class="hljs-comment">## Z_PE1</span>
ip vpn-instance OA
  route-distinguisher 65004:1
  vpn-target 1:4 import-extcommunity evpn
  vpn-target 3:4 import-extcommunity evpn
  vpn-target 4:1 export-extcommunity evpn
  vpn-target 4:3 export-extcommunity evpn
ip vpn-instance R&amp;D
  route-distinguisher 65004:3
  vpn-target 44:33 export-extcommunity evpn
  vpn-target 33:44 import-extcommunity evpn
<span class="hljs-comment">#</span>
interface G0/2/31.10
  vlan-type dot1q 10
  ip binding vpn-instance OA
  ip address 10.20.3.2 30
interface G0/2/31.20
  vlan-type dot1q 20
  ip binding vpn-instance R&amp;D
  ip address 10.20.3.6 30
<span class="hljs-comment">#</span>
bgp 65000
  ipv4-family vpn-instance OA
    advertise l2vpn evpn
    segment-routing ipv6 traffic-engineer best-effort evpn
    segment-routing ipv6 locator HCIE evpn
    peer 10.20.3.1 as-number 65004
  ipv4-family vpn-instance R&amp;D
    advertise l2vpn evpn
    segment-routing ipv6 traffic-engineer best-effort evpn
    segment-routing ipv6 locator HCIE evpn
    peer 10.20.3.5 as-number 65004

<span class="hljs-comment"># SRv6 Policy部署</span>
segment-routing ipv6
  srv6-te-policy locator HCIE 
  segment-list z1-x1-zhu
    index 10 sid ipv6 FC02:5::20
  segment-list z1-x1-bei
    index 10 sid ipv6 FC02:5::10
    index 20 sid ipv6 FC02:6::20
    index 30 sid ipv6 FC02:2::10
srv6-te policy z1-x1 endpoint FC00::1 Color 101
  candidate-path preference 200
    segment-list z1-x1-zhu
  candidate-path preference 100
    segment-list z1-x1-bei
    quit
  quit
segment-list z1-y1-zhu
  index 10 sid ipv6 FC02:5::30
segment-list z1-y1-bei
  index 10 sid ipv6 FC02:5::10
  index 20 sid ipv6 FC02:6::30
  index 30 sid ipv6 FC02:4::10
srv6-te policy z1-y1 endpoint FC00::3 Color 103
  candidate-path preference 200
    segment-list z1-y1-zhu
  candidate-path preference 100
    segment-list z1-y1-bei
<span class="hljs-comment">#</span>
route-policy fx1 permit node 10
  apply extcommunity color 0:101
<span class="hljs-comment">#</span>
route-policy fx2 permit node 10
  apply cost 10
<span class="hljs-comment">#</span>
route-policy fy1 permit node 10
  apply extcommunity color 0:103
<span class="hljs-comment">#</span>
route-policy fy2 permit node 10
  apply cost 10

<span class="hljs-comment">#</span>
bgp 65000
l2vpn-family evpn
  peer FC00::1 route-policy fx1 import
  peer FC00::2 route-policy fx2 import
  peer FC00::3 route-policy fy1 import
  peer FC00::4 route-policy fy2 import
<span class="hljs-comment">#</span>
tunnel-policy z1-xy1
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
<span class="hljs-comment">#</span>
ip vpn-instance OA
  ipv4-family
  tnl-policy z1-xy1 evpn
<span class="hljs-comment">#</span>
ip vpn-instance R&amp;D
  ipv4-family
  tnl-policy z1-xy1 evpn

<span class="hljs-comment"># SRv6 SBFD部署</span>
te ipv6-router-id FC00::5
bfd
sbfd
  reflector discriminator 5.0.0.5 对应自己的 Router-ID
  destination ipv6 FC00::1 remote-discriminator 1.0.0.1
  destination ipv6 FC00::3 remote-discriminator 3.0.0.3
segment-routing ipv6
  srv6-te-policy backup hot-standby <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd seamless <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd no-bypass
  srv6-te-policy bfd min-tx-interval 50
<span class="hljs-comment">#考场配置如下：</span>
srv6-te-policy seamless-bfd <span class="hljs-built_in">enable</span>
srv6-te-policy seamless-bfd min-tx-interval 50
<span class="hljs-comment"># 检查</span>
dis bfd session all
dis srv6-te policy

<span class="hljs-comment">## 路径规划实现， OA主路径，RD备路径</span>
route-policy MED_OA permit node 10 
  apply cost 10 
route-policy MED_RD permit node 10
  apply cost 12
bgp 65000 
  ipv4-family vpn-instance OA 
    peer 10.20.3.1 route-policy MED_OA <span class="hljs-built_in">export</span>
  ipv4-family vpn-instance R&amp;D
    peer 10.20.3.5 route-policy MED_RD <span class="hljs-built_in">export</span>



<span class="hljs-comment">## Z_PE2</span>
ip vpn-instance OA
  route-distinguisher 65004:2
  vpn-target 1:4 import-extcommunity evpn
  vpn-target 3:4 import-extcommunity evpn
  vpn-target 4:1 export-extcommunity evpn
  vpn-target 4:3 export-extcommunity evpn
<span class="hljs-comment">#</span>
ip vpn-instance R&amp;D
  route-distinguisher 65004:4
  vpn-target 44:33 export-extcommunity evpn
  vpn-target 33:44 import-extcommunity evpn
<span class="hljs-comment">#</span>
interface G0/2/31.10
  vlan-type dot1q 10
  ip binding vpn-instance OA
  ip address 10.20.3.10 30
<span class="hljs-comment">#</span>
interface G0/2/31.20
  vlan-type dot1q 20
  ip binding vpn-instance R&amp;D
  ip address 10.20.3.14 30
<span class="hljs-comment">#</span>
bgp 65000
  ipv4-family vpn-instance OA
    advertise l2vpn evpn
    segment-routing ipv6 traffic-engineer best-effort evpn
    segment-routing ipv6 locator HCIE evpn
    peer 10.20.3.9 as-number 65004
  ipv4-family vpn-instance R&amp;D
    advertise l2vpn evpn
    segment-routing ipv6 traffic-engineer best-effort evpn
    segment-routing ipv6 locator HCIE evpn
    peer 10.20.3.13 as-number 65004

<span class="hljs-comment"># SRv6 Policy部署</span>
segment-routing ipv6
  srv6-te-policy locator HCIE
  segment-list z2-x2-zhu
    index 10 sid ipv6 FC02:6::20
  segment-list z2-x2-bei
    index 10 sid ipv6 FC02:6::10
    index 20 sid ipv6 FC02:5::20
    index 30 sid ipv6 FC02:1::10
srv6-te policy z2-x2 endpoint FC00::2 Color 102
  candidate-path preference 200
    segment-list z2-x2-zhu
  candidate-path preference 100
    segment-list z2-x2-bei
    quit
  quit
segment-list z2-y2-zhu
  index 10 sid ipv6 FC02:6::30
segment-list z2-y2-bei
  index 10 sid ipv6 FC02:6::10
  index 20 sid ipv6 FC02:5::30
  index 30 sid ipv6 FC02:3::10
srv6-te policy z2-y2 endpoint FC00::4 Color 104
  candidate-path preference 200
    segment-list z2-y2-zhu
  candidate-path preference 100
    segment-list z2-y2-bei
<span class="hljs-comment">#</span>
route-policy fx1 permit node 10
  apply cost 10
<span class="hljs-comment">#</span>
route-policy fx2 permit node 10
  apply extcommunity color 0:102
<span class="hljs-comment">#</span>
route-policy fy1 permit node 10
  apply cost 10
<span class="hljs-comment">#</span>
route-policy fy2 permit node 10
  apply extcommunity color 0:104
<span class="hljs-comment">#</span>
bgp 65000
l2vpn-family evpn
  peer FC00::1 route-policy fx1 import
  peer FC00::2 route-policy fx2 import
  peer FC00::3 route-policy fy1 import
  peer FC00::4 route-policy fy2 import
<span class="hljs-comment">#</span>
tunnel-policy z2-xy2
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
<span class="hljs-comment">#</span>
ip vpn-instance OA
  ipv4-family
  tnl-policy z2-xy2 evpn
<span class="hljs-comment">#</span>
ip vpn-instance R&amp;D
  ipv4-family
  tnl-policy z2-xy2 evpn

<span class="hljs-comment"># SRv6 SBFD部署</span>
te ipv6-router-id FC00::6
bfd
sbfd
  reflector discriminator 6.0.0.6 对应自己的 Router-ID
  destination ipv6 FC00::2 remote-discriminator 2.0.0.2
  destination ipv6 FC00::4 remote-discriminator 4.0.0.4
segment-routing ipv6
  srv6-te-policy backup hot-standby <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd seamless <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd no-bypass
  srv6-te-policy bfd min-tx-interval 50
<span class="hljs-comment">#考场配置如下：</span>
srv6-te-policy seamless-bfd <span class="hljs-built_in">enable</span>
srv6-te-policy seamless-bfd min-tx-interval 50
<span class="hljs-comment"># 检查</span>
dis bfd session all
dis srv6-te policy

<span class="hljs-comment">## 路径规划实现， OA备路径，RD主路径</span>
route-policy MED_OA permit node 10 
  apply cost 12
route-policy MED_RD permit node 10 
  apply cost 10
bgp 65000 
  ipv4-family vpn-instance OA 
    peer 10.20.3.9 route-policy MED_OA <span class="hljs-built_in">export</span>
  ipv4-family vpn-instance R&amp;D 
    peer 10.20.2.13 route-policy MED_RD <span class="hljs-built_in">export</span>

<span class="hljs-comment">## Z_Export1</span>
sysname Z_Export1
<span class="hljs-comment"># </span>
ip vpn-instance OA
  route-distinguisher 65004:10
ip vpn-instance RD
  route-distinguisher 65004:20
  quit

int lo0
  ip binding vpn-instance OA
  ip add 10.3.101.254 24
int lo1
  ip binding vpn-instance R&amp;D
  ip add 10.3.99.254 24
int lo2
  ip binding vpn-instance R&amp;D
  ip add 10.3.100.254 24
  quit

int E 0/0/7
  undo portswitch
int E 0/0/6
  undo portswitch
int E 0/0/7.10
  dot1q termination vid 10
  ip binding vpn-instance OA
  ip add 10.20.3.1 30
  arp broadcast <span class="hljs-built_in">enable</span>
int E 0/0/7.20
  dot1q termination vid 20
  ip binding vpn-instance R&amp;D
  ip add 10.20.3.5 30
  arp broadcast <span class="hljs-built_in">enable</span>
int E 0/0/6.10
  dot1q termination vid 10
  ip binding vpn-instance OA
  ip add 10.20.3.9 30
  arp broadcast <span class="hljs-built_in">enable</span>
int E 0/0/6.20
  dot1q termination vid 20
  ip binding vpn-instance R&amp;D
  ip add 10.20.3.13 30
  arp broadcast <span class="hljs-built_in">enable</span>

bgp 65004
  router-id 10.3.99.254
  ipv4-family vpn-instance OA
    network 10.3.101.0 24
    peer 10.20.3.2 as-number 65000
    peer 10.20.3.10 as-number 65000
  ipv4-family vpn-instance R&amp;D
    network 10.3.99.0 24
    network 10.3.100.0 24
    peer 10.20.3.6 as-number 65000
    peer 10.20.3.14 as-number 65000
    quit
  quit

<span class="hljs-comment"># 检查</span>
dis bgp peer
dis bgp vpnv4 all peer
dis vpnv4 vpn-instance OA routing-table
dis vpnv4 vpn-instance R&amp;D routing-table

7、VPN FRR部署 / 部署 QOS
<span class="hljs-comment">## VPN FRR部署</span>
<span class="hljs-comment"># X/Y_PE1</span>
bgp 65000
  ipv4-family vpn-instance OA
    auto-frr \\使能 VPN FRR

<span class="hljs-comment">## 部署QOS</span>
acl number 3001
  rule permit ip <span class="hljs-built_in">source</span> 10.2.11.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.2.12.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.2.13.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.2.14.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.2.15.0 0.0.0.255
  description rd
acl number 3002
  rule permit ip <span class="hljs-built_in">source</span> 10.2.21.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.2.22.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.2.23.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.2.24.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.2.25.0 0.0.0.255
  description product
traffic classifier rd
  if-match acl 3001
traffic classifier pro
  if-match acl 3002
traffic behavior pro
  remark dscp ef
  queue llq bandwidth 100000
traffic behavior rd
  remark dscp af41
  queue af bandwidth 300000
traffic policy RD
  classifier rd behavior rd
  classifier pro behavior pro
interface GigabitEthernet0/0/6.20
  traffic-policy RD outbound
interface GigabitEthernet0/0/7.20
  traffic-policy RD outbound

<span class="hljs-comment">## Y_PE1/2</span>
interface G0/2/31.20 
  trust upstream default <span class="hljs-comment"># 信任 QOS 映射</span>

<span class="hljs-comment">## ALL PE</span>
flow-wred drop
  color green low-limit 70 high-limit 90 discard-percentage 50
  color yellow low-limit 60 high-limit 90 discard-percentage 50
  color red low-limit 50 high-limit 90 discard-percentage 100
flow-queue QOS
  queue af4 wfq weight 10 flow-wred drop
  queue ef pq flow-wred drop
qos-profile QOS
  user-queue cir 1000000 pir 1000000 flow-queue QOS
interface G0/2/28
  qos-profile QOS outbound
interface G0/2/29
  qos-profile QOS outbound
interface G0/2/30
  qos-profile QOS outbound
<span class="hljs-comment"># Z_PE1/2</span>
int G0/2/31.20
  qos-profile QOS outbound

SRv6配置整理
1、ISIS/SR/BGP EVPN
<span class="hljs-comment">## network-entity 49.0001.00X0.0000.000X.00</span>
isis 1
  is-level level-2
  cost-style wide
  network-entity 49.0001.0010.0000.0001.00
  domain-authentication-mode md5 cipher Huawei@123
  ipv6 <span class="hljs-built_in">enable</span> topology ipv6
  ipv6 bfd all-interfaces <span class="hljs-built_in">enable</span>
  ipv6 bfd all-interfaces min-tx-interval 15 min-rx-interval 15
  <span class="hljs-comment">#SR</span>
  segment-routing ipv6 locator HCIE
  avoid-microloop frr-protected
  ipv6 avoid-microloop segment-routing
  ipv6 frr
    loop-free-alternate level-2
interface LoopBack0
  isis ipv6 <span class="hljs-built_in">enable</span> 1
interface GigabitEthernet0/2/28
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis authentication-mode md5 cipher Huawei@123
  isis ppp-negotiation 2-way
interface GigabitEthernet0/2/29
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis authentication-mode md5 cipher Huawei@123
  isis ppp-negotiation 2-way
interface GigabitEthernet0/2/28
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis authentication-mode md5 cipher Huawei@123
  isis ppp-negotiation 2-way
interface GigabitEthernet0/2/30
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis ipv6 cost 4
  isis circuit-type p2p
  isis authentication-mode md5 cipher Huawei@123
  isis ppp-negotiation 2-way

<span class="hljs-comment">## SR</span>
<span class="hljs-comment">#  encapsulation source-address FC00::X</span>
<span class="hljs-comment">#  locator HCIE ipv6-prefix FC02:X:: 96 static 16</span>
segment-routing ipv6
  sr-te frr <span class="hljs-built_in">enable</span>
  encapsulation source-address FC00::1
  locator HCIE ipv6-prefix FC02:1:: 96 static 16
    <span class="hljs-comment"># Opcode静态部署，考场不用加PSP</span>
    opcode ::1 end psp
    opcode ::10 end-x interface GigabitEthernet0/2/30 nexthop FC01:10::A psp
    opcode ::20 end-x interface GigabitEthernet0/2/28 nexthop FC01:10::2 psp
    opcode ::30 end-x interface GigabitEthernet0/2/29 nexthop FC01:10::6 psp
    opcode ::100 end-op

<span class="hljs-comment">## BGP EVPN邻居部署</span>
<span class="hljs-comment"># Z_PE1/2</span>
bgp 65000
  router-id 5.0.0.5
  peer FC00::1 as-number 65000
  peer FC00::1 connect-interface LoopBack0
  peer FC00::1 password cipher Huawei@123
  peer FC00::2 as-number 65000
  peer FC00::2 connect-interface LoopBack0
  peer FC00::2 password cipher Huawei@123
  peer FC00::3 as-number 65000
  peer FC00::3 connect-interface LoopBack0
  peer FC00::3 password cipher Huawei@123
  peer FC00::4 as-number 65000
  peer FC00::4 connect-interface LoopBack0
  peer FC00::4 password cipher Huawei@123
  l2vpn-family evpn
    policy vpn-target
    peer FC00::1 <span class="hljs-built_in">enable</span>
    peer FC00::1 advertise encap-type srv6
    peer FC00::2 <span class="hljs-built_in">enable</span>
    peer FC00::2 advertise encap-type srv6
    peer FC00::3 <span class="hljs-built_in">enable</span>
    peer FC00::3 advertise encap-type srv6
    peer FC00::4 <span class="hljs-built_in">enable</span>
    peer FC00::4 advertise encap-type srv6
<span class="hljs-comment"># X/Y_PE1/2</span>
bgp 65000
  router-id 1.0.0.1
  peer FC00::5 as-number 65000
  peer FC00::5 connect-interface LoopBack0
  peer FC00::5 password cipher Huawei@123
  peer FC00::6 as-number 65000
  peer FC00::6 connect-interface LoopBack0
  peer FC00::6 password cipher Huawei@123
  l2vpn-family evpn
    policy vpn-target
    peer FC00::5 <span class="hljs-built_in">enable</span>
    peer FC00::5 advertise encap-type srv6
    peer FC00::6 <span class="hljs-built_in">enable</span>
    peer FC00::6 advertise encap-type srv6

2、65001 vpn-instance / ip / bgp
<span class="hljs-comment"># X_PE1/2</span>
<span class="hljs-comment"># peer 10.20.1.9 as-number 65001</span>
<span class="hljs-comment"># ip address 10.20.1.10 30</span>
ip vpn-instance OA
  route-distinguisher 65001:1
  vpn-target 1:4 export-extcommunity evpn
  vpn-target 4:1 import-extcommunity evpn
<span class="hljs-comment">#</span>
interface G0/2/31
  ip binding vpn-instance OA
  ip address 10.20.1.2 30
<span class="hljs-comment">#</span>
bgp 65000
  ipv4-family vpn-instance OA
    advertise l2vpn evpn
    segment-routing ipv6 traffic-engineer best-effort evpn
    segment-routing ipv6 locator HCIE evpn
    peer 10.20.1.1 as-number 65001

<span class="hljs-comment"># X_Export1/2</span>
<span class="hljs-comment"># ip add 10.20.1.9 30</span>
<span class="hljs-comment"># ip add 10.20.1.6 30</span>
<span class="hljs-comment"># router-id 10.1.0.2</span>
<span class="hljs-comment"># peer 10.20.1.10 as 65000</span>
inter E0/0/7
  ip add 10.20.1.1 30
<span class="hljs-comment">#</span>
inter E0/0/6
  ip add 10.20.1.5 30
<span class="hljs-comment">#</span>
acl 2001
  rule permit <span class="hljs-built_in">source</span> 10.1.11.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.12.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.13.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.14.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.15.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.21.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.22.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.23.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.24.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.25.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.31.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.32.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.33.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.34.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.35.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.41.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.42.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.43.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.44.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.45.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.51.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.52.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.53.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.54.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.55.0 0.0.0.255
  quit

route-policy b2o permit node 10 
  apply tag 10
route-policy o2b deny node 10 
  if-match tag 20
route-policy o2b permit node 20 
  if-match acl 2001


bgp 65001
  router-id 10.1.0.1
  peer 10.20.1.2 as 65000
  preference 120 255 255
  import ospf 1 route-policy o2b

ospf 1 
  import bgp route-policy b2o 
  default cost inherit-metric 
  area 0 
    network 10.20.1.5 0.0.0.0

<span class="hljs-comment"># X_T1_FW1</span>
switch vsys Employee
sys
security-policy
  rule name x-z
    source-zone trust
    source-zone untrust
    destination-zone untrust
    destination-zone trust
    source-address rang 10.1.11.0 10.1.15.255
    source-address rang 10.1.21.0 10.1.25.255
    source-address rang 10.1.31.0 10.1.35.255
    source-address rang 10.1.41.0 10.1.45.255
    source-address rang 10.1.51.0 10.1.55.255
    destination-address 10.3.101.0 24
    action permit
  rule move Employee_to_internet bottom

3、65003 vpn-instance / ip / bgp
<span class="hljs-comment"># Y_PE1</span>
ip vpn-instance OA
  route-distinguisher 65003:1
  vpn-target 3:4 export-extcommunity evpn
  vpn-target 4:3 import-extcommunity evpn
<span class="hljs-comment">#</span>
ip vpn-instance R&amp;D
  route-distinguisher 65003:3
  vpn-target 33:44 export-extcommunity evpn
  vpn-target 44:33 import-extcommunity evpn
<span class="hljs-comment">#</span>
bgp 65000
  ipv4-family vpn-instance OA
    advertise l2vpn evpn
    segment-routing ipv6 traffic-engineer best-effort evpn
    segment-routing ipv6 locator HCIE evpn
    peer 10.20.2.1 as-number 65003
  ipv4-family vpn-instance R&amp;D
    advertise l2vpn evpn
    segment-routing ipv6 traffic-engineer best-effort evpn
    segment-routing ipv6 locator HCIE evpn
    peer 10.20.2.5 as-number 65003
<span class="hljs-comment">#</span>
interface G0/2/31.10
  vlan-type dot1q 10
  ip binding vpn-instance OA
  ip address 10.20.2.2 30
interface G0/2/31.20
  vlan-type dot1q 20
  ip binding vpn-instance R&amp;D
  ip address 10.20.2.6 30

<span class="hljs-comment"># Y_Export</span>
interface G0/0/7
  undo portswitch
interface G0/0/6
  undo portswitch
interface G0/0/7.10
  dot1q termination vid 10
  ip binding vpn-instance vpn2
  ip address 10.20.2.1 255.255.255.252
interface G0/0/7.20
  dot1q termination vid 20
  ip binding vpn-instance vpn3
  ip address 10.20.2.5 255.255.255.252
interface G0/0/6.10
  dot1q termination vid 10
  ip binding vpn-instance vpn2
  ip address 10.20.2.9 255.255.255.252
interface G0/0/6.20
  dot1q termination vid 20
  ip binding vpn-instance vpn3
  ip address 10.20.2.13 255.255.255.252
<span class="hljs-comment">#</span>
ip ip-prefix OA index 10 permit 10.2.0.0 16 greater-equal 24 less-equal 24
ip ip-prefix OA index 20 permit 10.100.2.0 24
ip ip-prefix RD index 10 permit 10.2.0.0 16 greater-equal 24 less-equal 24
ip ip-prefix RD index 20 permit 10.100.3.0 24
bgp 65003
  ipv4-family vpn-instance vpn2
    peer 10.20.2.2 as-number 65000
    peer 10.20.2.2 ip-prefix OA <span class="hljs-built_in">export</span>
    peer 10.20.2.10 as-number 65000
    peer 10.20.2.10 ip-prefix OA <span class="hljs-built_in">export</span>
  ipv4-family vpn-instance vpn3
    peer 10.20.2.6 as-number 65000
    peer 10.20.2.6 ip-prefix RD <span class="hljs-built_in">export</span>
    peer 10.20.2.14 as-number 65000
    peer 10.20.2.14 ip-prefix RD <span class="hljs-built_in">export</span>

4、65004 vpn-instance / ip / bgp
<span class="hljs-comment"># Z_PE1/2</span>
ip vpn-instance OA
  route-distinguisher 65004:1
    vpn-target 1:4 import-extcommunity evpn
    vpn-target 3:4 import-extcommunity evpn
    vpn-target 4:1 export-extcommunity evpn
    vpn-target 4:3 export-extcommunity evpn
ip vpn-instance R&amp;D
  route-distinguisher 65004:3
    vpn-target 44:33 export-extcommunity evpn
    vpn-target 33:44 import-extcommunity evpn
<span class="hljs-comment">#</span>
interface G0/2/31.10
  vlan-type dot1q 10
  ip binding vpn-instance OA
  ip address 10.20.3.2 30
interface G0/2/31.20
  vlan-type dot1q 20
  ip binding vpn-instance R&amp;D
  ip address 10.20.3.6 30
<span class="hljs-comment">#</span>
bgp 65000
  ipv4-family vpn-instance OA
    advertise l2vpn evpn
    segment-routing ipv6 traffic-engineer best-effort evpn
    segment-routing ipv6 locator HCIE evpn
    peer 10.20.3.1 as-number 65004
  ipv4-family vpn-instance R&amp;D
    advertise l2vpn evpn
    segment-routing ipv6 traffic-engineer best-effort evpn
    segment-routing ipv6 locator HCIE evpn
    peer 10.20.3.5 as-number 65004

<span class="hljs-comment"># Z_Export1</span>
ip vpn-instance OA 
  route-distinguisher 65004:1
ip vpn-instance R&amp;D
  route-distinguisher 65004:2

int E0/0/7
  undo portswitch
int E0/0/6
  undo portswitch
int loopback0 
  ip binding vpn-instance OA 
  ip address 10.3.101.254 24
int loopback1
  ip binding vpn-instance R&amp;D
  ip address 10.3.99.254 24
int loopback2
  ip binding vpn-instance R&amp;D
  ip address 10.3.100.254 24
int E0/0/7.10
  dot1q termination vid 10 
  ip binding vpn-instance OA 
  ip address 10.20.3.1 30 
  arp broadcast <span class="hljs-built_in">enable</span> 
int E0/0/7.20 
  dot1q termination vid 20 
  ip binding vpn-instance R&amp;D 
  ip address 10.20.3.5 30 
  arp broadcast <span class="hljs-built_in">enable</span>
int E0/0/6.10
  dot1q termination vid 10 
  ip binding vpn-instance OA 
  ip address 10.20.3.9 30 
  arp broadcast <span class="hljs-built_in">enable</span> 
int E0/0/6.20 
  dot1q termination vid 20 
  ip binding vpn-instance R&amp;D 
  ip address 10.20.3.13 30 
  arp broadcast <span class="hljs-built_in">enable</span>
<span class="hljs-comment">#</span>
bgp 65004
  router-id 10.3.99.1
  ipv4-family vpn-instance OA
    network 10.3.101.0 24
    peer 10.20.3.2 as-number 65000
    peer 10.20.3.10 as-number 65000
  ipv4-family vpn-instance R&amp;D
    network 10.3.99.0 24
    network 10.3.100.0 24
    peer 10.20.3.6 as-number 65000
    peer 10.20.3.14 as-number 65000

5、SRv6 Policy部署
<span class="hljs-comment"># X_PE1</span>
segment-routing ipv6
  srv6-te-policy locator HCIE
  segment-list x1-z1-zhu
    index 10 sid ipv6 FC02:1::30
  segment-list x1-z1-bei
    index 10 sid ipv6 FC02:1::10
    index 20 sid ipv6 FC02:2::30
    index 30 sid ipv6 FC02:6::10
  srv6-te policy x1-z1 endpoint FC00::5 color 101
    candidate-path preference 200
      segment-list x1-z1-zhu
    candidate-path preference 100
      segment-list x1-z1-bei
<span class="hljs-comment">#</span>
route-policy fz1 permit node 10
  apply extcommunity color 0:101
route-policy fz2 permit node 10
  apply cost 10
<span class="hljs-comment">#</span>
bgp 65000
   l2vpn-family evpn
    peer FC00::5 route-policy fz1 import
    peer FC00::6 route-policy fz2 import
<span class="hljs-comment">#</span>
tunnel-policy x1-z1
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
<span class="hljs-comment">#</span>
ip vpn-instance OA
  ipv4-family
  tnl-policy x1-z1 evpn

<span class="hljs-comment"># X_PE2</span>
segment-routing ipv6
  srv6-te-policy locator HCIE
  segment-list x2-z2-zhu
    index 10 sid ipv6 FC02:2::30
  segment-list x2-z2-bei
    index 10 sid ipv6 FC02:2::10
    index 20 sid ipv6 FC02:1::30
    index 30 sid ipv6 FC02:5::10
  srv6-te policy x2-z2 endpoint FC00::6 Color 102
    candidate-path preference 200
      segment-list x2-z2-zhu
    candidate-path preference 100
      segment-list x2-z2-bei
<span class="hljs-comment">#</span>
route-policy fz1 permit node 10
  apply cost 10
route-policy fz2 permit node 10
  apply extcommunity color 0:102
<span class="hljs-comment">#</span>
bgp 65000
   l2vpn-family evpn
    peer FC00::5 route-policy fz1 import
    peer FC00::6 route-policy fz2 import
<span class="hljs-comment">#</span>
tunnel-policy x2-z2
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
<span class="hljs-comment">#</span>
ip vpn-instance OA
  ipv4-family
  tnl-policy x2-z2 evpn

<span class="hljs-comment"># Y_PE1</span>
segment-routing ipv6
  srv6-te-policy locator HCIE
  segment-list y1-z1-zhu
    index 10 sid ipv6 FC02:3::30
  segment-list y1-z1-bei
    index 10 sid ipv6 FC02:3::10
    index 20 sid ipv6 FC02:4::30
    index 30 sid ipv6 FC02:6::10
  srv6-te policy y1-z1 endpoint FC00::5 Color 103
    candidate-path preference 200
      segment-list y1-z1-zhu
    candidate-path preference 100
      segment-list y1-z1-bei
<span class="hljs-comment">#</span>
route-policy fz1 permit node 10
  apply extcommunity color 0:103
route-policy fz2 permit node 10
  apply cost 10
<span class="hljs-comment">#</span>
bgp 65000
  l2vpn-family evpn
    peer FC00::5 route-policy fz1 import
    peer FC00::6 route-policy fz2 import
<span class="hljs-comment">#</span>
tunnel-policy y1-z1
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
<span class="hljs-comment">#</span>
ip vpn-instance OA
  ipv4-family
  tnl-policy y1-z1 evpn
ip vpn-instance R&amp;D
  ipv4-family
  tnl-policy y1-z1 evpn

<span class="hljs-comment"># Y_PE2</span>
segment-routing ipv6
  srv6-te-policy locator HCIE
  segment-list y2-z2-zhu
    index 10 sid ipv6 FC02:4::30
  segment-list y2-z2-bei
    index 10 sid ipv6 FC02:4::10
    index 20 sid ipv6 FC02:3::30
    index 30 sid ipv6 FC02:5::10
  srv6-te policy y2-z2 endpoint FC00::6 Color 104
    candidate-path preference 200
      segment-list y2-z2-zhu
    candidate-path preference 100
      segment-list y2-z2-bei
<span class="hljs-comment">#</span>
route-policy fz2 permit node 10
  apply extcommunity color 0:104
route-policy fz1 permit node 10
  apply cost 10
<span class="hljs-comment">#</span>
bgp 65000
  l2vpn-family evpn
    peer FC00::5 route-policy fz1 import
    peer FC00::6 route-policy fz2 import
<span class="hljs-comment">#</span>
tunnel-policy y2-z2
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
<span class="hljs-comment">#</span>
ip vpn-instance OA
  ipv4-family
  tnl-policy y2-z2 evpn
ip vpn-instance R&amp;D
  ipv4-family
  tnl-policy y2-z2 evpn

<span class="hljs-comment"># Z_PE1</span>
segment-routing ipv6
  srv6-te-policy locator HCIE
  segment-list z1-x1-zhu
    index 10 sid ipv6 FC02:5::20
  segment-list z1-x1-bei
    index 10 sid ipv6 FC02:5::10
    index 20 sid ipv6 FC02:6::20
    index 30 sid ipv6 FC02:2::10
  srv6-te policy z1-x1 endpoint FC00::1 Color 101
    candidate-path preference 200
      segment-list z1-x1-zhu
    candidate-path preference 100
      segment-list z1-x1-bei
  <span class="hljs-comment">#</span>
  segment-list z1-y1-zhu
    index 10 sid ipv6 FC02:5::30
  segment-list z1-y1-bei
    index 10 sid ipv6 FC02:5::10
    index 20 sid ipv6 FC02:6::30
    index 30 sid ipv6 FC02:4::10
  srv6-te policy z1-y1 endpoint FC00::3 Color 103
    candidate-path preference 200
      segment-list z1-y1-zhu
    candidate-path preference 100
      segment-list z1-y1-bei
      quit
  quit
<span class="hljs-comment">#</span>
route-policy fx1 permit node 10
  apply extcommunity color 0:101
route-policy fx2 permit node 10
  apply cost 10
route-policy fy1 permit node 10
  apply extcommunity color 0:103
route-policy fy2 permit node 10
  apply cost 10
<span class="hljs-comment">#</span>
bgp 65000
  l2vpn-family evpn
    peer FC00::1 route-policy fx1 import
    peer FC00::2 route-policy fx2 import
    peer FC00::3 route-policy fy1 import
    peer FC00::4 route-policy fy2 import
<span class="hljs-comment">#</span>
tunnel-policy z1-xy1
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
<span class="hljs-comment">#</span>
ip vpn-instance OA
  ipv4-family
  tnl-policy z1-xy1 evpn
ip vpn-instance R&amp;D
  ipv4-family
  tnl-policy z1-xy1 evpn

<span class="hljs-comment"># Z_PE2</span>
segment-routing ipv6
  srv6-te-policy locator HCIE
  segment-list z2-x2-zhu
    index 10 sid ipv6 FC02:6::20
  segment-list z2-x2-bei
    index 10 sid ipv6 FC02:6::10
    index 20 sid ipv6 FC02:5::20
    index 30 sid ipv6 FC02:1::10
  srv6-te policy z2-x2 endpoint FC00::2 Color 102
    candidate-path preference 200
      segment-list z2-x2-zhu
    candidate-path preference 100
      segment-list z2-x2-bei
  <span class="hljs-comment">#</span>
  segment-list z2-y2-zhu
    index 10 sid ipv6 FC02:6::30
  segment-list z2-y2-bei
    index 10 sid ipv6 FC02:6::10
    index 20 sid ipv6 FC02:5::30
    index 30 sid ipv6 FC02:3::10
  srv6-te policy z2-y2 endpoint FC00::4 Color 104
    candidate-path preference 200
      segment-list z2-y2-zhu
    candidate-path preference 100
      segment-list z2-y2-bei
    quit
  quit
<span class="hljs-comment">#</span>
route-policy fx1 permit node 10
  apply cost 10
route-policy fx2 permit node 10
  apply extcommunity color 0:102
route-policy fy1 permit node 10
  apply cost 10
route-policy fy2 permit node 10
  apply extcommunity color 0:104
<span class="hljs-comment">#</span>
bgp 65000
  l2vpn-family evpn
    peer FC00::1 route-policy fx1 import
    peer FC00::2 route-policy fx2 import
    peer FC00::3 route-policy fy1 import
    peer FC00::4 route-policy fy2 import
<span class="hljs-comment">#</span>
tunnel-policy z2-xy2
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
<span class="hljs-comment">#</span>
ip vpn-instance OA
  ipv4-family
  tnl-policy z2-xy2 evpn
ip vpn-instance R&amp;D
  ipv4-family
  tnl-policy z2-xy2 evpn

6、SRv6 SBFD部署
<span class="hljs-comment"># X/Y_PE1</span>
te ipv6-router-id FC00::X
bfd
sbfd
  reflector discriminator X.0.0.X 对应自己的 Router-ID
  destination ipv6 FC00::5 remote-discriminator 5.0.0.5
te ipv6-router-id FC00::X
segment-routing ipv6
  srv6-te-policy backup hot-standby <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd seamless <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd no-bypass
  srv6-te-policy bfd min-tx-interval 50
<span class="hljs-comment"># 考场配置如下：</span>
srv6-te-policy seamless-bfd <span class="hljs-built_in">enable</span>
srv6-te-policy seamless-bfd min-tx-interval 50

<span class="hljs-comment"># X/Y_PE2</span>
te ipv6-router-id FC00::X
bfd
sbfd
  reflector discriminator X.0.0.X 对应自己的 Router-ID
  destination ipv6 FC00::6 remote-discriminator 6.0.0.6
segment-routing ipv6
srv6-te-policy backup hot-standby <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd seamless <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd no-bypass
  srv6-te-policy bfd min-tx-interval 50
<span class="hljs-comment"># 考场配置如下：</span>
srv6-te-policy seamless-bfd <span class="hljs-built_in">enable</span>
srv6-te-policy seamless-bfd min-tx-interval 50

<span class="hljs-comment"># Z_PE1</span>
te ipv6-router-id FC00::5
bfd
sbfd
  reflector discriminator 5.0.0.5 对应自己的 Router-ID
  destination ipv6 FC00::1 remote-discriminator 1.0.0.1
  destination ipv6 FC00::3 remote-discriminator 3.0.0.3
segment-routing ipv6
  srv6-te-policy backup hot-standby <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd seamless <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd no-bypass
  srv6-te-policy bfd min-tx-interval 50
<span class="hljs-comment"># 考场配置如下：</span>
srv6-te-policy seamless-bfd <span class="hljs-built_in">enable</span>
srv6-te-policy seamless-bfd min-tx-interval 50

<span class="hljs-comment"># Z_PE2</span>
te ipv6-router-id FC00::6
bfd
sbfd
  reflector discriminator 6.0.0.6 对应自己的 Router-ID
  destination ipv6 FC00::2 remote-discriminator 2.0.0.2
  destination ipv6 FC00::4 remote-discriminator 4.0.0.4
segment-routing ipv6
  srv6-te-policy backup hot-standby <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd seamless <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd no-bypass
  srv6-te-policy bfd min-tx-interval 50
<span class="hljs-comment"># 考场配置如下：</span>
srv6-te-policy seamless-bfd <span class="hljs-built_in">enable</span>
srv6-te-policy seamless-bfd min-tx-interval 50

SRv6 配置案例
1. 通用
flow-wred drop
  co g lo 70 hi 90 di 50
  co y lo 60 hi 90 di 50
  co r lo 50 hi 90 di 100
  quit
flow-queue qos
  queue af4 wfq weight 10 flow-wred drop
  queue ef pd flow-wred drop
  quit
qos-profile QOS
  user-queue cir 1000000 pri 1000000 flow-queue qos
  quit
bfd
  quit

2. X_PE1
bfd
  sbfd
  reflector discriminator 1.0.0.1
  destination ipv6 fc00::5 remote-discriminator 5.0.0.5
  quit

te ipv6-router-id fc00::1

segment-routing ipv6
  sr-te frr <span class="hljs-built_in">enable</span>
  encapsulation source-address fc00::1
  
  locator HCIE ipv6-prefix fc02:1:: 96 static 16
    opcode ::1 end psp
    opcode ::10 end-x interface ethernet 3/0/0 nexthop fc01:10::A psp
    opcode ::20 end-x interface ethernet 3/0/1 nexthop fc01:10::2 psp
    opcode ::30 end-x interface ethernet 3/0/2 nexthop fc01:10::6 psp
    opcode ::100 end-op
    quit
  

  srv6-te-policy backup hot-standby <span class="hljs-built_in">enable</span>
  srv6-te-policy locator HCIE
  srv6-te-policy bfd seamless <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd no-bypass
  srv6-te-policy bfd min-tx-interval 50

  segment-list x1-z1-zhu
    index 10 sid ipv6 fc02:1::30
  segment-list x1-z1-bei
    index 10 sid ipv6 fc02:1::10
    index 20 sid ipv6 fc02:2::30
    index 30 sid ipv6 fc02:6::10
    quit
  
  srv6-te policy x1-z1 endpoint fc00::5 color 101
    candidate-path preference 200
      segment-list x1-z1-zhu
    candidate-path preference 100
      segment-list x1-z1-bei
      quit
    quit
  quit


route-policy fz1 permit node 10
  apply extcommunity color 0:101
route-policy fz2 permit node 10
  apply cost 10
route-policy oa_med permit node 10
  apply cost 10
  quit

tunnel-policy x1-z1
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
  quit

ip vpn-instance OA
  route-distinguisher 65001:1
  vpn-target 1:4 export-extcommunity evpn
  vpn-target 4:1 import-extcommunity evpn
  tnl-policy x1-z1 evpn
  quit

interface ethernet 3/0/7
  ip binding vpn-instance OA
  ip add 10.20.1.2 30
  quit

isis 1 
  is-level level-2
  cost-style wide
  network-entity 49.0001.0010.0000.0001.00
  domain-authentication-mode md5 cipher Huawei@123
  ipv6 <span class="hljs-built_in">enable</span> topology ipv6
  ipv6 bfd all-interfaces <span class="hljs-built_in">enable</span>
  ipv6 bfd all-interfaces min-tx-interval 300 min-rx-interval 300
  segment-routing ipv6 locator HCIE
  avoid-microloop frr-protected
  ipv6 avoid-microloop segment-routing
  ipv6 frr
    loop-free-alternate level-2
    quit
  quit

int lo0
  isis ipv6 <span class="hljs-built_in">enable</span> 1
int ethernet 3/0/1
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
int ethernet 3/0/2
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
int ethernet 3/0/0
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis cost 4
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
  quit

bgp 65000
  router-id 1.0.0.1
  peer fc00::5 as-number 65000
  peer fc00::5 password cipher Huawei@123
  peer fc00::5 connect-interface loopback 0
  peer fc00::6 as-number 65000
  peer fc00::6 password cipher Huawei@123
  peer fc00::6 connect-interface loopback 0
  l2vpn-family evpn
    peer fc00::5 <span class="hljs-built_in">enable</span>
    y
    peer fc00::5 route-policy fz1 import
    peer fc00::5 advertise encap-type srv6
    peer fc00::6 <span class="hljs-built_in">enable</span>
    y
    peer fc00::6 route-policy fz2 import
    peer fc00::6 advertise encap-type srv6
  ipv4-family vpn-instance OA
    advertise l2vpn evpn
    segment-routing ipv6 locator HCIE
    segment-routing ipv6 traffic-engineer best-effort evpn
    peer 10.20.1.1 as-number 65001
    peer 10.20.1.1 route-policy oa_med <span class="hljs-built_in">export</span>
    quit
  quit

3. X_PE2
bfd
  sbfd
  reflector discriminator 2.0.0.2
  destination ipv6 fc00::6 remote-discriminator 6.0.0.6
  quit

te ipv6-router-id fc00::2

segment-routing ipv6
  sr-te frr <span class="hljs-built_in">enable</span>
  encapsulation source-address fc00::2
  
  locator HCIE ipv6-prefix fc02:2:: 96 static 16
    opcode ::1 end psp
    opcode ::10 end-x interface ethernet 3/0/0 nexthop fc01:10::9 psp
    opcode ::20 end-x interface ethernet 3/0/1 nexthop fc01:10::E psp
    opcode ::30 end-x interface ethernet 3/0/2 nexthop fc01:10::12 psp
    opcode ::100 end-op
    quit
  

  srv6-te-policy backup hot-standby <span class="hljs-built_in">enable</span>
  srv6-te-policy locator HCIE
  srv6-te-policy bfd seamless <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd no-bypass
  srv6-te-policy bfd min-tx-interval 50

  segment-list x2-z2-zhu
    index 10 sid ipv6 fc02:2::30
  segment-list x2-z2-bei
    index 10 sid ipv6 fc02:2::10
    index 20 sid ipv6 fc02:1::30
    index 30 sid ipv6 fc02:5::10
    quit
  
  srv6-te policy x2-z2 endpoint fc00::6 color 102
    candidate-path preference 200
      segment-list x2-z2-zhu
    candidate-path preference 100
      segment-list x2-z2-bei
      quit
    quit
  quit


route-policy fz1 permit node 10
  apply cost 10
route-policy fz2 permit node 10
  apply extcommunity color 0:102
route-policy oa_med permit node 10
  apply cost 12
  quit

tunnel-policy x2-z2
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
  quit

ip vpn-instance OA
  route-distinguisher 65001:2
  vpn-target 1:4 export-extcommunity evpn
  vpn-target 4:1 import-extcommunity evpn
  tnl-policy x2-z2 evpn
  quit

interface ethernet 3/0/7
  ip binding vpn-instance OA
  ip add 10.20.1.10 30
  quit

isis 1 
  is-level level-2
  cost-style wide
  network-entity 49.0001.0020.0000.0002.00
  domain-authentication-mode md5 cipher Huawei@123
  ipv6 <span class="hljs-built_in">enable</span> topology ipv6
  ipv6 bfd all-interfaces <span class="hljs-built_in">enable</span>
  ipv6 bfd all-interfaces min-tx-interval 300 min-rx-interval 300
  segment-routing ipv6 locator HCIE
  avoid-microloop frr-protected
  ipv6 avoid-microloop segment-routing
  ipv6 frr
    loop-free-alternate level-2
    quit
  quit

int lo0
  isis ipv6 <span class="hljs-built_in">enable</span> 1
int ethernet 3/0/1
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
int ethernet 3/0/2
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
int ethernet 3/0/0
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis cost 4
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
  quit

bgp 65000
  router-id 2.0.0.2
  peer fc00::5 as-number 65000
  peer fc00::5 password cipher Huawei@123
  peer fc00::5 connect-interface loopback 0
  peer fc00::6 as-number 65000
  peer fc00::6 password cipher Huawei@123
  peer fc00::6 connect-interface loopback 0
  l2vpn-family evpn
    peer fc00::5 <span class="hljs-built_in">enable</span>
    y
    peer fc00::5 route-policy fz1 import
    peer fc00::5 advertise encap-type srv6
    peer fc00::6 <span class="hljs-built_in">enable</span>
    y
    peer fc00::6 route-policy fz2 import
    peer fc00::6 advertise encap-type srv6
  ipv4-family vpn-instance OA
    advertise l2vpn evpn
    segment-routing ipv6 locator HCIE
    segment-routing ipv6 traffic-engineer best-effort evpn
    peer 10.20.1.9 as-number 65001
    peer 10.20.1.9 route-policy oa_med <span class="hljs-built_in">export</span>
    quit
  quit

4. Y_PE1
bfd
  sbfd
  reflector discriminator 3.0.0.3
  destination ipv6 fc00::5 remote-discriminator 5.0.0.5
  quit

te ipv6-router-id fc00::3

segment-routing ipv6
  sr-te frr <span class="hljs-built_in">enable</span>
  encapsulation source-address fc00::3
  
  locator HCIE ipv6-prefix fc02:3:: 96 static 16
    opcode ::1 end psp
    opcode ::10 end-x interface ethernet 3/0/0 nexthop fc01:10::1A psp
    opcode ::20 end-x interface ethernet 3/0/1 nexthop fc01:10::1 psp
    opcode ::30 end-x interface ethernet 3/0/2 nexthop fc01:10::16 psp
    opcode ::100 end-op
    quit
  

  srv6-te-policy backup hot-standby <span class="hljs-built_in">enable</span>
  srv6-te-policy locator HCIE
  srv6-te-policy bfd seamless <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd no-bypass
  srv6-te-policy bfd min-tx-interval 50

  segment-list y1-z1-zhu
    index 10 sid ipv6 fc02:3::30
  segment-list y1-z1-bei
    index 10 sid ipv6 fc02:3::10
    index 20 sid ipv6 fc02:4::30
    index 30 sid ipv6 fc02:6::10
    quit
  
  srv6-te policy y1-z1 endpoint fc00::5 color 103
    candidate-path preference 200
      segment-list y1-z1-zhu
    candidate-path preference 100
      segment-list y1-z1-bei
      quit
    quit
  quit


route-policy fz1 permit node 10
  apply extcommunity color 0:103
route-policy fz2 permit node 10
  apply cost 10
route-policy oa_med permit node 10
  apply cost 10
route-policy rd_med permit node 10
  apply cost 12
  quit

tunnel-policy y1-z1
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
  quit

ip vpn-instance OA
  route-distinguisher 65003:1
  vpn-target 3:4 export-extcommunity evpn
  vpn-target 4:3 import-extcommunity evpn
  tnl-policy y1-z1 evpn
ip vpn-instance R&amp;D
  route-distinguisher 65003:3
  vpn-target 33:44 export-extcommunity evpn
  vpn-target 44:33 import-extcommunity evpn
  tnl-policy y1-z1 evpn
  quit

interface ethernet 3/0/7.10
  vlan-t <span class="hljs-keyword">do</span> 10
  ip binding vpn-instance OA
  ip add 10.20.2.2 30
interface ethernet 3/0/7.20
  vlan-t <span class="hljs-keyword">do</span> 20
  ip binding vpn-instance R&amp;D
  ip add 10.20.2.6 30
  quit

isis 1 
  is-level level-2
  cost-style wide
  network-entity 49.0001.0030.0000.0003.00
  domain-authentication-mode md5 cipher Huawei@123
  ipv6 <span class="hljs-built_in">enable</span> topology ipv6
  ipv6 bfd all-interfaces <span class="hljs-built_in">enable</span>
  ipv6 bfd all-interfaces min-tx-interval 300 min-rx-interval 300
  segment-routing ipv6 locator HCIE
  avoid-microloop frr-protected
  ipv6 avoid-microloop segment-routing
  ipv6 frr
    loop-free-alternate level-2
    quit
  quit

int lo0
  isis ipv6 <span class="hljs-built_in">enable</span> 1
int ethernet 3/0/1
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
int ethernet 3/0/2
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
int ethernet 3/0/0
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis cost 4
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
  quit

bgp 65000
  router-id 3.0.0.3
  peer fc00::5 as-number 65000
  peer fc00::5 password cipher Huawei@123
  peer fc00::5 connect-interface loopback 0
  peer fc00::6 as-number 65000
  peer fc00::6 password cipher Huawei@123
  peer fc00::6 connect-interface loopback 0
  l2vpn-family evpn
    peer fc00::5 <span class="hljs-built_in">enable</span>
    y
    peer fc00::5 route-policy fz1 import
    peer fc00::5 advertise encap-type srv6
    peer fc00::6 <span class="hljs-built_in">enable</span>
    y
    peer fc00::6 route-policy fz2 import
    peer fc00::6 advertise encap-type srv6
  ipv4-family vpn-instance OA
    advertise l2vpn evpn
    segment-routing ipv6 locator HCIE
    segment-routing ipv6 traffic-engineer best-effort evpn
    peer 10.20.2.1 as-number 65003
    peer 10.20.2.1 route-policy oa_med <span class="hljs-built_in">export</span>
  ipv4-family vpn-instance R&amp;D
    advertise l2vpn evpn
    segment-routing ipv6 locator HCIE
    segment-routing ipv6 traffic-engineer best-effort evpn
    peer 10.20.2.5 as-number 65003
    peer 10.20.2.5 route-policy rd_med <span class="hljs-built_in">export</span>
    quit
  quit

5. Y_PE2
bfd
  sbfd
  reflector discriminator 4.0.0.4
  destination ipv6 fc00::6 remote-discriminator 6.0.0.6
  quit

te ipv6-router-id fc00::4

segment-routing ipv6
  sr-te frr <span class="hljs-built_in">enable</span>
  encapsulation source-address fc00::4
  
  locator HCIE ipv6-prefix fc02:4:: 96 static 16
    opcode ::1 end psp
    opcode ::10 end-x interface ethernet 3/0/0 nexthop fc01:10::19 psp
    opcode ::20 end-x interface ethernet 3/0/1 nexthop fc01:10::D psp
    opcode ::30 end-x interface ethernet 3/0/2 nexthop fc01:10::1E psp
    opcode ::100 end-op
    quit
  

  srv6-te-policy backup hot-standby <span class="hljs-built_in">enable</span>
  srv6-te-policy locator HCIE
  srv6-te-policy bfd seamless <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd no-bypass
  srv6-te-policy bfd min-tx-interval 50

  segment-list y2-z2-zhu
    index 10 sid ipv6 fc02:4::30
  segment-list y2-z2-bei
    index 10 sid ipv6 fc02:4::10
    index 20 sid ipv6 fc02:3::30
    index 30 sid ipv6 fc02:6::10
    quit
  
  srv6-te policy y2-z2 endpoint fc00::6 color 104
    candidate-path preference 200
      segment-list y2-z2-zhu
    candidate-path preference 100
      segment-list y2-z2-bei
      quit
    quit
  quit


route-policy fz1 permit node 10
  apply cost 10
route-policy fz2 permit node 10
  apply extcommunity color 0:104
route-policy oa_med permit node 10
  apply cost 12
route-policy rd_med permit node 10
  apply cost 10
  quit

tunnel-policy y2-z2
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
  quit

ip vpn-instance OA
  route-distinguisher 65003:2
  vpn-target 3:4 export-extcommunity evpn
  vpn-target 4:3 import-extcommunity evpn
  tnl-policy y2-z2 evpn
ip vpn-instance R&amp;D
  route-distinguisher 65003:4
  vpn-target 33:44 export-extcommunity evpn
  vpn-target 44:33 import-extcommunity evpn
  tnl-policy y2-z2 evpn
  quit

interface ethernet 3/0/7.10
  vlan <span class="hljs-keyword">do</span> 10
  ip binding vpn-instance OA
  ip add 10.20.2.10 30
interface ethernet 3/0/7.20
  vlan <span class="hljs-keyword">do</span> 20
  ip binding vpn-instance R&amp;D
  ip add 10.20.2.14 30
  quit

isis 1 
  is-level level-2
  cost-style wide
  network-entity 49.0001.0040.0000.0004.00
  domain-authentication-mode md5 cipher Huawei@123
  ipv6 <span class="hljs-built_in">enable</span> topology ipv6
  ipv6 bfd all-interfaces <span class="hljs-built_in">enable</span>
  ipv6 bfd all-interfaces min-tx-interval 300 min-rx-interval 300
  segment-routing ipv6 locator HCIE
  avoid-microloop frr-protected
  ipv6 avoid-microloop segment-routing
  ipv6 frr
    loop-free-alternate level-2
    quit
  quit

int lo0
  isis ipv6 <span class="hljs-built_in">enable</span> 1
int ethernet 3/0/1
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
int ethernet 3/0/2
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
int ethernet 3/0/0
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis cost 4
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
  quit

bgp 65000
  router-id 4.0.0.4
  peer fc00::5 as-number 65000
  peer fc00::5 password cipher Huawei@123
  peer fc00::5 connect-interface loopback 0
  peer fc00::6 as-number 65000
  peer fc00::6 password cipher Huawei@123
  peer fc00::6 connect-interface loopback 0
  l2vpn-family evpn
    peer fc00::5 <span class="hljs-built_in">enable</span>
    y
    peer fc00::5 route-policy fz1 import
    peer fc00::5 advertise encap-type srv6
    peer fc00::6 <span class="hljs-built_in">enable</span>
    y
    peer fc00::6 route-policy fz2 import
    peer fc00::6 advertise encap-type srv6
  ipv4-family vpn-instance OA
    advertise l2vpn evpn
    segment-routing ipv6 locator HCIE
    segment-routing ipv6 traffic-engineer best-effort evpn
    peer 10.20.2.9 as-number 65003
    peer 10.20.2.9 route-policy oa_med <span class="hljs-built_in">export</span>
  ipv4-family vpn-instance R&amp;D
    advertise l2vpn evpn
    segment-routing ipv6 locator HCIE
    segment-routing ipv6 traffic-engineer best-effort evpn
    peer 10.20.2.13 as-number 65003
    peer 10.20.2.13 route-policy rd_med <span class="hljs-built_in">export</span>
    quit
  quit
  

6. Z_PE1
bfd
  sbfd
  reflector discriminator 5.0.0.5
  destination ipv6 fc00::1 remote-discriminator 1.0.0.1
  destination ipv6 fc00::3 remote-discriminator 3.0.0.3
  quit

te ipv6-router-id fc00::5

segment-routing ipv6
  sr-te frr <span class="hljs-built_in">enable</span>
  encapsulation source-address fc00::5
  
  locator HCIE ipv6-prefix fc02:5:: 96 static 16
    opcode ::1 end psp
    opcode ::10 end-x interface ethernet 3/0/0 nexthop fc01:10::22 psp
    opcode ::20 end-x interface ethernet 3/0/1 nexthop fc01:10::5 psp
    opcode ::30 end-x interface ethernet 3/0/2 nexthop fc01:10::15 psp
    opcode ::100 end-op
    quit
  

  srv6-te-policy backup hot-standby <span class="hljs-built_in">enable</span>
  srv6-te-policy locator HCIE
  srv6-te-policy bfd seamless <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd no-bypass
  srv6-te-policy bfd min-tx-interval 50

  segment-list z1-x1-zhu
    index 10 sid ipv6 fc02:5::20
  segment-list z1-x1-bei
    index 10 sid ipv6 fc02:5::10
    index 20 sid ipv6 fc02:6::20
    index 30 sid ipv6 fc02:2::10
    quit
  
  srv6-te policy z1-x1 endpoint fc00::1 color 101
    candidate-path preference 200
      segment-list z1-x1-zhu
    candidate-path preference 100
      segment-list z1-x1-bei
      quit
    quit
    
  segment-list z1-y1-zhu
    index 10 sid ipv6 fc02:5::30
  segment-list z1-y1-bei
    index 10 sid ipv6 fc02:5::10
    index 20 sid ipv6 fc02:6::20
    index 30 sid ipv6 fc02:4::10
    quit
  
  srv6-te policy z1-y1 endpoint fc00::3 color 103
    candidate-path preference 200
      segment-list z1-y1-zhu
    candidate-path preference 100
      segment-list z1-y1-bei
      quit
    quit
  quit


route-policy fx1 permit node 10
  apply extcommunity color 0:101
route-policy fx2 permit node 10
  apply cost 10
route-policy fy1 permit node 10
  apply extcommunity color 0:103
route-policy fy2 permit node 10
  apply cost 10
route-policy oa_med permit node 10
  apply cost 10
route-policy rd_med permit node 10
  apply cost 12
  quit

tunnel-policy z1-xy1
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
  quit

ip vpn-instance OA
  route-distinguisher 65004:1
  vpn-target 4:1 export-extcommunity evpn
  vpn-target 1:4 import-extcommunity evpn
  vpn-target 4:3 export-extcommunity evpn
  vpn-target 3:4 import-extcommunity evpn
  tnl-policy z1-xy1 evpn
ip vpn-instance R&amp;D
  route-distinguisher 65004:3
  vpn-target 44:33 export-extcommunity evpn
  vpn-target 33:44 import-extcommunity evpn
  tnl-policy z1-xy1 evpn
  quit

interface ethernet 3/0/7.10
  vlan <span class="hljs-keyword">do</span> 10
  ip binding vpn-instance OA
  ip add 10.20.3.2 30
interface ethernet 3/0/7.20
  vlan <span class="hljs-keyword">do</span> 20
  ip binding vpn-instance R&amp;D
  ip add 10.20.3.6 30
  quit

isis 1 
  is-level level-2
  cost-style wide
  network-entity 49.0001.0050.0000.0005.00
  domain-authentication-mode md5 cipher Huawei@123
  ipv6 <span class="hljs-built_in">enable</span> topology ipv6
  ipv6 bfd all-interfaces <span class="hljs-built_in">enable</span>
  ipv6 bfd all-interfaces min-tx-interval 300 min-rx-interval 300
  segment-routing ipv6 locator HCIE
  avoid-microloop frr-protected
  ipv6 avoid-microloop segment-routing
  ipv6 frr
    loop-free-alternate level-2
    quit
  quit

int lo0
  isis ipv6 <span class="hljs-built_in">enable</span> 1
int ethernet 3/0/1
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
int ethernet 3/0/2
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
int ethernet 3/0/0
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis cost 4
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
  quit

bgp 65000
  router-id 5.0.0.5
  peer fc00::1 as-number 65000
  peer fc00::1 password cipher Huawei@123
  peer fc00::1 connect-interface loopback 0
  peer fc00::2 as-number 65000
  peer fc00::2 password cipher Huawei@123
  peer fc00::2 connect-interface loopback 0
  peer fc00::3 as-number 65000
  peer fc00::3 password cipher Huawei@123
  peer fc00::3 connect-interface loopback 0
  peer fc00::4 as-number 65000
  peer fc00::4 password cipher Huawei@123
  peer fc00::4 connect-interface loopback 0
  l2vpn-family evpn
    peer fc00::1 <span class="hljs-built_in">enable</span>
    y
    peer fc00::1 route-policy fx1 import
    peer fc00::1 advertise encap-type srv6
    peer fc00::2 <span class="hljs-built_in">enable</span>
    y
    peer fc00::2 route-policy fx2 import
    peer fc00::2 advertise encap-type srv6
    peer fc00::3 <span class="hljs-built_in">enable</span>
    y
    peer fc00::3 route-policy fy1 import
    peer fc00::3 advertise encap-type srv6
    peer fc00::4 <span class="hljs-built_in">enable</span>
    y
    peer fc00::4 route-policy fy2 import
    peer fc00::4 advertise encap-type srv6
  ipv4-family vpn-instance OA
    advertise l2vpn evpn
    segment-routing ipv6 locator HCIE
    segment-routing ipv6 traffic-engineer best-effort evpn
    peer 10.20.3.1 as-number 65004
    peer 10.20.3.1 route-policy oa_med <span class="hljs-built_in">export</span>
  ipv4-family vpn-instance R&amp;D
    advertise l2vpn evpn
    segment-routing ipv6 locator HCIE
    segment-routing ipv6 traffic-engineer best-effort evpn
    peer 10.20.3.5 as-number 65004
    peer 10.20.3.5 route-policy rd_med <span class="hljs-built_in">export</span>
    quit
  quit

7. Z_PE2
bfd
  sbfd
  reflector discriminator 6.0.0.6
  destination ipv6 fc00::2 remote-discriminator 2.0.0.2
  destination ipv6 fc00::4 remote-discriminator 4.0.0.4
  quit

te ipv6-router-id fc00::6

segment-routing ipv6
  sr-te frr <span class="hljs-built_in">enable</span>
  encapsulation source-address fc00
  locator HCIE ipv6-prefix fc02:6:: 96 static 16
    opcode ::1 end psp
    opcode ::10 end-x interface ethernet 3/0/0 nexthop fc01:10::21 psp
    opcode ::20 end-x interface ethernet 3/0/1 nexthop fc01:10::11 psp
    opcode ::30 end-x interface ethernet 3/0/2 nexthop fc01:10::1D psp
    opcode ::100 end-op
    quit
  

  srv6-te-policy backup hot-standby <span class="hljs-built_in">enable</span>
  srv6-te-policy locator HCIE
  srv6-te-policy bfd seamless <span class="hljs-built_in">enable</span>
  srv6-te-policy bfd no-bypass
  srv6-te-policy bfd min-tx-interval 50

  segment-list z2-x2-zhu
    index 10 sid ipv6 fc02:6::20
  segment-list z2-x2-bei
    index 10 sid ipv6 fc02:6::10
    index 20 sid ipv6 fc02:5::20
    index 30 sid ipv6 fc02:1::10
    quit
  
  srv6-te policy z2-x2 endpoint fc00::2 color 102
    candidate-path preference 200
      segment-list z2-x2-zhu
    candidate-path preference 100
      segment-list z2-x2-bei
      quit
    quit
    
  segment-list z2-y2-zhu
    index 10 sid ipv6 fc02:6::30
  segment-list z2-y2-bei
    index 10 sid ipv6 fc02:6::10
    index 20 sid ipv6 fc02:5::20
    index 30 sid ipv6 fc02:3::10
    quit
  
  srv6-te policy z2-y2 endpoint fc00::4 color 104
    candidate-path preference 200
      segment-list z2-y2-zhu
    candidate-path preference 100
      segment-list z2-y2-bei
      quit
    quit
  quit


route-policy fx1 permit node 10
  apply cost 10
route-policy fx2 permit node 10
  apply extcommunity color 0:102
route-policy fy1 permit node 10
  apply cost 10
route-policy fy2 permit node 10
  apply extcommunity color 0:104
route-policy oa_med permit node 10
  apply cost 10
route-policy rd_med permit node 10
  apply cost 12
  quit

tunnel-policy z2-xy2
  tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
  quit

ip vpn-instance OA
  route-distinguisher 65004:2
  vpn-target 4:1 export-extcommunity evpn
  vpn-target 1:4 import-extcommunity evpn
  vpn-target 4:3 export-extcommunity evpn
  vpn-target 3:4 import-extcommunity evpn
  tnl-policy z2-xy2 evpn
ip vpn-instance R&amp;D
  route-distinguisher 65004:4
  vpn-target 44:33 export-extcommunity evpn
  vpn-target 33:44 import-extcommunity evpn
  tnl-policy z2-xy2 evpn
  quit

interface ethernet 3/0/7.10
  vlan <span class="hljs-keyword">do</span> 10
  ip binding vpn-instance OA
  ip add 10.20.3.10 30
interface ethernet 3/0/7.20
  vlan <span class="hljs-keyword">do</span> 20
  ip binding vpn-instance R&amp;D
  ip add 10.20.3.14 30
  quit

isis 1 
  is-level level-2
  cost-style wide
  network-entity 49.0001.0060.0000.0006.00
  domain-authentication-mode md5 cipher Huawei@123
  ipv6 <span class="hljs-built_in">enable</span> topology ipv6
  ipv6 bfd all-interfaces <span class="hljs-built_in">enable</span>
  ipv6 bfd all-interfaces min-tx-interval 300 min-rx-interval 300
  segment-routing ipv6 locator HCIE
  avoid-microloop frr-protected
  ipv6 avoid-microloop segment-routing
  ipv6 frr
    loop-free-alternate level-2
    quit
  quit

int lo0
  isis ipv6 <span class="hljs-built_in">enable</span> 1
int ethernet 3/0/1
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
int ethernet 3/0/2
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
int ethernet 3/0/0
  isis ipv6 <span class="hljs-built_in">enable</span> 1
  isis cost 4
  isis circuit-type p2p
  isis ppp-negotiation 2-way
  isis authentication-mode md5 plain Huawei@123
  quit

bgp 65000
  router-id 6.0.0.6
  peer fc00::1 as-number 65000
  peer fc00::1 password cipher Huawei@123
  peer fc00::1 connect-interface loopback 0
  peer fc00::2 as-number 65000
  peer fc00::2 password cipher Huawei@123
  peer fc00::2 connect-interface loopback 0
  peer fc00::3 as-number 65000
  peer fc00::3 password cipher Huawei@123
  peer fc00::3 connect-interface loopback 0
  peer fc00::4 as-number 65000
  peer fc00::4 password cipher Huawei@123
  peer fc00::4 connect-interface loopback 0
  l2vpn-family evpn
    peer fc00::1 <span class="hljs-built_in">enable</span>
    y
    peer fc00::1 route-policy fx1 import
    peer fc00::1 advertise encap-type srv6
    peer fc00::2 <span class="hljs-built_in">enable</span>
    y
    peer fc00::2 route-policy fx2 import
    peer fc00::2 advertise encap-type srv6
    peer fc00::3 <span class="hljs-built_in">enable</span>
    y
    peer fc00::3 route-policy fy1 import
    peer fc00::3 advertise encap-type srv6
    peer fc00::4 <span class="hljs-built_in">enable</span>
    y
    peer fc00::4 route-policy fy2 import
    peer fc00::4 advertise encap-type srv6
  ipv4-family vpn-instance OA
    advertise l2vpn evpn
    segment-routing ipv6 locator HCIE
    segment-routing ipv6 traffic-engineer best-effort evpn
    peer 10.20.3.9 as-number 65004
    peer 10.20.3.9 route-policy oa_med <span class="hljs-built_in">export</span>
  ipv4-family vpn-instance R&amp;D
    advertise l2vpn evpn
    segment-routing ipv6 locator HCIE
    segment-routing ipv6 traffic-engineer best-effort evpn
    peer 10.20.3.13 as-number 65004
    peer 10.20.3.13 route-policy rd_med <span class="hljs-built_in">export</span>
    quit
  quit

8. Z_Export

ip vpn-instance OA
  route-distinguisher 65004:1
ip vpn-instance R&amp;D
  route-distinguisher 65004:2
  quit
  
int g 0/0/7
  undo portswitch
int g 0/0/6
  undo portswitch
  quit
  
int lo0
  ip binding vpn-instance OA
  ip add 10.3.101.254 24
int lo1
  ip binding vpn-instance R&amp;D
  ip add 10.3.99.254 24
int lo2
  ip binding vpn-instance R&amp;D
  ip add 10.3.100.254 24

interface G 0/0/7.10
  dot1q termination vid 10
  ip binding vpn-instance OA
  ip add 10.20.3.1 30
interface G 0/0/7.20
  dot1q termination vid 20
  ip binding vpn-instance R&amp;D
  ip add 10.20.3.5 30
interface G 0/0/6.10
  dot1q termination vid 10
  ip binding vpn-instance OA
  ip add 10.20.3.9 30
interface G 0/0/6.20
  dot1q termination vid 20
  ip binding vpn-instance R&amp;D
  ip add 10.20.3.13 30
  quit
  
bgp 65004
  router-id 10.3.99.254
  ipv4-family vpn-instance OA
    network 10.3.101.0 24
    peer 10.20.3.2 as-number 65000
    peer 10.20.3.10 as-number 65000
  ipv4-family vpn-instance R&amp;D
    network 10.3.99.0 24
    network 10.3.100.0 24
    peer 10.20.3.6 as-number 65000
    peer 10.20.3.14 as-number 65000
    quit
  quit

9. 其他
<span class="hljs-comment"># auto-frr</span>
bgp 65000
  ipv4-family vpn-instance OA
    <span class="hljs-comment"># X/Y_PE1</span>
    auto-frr
    <span class="hljs-comment"># other PE</span>
    undo auto-frr

<span class="hljs-comment"># 检查</span>
dis isis peer

Python网络自动化
1、前5个需求
1. 5min读取一下 X_T1_AGG1上的关键信息： 电源，风扇，LACP状态，CUP和内存使用率，OSPF邻居状态；
2. PC1-X_T1_AGG1之间采用安全的通道进行连接；
3. 读取风扇信息，如果两个风扇为Nor（坏掉的意思），则输出“All fans are faultly”；
4. 所有监控命令不能固定在代码里面，需要防止文件里面，通过调用文件的方式进行；
5. 每24小时自动保存设备的配置文件并备份到本地，并通过安全的传输协议存在本地设备，以【当天日期_设备名字.后续】的名称命名设备端以及本地的配置文件。举例：2022_2_14_X_T2_AGG1.zip 2022_2_14_X_T2_AGG1.bak

X_T1_AGG1
user-interface vty 0 4
  authentication-mode aaa
  protocol inbound ssh
  user privilege level 15
  quit
aaa
  local-user python password irreversible-cipher Huawei@123
  local-user python service-type ssh  
  local-user python privilege level 15
  local-user netconf password irreversible-cipher Huawei@123
  local-user netconf service-type api
  local-user netconf privilege level 15
  local-aaa-user password policy administrator
    undo password alert original
    quit
  quit


stelnet server <span class="hljs-built_in">enable</span>
ssh server-source all-interface
ssh user python
ssh user python authentication-type password
ssh user python service-type stelnet

sftp server <span class="hljs-built_in">enable</span>
ssh user python service-type all
ssh user python sftp-directory flash:/


netconf
  <span class="hljs-built_in">source</span> ip interface loopback 0 port 830
  quit



2、创建“command.txt”文件，完成1和4需求
display power
display fan
display lacp brief
display cpu <span class="hljs-built_in">history</span> 1hour
display memory-usage
display ospf peer brief

3、相关需求的Python程序
pip install ncclient
pip install paramiko

<span class="hljs-comment"># S300交换机 配置日志主机信息</span>
<span class="hljs-comment"># S300交换机 配置设备时间</span>

from paramiko import SSHClient,AutoAddPolicy
from ncclient import manager
from ncclient.xml_ import to_ele
from <span class="hljs-keyword">time</span> import <span class="hljs-built_in">sleep</span>
from datetime import datetime,timedelta


class Datacom:

    def __init__(self,server,username,password):

        self.server=server
        self.username=username
        self.password=password
        self.client=self._get_client()
        self.cli=self.client.invoke_shell()
        self.cli.send(<span class="hljs-string">&#x27;screen-length 0 temporary\n&#x27;</span>)
        <span class="hljs-built_in">sleep</span>(6)
        self.cli.recv(9999)

    <span class="hljs-comment"># 创建一个SSH连接客户端</span>
    def _get_client(self):
        client=SSHClient() <span class="hljs-comment"># SSH客户端工具进行实例化</span>
        client.load_system_host_keys() <span class="hljs-comment"># 加载SSH的主机公钥</span>
        client.set_missing_host_key_policy(AutoAddPolicy) <span class="hljs-comment"># 当本地设备没有公钥时自动保存交换机的SSH公钥</span>
        client.connect(self.server,username=self.username,password=self.password) <span class="hljs-comment"># 使用地址，账号和密码进行SSH连接</span>
        <span class="hljs-built_in">return</span> client

    <span class="hljs-comment"># 发送命令的方法</span>
    def <span class="hljs-built_in">command</span>(self,cmd):
        self.cli.send(<span class="hljs-string">&#x27;&#123;&#125;\n&#x27;</span>.format(cmd))
        <span class="hljs-built_in">sleep</span>(6)
        <span class="hljs-built_in">return</span> self.cli.recv(9999).decode() <span class="hljs-comment"># 回到cli函数读取回显结果9999字符，并使用decode进行解码</span>

    <span class="hljs-comment"># 检测风扇是否正常</span>
    def fan_info(self):
        fan_info=self.command(<span class="hljs-string">&#x27;display fan&#x27;</span>) 
        <span class="hljs-built_in">return</span> fan_info.find(<span class="hljs-string">&#x27;Normal&#x27;</span>)==-1

    <span class="hljs-comment"># sftp下载配置文件</span>
    def download(self,target,path=<span class="hljs-string">&#x27;/vrpcfg.zip&#x27;</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;download staring...&#x27;</span>)
        client=self._get_client()
        sftp=client.open_sftp()
        sftp.get(path,target)
        self.client.close()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;download finish.&#x27;</span>)

    <span class="hljs-comment"># 关闭连接</span>
    def close(self):
        self.client.close()

<span class="hljs-comment"># 定义使用ncclient并使用netconf方式进行设备配置，并在配置成功后输出成功提示</span>
def Netconf_by_rpc(ip,username,password,rpc_netconf):
    with manager.connect_ssh(host=ip,
                             username=username,
                             password=password,
                             hostkey_verify=False,
                             device_params=&#123;<span class="hljs-string">&#x27;name&#x27;</span>:<span class="hljs-string">&quot;huaweiyang&quot;</span>&#125;)  as  m:
        <span class="hljs-built_in">command</span>=to_ele(rpc_netconf)
        rpc=m.__getattr__(<span class="hljs-string">&quot;rpc&quot;</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;get manager inner function rpc &#123;&#125;&#x27;</span>.format(rpc))
        rpc(<span class="hljs-built_in">command</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;netconf setting success!&#x27;</span>)

<span class="hljs-comment"># 定义使用netconf的方法进行设置设备日志主机的函数，并输出正在配置日志主机提示</span>
def Netconf_syslog_host(ip,username,password,syslog):
    rpc_netconf=<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;&lt;edit-config&gt;</span>
<span class="hljs-string">    &lt;target&gt;</span>
<span class="hljs-string">      &lt;running/&gt;</span>
<span class="hljs-string">    &lt;/target&gt;</span>
<span class="hljs-string">    &lt;config&gt;</span>
<span class="hljs-string">      &lt;syslog:syslog xmlns:syslog=&quot;urn:ietf:params:xml:ns:yang:ietf-syslog&quot;&gt;</span>
<span class="hljs-string">        &lt;syslog:log-actions&gt;</span>
<span class="hljs-string">          &lt;syslog:remote&gt;</span>
<span class="hljs-string">            &lt;syslog:destination&gt;</span>
<span class="hljs-string">              &lt;syslog:name&gt;syslog-host&lt;/syslog:name&gt;</span>
<span class="hljs-string">              &lt;syslog:udp&gt;</span>
<span class="hljs-string">                &lt;syslog:address&gt;&#123;&#125;&lt;/syslog:address&gt;</span>
<span class="hljs-string">                &lt;syslog:port&gt;43&lt;/syslog:port&gt;</span>
<span class="hljs-string">              &lt;/syslog:udp&gt;</span>
<span class="hljs-string">              &lt;syslog:destination-facility xmlns:ietf-syslog-types=&quot;urn:ietf:params:xml:ns:yang:ietf-syslog-types&quot;&gt;ietf-syslog-types:local0&lt;/syslog:destination-facility&gt;</span>
<span class="hljs-string">            &lt;/syslog:destination&gt;</span>
<span class="hljs-string">          &lt;/syslog:remote&gt;</span>
<span class="hljs-string">        &lt;/syslog:log-actions&gt;</span>
<span class="hljs-string">      &lt;/syslog:syslog&gt;</span>
<span class="hljs-string">    &lt;/config&gt;</span>
<span class="hljs-string">  &lt;/edit-config&gt;</span>
<span class="hljs-string">  &#x27;</span><span class="hljs-string">&#x27;&#x27;</span>.format(syslog)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Using netconf configure syslog...&#x27;</span>)
    Netconf_by_rpc(ip,username,password,rpc_netconf)


<span class="hljs-comment"># 定义组装函数</span>
def datacom_loop(ip,username,password,name):
    try:
        <span class="hljs-keyword">while</span> True:
            datacom=Datacom(ip,username,password)
            with open(<span class="hljs-string">&#x27; .txt&#x27;</span>)  as f:
             <span class="hljs-keyword">for</span> <span class="hljs-built_in">command</span> <span class="hljs-keyword">in</span> f:
                <span class="hljs-built_in">print</span>(datacom.command(<span class="hljs-built_in">command</span>))
            <span class="hljs-keyword">if</span> datacom.fan_info(): <span class="hljs-comment"># 判断风扇是否故障</span>
                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ALL fans are faultly&#x27;</span>)
            try:
                <span class="hljs-comment"># 开始判断是不是保存配置超过24小时了, 则进行强行赋值，大于一天</span>
                than_one_day= datetime.now() - last_downloadtime&gt;=timedelta(days=1)
            except NameError:
                than_one_day=True
            <span class="hljs-keyword">if</span> than_one_day: <span class="hljs-comment"># 开始判断是不是保存配置超过24小时了</span>
                downloadtime=datetime.now() <span class="hljs-comment"># 记录下载时间</span>
                downloadtime_date=downloadtime.strftime(<span class="hljs-string">&#x27;%Y_%m_%d&#x27;</span>)
                config_filename=<span class="hljs-string">&#x27;&#123;&#125;_&#123;&#125;.zip&#x27;</span>.format(downloadtime_date,name) <span class="hljs-comment"># 下载载的文件名字</span>
                backup_filename=<span class="hljs-string">&#x27;&#123;&#125;_&#123;&#125;.bak&#x27;</span>.format(downloadtime_date,name) <span class="hljs-comment"># 保存的配置文件名字</span>
                datacom.command(<span class="hljs-string">&#x27;save force &#123;&#125;&#x27;</span>.format(config_filename))  <span class="hljs-comment"># 保存文件</span>
                datacom.download(backup_filename,config_filename) <span class="hljs-comment"># 下载函数下载文件</span>
                last_downloadtime=downloadtime <span class="hljs-comment"># 把最后一次的下载的时间设置成现在</span>
                datacom.close()
                <span class="hljs-built_in">sleep</span>(5*60) <span class="hljs-comment"># 五分钟之后继续重复以上操作</span>
    except Exception as e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;stopped by &#123;&#125;&#x27;</span>.format(e))


ip = <span class="hljs-string">&#x27;10.1.0.6&#x27;</span> <span class="hljs-comment"># 设备IP地址</span>
name = <span class="hljs-string">&#x27;X_T1_AGG1&#x27;</span> <span class="hljs-comment"># 设备名</span>
syslog = <span class="hljs-string">&#x27;10.1.60.2&#x27;</span> <span class="hljs-comment"># 日志主机地址</span>
username = <span class="hljs-string">&#x27;python&#x27;</span> <span class="hljs-comment"># SSH的用户名</span>
password = <span class="hljs-string">&#x27;Huawei@123&#x27;</span> <span class="hljs-comment"># SSH的密码</span>
nc_username = <span class="hljs-string">&#x27;netconf&#x27;</span> <span class="hljs-comment"># 用于netconf的用户名</span>
nc_password = <span class="hljs-string">&#x27;Huawei@123&#x27;</span> <span class="hljs-comment"># 用于netconf的密码</span>


<span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:
    try:
        Netconf_syslog_host(ip,nc_username,nc_password,syslog)
        datacom_loop(ip,username,password,name) <span class="hljs-comment"># 执行巡检调用，进行每5分钟一次的循环</span>
    except KeyboardInterrupt:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;end of process!&#x27;</span>)
language-py
from paramiko import SSHClient, AutoAddPolicy
from ncclient import manager
from ncclient.xml_ import to_ele
from <span class="hljs-keyword">time</span> import <span class="hljs-built_in">sleep</span>
from datetime import datetime, timedelta

class Datacom:
    def __init__(self, server, username, password):
        self.server = server
        self.username = username
        self.password = password
        self.client = self._get_client()
        self.cli = self.client.invoke_shell()
        self.cli.send(<span class="hljs-string">&#x27;screen-length 0 temporary\n&#x27;</span>)
        <span class="hljs-built_in">sleep</span>(6)
        self.cli.recv(9999)

    def _get_client(self):
        client = SSHClient()
        client.load_system_host_keys()
        client.set_missing_host_key_policy(AutoAddPolicy)
        client.connect(self.server, username=self.username, password=self.password)
        <span class="hljs-built_in">return</span> client

    def <span class="hljs-built_in">command</span>(self, cmd):
        self.cli.send(<span class="hljs-string">&#x27;&#123;&#125;\n&#x27;</span>.format(cmd))
        <span class="hljs-built_in">sleep</span>(6)
        <span class="hljs-built_in">return</span> self.cli.recv(9999).decode()

    def fan_info(self):
        fan_info = self.command(<span class="hljs-string">&#x27;display fan&#x27;</span>)
        <span class="hljs-built_in">return</span> fan_info.find(<span class="hljs-string">&#x27;Normal&#x27;</span>) == -1

    def download(self, target, path=<span class="hljs-string">&#x27;/vrpcfg.zip&#x27;</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;download starting...&#x27;</span>)
        client = self._get_client()
        sftp = client.open_sftp()
        sftp.get(path, target)
        self.client.close()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;download finish!&#x27;</span>)

    def close(self):
        self.client.close()

def Netconf_by_rpc(ip, username, password, rpc_netconf):
    with manager.connect_ssh(host=ip,
                             username = username,
                             password = password,
                             hostkey_verify=False,
                             device_params=&#123;<span class="hljs-string">&#x27;name&#x27;</span>:<span class="hljs-string">&quot;huaweiyang&quot;</span>&#125;)as m:
                                <span class="hljs-built_in">command</span> = to_ele(rpc_netconf)
                                rpc = m.__getattr__(<span class="hljs-string">&#x27;rpc&#x27;</span>)
                                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;get manager inner function rpc &#123;&#125;&#x27;</span>.format(rpc));
                                rpc(<span class="hljs-built_in">command</span>)
                                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Netconf setting success!&#x27;</span>)

def Netconf_syslog_host(ip, username, password, syslog):
    rpc_netconf = <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;&lt;edit-config&gt;</span>
<span class="hljs-string">    &lt;target&gt;</span>
<span class="hljs-string">      &lt;running/&gt;</span>
<span class="hljs-string">    &lt;/target&gt;</span>
<span class="hljs-string">    &lt;config&gt;</span>
<span class="hljs-string">      &lt;syslog:syslog xmlns:syslog=&quot;</span>urn:ietf:params:xml:ns:yang:ietf-syslog<span class="hljs-string">&quot;&gt;</span>
<span class="hljs-string">        &lt;syslog:log-actions&gt;</span>
<span class="hljs-string">          &lt;syslog:remote&gt;</span>
<span class="hljs-string">            &lt;syslog:destination&gt;</span>
<span class="hljs-string">              &lt;syslog:name&gt;syslog-host&lt;/syslog:name&gt;</span>
<span class="hljs-string">              &lt;syslog:udp&gt;</span>
<span class="hljs-string">                &lt;syslog:address&gt;huawei&lt;/syslog:address&gt;</span>
<span class="hljs-string">                &lt;syslog:port&gt;43&lt;/syslog:port&gt;</span>
<span class="hljs-string">              &lt;/syslog:udp&gt;</span>
<span class="hljs-string">              &lt;syslog:destination-facility xmlns:ietf-syslog-types=&quot;</span>urn:ietf:params:xml:ns:yang:ietf-syslog-types<span class="hljs-string">&quot;&gt;ietf-syslog-types:local0&lt;/syslog:destination-facility&gt;</span>
<span class="hljs-string">            &lt;/syslog:destination&gt;</span>
<span class="hljs-string">          &lt;/syslog:remote&gt;</span>
<span class="hljs-string">        &lt;/syslog:log-actions&gt;</span>
<span class="hljs-string">      &lt;/syslog:syslog&gt;</span>
<span class="hljs-string">    &lt;/config&gt;</span>
<span class="hljs-string">  &lt;/edit-config&gt;&quot;</span><span class="hljs-string">&quot;&quot;</span>.format(syslog)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Using netconf configure syslog&#x27;</span>)
    Netconf_by_rpc(ip, username, password, rpc_netconf)

def datacom_loop(ip, username, password, name):
    try:
        <span class="hljs-keyword">while</span> True:
            datacom = Datacom(ip, username, password)
            with open(<span class="hljs-string">&#x27;command.txt&#x27;</span>)as f:
                <span class="hljs-keyword">for</span> <span class="hljs-built_in">command</span> <span class="hljs-keyword">in</span> f:
                    <span class="hljs-built_in">print</span>(datacom.command(<span class="hljs-built_in">command</span>))
            <span class="hljs-keyword">if</span> datacom.fan_info():
                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;All fans are faulty&#x27;</span>)
            try:
                than_one_day = datetime.now() - last_downloadtime &gt;= timedelta(days=1)
            except NameError:
                than_one_day = True
            <span class="hljs-keyword">if</span> than_one_day:
                downloadtime = datetime.now()
                downloadtime_date = downloadtime.strftime(<span class="hljs-string">&#x27;%Y_%m_%d&#x27;</span>)
                config_filename = <span class="hljs-string">&#x27;&#123;&#125;_&#123;&#125;.zip&#x27;</span>.format(downloadtime_date, name)
                backup_filenmae = <span class="hljs-string">&#x27;&#123;&#125;_&#123;&#125;.bak&#x27;</span>.format(downloadtime_date, name)
                datacom.command(<span class="hljs-string">&#x27;save fore &#123;&#125;&#x27;</span>.format(config_filename))
                datacom.download(backup_filenmae, config_filename)

                last_downloadtime = downloadtime

                datacom.close()
                <span class="hljs-built_in">sleep</span>(5*60)

    except Exception as e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;stopped by &#123;&#125;&#x27;</span>.format(e))

ip = <span class="hljs-string">&#x27;10.1.0.6&#x27;</span>
name = <span class="hljs-string">&#x27;X_T1_AGG1&#x27;</span>
syslog = <span class="hljs-string">&#x27;10.1.60.2&#x27;</span>
username = <span class="hljs-string">&#x27;python&#x27;</span>
password = <span class="hljs-string">&#x27;Huawei@123&#x27;</span>
nc_username = <span class="hljs-string">&#x27;netconf&#x27;</span>
nc_password = <span class="hljs-string">&#x27;Huawei@123&#x27;</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:
    try:
        Netconf_syslog_host(ip, nc_username, nc_password, syslog)
        datacom_loop(ip, username, password, name)
    except KeyboardInterrupt:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;end of process&#x27;</span>)
language-python
网络八股文
1、内网攻击场景
问题1 5’: 来自于外网的流量DDos攻击等，可以通过FW进行防御。来自于内部的流量，会有哪些?举出5 种内网攻击场景，并提供解决方案。(1 个场景1 分，5 个场景以上满分)

答:
DDoS 攻击是指攻击者通过控制大量的僵尸主机，向被攻击目标发送大量精心构造的攻击报文， 造成被攻击者所在网络的链路拥塞、系统资源耗尽，从而使被攻击者产生拒绝向正常用户的请求提供服务的效果。来自外网流量的DDoS 攻击等，可以使用防火墙进行防御，而来自内部的流量也往往存在很多攻击行为，以下是关于内网流量攻击以及相应解决方案:

<span class="hljs-comment"># 1、LAND 攻击</span>
LAND 攻击是攻击者利用TCP 连接三次握手机制中的缺陷，向目标主机发送一个源地址和目的地址均为目标主机、源端口和目的端口相同的SYN 报文，目标主机接收到该报文后，将创建一个源地址和目的地址均为自己的TCP 空连接，直至连接超时。在这种攻击方式下，目标主机将会创建大量无用的TCP空连接，耗费大量资源，直至设备瘫痪。攻击者利用这个攻击原理攻击重要节点的网络设备， 例如服务器的网关设备，这样会导致设备资源使用率过高，影响网络服务。
<span class="hljs-comment"># 解决方式:</span>
可以在网关设备上启用畸形报文攻击防范，启用该防范后，设备采用检测TCP SYN 报文的源地址和目的地址的方法来避免LAND 攻击。如果TCP SYN 报文中的源地址和目的地址一致，则认为是畸形报文攻击，丢弃该报文。

<span class="hljs-comment"># 2、TC-BPDU 攻击</span>
交换设备在接收到TC BPDU 报文后，会执行MAC 地址表项和ARP 表项的删除操作。攻击者利用该原理伪造TC BPDU 报文恶意攻击交换设备，短时间内产生大量的TC BPDU 报文，导致交换设备会收到很多TC BPDU 报文，频繁的删除操作会给设备造成很大的负担，导致设备资源使用率过高，影响网络质量，也给网络的稳定带来很大隐患。解决方式:在交换设备上启用防TC-BPDU 报文攻击，启用该功能后，在单位时间内，交换设备处理TC BPDU 报文的次数可配置。如果在单位时间内，交换设备在收到TC BPDU 报文数量大于配置的阈值，那么设备只会处理阈值指定的次数。对于其他超出阈值的TC BPDU 报文，定时器到期后设备只对其统一处理一次。这样可以避免频繁的删除MAC 地址表项和ARP 表项，从而达到保护设备的目的。

<span class="hljs-comment"># 3、DHCP Server 仿冒攻击</span>
由于DHCP Server 和DHCP Client 之间没有认证机制，所以如果在网络上随意添加一台DHCP 服务器，它就可以为客户端分配IP 地址以及其他网络参数。如果该DHCP 服务器为用户分配错误的IP 地址和其他网络参数，导致用户上网异常等现象。解决方案:为了防止DHCP Server 仿冒者攻击，可配置设备接口的“信任(Trusted)/非信任(Untrusted)”工作模式，启用后接口默认为非信任模式，将与合法DHCP 服务器直接或间接连接的接口设置为信任接口。此后，从“非信任(Untrusted)”接口上收到的DHCP 回应报文将被直接丢弃，这样可以有效防止DHCP Server 仿冒者的攻击。

<span class="hljs-comment"># 4、IP 欺骗攻击</span>
随着网络规模越来越大，通过伪造源IP 地址实施的网络攻击(简称IP 地址欺骗攻击)也逐渐增多。攻击者通过伪造合法用户的IP 地址获取网络访问权限，非法访问网络，甚至造成合法用户无法访问网络，或者信息泄露。解决方案:可以在接入设备上启用IPSG，IPSG 利用绑定表(源IP 地址、源MAC 地址、所属VLAN、入接口的绑定关系)去匹配检查二层接口上收到的IP报文，只有匹配绑定表的报文才允许通过，其他报文将被丢弃。绑定表包括静态和动态两种。静态绑定表使用user-bind 命令手工配置。DHCP Snooping 动态绑定表在配置DHCP Snooping 功能后，DHCP 主机动态获取IP 地址时，设备根据DHCP 服务器发送的DHCP 回复报文动态生成。配置IPSG 技术结合DHCP Snooping 功能进行抵御。可以在交换机上接口或者VLAN 上配置IPSG功能，对入方向的IP 报文进行绑定表匹配检查，当设备在转发IP 报文时， 将此IP 报文中的源IP、源MAC、端口、VLAN 信息和绑定表的信息进行比较，如果信息匹配，说明是合法用户，则允许此用户正常转发，否则认为是攻击者，丢弃该用户发送的IP 报文。从而避免了IP 欺骗攻击。

<span class="hljs-comment"># 5、ARP 欺骗攻击</span>
ARP 欺骗是针对ARP 的一种攻击技术，通过使用错误的ARP 载荷信息欺骗局域网内访问者PC 的网关MAC 地址，使访问者PC 错以为攻击者更改后的MAC 地址是网关的MAC，

2、CloudCampus 全网业务随行原理
问题2 3’：解释CloudCampus 解决方案的业务随行原理，如果有两个认证点(同时也是策略执行点)，用户分散在两个认证点，采用什么方案实现全网业务随行。给出两个方案。(3 分)

答：
<span class="hljs-comment"># 业务随行的原理如下：</span>
传统园区网络主要通过ACL 对用户的策略进行控制。基于ACL 的策略配置依赖组网、IP 和VLAN 的规划，网络的拓扑改变、VLAN 规划改变、IP 地址规划改变以及用户的位置变化都会导致ACL 规则的变更，因此用户策略的配置无法与物理网络解耦，缺乏灵活性，可维护性差。
为了解决这个问题，使得用户不管身处何地、使用哪个IP 地址，都可以保证该用户在园区网络中获得一致性的访问策略，华为推出了基于用户身份进行策略控制的业务随行方案。
首先管理员在控制器中创建用户账号、定义UCL 组，同时将用户账号加入其所属的UCL 组，所有用户必须在认证通过后才可接入网络。然后为用户统一定义基于UCL 组的网络访问策略（即组策略）。
策略组配置完成后控制器将管理员配置的UCL 组下发给所有关联的交换机（执行点和认证点设备），从而实现交换机对用户所属UCL 组的识别。同时执行点设备向控制器发起建立IP-GROUP 通道。
当用户启动认证，在认证过程中，控制器根据用户的登录信息，将其与UCL组关联。认证成功后，控制器收集所有上线用户的IP 地址。
控制器通过IP-GROUP 通道向执行点设备推送UCL 组表项信息（该用户所属安全组作为授权结果），记录源/目的IP 与UCL 组的映射关系。
通过安全组完成了对网络对象的分类，通过安全组策略来定义该安全组能享受的网络服务。在iMaster NCE-Campus 中，管理员在二维矩阵上统一规划安全组所能享受的网络服务，包括访问权限、应用控制等。
业务随行方案：
<span class="hljs-comment"># （1） 场景1：虚拟化园区场景</span>
可以把汇聚设备部署为认证点和策略执行点，在虚拟化园区网场景下，同时把汇聚设备部署为Edge 节点,Edge 节点之间会部署VXLAN 隧道。当终端设备通过认证后，汇聚设备会拥有UCL 组信息，同时会拥有该汇聚节点下终端的IP-Group信息。
如果互访的终端都在同一个汇聚设备下，那么可以直接根据数据报文的源目的IP信息和IP-Group 表现来查找对应的源目安全组信息，之后再根据源目安全组执行组间策略，允许访问则转发，不允许则丢弃处理。
如果互访的目的终端不在该汇聚节点下，汇聚设备只有源终端的IP-Group 表项信息，没有目的终端的IP-Group 表项信息，所以不能直接执行组间策略。而此时汇聚节点同时是Edge 节点，会进行Vxlan 报文的封装，同时会将源安全组ID信息封装在VXLAN 报文中传递到对端的Edge 设备，对端设备再根据目的IP 查找目的的安全组。最后根据找到的目的安全组和VXLAN 报文中的源组ID 执行组间策略，如果禁止就丢弃，如果允许就通过。
<span class="hljs-comment"># （2） 场景2：非虚拟化园区网场景</span>
可以把汇聚设备部署为认证点和策略执行点。当终端设备通过认证后，汇聚设备会拥有UCL 组信息，同时会拥有该汇聚节点下终端的IP-Group 信息。
如果互访的终端都在通一个汇聚设备下，那么可以直接根据数据报文的源目IP信息和IP-Group 表项来查找对应的源目安全组信息，之后再根据源目安全组执行组间策略，允许访问则转发，不允许则进行丢弃处理。
如果互访的终端不在同一个汇聚设备下，汇聚设备只有源终端的IP-Group 表项信息，没有目的终端的IP-Group 表项信息，所以不能够直接执行组间策略。而普通的IP 报文无法携带安全组ID 信息，所以此时需要在控制器上配置IP-Group订阅，控制器需要把目的终端的IP-Group 表项信息推送到该汇聚设备上，拥有源目终端的IP-Group 信息，则可以根据数据报文的源目的IP 和IP-Group 表项来查找对应的源目阿全组信息，然后再执行策略，如果禁止就丢弃，允许就通过即可。

3、FRR 环路技术
问题3 5’：FRR 技术可以分为LFA、R-LFA、TI-LFA，FRR 的环路风险有哪些?(为什么会有环路)

答：
1、LFA （Loop-Free Alternates）算法以可提供备份链路的邻居为根节点，利用SPF （Shortest Path First〉算法计算出到目的节点的最短距离。然后，按照以下不等式计算出一组开销最小且无环的备份链路。
LFA 不等式1：Distance_opt(N, D)＜ Distance_opt(N, S) + Distance_opt(S, D)。其中，Distance_opt(X,Y)是指节点X 到Y 之间的最短路径，N 是备份链路的节点，D 是流量转发的目的节点，S 是转发流量的源节点。
LFA 不等式2：Distance_opt(N, D)＜ Distance_opt(N, E) + Distance_opt(E，D)。其中，S 是转发流量的源节点，E 是发生故障的节点，N 是备份链路的节点，D是流量转发的目的节点。
满足以上两个公式，就避免了计算的备用路径产生环路的风险。但是并不意味部署1P FRR 的网络环境中就一定没有环路，可能会因为收敛不一致导致微环。
当主路径故障，流量切换到备份路径后，而后期原主路径恢复后，转发流量的源节点还未收敛完成，收到流量依旧向备份路径转发。此时备份链路的节点已经收敛完成，且该节点去往目的节点会经过源节点，则产生微环。
2、LFA FRR 对于某些大型组网，特别是环形组网，无法计算出备份路径，不能满足可靠性要求。在这种情况下，实现了Remote LFA FRR。Remote LFA 算法根据保护路径计算PQ 节点，并在源节点与PQ 节点之间建立tunnel 隧道形成备份下一跳保护。当保护链路发生故障时，流量自动切换到隧道备份路径，继续转发，从而提高网络可靠性。R-LFA 虽然提高了计算备用路径的覆盖率，但是同样会存在路由器拓扑变化的IGP 收敛先后不一致导致的微环。
3、LFA FRR 和Remote LFA 对于葉些场景中，扩展P 空间和Q 空间既没有交集，也没有直连的邻居，无法计算出备份路径，不能满足可靠性要求。在这种情况下，实现了T-LFA。TI-LFA 算法根据保护路径计算扩展P 空间，Q 空间，Post convergence 最短路径树，以及根据不同场景计算Repair List，并从源节点到。节点，再到Q 节点建立SegmentRouting 隧道形成备份下一跳保护。当保护链路发生故障时，流量自动切换到隧道备份路径，继续转发，从而提高网络可靠性。虽然T-LFA 拓扑无关，但是同样存在路由器收敛不一致导致的微环问题，T-LFA 可以通过算法来避免微环，主要的微环保护以下三个方面：
<span class="hljs-comment"># （1） SR-MPLS 本地正切防微环</span>
本地正切微环指的是紧邻故障节点的节点收敛后引发的环路。全网节点都部署TI-LFA，当主路径故障的时候，节点针对目的地址的收敛过程如下：源节点感知到故障，进入TI-LFA 的快速重路由切换流程，向报文插入Repair List，将报文转向TI-LFA 计算的PQ 节点。因此报文会先转发到下一跳备份节点。当源节点完成到目的地址的路由收敛，则直接查找目的节点的路由，将报文转发到下一跳备份节点，此时不再携带Repair List，而是直按转发。如果此时备份节点还未完成收敛，当源节点向备份节点转发报文时，备份节点的转发表中到目的节点的路由下一跳还是源节点，这样就在源节点和备份节点之间形成了环路。
解决方式：
在源节点部署正切防微环，部署正切防微环后的收敛流程如下：源节点感知到故障，进入T-LFA 流程，报文沿着备份路径转发，下一跳为备份节点，并封装Repair List，源节点启动一个定时器T1。在T_期间，源节点不响应拓扑变化，转发表不变，报文依旧按照TI-LFA 策略转发。网络中其他节点正常收敛。源节点的定时器T1 超时，这时网络中其他节点都己经完成收敛，源节点也正常收敛，退出TI-LFA 流程，按照正常收敛后的路径转发报文。
<span class="hljs-comment"># （2）本地回切防微环</span>
微环不但可能在路径正切时产生，也可能在故障恢复后路径回切时出现。下面介绍回切时产生环路：
主链路发生故障之后，报文按照重新收敛之后的备份路径发送到目的节点。
主链路故障恢复后，假设备份节点率先完成收敛。源节点收到报文，由于源节点未完成收敛，依然按照故障恢复前路径转发，转发给备份节点。备份节点已经完成收敛，所以备份节点按照故障恢复后的路径转发到源节点，这样就在源节点和备份节点之间形成了环路。
解决方式：
在备份节点部署回切防微环，部署回切防微环后的收敛流程如下：
主链路故障后恢复，备份节点率先完成收敛。备份节点启动定时器T1，在T1 超时前，备份节点针对访问目的节点的报文计算出防微环Segment List。源节点收到报文，由于源节点未完成收敛，依然按照故障恢复前路径转发，转发给备份节点。备份节点在报文中插入防微环Segment List，并转发到源节点。源节点根据Node SID 和Adjacency SID 指令执行转发动作，沿着Adjacency SiID 指定的出接口转发出去，最终转发至目的节点。
<span class="hljs-comment"># （3） 远端防微环</span>
前面介绍了本地正切防微环，实际上正切时不仅会导致本地微环，也可能引起远端节点之间形成环路，即沿着报文转发路径，如果离故障点更近的节点先于离故障点远的节点收敛，就可能会导致环路。下面描述远端微环产生过程：计算节点的非直连链路或节点故障，假设计算节点率先完成收敛，备份节点未完成收敛。备份节点沿着故障前路径将报文转发到计算节点，由于计算节点已经完成收敛，根据路由下一跳转发到备份节点。这样报文就在备份节点和计算节点之间形成了环路。
解决方式：
在计算节点使能远端防微环，使能远端防微环后的收敛流程如下：
计算节点的非直连链路或节点故障，假设计算节点率先完成收敛。计算节点启动定时器T1，在T1 超时前，算节点针对访问目的节点的报文计算出防微环Segment List。备份节点收到报文，由于备份节点未完成收敛，依然按照故障发生之前的路径将报文转发给计算节点。计算节点在报文中插入防微环Segment List，并转发到备份节点。备份节点根据Node SID 的指令执行转发动作，将报文转发给最远P 节点。最远P 节点根据AdjacencysD 的指令执行转发动作，沿着Adjacency SID 出接口转发出去，最后转发到目的节点。

4、FRR TI-LFA环路风险
问题3 在部署FRR 时，开启TI-LFA 功能规避环路的风险,那么FRR 是否存在环路的风险？

答：
LFA FRR 和Remote LFA 对于某些场景中，扩展P 空间和Q 空间既没有交集，也没有直连的邻居，无法计算出备份路径，不能满足可靠性要求。在这种情况下，实现了TI-LFA。TI-LFA 算法根据保护路径计算扩展P 空间，Q 空间，Post-convergence 最短路径树，以及根据不同场景计算Repair List，并从源节点到P 节点，再到Q 节点建立SegmentRouting 隧道形成备份下一跳保护。当保护链路发生故障时，流量自动切换到隧道备份路径，继续转发，从而提高网络可靠性。虽然TI-LFA 拓扑无关，但是同样存在路由器收敛不一致导致的微环问题，TI-LFA 可以通过算法来避免微环，主要的微环保护以下三个方面：
<span class="hljs-comment"># （1） SR-MPLS 本地正切防微环</span>
本地正切微环指的是紧邻故障节点的节点收敛后引发的环路。全网节点都部署TIHLFA，当主路径故障的时候，源节点针对目的地址的收敛过程如下：
源节点感知到故障，进入T-LFA 的快速重路由切换流程，向报文插入Repair List，将报文转向TH-LFA 计算的PQ 节点。因此报文会先转发到下一跳备份节点。当源节点完成到目的地址的路由收敛，则直接查找目的节点的路由，报文转发到下一跳备份节点，此时不再携带Repair List，而是直接转发。如果此时备份节点还未完成收敛，当源节点向备份节点转发报文时，备份节点的转发表中到目的节点的路由下一跳还是源节点，这样就在源节点和备份节点之间形成了环路。
解决方式：
在源节点部署正切防微环，部署正切防微环后的收敛流程如下：源节点感知到故障，进入T-LFA 流程，报文沿着备份路径转发，下一跳为备份节点，并封装RepairList。源节点启动一个定时器T1。在T1 期间，源节点不响应拓扑变化，转发表不变，报文依旧按照TI-LFA 策略转发。网络中其他节点正常收敛。源节点的定时器T1 超时，这时网络中其他节点都己经完成收敛，源节点也正常收敛，退出TI-LFA 流程，按照正常收敛后的路径转发报文。
<span class="hljs-comment"># （2）本地回切防微环</span>
微环不但可能在路径正切时产生，也可能在放障恢复后路径回切时出现。下面介绍回切时产生环路：
主链路发生故障之后，报文按照重新收敛之后的备份路径发送到目的节点。主链路故障恢复后，假设备份节点率先完成收敛。源节点收到报文，由于源节点未完成收敛，依然按照故障恢复前路径转发，转发给备份节点。备份节点已经完成收敛，所以备份节点按照故障恢复后的路径转发到源节点，这样就在源节点和备份节点之间形成了环路。
解决方式：
在备份节点部署回切防微环，部署回切防微环后的收敛流程如下：
主链路故障后恢复，备份节点率先完成收敛。备份节点启动定时器T1，在T1超时前，备份节点针对访问目的节点的报文计算出防微环Segment List。源节点收到报文，由于源节点未完成收敛，依然按照故障恢复前路径转发，转发给备份节点。备份节点在报文中插入防微环Segment List，并转发到源节点。源节点根据Node SID 和Adjacency SID 指令执行转发动作，沿着Adjacency SID 指定的出接口转发出去，最终转发至目的节点。
<span class="hljs-comment"># （3）远端防微环</span>
前面介绍了本地正切防微环，实际上正切时不仅会导致本地微环，也可能引起远端节点之间形成环路，即沿着报文转发路径，如果离放障点更近的节点先于离放障点远的节点收敛，就可能会导致环路。下面描述远端微环产生过程：
计算节点的非直连链路或节点故障，假设计算节点率先完成收敛，备份节点未完成收敛。备份节点沿着故障前路径将报文转发到计算节点，由于计算节点己经完成收敛，根据路由下一跳转发到备份节点。这样报文就在备份节点和计算节点之间闻形成了环路。
解决方式：
在计算节点使能远端防微环，使能远端防微环后的收敛流程如下：
计算节点的非直连链路或节点故障，假设计算节点率先完成收敛。计算节点启动定时器T1，在T1 超时前，计算节点针对访问目的节点的报文计算出防微环Segment List。备份节点收到报文，由于备份节点末完成收敛，依然按照故障发生之前的路径将报文转发给计算节点。计算节点在报文中插入防微环Segment List，并转发到备份节点。备份节点根据Node SID 的指令执行转发动作，将报文转发给最远P 节点。最远P 节点根据Adjacency SID 的指令执行转发动作，沿着Adjacency SID 出接口转发出去，最后转发到目的节点。

5、LDP、RSVP-TE 跟SR 比较
问题4：LDP、RSVP-TE 跟SR 比，不好在哪里。(MPLS LDP 和RSVP-TE 与SR 相比较有不足之处，那么部署MPLS LDP 和RSVP-TE 有什么问题?)

答:
MPLS LDP 和SR 相比MPLS LDP 建立LSP 需要同时使用IGP 和LDP 协议，IGP 用来通告路由和拓扑信息，形成路由表。LDP 用来分发标签，形成标签转发表。LDP 的LSP 需要依赖IGP 生成的路由表才能形成LSP。MPLS LDP 的两个主要缺点:
    (1)存在IGP 和LDP 同步的问题，某些场景，IGP 如果先收敛，LDP 后收敛会导致数据传递的路由黑洞问题。
    (2)LDP 不支持计算路径。SR 的路由信息的通告和计算全部使用IGP 协议单独完成，OSPF 通过LSA10 中的type7 来携带PrefixSID，ISIS 通过TLV235携带PrefixSID，那么就不存在MPLS LDP 中的IGP 和LDP 问题。
    (3)LDP 是为每条路由分配标签，而SR 只为节点和IGP 的邻居分配标签，在标签空间的使用上，SR 比LDP 少很多，SR 更适合大规模组网。
RSVP-TE 和SR 相比
    (1)控制平面:SR 信令控制也是IGP 的扩展，无需专门的MPLS 的控制协议，减少了协议的数量，而RSVP- TE 需要RSVP 作为控制协议，控制平面比较复杂。
    (2)可扩展性:SR 是源路由技术，通过控制器可以计算路径，隧道的信息有标签栈进行携带，也就是状态在数据包中。而RSVPTE 每台设备都需要维护隧道的状态信息，可扩展性差。
    (3)负载分担能力:RSVP 的隧道不支持负载分担，如果需要做负载必须创建多个隧道，而SR 的隧道很容易支持负载分担。

6、外网攻击场景
论述题1.5 来自外网的流量攻击 DDos攻击等，可以通过FW进行防御。来自于内网的流量，会有哪些？举出5种内网攻击场景，并提供解决方案。（1个场景1分，5个场景以上满分）

答：DDos攻击是指攻击者通过控制大量的僵尸主机，向被攻击目标发送大量精心构造的攻击报文，造成被攻击者所在网络的链路拥塞、系统资源耗尽，从而使被攻击者产生拒绝向正常用户的请求提供服务的效果。来自外网流量的DDos攻击等，可以使用防火墙进行防御，而来自内部的流量也往往存在很多攻击行为，以下是关于内网流量攻击以及相应的解决方案：

LAND 攻击
LAND攻击是攻击者利用 TCP 连接三次握手机制中的缺陷，向目标主机发送一个源地址和目的地址均为目标主机、源端口和目的端口相同的 SYN 报文，目标主机接受到该报文后，将创建一个源地址和目的地址均为自己的 TCP 空连接，直至连接超时。在这种攻击方式下，目标主机将会创建大量无用的 TCP 空连接，耗费大量资源，直至设备瘫痪。攻击者利用这个攻击原理攻击重要节点的网络设备，例如服务器的网关设备，这样会导致设备资源使用率过高，影响网络服务。
解决方式：

可以在网关设备上启用畸形报文攻击防范，启用该防范后，设备采用监测 TCP SYN 报文的源地址和目的地址的方式来避免LAND攻击。如果 TCP SYN 报文中的源地址和目的地址一致，则认为是畸形攻击，丢弃该报文。

TC-BPDU攻击
交换设备在接受到TC BPDU 报文后，会执行 MAC 地址表项和 ARP 表项的删除操作。攻击者利用该原理伪造TC BPDU 报文而已攻击交换设备，短时间内产生大量的 TC BPDU 报文，
导致交换设备会收到很多 TC BPDU 报文，频繁的删除操作会给设备造成很大的负担，导致设备资源使用率过高，影响网络质量，也给网络的稳定带来很大隐患。

解决方式：

在交换设备上启用防 TC-BPDU 报文攻击，启用该功能后，在单位时间内，交换设备处理 TC BPDU 报文的次数可配置。如果在单位时间内，交换设备在收到 TC BPDU 报文数量大于配置的阈值，那么设备只会处理阈值指定的次数。对于其他超出阈值的 TC BPDU 报文，定时器到期后设备只对其统一处理一次。这样可以避免频繁的删 MAC 地址表象和 ARP 表项，从而达到保护设备的目的。

DHCP Server 仿冒攻击
由于 DHCP Server 和 DHCP Client 之间没有认知机制，所以如果在网络上随意添加一台 DHCP 服务器，他就可以为客户端分配 IP 地址以及其他网络参数。如果该 DHCP 服务器为用户分配错误的 IP 地址和其他的网络参数，导致用户上网异常等现象。

解决方案：

为了防止 DHCP Server 放冒者攻击，可配置设备接口的“信任(Trusted)/非信任(Untrusted)”工作模式，启用后接口默认为非信任模式，将与合法 DHCP 服务器直接或间接的连接的接口设置为信任接口。此后，从“非信任(Untrusted)”接口上收到的 DHCP 回应报文将被直接丢弃，这样可以有效防止 DHCP Server 放冒者的攻击。

IP 欺骗攻击
随着网络规模越来越大，通过伪造源 IP 地址实施的网络攻击（简称 IP 地址欺骗攻击）也逐渐增多。攻击者通过伪造合法用户的 IP 地址获取网络访问权限，非法访问网络，甚至造成合法用户无法访问网络，或者信息渗漏。

解决方案：

可以在接入设备上启用 IPSG，IPSG 利用绑定表（源 IP 地址、源 MAC 地址、所属 VLAN、入接口的绑定关系）去匹配检查二层接口上收到的IP报文，只有匹配绑定表的报文才允许通过，其他报文将被丢弃。绑定表包括静态和动态两种。静态绑定表使用 user-bind 命令手动配置。 DHCP Snooping 动态绑定表在配置 DHCP Snooping 功能后， DHCP 主机动态获取IP地址时，设备根据 DHCP 服务器发送的 DHCP 回复报文动态生成。配置 IPSG 技术结合 DHCP Snooping 功能进行抵御。可以在交换机上接口或者 VLAN 上配置 IPSG 功能，对入方向的IP报文进行绑定表匹配检查，当设备在转发IP报文时，将此IP报文中的源IP、源MAC、端口、VLAN信息和绑定表的信息进行比较， 如果信息匹配，说明是合法用户，则允许此用户正常转发，否则认为是攻击者，丢弃该用户发送的IP报文。从而避免了IP欺骗报文。

ARP欺骗攻击
ARP欺骗是针对ARP的一种攻击技术，通过使用错误的ARP 载荷信息欺骗局域网内访问者PC的网关MAC地址，使访问者PC错以为攻击者更改后的MAC地址是网关的MAC，导致网关不通。此种攻击可让攻击者获取局域网上的数据包甚至可以篡改数据包，且可让网络上特定计算机或所有计算机无法正常连通。

解决方案：

为了防御 ARP 欺骗攻击，可以在 Switch 上部署动态 ARP 监测 DAI(Dynamic ARP Inspection)功能。动态ARP监测是利用DHCP snooping绑定表来防御中间人攻击的。当设备收到ARP报文时，将此ARP报文对应的源IP、源MAC、VLAN以及接口信息和绑定表的信息进行比较，如果信息匹配，说明发送该ARP报文的用户是合法用户，允许此用户的ARP报文通过，否则就认为是攻击，丢弃该ARP报文。

7、CloudCampus 解决方案的业务随行多认证点
论述题2.5 解释 CloudCampus 解决方案的业务随行原理，如果有两个认证点（同时也是策略执行点），用户分散在两个认证点，采用什么方案实现全网业务随行。给出两个方案。

答：业务随行的原理如下：

传统园区网络主要通过 ACL 对用户的策略进行控制。基于 ACL 的策略配置依赖组网、IP和VLAN 的规划，网络的拓扑改变、VLAN规划改变、IP地址改变以及用户的位置变化都会导致ACL规则的变更，因此用户策略的配置无法与物理网络解耦，缺乏灵活性，可维护性差。

为了解决这个问题，使得用户不管身处何处、使用哪个IP地址，都可以保证该用户在园区网络中忽的一致性的访问策略

截图
截图心法

X园区
Export: ospf，tracert(Service_OA)
AC: AP
Core: ip, ospf, ip pool, routing-table
AGG: ip, routing-table, access-user, stack
ACC: interface
FW: ip, routing-table, firewall session table
Terminal1/2/5: ping (出口，99,100,101)

Y园区 Terminal 互相ping 并ping（Service_RD1, Service_RD2, Service_common, Store(OA/RD)）
Terminal 03: R&amp;D / Marketing
Terminal 04: Production
Terminal 05: Employee / Guest
Y_Export: ospf
Store_Export1: ping -vpn-instance(Store(OA/RD)), tracert -vpn-instance(vpn2/4, 5.254)

Z园区
ALL PE: interface, config(isis/bgp), isis peer, mpls ldp, bgp peer
X_PE1: routing-table vpn-instance OA Service(OA/R&amp;D) verbose, tracert(1-&gt;5 lo0)
Y_PE1: routing-table vpn-instance OA/R&amp;D Service(OA/R&amp;D) verbose, tracert(3-&gt;5 lo0)
Z_PE1/2: routing-table vpn-instance OA/RD,
Z_Export: ip, routing-table vpn-instance OA/RD

X园区
1. 2张python执行结果
<span class="hljs-comment"># X_T1_Export2</span>
2. display ospf peer brief
<span class="hljs-comment"># X_T1_AC1</span>
3. display ap all
<span class="hljs-comment"># X_T1_AGG1</span>
4. display ip int brief
5. display ip routing-table
6. display access-user
7. display stack
<span class="hljs-comment"># X_T2_AGG1</span>
8. dis ip int brief
9. display ip routing-table
10. display access-user
11. display stack
<span class="hljs-comment"># X_T1_Core</span>
12. display ip int brief
13. display ospf peer brief
14. display ip routing-table
15. display ip pool vpn-instance Employee
16. display ip pool vpn-instance Guest
17. display ip routing-table vpn-instance Employee
18. display ip routing-table vpn-instance Guest
<span class="hljs-comment"># X_T1/2_ACC1/2</span>
19. display current-configuration interface
<span class="hljs-comment"># X_T1_FW1</span>
20. display ip int brief
21. display ip routing-table vpn-instance Employee
22. display ip routing-table vpn-instance Guest
<span class="hljs-comment"># 23 Terminal 01</span>
ipconfig <span class="hljs-comment"># 14 IP</span>
ping -w 1 10.255.1.254 <span class="hljs-comment"># 通</span>
ping -w 1 10.1.60.99 <span class="hljs-comment"># 通</span>
ping -w 1 10.1.60.100 <span class="hljs-comment"># 通</span>
ping -w 1 10.1.60.101 <span class="hljs-comment"># 不通</span>
ipconfig <span class="hljs-comment"># 21 IP</span>
ping -w 1 10.255.1.254 <span class="hljs-comment"># 通</span>
ping -w 1 10.1.60.99 <span class="hljs-comment"># 通</span>
ping -w 1 10.1.60.100 <span class="hljs-comment"># 通</span>
ping -w 1 10.1.60.101 <span class="hljs-comment"># 不通</span>
<span class="hljs-comment"># 24 Terminal 02</span>
ipconfig <span class="hljs-comment"># 32 IP</span>
ping -w 1 10.255.1.254 <span class="hljs-comment"># 不通</span>
ping -w 1 10.1.60.99 <span class="hljs-comment"># 通</span>
ping -w 1 10.1.60.100 <span class="hljs-comment"># 通</span>
ping -w 1 10.1.60.101 <span class="hljs-comment"># 不通</span>
ipconfig <span class="hljs-comment"># 41 IP</span>
ping -w 1 10.255.1.254 <span class="hljs-comment"># 不通</span>
ping -w 1 10.1.60.99 <span class="hljs-comment"># 通</span>
ping -w 1 10.1.60.100 <span class="hljs-comment"># 通</span>
ping -w 1 10.1.60.101 <span class="hljs-comment"># 不通</span>
<span class="hljs-comment"># 25 Terminal 05</span>
ipconfig <span class="hljs-comment"># 55 IP</span>
ping -w 1 10.255.1.254 <span class="hljs-comment"># 通</span>
ping -w 1 10.1.60.99 <span class="hljs-comment"># 通</span>
ping -w 1 10.1.60.100 <span class="hljs-comment"># 通</span>
ping -w 1 10.1.60.101 <span class="hljs-comment"># 不通</span>
ipconfig <span class="hljs-comment"># 105 IP</span>
ping -w 1 10.255.1.254 <span class="hljs-comment"># 通</span>
ping -w 1 10.1.60.100 <span class="hljs-comment"># 不通</span>
ping -w 10.1.60.101 <span class="hljs-comment"># 不通</span>
telnet 10.1.60.99 3389

Y园区
<span class="hljs-comment"># 1 Terminal 03 （R&amp;D, Procution, Guest）</span>
ipconfig <span class="hljs-comment"># 10.2.12.x</span>
ping -w 1 10.2.21.79 <span class="hljs-comment"># 通</span>
ping -w 1 10.2.55.61 <span class="hljs-comment"># 通</span>
ping -w 1 10.100.3.1 <span class="hljs-comment"># 通</span>
ping -w 1 10.3.99.254 <span class="hljs-comment"># 不通</span>
ping -w 1 10.3.100.254 <span class="hljs-comment"># 通</span>
ping -w 1 10.3.101.254 <span class="hljs-comment"># 不通</span>
ping -w 1 10.2.110.149 <span class="hljs-comment"># 不通</span>
ipconfig <span class="hljs-comment"># 10.2.31.x</span>
ping -w 1 10.2.110.149 <span class="hljs-comment"># 不通</span>
ping -w 1 10.2.21.79 <span class="hljs-comment"># 不通</span>
ping -w 1 10.100.2.1 <span class="hljs-comment"># 通</span>
ping -w 1 10.255.5.254 <span class="hljs-comment"># 通</span>
ping -w 1 10.3.99.254 <span class="hljs-comment"># 不通</span>
ping -w 1 10.3.100.254 <span class="hljs-comment"># 不通</span>
ping -w 1 10.3.101.254 <span class="hljs-comment"># 通</span>
<span class="hljs-comment"># 2 Terminal 04</span>
ipconfig <span class="hljs-comment"># 10.2.21.x</span>
ping -w 1 10.100.3.1 <span class="hljs-comment"># 通</span>
ping -w 1 10.3.99.254 <span class="hljs-comment"># 通</span>
ping -w 1 10.3.100.254 <span class="hljs-comment"># 通</span>
ping -w 1 10.3.101.254 <span class="hljs-comment"># 不通</span>
ping -w 1 10.2.110.149 <span class="hljs-comment"># 不通</span>
<span class="hljs-comment"># 3 Terminal 05</span>
<span class="hljs-comment"># 网站认证：empl1/Huawei@123</span>
ipconfig <span class="hljs-comment"># 10.2.55.x</span>
ping -w 1 10.255.5.254
<span class="hljs-comment"># 网站认证：guest/Huawei@123</span>
ipconfig <span class="hljs-comment"># 10.2.110.x</span>
ping -w 1 10.255.5.254 <span class="hljs-comment"># 通 本地local</span>
ping -w 1 10.3.99.254 <span class="hljs-comment"># 不通</span>
ping -w 1 10.3.100.254 <span class="hljs-comment"># 不通</span>
ping -w 1 10.3.101.254 <span class="hljs-comment"># 不通</span>
<span class="hljs-comment"># 4 Y_export</span>
display ospf peer brief
<span class="hljs-comment"># 5 Sotre_Export1</span>
tracert -vpn-instance vpn2 -a 10.100.2.1 10.255.5.254 <span class="hljs-comment"># 通</span>
tracert -vpn-instance vpn4 -a 10.100.4.1 10.255.5.254 <span class="hljs-comment"># 通</span>
<span class="hljs-comment"># 6. NCE</span>
1. 准入/准入策略/用户在线控制/在线用户

Z园区
<span class="hljs-comment"># X_T1_Export1</span>
tracert -a 10.20.1.5 10.100.2.1 <span class="hljs-comment"># 通</span>
<span class="hljs-comment"># X_T1_Export2</span>
tracert -a 10.20.1.6 10.100.2.1 <span class="hljs-comment"># 通</span>
<span class="hljs-comment"># Store_Export1</span>
ping -vpn-instance vpn3 -a 10.100.3.1 10.3.99.254
ping -vpn-instance vpn3 -a 10.100.3.1 10.3.100.254
<span class="hljs-comment"># X/Y/Z_PE1/2</span>
display current-configuration interface
display mpls lsp
display isis peer
display current-configuration configuration isis
display current-configuration configuration bgp
display bgp vpnv4 all peer
<span class="hljs-comment"># X_PE1</span>
display ip routing-table vpn-instance OA 10.3.101.0 24 verbose
display ip routing-table 5.0.0.5 verbose
tracert -a 1.0.0.1 5.0.0.5
int g 0/0/1 &amp; shutdown &amp; tracert -a 1.0.0.1 5.0.0.5 &amp; undo shutdown
<span class="hljs-comment"># Y_PE1</span>
display ip routing-table vpn-instance OA 10.3.101.0 24 verbose
display ip routing-table vpn-instance R&amp;D 10.3.100.0 24 verbose
display ip routing-table vpn-instance R&amp;D 10.3.99.0 24 verbose
<span class="hljs-comment"># Z_PE1</span>
display ip routing-table vpn-instance OA_In
display ip routing-table vpn-instance OA_Out
<span class="hljs-comment"># Z_PE2</span>
display ip vpn-instance verbose
display ip routing-table vpn-instance OA_In
display ip routing-table vpn-instance OA_Out
<span class="hljs-comment"># Z_Export1</span>
display ip routing-table vpn-instance OA
display ip routing-table vpn-instance R&amp;D

其他
常用命令与技巧
检查命令
<span class="hljs-comment"># 保持ssh会话</span>
sys
user-interface console 0
idle-timeout 0 0
<span class="hljs-comment"># 关闭日志</span>
undo info-center <span class="hljs-built_in">enable</span>
<span class="hljs-comment"># lldp</span>
system-view
lldp <span class="hljs-built_in">enable</span>
display lldp neighbor brief
<span class="hljs-comment"># 查看 IP 地址池</span>
display current-configuration configuration ip-pool
<span class="hljs-comment"># </span>
display ip interface brief
<span class="hljs-comment">#</span>
display port vlan
<span class="hljs-comment">#</span>
dis lldp neighbor brief
<span class="hljs-comment"># </span>
dis cur | include prefix
&gt; <span class="hljs-comment"># 清除配置，重启生效</span>
reset saved-configuration
<span class="hljs-comment"># 查看VPN实例</span>
dis cur config vpn-instance

快捷键
CTRL+X 删除光标左侧所有的字符
CTRL+Y 删除光标所在位置及其右侧所有的字符
CTRL+E 将光标移动到当前行的末尾
CTRL+A 将光标移动到当前行的第一个字符
CTRL+W 删除光标左侧的一个字
<span class="hljs-comment"># 组合键</span>
ESC+B 将光标向左移动一个字符串
ESC+D 删除光标右侧的一个字符串
<span class="hljs-comment"># 不常用</span>
ESC+F 将光标向右移动一个字符串
CTRL+B 将光标向左移动一个字符
CTRL+F 将光标向右移动一个字符
CTRL+D 删除当前光标所在位置的字符
CTRL+H 删除光标左侧的一个字符
CTRL+N 显示历史命令缓冲区中的后一条命令
CTRL+P 显示历史命令缓冲区中的前一条命令

排查命令
display  ospf 65001 error
dis cu configuration  ospf  65001

转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以邮件至 hjxstart@126.com
中华人民共和国工业和信息化部 粤ICP备2021170625号-1 ©2019-2022 hjxstart

Built with Hexo and 3-hexo theme


</code></pre>


<h3 id="4-1-配置-无线-802-1X-认证-AP-强制不认证"><a href="#4-1-配置-无线-802-1X-认证-AP-强制不认证" class="headerlink" title="4.1 配置 无线 &#x2F; 802.1X 认证 &#x2F; AP 强制不认证"></a>4.1 配置 无线 &#x2F; 802.1X 认证 &#x2F; AP 强制不认证</h3><h3 id="4-2-配置-802-1X-MAC-接入模版，并绑定到身份认证模版中"><a href="#4-2-配置-802-1X-MAC-接入模版，并绑定到身份认证模版中" class="headerlink" title="4.2 配置 802.1X &#x2F; MAC 接入模版，并绑定到身份认证模版中"></a>4.2 配置 802.1X &#x2F; MAC 接入模版，并绑定到身份认证模版中</h3><h3 id="4-3-在汇聚设备的相应端口上开启认证模版"><a href="#4-3-在汇聚设备的相应端口上开启认证模版" class="headerlink" title="4.3 在汇聚设备的相应端口上开启认证模版"></a>4.3 在汇聚设备的相应端口上开启认证模版</h3><pre><code class="hljs bash"><span class="hljs-comment"># X_T1_AC</span>
vlan pool wireless_Employee
  vlan 51 to 55
  assignment <span class="hljs-built_in">hash</span>
vlan pool wireless_Guest
  vlan 101 to 105
  assignment <span class="hljs-built_in">hash</span>
wlan
  ssid-profile name Guest
    ssid X_Guest010
    y
  ssid-profile name Employee
    ssid X_Employee010
    y
  vap-profile name Employee
    service-vlan vlan-pool wireless_Employee
    y
  vap-profile name Guest
    service-vlan vlan-pool wireless_Guest
    y
  ap-id 1 ap-mac 00e0-fca9-6ac0
    ap-name X_T2_AP
    ap-group X
    y

<span class="hljs-comment"># X_T_ACC1/ACC2 </span>
l2protocol-tunnel user-defined-protocol 802.1X protocol-mac 0180-c200-0003 group-mac  0100-0000-0002
port-group group-number GigabitEthernet 0/0/1 to GigabitEthernet 0/0/22
  l2protocol-tunnel user-defined-protocol 802.1X <span class="hljs-built_in">enable</span>
interface Eth-trunk 1
  l2protocol-tunnel user-defined-protocol 802.1X <span class="hljs-built_in">enable</span>
<span class="hljs-comment"># X_T_AGG1</span>
radius-server template Employee
  radius-server authentication 10.1.60.2 1812
  radius-server accounting 10.1.60.2 1813
  radius-server shared-key cipher Huawei@123
radius authorization 10.1.60.2 shared-key cipher Huawei@123
aaa
  authentication-scheme Employee
    authentication-mode radius
  authentication-scheme ap_noauthen
    authentication-mode none
  accounting-scheme Employee
    accounting-mode radius
  domain Employee
    authentication-scheme Employee
    accounting-scheme Employee
    radius-server Employee
  domain ap_noauthen
    authenticaton-scheme ap_noauthen
domain Employee

<span class="hljs-comment"># X_T1_AGG1</span>
<span class="hljs-comment"># 模拟器不用敲</span>
domain ap_noauthen mac-authentication force mac-address 00e0-fcb7-2890 mask ffff-ffff-ffff
<span class="hljs-comment"># X_T2_AGG1</span>
domain ap_noauthen mac-authentication force mac-address 00e0-fca9-6ac0 mask ffff-ffff-ffff
<span class="hljs-comment"># X_T1/2_AGG1 </span>
dot1x-access-profile name Employee
mac-access-profile name Employee
authentication-profile name Employee
  dot1x-access-profile Employee
  mac-access-profile Employee
interface Eth-trunk 2
  authentication-profile Employee
interface Eth-trunk 3
  authentication-profile Employee
<span class="hljs-comment"># X_T1_AGG1 </span>
vlan pool market
  vlan 11 to 15
vlan pool procure
  vlan 21 to 25
<span class="hljs-comment"># X_T2_AGG1</span>
vlan pool finance
  vlan 31 to 35
vlan pool hr
  vlan 41 to 45</code></pre>

<h3 id="5-配置-FW-策略"><a href="#5-配置-FW-策略" class="headerlink" title="5. 配置 FW 策略"></a>5. 配置 FW 策略</h3><pre><code class="hljs bash"><span class="hljs-comment"># X_T1_FW</span>
ip route-static vpn-instance Guest 10.1.60.99 32 vpn-instance Employee
switch vsys Guest
  sys
    ip service-set Guest_Service <span class="hljs-built_in">type</span> object
      service protocol tcp source-port 0 to 65535 destination-port 3389
    security-policy
      rule name Guest_Service //外部无线用户访问HTTP 服务3389
        source-zone trust
        destination-zone untrust
        source-address range 10.1.101.0 10.1.105.255
        destination-address 10.1.60.99 mask 255.255.255.255
        service Guest_Service
        action permit
      rule name Deny_Servcie
        source-zone trust
        destination-zone untrust
        source-address range 10.1.101.0 10.1.105.255
        destination-address 10.1.60.0 mask 255.255.255.0
        action deny
      rule name Guest_Internet //访问Internet 的策略最后配置
        source-zone trust
        destination-zone untrust
        source-address range 10.1.101.0 10.1.105.255
        destination-address any
        action permit
switch vsys Employee
  sys
    ip service-set Guest_Service <span class="hljs-built_in">type</span> object
      service protocol tcp source-port 0 to 65535 destination-port 3389
    security-policy
      rule name Guest_Service //放行Guest 到服务器区域的流量
        source-zone untrust
        destination-zone trust
        source-address range 10.1.101.0 10.1.105.255
        destination-address 10.1.60.99 mask 255.255.255.255
        service Guest_Service
        action permit
      rule name Employee_Service //内部无线访问服务器
        source-zone trust
        destination-zone trust
        source-address 10.1.51.0 10.1.55.255
        destination-address 10.1.60.100 mask 255.255.255.255
        action permit
      rule name Deny_Service
        source-zone trust
        destination-zone trust
        source-address range 10.1.51.0 10.1.55.255
        destination-address 10.1.60.0 mask 255.255.255.0
        action deny
      rule name NAT_http_Service //放行NAT_Service 流量
        source-zone untrust
        destination-zone trust
        source-address any
        destination-address 10.1.60.101 mask 255.255.255.255
        service http
        action permit
      rule name Employee_to_Internet //访问Internet 的策略最后配置
        source-zone trust
        destination-zone untrust
        source-address range 10.1.11.0 10.1.15.255
        source-address range 10.1.21.0 10.1.25.255
        source-address range 10.1.51.0 10.1.55.255
        action permit</code></pre>

<h3 id="6-ACL-NAT-Traffic"><a href="#6-ACL-NAT-Traffic" class="headerlink" title="6. ACL &#x2F; NAT &#x2F; Traffic"></a>6. ACL &#x2F; NAT &#x2F; Traffic</h3><pre><code class="hljs bash"><span class="hljs-comment">## X_T1_CORE</span>
<span class="hljs-comment"># 模拟器不用敲</span>
acl 3000 
  rule permit ip <span class="hljs-built_in">source</span> 10.1.51.0 0.0.0.255 destination 10.1.60.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.1.52.0 0.0.0.255 destination 10.1.60.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.1.53.0 0.0.0.255 destination 10.1.60.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.1.54.0 0.0.0.255 destination 10.1.60.0 0.0.0.255
  rule permit ip <span class="hljs-built_in">source</span> 10.1.55.0 0.0.0.255 destination 10.1.60.0 0.0.0.255
<span class="hljs-comment"># 连接AC 的物理口,记住即可，无法配置 拟器不用敲</span>
interface g0/0/3 
  traffic-redirect inbound acl 3000 vpn-instance Employee ip-nexthop 10.1.200.22
<span class="hljs-comment">#</span>
acl number 3001
  rule permit tcp <span class="hljs-built_in">source</span> 10.1.60.101 0.0.0.0 source-port eq 80 destination any
interface GigabitEthernet 0/0/4
  traffic-redirect inbound acl 3001 ip-nexthop 10.1.200.5

<span class="hljs-comment">## X_T_Export1</span>
acl 2000
  udno rule 5
  rule permit <span class="hljs-built_in">source</span> 10.1.11.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.12.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.13.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.14.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.15.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.21.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.22.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.23.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.24.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.25.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.51.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.52.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.53.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.54.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.55.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.101.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.102.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.103.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.104.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.105.0 0.0.0.255
<span class="hljs-comment">## X_T_Export2</span>
acl 2000 
  rule permit <span class="hljs-built_in">source</span> 10.1.11.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.12.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.13.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.14.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.15.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.21.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.22.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.23.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.24.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.25.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.51.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.52.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.53.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.54.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.55.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.101.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.102.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.103.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.104.0 0.0.0.255
  rule permit <span class="hljs-built_in">source</span> 10.1.105.0 0.0.0.255
nat address-group 1 10.255.4.2 10.255.4.100 
interface GigabitEthernet 0/0/0
  nat outbound 2000
interface GigabitEthernet 0/0/2
  nat outbound 2000 address-group 1
  nat server protocol tcp global current-interface 8081 inside 10.1.60.101 wwww
acl number 3001
  rule permit tcp <span class="hljs-built_in">source</span> 10.1.60.101 0.0.0.0 source-port eq 80 destination any
traffic classifier web
  if-match acl 3001
traffic behavior web
  redirect ip-nexthop 10.255.4.254
traffic policy web
  classifier web behavior web
interface GigabitEthernet 0/0/1
  traffic-policy web inbound</code></pre>

<h3 id="7-测试"><a href="#7-测试" class="headerlink" title="7. 测试"></a>7. 测试</h3><pre><code class="hljs bash"><span class="hljs-comment"># X_T1_ACC2</span>
interface GigabitEthernet 0/0/1
  port hybrid untagged vlan 24
  port hybrid pvid vlan 24
<span class="hljs-comment"># X_T2_ACC1</span>
interface GigabitEthernet 0/0/1
  port hybrid untagged vlan 33
  port hybrid pvid vlan 33

<span class="hljs-comment"># 使用 STA 设备连接到T1 X_Guest010 WIFI</span>
ping 10.255.1.254
ping 10.1.60.99 [不通]

<span class="hljs-comment"># 使用 STA 设备连接到T2 X_Employee010 WIFI</span>
ping 10.255.1.254
ping 10.1.60.100

<span class="hljs-comment"># Terminal01测试</span>
ping 10.255.1.254
ping 10.1.60.100
ping 10.1.60.99

<span class="hljs-comment"># Terminal02测试</span>
ping 10.1.60.100
ping 10.255.1.254 [不通]

<span class="hljs-comment"># X_T1_AC</span>
interface GigabitEthernet 0/0/2
  port hybrid untagged vlan 103
  port hybrid pvid vlan 103

<span class="hljs-comment"># 60.99 模拟终端</span>
sys
  telnet server <span class="hljs-built_in">enable</span>
  telnet server port 3389

<span class="hljs-comment"># 模拟Guest</span>
telnet 10.1.60.99 3389</code></pre>

<hr>
<h2 id="Y园区：iMaster-NCE-Campus-SD-WAN-部署"><a href="#Y园区：iMaster-NCE-Campus-SD-WAN-部署" class="headerlink" title="Y园区：iMaster NCE-Campus SD-WAN 部署"></a>Y园区：iMaster NCE-Campus SD-WAN 部署</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>OSPF &#x2F; BGP 65003 &#x2F; VXLAN</p>
<h3 id="NCE-纳管设备"><a href="#NCE-纳管设备" class="headerlink" title="NCE 纳管设备"></a>NCE 纳管设备</h3><h4 id="0-环境信息"><a href="#0-环境信息" class="headerlink" title="0 - 环境信息"></a>0 - 环境信息</h4><pre><code class="hljs bash"><span class="hljs-comment"># 考试环境</span>
NCE-Web地址: 172.22.8.71/171
NCE-南向地址: 172.22.8.72/172

<span class="hljs-comment"># FZ-Rack</span>
NCE-Web地址: 172.22.8.71
NCE-南向地址: 172.22.8.72
快照地址(FC界面): 192.168.10.110

<span class="hljs-comment"># NJ-Rack</span>
NCE-Web地址: 172.22.8.70
NCE-南向地址: 172.22.8.71
快照地址(FC界面): 10.1.10.21

<span class="hljs-comment"># FZMN-Rack</span>
NCE-Web地址: 172.22.8.172

<span class="hljs-comment"># NJMN-Rack</span>
NCE-Web地址: 172.22.8.81
NCE-南向地址: 172.22.8.82
快照地址(FC界面): 192.168.130.22
user001/Huawei@123


<span class="hljs-comment"># 设备清空</span>
<span class="hljs-comment"># 路由器设备清空&gt; reset saved-configuration</span>
<span class="hljs-comment"># 路由器设备清空&gt; reboot fast</span>
<span class="hljs-comment"># 交换机设备清空# reset netconf db-configureation </span>
</code></pre>

<h4 id="1-切换-EVPN-网络隧道模式"><a href="#1-切换-EVPN-网络隧道模式" class="headerlink" title="1 - 切换 EVPN 网络隧道模式"></a>1 - 切换 EVPN 网络隧道模式</h4><blockquote>
<p>设计 &#x2F; 基础网络设计 &#x2F; 网络设置 &#x2F; 隧道模式 &#x2F; EVPN</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412072242664.png" alt="切换EVPN"></p>
<h4 id="2-关闭-物理网络-开局邮件加密"><a href="#2-关闭-物理网络-开局邮件加密" class="headerlink" title="2 - 关闭 物理网络 开局邮件加密"></a>2 - 关闭 物理网络 开局邮件加密</h4><blockquote>
<p>多分支互联 &#x2F; 全局配置 &#x2F; 物理网络 &#x2F; 设备激活安全配置 &#x2F; 加密使能</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412072310821.png" alt="多分支互联"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412072311085.png" alt="关闭加密使能"></p>
<h4 id="3-确定-BGP-AS-65003-IP地址池-10-99-0-0-16"><a href="#3-确定-BGP-AS-65003-IP地址池-10-99-0-0-16" class="headerlink" title="3 - 确定 BGP AS 65003 &amp; IP地址池 10.99.0.0&#x2F;16"></a>3 - 确定 BGP AS 65003 &amp; IP地址池 10.99.0.0&#x2F;16</h4><blockquote>
<p>多分支互联 &#x2F; 全局配置 &#x2F; 虚拟网络 &#x2F; 路由 &amp; IP地址池</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412072314337.png"></p>
<h4 id="4-创建-Site-Y-Site-Store1"><a href="#4-创建-Site-Y-Site-Store1" class="headerlink" title="4 - 创建 Site_Y &amp; Site_Store1"></a>4 - 创建 Site_Y &amp; Site_Store1</h4><blockquote>
<p>多分支互联 &#x2F; 站点设置 &#x2F; 创建 &#x2F; Site_Y 和 Store 站点</p>
</blockquote>
<blockquote>
<p>Site_Y&#x2F;Site_Store1: 勾选 AR &#x2F; LSW &#x2F; WAC </p>
</blockquote>
<blockquote>
<p>参数说明: WAC – 随绑&#x2F;带AC的交换机; AP – 云AP</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412072330132.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412072337235.png"></p>
<h4 id="5-添加设备"><a href="#5-添加设备" class="headerlink" title="5 - 添加设备"></a>5 - 添加设备</h4><blockquote>
<p>多分支互联 &#x2F; 设备管理 &#x2F; 添加设备 &#x2F; 批量导入 &#x2F; 选择对应的设备exce模版 &#x2F; 开始导入 &#x2F; 确定 </p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412072341966.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412072348298.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412081944889.png"></p>
<h4 id="6-创建-WAN链路模版"><a href="#6-创建-WAN链路模版" class="headerlink" title="6 - 创建 WAN链路模版"></a>6 - 创建 WAN链路模版</h4><blockquote>
<p>多分支互联 &#x2F; WAN链路模版</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102013430.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102015140.png"></p>
<h4 id="7-零配置开局-路由器托管配置-手动配置和自动配置"><a href="#7-零配置开局-路由器托管配置-手动配置和自动配置" class="headerlink" title="7 - 零配置开局 路由器托管配置(手动配置和自动配置)"></a>7 - 零配置开局 路由器托管配置(手动配置和自动配置)</h4><blockquote>
<p>多分支互联 &#x2F; 零配置开局 &#x2F; 点击开局 &#x2F; 站点 &#x2F; DHCP Option &#x2F; 模版导入 &#x2F; 配置地址 &#x2F; 接口编号 IP GW Mb&#x2F;s</p>
</blockquote>
<blockquote>
<p>多分支互联 &#x2F; WAN Underlay &#x2F; WALN路由（静态路由）</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102018682.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102020715.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102022854.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102026251.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102028881.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102030112.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102032745.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102034294.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102035767.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102037603.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102038464.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102040901.png"></p>
<blockquote>
<p>配置静态路由和NAT</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102044754.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102046134.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102048906.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102052530.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102053016.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102054984.png"></p>
<h4 id="8-站点间组网-RR反射器"><a href="#8-站点间组网-RR反射器" class="headerlink" title="8 - 站点间组网 RR反射器"></a>8 - 站点间组网 RR反射器</h4><p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102056687.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102058715.png"></p>
<h4 id="9-交换机托管配置-并部署-Management-VN"><a href="#9-交换机托管配置-并部署-Management-VN" class="headerlink" title="9 - 交换机托管配置 并部署 Management VN"></a>9 - 交换机托管配置 并部署 Management VN</h4><p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102059799.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102103238.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102104429.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102106086.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102108467.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102109553.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102112340.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102115336.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102117586.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102120939.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102122480.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102123930.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102126558.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102129475.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102131405.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102133799.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102135787.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102138841.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102139409.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412102140063.png"></p>
<p>91’ Y_Core -&gt; web -&gt; 配置 -&gt; 无线业务管理 -&gt; vlan 3996 -&gt; 应用</p>
<h4 id="10-纳管检查"><a href="#10-纳管检查" class="headerlink" title="10 - 纳管检查"></a>10 - 纳管检查</h4><h3 id="Fabric-池-资源网络"><a href="#Fabric-池-资源网络" class="headerlink" title="Fabric(池)资源网络"></a>Fabric(池)资源网络</h3><p>1 - Fabric网络规划</p>
<blockquote>
<p>配置IGP 协议的地址和VLAN 创建Radius服务 Rrotal认证服务器 802.1X认证模版</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412112030554.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412112032637.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412112034354.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412112036282.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412112037587.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412112039707.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412112041526.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412112043877.png"></p>
<p>3 - 创建Fabric网络</p>
<p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412112048179.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412112050027.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412112051232.png"></p>
<p>4 - 配置网络中的设备角色（边缘节点和边界网关节点）</p>
<p>5 - 添加DHCP服务器</p>
<p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122051422.png"></p>
<p>6 - 创建 OA&#x2F;R&amp;D 业务网络的L3独占外部接口</p>
<p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122054734.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122057959.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122058484.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122100497.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122101360.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122104394.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122106691.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122108089.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122110576.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122111108.png"></p>
<p>7 - 创建 Guest 业务三层出口</p>
<p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122113225.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122114236.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122116069.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122117638.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122120590.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122125912.png"></p>
<p>8 - 配置Y_AGG和Y_ACC的接入认证</p>
<p>9 - 执行点配置</p>
<p>10 - 创建LAN侧VN（地址池）</p>
<p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122127055.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122128166.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122129703.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122130512.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122131391.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122132992.png"></p>
<p>11 - 创建OA虚拟网络，分配地址和网关，添加有线认证部分</p>
<p><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122133617.png"><br><img src="https://cdn.jsdelivr.net/gh/hjxstart/PicGo@main/img/202412122134728.png"></p>
<p>12 - 创建RD虚拟网络，分配网段11-15和21-25</p>
<p>13 - 创建Guest虚拟网络</p>
<p>14 - 部署VN之间的互通</p>
<p>15 - 部署无线用户认证（组&#x2F;用户）及授权（密码）</p>
<p>16 - 创建优秀用户认证（组&#x2F;用户）及授权（密码）</p>
<p>17 - 创建安全组，资源组（IP&#x2F;掩码）</p>
<p>18 - 根据要求部署策略矩阵</p>
<p>19 - 部署准入认证</p>
<p>20 - 配置授权结果</p>
<p>21 - 绑定站点</p>
<p>22 - 创建有线用户的授权规则</p>
<p>23 - 创建无线用户的授权规则</p>
<p>24 - 部署无线网络</p>
<p>25 - 创建无线认证模版</p>
<p>26 - 交换机的WEB界面中国呢，新建两个SSID模版</p>
<p>27 - 创建 Guest&#x2F;Employee VAP模版，并调用SSID模版，选择安全模版</p>
<p>28 - 配置AP组，添加VAP模版</p>
<h4 id="1、规划资源池"><a href="#1、规划资源池" class="headerlink" title="1、规划资源池"></a>1、规划资源池</h4><h4 id="2、配置VXLAN组网方式"><a href="#2、配置VXLAN组网方式" class="headerlink" title="2、配置VXLAN组网方式"></a>2、配置VXLAN组网方式</h4><h4 id="3、配置DHCP服"><a href="#3、配置DHCP服" class="headerlink" title="3、配置DHCP服"></a>3、配置DHCP服</h4><h4 id="4、配置外部网络接口"><a href="#4、配置外部网络接口" class="headerlink" title="4、配置外部网络接口"></a>4、配置外部网络接口</h4><h4 id="5、配置外部网络接口"><a href="#5、配置外部网络接口" class="headerlink" title="5、配置外部网络接口"></a>5、配置外部网络接口</h4><h4 id="6、配置VN部署"><a href="#6、配置VN部署" class="headerlink" title="6、配置VN部署"></a>6、配置VN部署</h4><h4 id="7、配置VN之间互通"><a href="#7、配置VN之间互通" class="headerlink" title="7、配置VN之间互通"></a>7、配置VN之间互通</h4><h4 id="8、配置认证策略"><a href="#8、配置认证策略" class="headerlink" title="8、配置认证策略"></a>8、配置认证策略</h4><h4 id="9、配置授权规则-授权结果"><a href="#9、配置授权规则-授权结果" class="headerlink" title="9、配置授权规则&#x2F;授权结果"></a>9、配置授权规则&#x2F;授权结果</h4><h4 id="10、配置无线"><a href="#10、配置无线" class="headerlink" title="10、配置无线"></a>10、配置无线</h4><h3 id="SD-WAN"><a href="#SD-WAN" class="headerlink" title="SD-WAN"></a>SD-WAN</h3><h4 id="1、创建WAN侧VN（Y-OA-TO-Sites-Guest-To-Internet-OA-HUB-Spoke组网）"><a href="#1、创建WAN侧VN（Y-OA-TO-Sites-Guest-To-Internet-OA-HUB-Spoke组网）" class="headerlink" title="1、创建WAN侧VN（Y_OA_TO_Sites &#x2F; Guest_To_Internet &#x2F; OA HUB-Spoke组网）"></a>1、创建WAN侧VN（Y_OA_TO_Sites &#x2F; Guest_To_Internet &#x2F; OA HUB-Spoke组网）</h4><h4 id="2、LAN-WAN融合"><a href="#2、LAN-WAN融合" class="headerlink" title="2、LAN&#x2F;WAN融合"></a>2、LAN&#x2F;WAN融合</h4><h4 id="3、WAN组网"><a href="#3、WAN组网" class="headerlink" title="3、WAN组网"></a>3、WAN组网</h4><h4 id="4、Internet访问"><a href="#4、Internet访问" class="headerlink" title="4、Internet访问"></a>4、Internet访问</h4><h4 id="5、监控"><a href="#5、监控" class="headerlink" title="5、监控"></a>5、监控</h4><h4 id="6、订单业务流量做低延迟处理"><a href="#6、订单业务流量做低延迟处理" class="headerlink" title="6、订单业务流量做低延迟处理"></a>6、订单业务流量做低延迟处理</h4><h4 id="7、优化路由"><a href="#7、优化路由" class="headerlink" title="7、优化路由"></a>7、优化路由</h4><hr>
<h2 id="Z园区：广域网承载及设计"><a href="#Z园区：广域网承载及设计" class="headerlink" title="Z园区：广域网承载及设计"></a>Z园区：广域网承载及设计</h2><h3 id="1、全局ISIS配置-IGB打通"><a href="#1、全局ISIS配置-IGB打通" class="headerlink" title="1、全局ISIS配置(IGB打通)"></a>1、全局ISIS配置(IGB打通)</h3><pre><code class="hljs bash"><span class="hljs-comment"># X/Y/Z_PE1/2</span>
<span class="hljs-comment">#  network-entity 49.0001.00X0.0000.000X.00</span>
bfd
 quit
isis 1
 is-level level-2
 cost-style wide
 bfd all-interfaces <span class="hljs-built_in">enable</span>
 bfd all-interfaces min-tx-interval 500 min-rx-interval 500
 network-entity 49.0001.0010.0000.0001.00
 domain-authentication-mode md5 plain Huawei@123
 frr
  loop-free-alternate level-2 <span class="hljs-comment"># 循环-免费-备用</span>
  quit
 quit
int lo0
 isis <span class="hljs-built_in">enable</span> 1
interface GigabitEthernet0/0/0
 isis <span class="hljs-built_in">enable</span> 1
 isis circuit-type p2p <span class="hljs-comment"># 线路类型</span>
 isis ppp-negotiation 2-way <span class="hljs-comment"># ppp 协商</span>
 isis authentication-mode md5 plain Huawei@123
interface GigabitEthernet0/0/1
 isis <span class="hljs-built_in">enable</span> 1
 isis circuit-type p2p
 isis ppp-negotiation 2-way
 isis authentication-mode md5 plain Huawei@123
interface GigabitEthernet0/0/2
 isis <span class="hljs-built_in">enable</span> 1
 isis cost 4
 isis circuit-type p2p
 isis ppp-negotiation 2-way
 isis authentication-mode md5 plain Huawei@123
 quit
<span class="hljs-comment"># X_PEX 多开窗口</span>
dis isis peer <span class="hljs-comment"># 3个</span>
dis isis bfd session all <span class="hljs-comment"># 3个</span>
<span class="hljs-comment"># X_PE1</span>
dis ip routing-table 5.0.0.5 verbose
int GigabitEthernet 0/0/1
 shutdown
 tracert -a 1.0.0.1 5.0.0.5
 undo shutdown
 quit</code></pre>

<h3 id="2、-全局MPLS配置"><a href="#2、-全局MPLS配置" class="headerlink" title="2、 全局MPLS配置"></a>2、 全局MPLS配置</h3><pre><code class="hljs bash"><span class="hljs-comment"># X/Y/Z_PE1/2</span>
<span class="hljs-comment"># mpls lsr-id X.0.0.X</span>
bfd
 mpls-passive
 quit
mpls lsr-id 1.0.0.1
mpls
 mpls bfd <span class="hljs-built_in">enable</span>
 mpls bfd-trigger host
 mpls bfd min-tx-interval 500 min-rx-interval 500
 quit
mpls ldp
 quit
interface GigabitEthernet0/0/0
 mpls
 mpls ldp
 mpls mtu 1382
 isis ldp-sync
interface GigabitEthernet0/0/1
 mpls
 mpls ldp
 mpls mtu 1382
 isis ldp-sync
interface GigabitEthernet0/0/2
 mpls
 mpls ldp
 mpls mtu 1382
 isis ldp-sync
 quit
<span class="hljs-comment"># 检查</span>
dis mpls ldp peer <span class="hljs-comment"># 3个</span>
dis mpls bfd session <span class="hljs-comment"># 7个</span>
display bfd session all <span class="hljs-comment"># 17个</span>
dis isis ldp-sync interface <span class="hljs-comment"># 3个</span></code></pre>

<h3 id="3、-BGP-65000-group-IBGP-vpnv4配置"><a href="#3、-BGP-65000-group-IBGP-vpnv4配置" class="headerlink" title="3、 BGP 65000 &#x2F; group IBGP &#x2F; vpnv4配置"></a>3、 BGP 65000 &#x2F; group IBGP &#x2F; vpnv4配置</h3><pre><code class="hljs bash"><span class="hljs-comment"># X_PE1/2</span>
<span class="hljs-comment"># router-id 2.0.0.2</span>
<span class="hljs-comment"># peer 2.0.0.2 as-number 65000</span>
<span class="hljs-comment"># peer 2.0.0.2 group IBGP</span>
<span class="hljs-comment"># peer 2.0.0.2 enable</span>
bgp 65000
 router-id 1.0.0.1
 undo default ipv4-unicast <span class="hljs-comment"># 配置BGP对等体默认不在任何地址族下使能</span>
 group IBGP internal <span class="hljs-comment"># 创建IBGP对等体组</span>
 peer IBGP connect-interface Loopback 0 <span class="hljs-comment"># 使用loopback0接口建立BGP邻居关系</span>
 peer IBGP bfd min-rx-interval 500 min-tx-interval 500
 peer IBGP bfd <span class="hljs-built_in">enable</span>
 peer IBGP password cipher Huawei@123
 peer 2.0.0.2 as-number 65000
 peer 2.0.0.2 group IBGP
 peer 3.0.0.3 as-number 65000
 peer 3.0.0.3 group IBGP
 peer 4.0.0.4 as-number 65000
 peer 4.0.0.4 group IBGP
 peer 4.0.0.4 as-number 65000
 peer 5.0.0.5 group IBGP
 peer 5.0.0.5 as-number 65000
 peer 6.0.0.6 group IBGP
 ipv4-family vpnv4
  undo policy vpn-target <span class="hljs-comment"># (RR)用来取消对接收的VPN路由或者标签块进行VPN-Target过滤的,保证所有的VPN路由或者标签块都能被接收和处理。</span>
  reflector cluster-id 65000 <span class="hljs-comment"># 配置反射器集群ID，所有RR配置相同，建议使用AS号作为集群ID</span>
  peer 2.0.0.2 <span class="hljs-built_in">enable</span>
  peer 3.0.0.3 <span class="hljs-built_in">enable</span>
  peer 3.0.0.3 reflect-client <span class="hljs-comment"># 本机作为路由反射器，并将指定的对等体（组）作为路由反射器的客户。</span>
  peer 4.0.0.4 <span class="hljs-built_in">enable</span>
  peer 4.0.0.4 reflect-client
  peer 5.0.0.5 <span class="hljs-built_in">enable</span>
  peer 5.0.0.5 reflect-client
  peer 6.0.0.6 <span class="hljs-built_in">enable</span>
  peer 6.0.0.6 reflect-client
  quit
 quit
<span class="hljs-comment"># Y/Z_PE1/2</span>
<span class="hljs-comment"># router-id X.0.0.X # 3,4,5,6</span>
bgp 65000
 router-id 3.0.0.3
 undo default ipv4-unicast
 peer 1.0.0.1 as-number 65000
 peer 1.0.0.1 connect-interface LoopBack0
 peer 1.0.0.1 bfd <span class="hljs-built_in">enable</span>
 peer 1.0.0.1 bfd min-tx-interval 500 min-rx-interval 500
 peer 1.0.0.1 password cipher Huawei@123
 peer 2.0.0.2 as-number 65000
 peer 2.0.0.2 connect-interface LoopBack0
 peer 2.0.0.2 bfd <span class="hljs-built_in">enable</span>
 peer 2.0.0.2 bfd min-tx-interval 500 min-rx-interval 500
 peer 2.0.0.2 password cipher Huawei@123
 <span class="hljs-comment">#</span>
 ipv4-family vpnv4
  peer 1.0.0.1 <span class="hljs-built_in">enable</span>
  peer 2.0.0.2 <span class="hljs-built_in">enable</span>
  quit
<span class="hljs-comment"># 检查</span>
dis bgp vpnv4 all peer <span class="hljs-comment"># X5个 Y2个 Z2个</span>
dis bgp bfd session all <span class="hljs-comment"># X5个 </span></code></pre>

<h3 id="4、-65000-65001-VPN-Instance-IP-BGP"><a href="#4、-65000-65001-VPN-Instance-IP-BGP" class="headerlink" title="4、 [65000, 65001] VPN-Instance&#x2F;IP&#x2F;BGP"></a>4、 [65000, 65001] VPN-Instance&#x2F;IP&#x2F;BGP</h3><pre><code class="hljs bash"><span class="hljs-comment">## X_PE1/2</span>
<span class="hljs-comment"># vpn-instance</span>
<span class="hljs-comment">#  route-distinguisher 65001:2</span>
ip vpn-instance OA
 ipv4-family
  route-distinguisher 65001:1 <span class="hljs-comment"># 配置VPN实例IPv4地址族的RD</span>
  vpn-target 1:1 export-extcommunity <span class="hljs-comment"># 必须将对方的export-extcommunity的VPN Target值配置为自己的import-extcommunity的VPN Target值</span>
  vpn-target 2:2 import-extcommunity
  quit
 quit
<span class="hljs-comment"># ip binding vpn-instance</span>
<span class="hljs-comment">#   ip address 10.20.1.10 30</span>
dis ip int brief
interface GigabitEthernet2/0/0
 ip binding vpn-instance OA
 ip address 10.20.1.2 30
 quit
<span class="hljs-comment"># BGP绑定VPN-instance</span>
<span class="hljs-comment">#   peer 10.20.1.9 as-number 65001</span>
bgp 65000
 ipv4-family vpn-instance OA
  peer 10.20.1.1 as-number 65001
  quit
 quit

<span class="hljs-comment">## X_T1_Export1</span>
<span class="hljs-comment"># ip</span>
<span class="hljs-comment">#  ip address 10.20.1.9 30</span>
<span class="hljs-comment">#  ip address 10.20.1.6 30</span>
interface GigabitEthernet2/0/0
 ip address 10.20.1.1 30
interface GigabitEthernet2/0/1
 ip address 10.20.1.5 30
 quit
ping 10.20.1.2
<span class="hljs-comment"># BGP</span>
<span class="hljs-comment">#  router-id 10.1.0.2</span>
<span class="hljs-comment">#  peer 10.20.1.10 as-number 65000</span>
bgp 65001
 router-id 10.1.0.1
 dis ip int brief
 peer 10.20.1.2 as-number 65000
 quit</code></pre>

<h3 id="5、-65000-65003-VPN-Instance-IP-BGP"><a href="#5、-65000-65003-VPN-Instance-IP-BGP" class="headerlink" title="5、 [65000, 65003] VPN-Instance&#x2F;IP&#x2F;BGP"></a>5、 [65000, 65003] VPN-Instance&#x2F;IP&#x2F;BGP</h3><pre><code class="hljs bash"><span class="hljs-comment">## Y_PE1/2</span>
<span class="hljs-comment"># VPN-Instance</span>
<span class="hljs-comment">#  route-distinguisher 65003:2</span>
<span class="hljs-comment">#  route-distinguisher 65003:4</span>
ip vpn-instance OA
 ipv4-family
  route-distinguisher 65003:1
  vpn-target 1:1 export-extcommunity
  vpn-target 2:2 import-extcommunity
  quit
 quit
ip vpn-instance R&amp;D
 ipv4-family
  route-distinguisher 65003:3
  vpn-target 3:3 export-extcommunity
  vpn-target 4:4 import-extcommunity
  quit
 quit
<span class="hljs-comment"># IP binding vpn-instance</span>
<span class="hljs-comment">#  ip address 10.20.2.10 30</span>
<span class="hljs-comment">#  ip address 10.20.2.14 30</span>
interface GigabitEthernet2/0/0.10
 dot1q termination vid 10 <span class="hljs-comment"># 开启识别802.1Q数据帧，同时将子接口划分给相应的vlan</span>
 ip binding vpn-instance OA
 ip address 10.20.2.2 30
 arp broadcast <span class="hljs-built_in">enable</span>
interface GigabitEthernet2/0/0.20
 dot1q termination vid 20
 ip binding vpn-instance R&amp;D
 ip address 10.20.2.6 30
 arp broadcast <span class="hljs-built_in">enable</span>
 quit
<span class="hljs-comment"># BGP绑定VPN-instance</span>
<span class="hljs-comment">#  peer 10.20.2.9 as-number 65003</span>
<span class="hljs-comment">#  peer 10.20.2.13 as-number 65003</span>
bgp 65000
 ipv4-family vpn-instance OA
  peer 10.20.2.1 as-number 65003
 ipv4-family vpn-instance R&amp;D
  peer 10.20.2.5 as-number 65003
  quit
 quit

<span class="hljs-comment">## Y_Export1</span>
<span class="hljs-comment"># ip binding vpn-instance</span>
<span class="hljs-comment">#  interface GigabitEthernet2/0/1.10</span>
<span class="hljs-comment">#   ip address 10.20.2.9 30</span>
<span class="hljs-comment">#  interface GigabitEthernet2/0/1.20</span>
<span class="hljs-comment">#   ip address 10.20.2.13 30</span>
interface GigabitEthernet2/0/0.10
 dot1q termination vid 10
 ip binding vpn-instance vpn2
 ip address 10.20.2.1 30
 arp broadcast <span class="hljs-built_in">enable</span>
interface GigabitEthernet2/0/0.20
 dot1q termination vid 20
 ip binding vpn-instance vpn3
 ip address 10.20.2.5 30
 arp broadcast <span class="hljs-built_in">enable</span>
 quit
<span class="hljs-comment"># BGP绑定VPN-instance</span>
bgp 65003
 ipv4-family vpn-instance vpn2
  peer 10.20.2.2 as-number 65000
  peer 10.20.2.2 ip-prefix deny_default <span class="hljs-built_in">export</span>
  peer 10.20.2.10 as-number 65000
  peer 10.20.2.10 ip-prefix deny_default <span class="hljs-built_in">export</span> 
 ipv4-family vpn-instance vpn3
  peer 10.20.2.6 as-number 65000
  peer 10.20.2.14 as-number 65000
  quit
 quit</code></pre>

<h3 id="6、-65000-65004-VPN-Instance-IP-BGP"><a href="#6、-65000-65004-VPN-Instance-IP-BGP" class="headerlink" title="6、 [65000, 65004] VPN-Instance&#x2F;IP&#x2F;BGP"></a>6、 [65000, 65004] VPN-Instance&#x2F;IP&#x2F;BGP</h3><pre><code class="hljs bash"><span class="hljs-comment">## Z_PE1/2</span>
<span class="hljs-comment"># vpn-instance</span>
<span class="hljs-comment">#  route-distinguisher 65004:3</span>
<span class="hljs-comment">#  route-distinguisher 65004:4</span>
<span class="hljs-comment">#  route-distinguisher 65004:6</span>
ip vpn-instance OA_In
 ipv4-family
  route-distinguisher 65004:1
  vpn-target 1:1 import-extcommunity
ip vpn-instance OA_Out
 ipv4-family
  route-distinguisher 65004:2
  vpn-target 2:2 export-extcommunity
ip vpn-instance R&amp;D
 ipv4-family
  route-distinguisher 65004:5
  vpn-target 3:3 import-extcommunity
  vpn-target 4:4 export-extcommunity
  quit
 quit
<span class="hljs-comment">#</span>
dis bgp vpnv4 all peer <span class="hljs-comment"># Y=4</span>
<span class="hljs-comment"># ip binding vpn-instance</span>
<span class="hljs-comment">#  ip add 10.20.3.14 30</span>
<span class="hljs-comment">#  ip add 10.20.3.18 30</span>
<span class="hljs-comment">#  ip add 10.20.3.22 30</span>
int g 2/0/0.10
 dot1q termination vid 10
 ip binding vpn-instance OA_In
 ip add 10.20.3.2 30
 arp broadcast <span class="hljs-built_in">enable</span>
int g 2/0/0.11
 dot1q termination vid 11
 ip binding vpn-instance OA_Out
 ip add 10.20.3.6 30
 arp broadcast <span class="hljs-built_in">enable</span>
int g 2/0/0.20
 dot1q termination vid 20
 ip binding vpn-instance R&amp;D
 ip add 10.20.3.10 30
 arp broadcast <span class="hljs-built_in">enable</span>
 quit
<span class="hljs-comment"># BGP绑定VPN-instance</span>
<span class="hljs-comment">#  peer 10.20.3.13 as-number 65004</span>
<span class="hljs-comment">#  peer 10.20.3.17 as-number 65004</span>
<span class="hljs-comment">#  peer 10.20.3.21 as-number 65004</span>
bgp 65000
 ipv4-family vpn-instance OA_In
  peer 10.20.3.1 as-number 65004
 ipv4-family vpn-instance OA_Out
  peer 10.20.3.5 as-number 65004
  peer 10.20.3.5 allow-as-loop
 ipv4-family vpn-instance R&amp;D
  peer 10.20.3.9 as-number 65004
  quit
 quit

<span class="hljs-comment">## Z_Export1</span>
<span class="hljs-comment"># vpn-instance</span>
ip vpn-instance OA
 route-distinguisher 65004:10
  quit
ip vpn-instance R&amp;D
 route-distinguisher 65004:20
  quit
<span class="hljs-comment">#</span>
int lo0
 ip binding vpn-instance OA
 ip add 10.3.101.254 24
int lo1
 ip binding vpn-instance R&amp;D
 ip add 10.3.99.254 24
int lo2
 ip binding vpn-instance R&amp;D
 ip add 10.3.100.254 24
 quit
<span class="hljs-comment"># ip binding vpn-instance</span>
<span class="hljs-comment">#  int g 0/0/1.10</span>
<span class="hljs-comment">#   ip add 10.20.3.13 30</span>
<span class="hljs-comment">#  int g 0/0/1.11</span>
<span class="hljs-comment">#   ip add 10.20.3.17 30</span>
<span class="hljs-comment">#  int g 0/0/1.20</span>
<span class="hljs-comment">#   ip add 10.20.3.21 30</span>
int g 0/0/0.10
 dot1q termination vid 10
 ip binding vpn-instance OA
 ip add 10.20.3.1 30
 arp broadcast <span class="hljs-built_in">enable</span>
int g 0/0/0.11
 dot1q termination vid 11
 ip binding vpn-instance OA
 ip add 10.20.3.5 30
 arp broadcast <span class="hljs-built_in">enable</span>
int g 0/0/0.20
 dot1q termination vid 20
 ip binding vpn-instance R&amp;D
 ip add 10.20.3.9 30
 arp broadcast <span class="hljs-built_in">enable</span>
 quit
dis ip int brief
<span class="hljs-comment"># BGP绑定VPN-Instance</span>
bgp 65004
 router-id 10.3.99.254
 undo default ipv4-unicast
 ipv4-family vpn-instance OA
  peer 10.20.3.2 as-number 65000
  peer 10.20.3.6 as-number 65000
  peer 10.20.3.14 as-number 65000
  peer 10.20.3.18 as-number 65000
 ipv4-family vpn-instance R&amp;D
  peer 10.20.3.10 as-number 65000
  peer 10.20.3.22 as-number 65000
  quit
 quit
<span class="hljs-comment"># to-do</span>
bgp 65004
 ipv4-family vpn-instance OA
  network 10.3.101.0 24
  quit
 ipv4-family vpn-instance R&amp;D
  network 10.3.99.0 24
  network 10.3.100.0 24
  quit
 quit</code></pre>

<h3 id="7、配置PE-BGP-export-route-policy"><a href="#7、配置PE-BGP-export-route-policy" class="headerlink" title="7、配置PE BGP export route-policy"></a>7、配置PE BGP export route-policy</h3><pre><code class="hljs bash"><span class="hljs-comment">## X_PE1 oa主路径</span>
route-policy oa_med permit node 10
 apply cost-type internal <span class="hljs-comment"># 继承</span>
 quit
<span class="hljs-comment">#</span>
bgp 65000
 ipv4-family vpn-instance OA
  dis this
  peer 10.20.1.1 route-policy oa_med <span class="hljs-built_in">export</span>
  quit
 quit
<span class="hljs-comment">## X_PE2 oa备用路径</span>
route-policy oa_med permit node 10
 apply cost 12
 quit
<span class="hljs-comment">#</span>
bgp 65000
 ipv4-family vpn-instance OA
  dis this
  peer 10.20.1.9 route-policy oa_med <span class="hljs-built_in">export</span>
  quit
 quit
<span class="hljs-comment">## Y_PE1 oa主路径，rd备路径</span>
route-policy oa_med permit node 10
 apply cost-type internal
 quit
route-policy rd_med permit node 10
 apply cost 12
 quit
<span class="hljs-comment">#</span>
bgp 65000
 ipv4-family vpn-instance OA
  dis this
  peer 10.20.2.1 route-policy oa_med <span class="hljs-built_in">export</span>
  quit
 ipv4-family vpn-instance R&amp;D
  dis this
  peer 10.20.2.5 route-policy rd_med <span class="hljs-built_in">export</span>
  quit
 quit
<span class="hljs-comment">## Y_PE2 oa备路径，rd主路径</span>
route-policy oa_med permit node 10
 apply cost 12
 quit
route-policy rd_med permit node 10
 apply cost-type internal
 quit
<span class="hljs-comment">#</span>
bgp 65000
 ipv4-family vpn-instance OA
  dis this
  peer 10.20.2.9 route-policy oa_med <span class="hljs-built_in">export</span>
  quit
 ipv4-family vpn-instance R&amp;D
  dis this
  peer 10.20.2.13 route-policy rd_med <span class="hljs-built_in">export</span>
  quit
 quit
<span class="hljs-comment">## Z_PE1 oa主路径，rd备路径</span>
route-policy oa_med permit node 10
 apply cost-type internal
 quit
route-policy rd_med permit node 10
 apply cost 12
 quit
<span class="hljs-comment">#</span>
bgp 65000
 ipv4-family vpn-instance OA_In
  dis this
  peer 10.20.3.1 route-policy oa_med <span class="hljs-built_in">export</span>
  quit
 ipv4-family vpn-instance R&amp;D
  dis this
  peer 10.20.3.9 route-policy rd_med <span class="hljs-built_in">export</span>
  quit
 quit
<span class="hljs-comment">## Z_PE2 oa备路径，rd主路径</span>
route-policy oa_med permit node 10
 apply cost 12
 quit
route-policy rd_med permit node 10
 apply cost-type internal
 quit
<span class="hljs-comment">#</span>
bgp 65000
 ipv4-family vpn-instance OA_In
  dis this
  peer 10.20.3.13 route-policy oa_med <span class="hljs-built_in">export</span>
  quit
 ipv4-family vpn-instance R&amp;D
  dis this
  peer 10.20.3.21 route-policy rd_med <span class="hljs-built_in">export</span>
  quit
 quit

<span class="hljs-comment"># 检查</span>
<span class="hljs-comment">## Z_Export1</span>
dis bgp vpnv4 all peer <span class="hljs-comment"># 6</span>
<span class="hljs-comment">## X_T_Export1/2</span>
dis bgp routing-table <span class="hljs-comment"># 21</span>
<span class="hljs-comment">## Y_Export1</span>
dis ip routing-table vpn-instance vpn2 <span class="hljs-comment"># 64 63</span>
dis bgp vpnv4 vpn-instance vpn2 routing-table <span class="hljs-comment"># 42</span>
dis bgp vpnv4 vpn-instance vpn3 routing-table <span class="hljs-comment"># 30 -------to do</span>
<span class="hljs-comment">## Z_Export1</span>
dis bgp vpnv4 vpn-instance OA routing-table <span class="hljs-comment"># 41</span>
dis bgp vpnv4 vpn-instance R&amp;D routing-table <span class="hljs-comment"># 28</span>
<span class="hljs-comment">## Z_PE1</span>
dis bgp vpnv4 vpn-instance OA_In routing-table <span class="hljs-comment"># 41 --- to do 21</span>
dis bgp vpnv4 vpn-instance OA_Out routing-table <span class="hljs-comment"># 21</span></code></pre>

<h3 id="8、Y过滤路由-X双点双路路由重发布"><a href="#8、Y过滤路由-X双点双路路由重发布" class="headerlink" title="8、Y过滤路由,X双点双路路由重发布"></a>8、Y过滤路由,X双点双路路由重发布</h3><pre><code class="hljs bash"><span class="hljs-comment">## Y_Export1 ----- to do</span>
ip ip-prefix deny_Default deny 0.0.0.0 0
ip ip-prefix deny_Default permit 0.0.0.0 0 less-equal 32
bgp 65003
 ipv4-family vpn-instance vpn2
  dis this
  peer 10.20.2.2 ip-prefix deny_Default <span class="hljs-built_in">export</span>
  peer 10.20.2.10 ip-prefix deny_Default <span class="hljs-built_in">export</span>
  quit
 quit
<span class="hljs-comment">## Y_Export1</span>
dis cur int lo 1
ip ip-prefix OA permit 10.2.0.0 16 greater-equal 24 less-equal 24 
ip ip-prefix OA permit 10.100.2.0 24
dis cur int lo 2
ip ip-prefix R&amp;D permit 10.2.0.0 16 greater-equal 24 less-equal 24
ip ip-prefix R&amp;D permit 10.100.3.0 24
bgp 65003
 ipv4-family vpn-instance vpn2
  dis this
  peer 10.20.2.2 ip-prefix OA <span class="hljs-built_in">export</span>
  peer 10.20.2.10 ip-prefix OA <span class="hljs-built_in">export</span>
 ipv4-family vpn-instance vpn3
  dis this
  peer 10.20.2.6 ip-prefix R&amp;D <span class="hljs-built_in">export</span>
  peer 10.20.2.14 ip-prefix R&amp;D <span class="hljs-built_in">export</span>
  quit
 quit
  
<span class="hljs-comment">## X_T_Export1</span>
acl 2001
 rule permit <span class="hljs-built_in">source</span> 10.1.11.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.12.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.13.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.14.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.15.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.21.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.22.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.23.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.24.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.25.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.31.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.32.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.33.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.34.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.35.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.41.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.42.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.43.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.44.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.45.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.51.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.52.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.53.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.54.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.55.0 0.0.0.255
 quit
route-policy b2o permit node 10
 apply tag 10
 quit
route-policy o2b deny node 10
 if-match tag 20
 quit
route-policy o2b permit node 20
 if-match acl 2001
 quit
dis cur config route-policy
<span class="hljs-comment">#</span>
ospf 1
 import-route bgp route-policy b2o
 default cost inherit-metric
 quit
bgp 65001
 preference 120 255 255
 import-route ospf 1 route-policy o2b
 network 10.20.1.4 30
 quit


<span class="hljs-comment">## X_T_Export2</span>
acl 2001
 rule permit <span class="hljs-built_in">source</span> 10.1.11.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.12.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.13.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.14.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.15.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.21.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.22.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.23.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.24.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.25.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.31.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.32.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.33.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.34.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.35.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.41.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.42.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.43.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.44.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.45.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.51.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.52.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.53.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.54.0 0.0.0.255
 rule permit <span class="hljs-built_in">source</span> 10.1.55.0 0.0.0.255
 quit
route-policy b2o permit node 10
 apply tag 20
 quit
route-policy o2b deny node 10
 if-match tag 10
 quit
route-policy o2b permit node 20
 if-match acl 2001
 quit
<span class="hljs-comment">#</span>
ospf 1
 import-route bgp route-policy b2o
 default cost inherit-metric
 quit
bgp 65001
 preference 120 255 255
 import-route ospf 1 route-policy o2b
 quit
dis ip routing-table 10.2.31.0
dis ip routing-table 10.2.51.0
dis ip routing-table protocol ospf  <span class="hljs-comment"># 70 49 21</span>
<span class="hljs-comment">## X_PE1</span>
dis ip routing-table vpn-instance OA <span class="hljs-comment"># 51</span>
dis bgp vpnv4 vpn-instance OA routing-table <span class="hljs-comment"># 120</span>
<span class="hljs-comment">## X_PE1</span>
dis bgp vpnv4 vpn-instance OA routing-table <span class="hljs-comment"># 112</span>
<span class="hljs-comment">## X_T1_CORE</span>
dis ip routing-table protocol ospf <span class="hljs-comment"># 67</span>
<span class="hljs-comment">## Y_PE1</span>
dis ip routing-table vpn-instance OA 10.3.101.0 verbose</code></pre>

<h3 id="9、VPN-FRR与-MPLS-MTU"><a href="#9、VPN-FRR与-MPLS-MTU" class="headerlink" title="9、VPN FRR与 MPLS MTU"></a>9、VPN FRR与 MPLS MTU</h3><pre><code class="hljs bash"><span class="hljs-comment">## X/Y_PE1</span>
route-policy vpnfrr permit node 10
 apply backup-interface g 0/0/2 
 apply backup-nexthop 6.0.0.6
 quit
ip vpn-instance OA
 vpn frr route-policy vpnfrr
 quit
<span class="hljs-comment"># X_PE1</span>
dis ip routing-table vpn-instance OA 10.2.31.0 verbose
<span class="hljs-comment"># Y_PE1</span>
dis ip routing-table vpn-instance OA 10.3.101.0 verbose</code></pre>

<h3 id="10、QOS-FW-Test"><a href="#10、QOS-FW-Test" class="headerlink" title="10、QOS &amp; FW &amp; Test"></a>10、QOS &amp; FW &amp; Test</h3><pre><code class="hljs bash"><span class="hljs-comment">## Y_Export1</span>
acl number 3001
 rule permit ip <span class="hljs-built_in">source</span> 10.2.11.0 0.0.0.255
 rule permit ip <span class="hljs-built_in">source</span> 10.2.12.0 0.0.0.255
 rule permit ip <span class="hljs-built_in">source</span> 10.2.13.0 0.0.0.255
 rule permit ip <span class="hljs-built_in">source</span> 10.2.14.0 0.0.0.255
 rule permit ip <span class="hljs-built_in">source</span> 10.2.15.0 0.0.0.255
 description discover
 quit
acl number 3002
 rule permit ip <span class="hljs-built_in">source</span> 10.2.21.0 0.0.0.255
 rule permit ip <span class="hljs-built_in">source</span> 10.2.22.0 0.0.0.255
 rule permit ip <span class="hljs-built_in">source</span> 10.2.23.0 0.0.0.255
 rule permit ip <span class="hljs-built_in">source</span> 10.2.24.0 0.0.0.255
 rule permit ip <span class="hljs-built_in">source</span> 10.2.25.0 0.0.0.255
 quit
traffic classifier discover
 if-match acl 3001
 quit
traffic behavior discover
 remark dscp af41
 queue af bandwidth 300000
 quit
traffic classifier product
 if-match acl 3002
 quit
traffic behavior product
 remark dscp ef
 queue llq bandwidth 100000
 quit
traffic policy R&amp;D
 classifier discover behavior discover
 classifier product behavior product
 quit
int g 2/0/0.20
 dis this
 traffic-policy R&amp;D outbound
int g 2/0/1.20
 dis this
 traffic-policy R&amp;D outbound

<span class="hljs-comment">## Y/Z_PE1/2</span>
drop-profile discover
 wred dscp
 dscp af41 low-limit 50 high-limit 90 discard-percentage 50
traffic classifier discover
 if-match dscp af41
 quit
traffic behavior discover
 queue af bandwidth 300000
 drop-profile discover
 quit
traffic classifier product
 if-match dscp ef
 quit
traffic behavior product
 queue llq bandwidth 100000 cbs 2500000
 quit
traffic policy R&amp;D
 classifier discover behavior discover
 classifier product behavior product
 quit
int g 0/0/0
 traffic-policy R&amp;D outbound
int g 0/0/1
 traffic-policy R&amp;D outbound
int g 0/0/2
 traffic-policy R&amp;D outbound
 quit

<span class="hljs-comment">## Z_PE1/2</span>
int g 2/0/0.20
 traffic-policy R&amp;D outbound
 quit


<span class="hljs-comment">## X_T_FW</span>
switch vsys Employee
 sys
 ip address-set X <span class="hljs-built_in">type</span> object
  add range 10.1.11.0 10.1.15.255
  add range 10.1.21.0 10.1.25.255
  add range 10.1.31.0 10.1.35.255
  add range 10.1.41.0 10.1.45.255
  add range 10.1.51.0 10.1.55.255
  quit
ip address-set Y <span class="hljs-built_in">type</span> object
  add range 10.2.31.0 10.2.35.255
  add range 10.2.41.0 10.2.45.255
  add range 10.2.51.0 10.2.55.255
  quit
ip address-set Z&amp;Store <span class="hljs-built_in">type</span> object
  add range 10.2.101.0 10.3.101.255
  add range 10.100.2.0 10.100.2.255
  quit
security-policy
 rule name X_Y&amp;Z&amp;Store
  source-zone trust
  destination-zone untrust
  source-address address-set X
  destination-address address-set Y
  destination-address address-set Z&amp;Store
  action permit
 rule name Y&amp;Z&amp;Store_X
  source-zone untrust
  destination-zone trust
  source-address address-set Y
  source-address address-set Z&amp;Store
  destination-address address-set X
  action permit
 rule name Employee_Internet bottom

<span class="hljs-comment">## X_T_Export1</span>
tracert  -a 10.20.1.5 10.100.2.1
<span class="hljs-comment">## Y_Export1</span>
ping -vpn-instance vpn3 -a 10.100.3.1 10.3.99.254
<span class="hljs-comment">## </span>
<span class="hljs-built_in">return</span>
 save
 Y</code></pre>

<hr>
<h2 id="Python网络自动化"><a href="#Python网络自动化" class="headerlink" title="Python网络自动化"></a>Python网络自动化</h2><h3 id="1、前5个需求"><a href="#1、前5个需求" class="headerlink" title="1、前5个需求"></a>1、前5个需求</h3><pre><code class="hljs bash">1. 5min读取一下 X_T1_AGG1上的关键信息： 电源，风扇，LACP状态，CUP和内存使用率，OSPF邻居状态；
2. PC1-X_T1_AGG1之间采用安全的通道进行连接；
3. 读取风扇信息，如果两个风扇为Nor（坏掉的意思），则输出“All fans are faultly”；
4. 所有监控命令不能固定在代码里面，需要防止文件里面，通过调用文件的方式进行；
5. 每24小时自动保存设备的配置文件并备份到本地，并通过安全的传输协议存在本地设备，以【当天日期_设备名字.后续】的名称命名设备端以及本地的配置文件。举例：2022_2_14_X_T2_AGG1.zip 2022_2_14_X_T2_AGG1.bak</code></pre>

<h3 id="2、创建“command-txt”文件，完成1和4需求"><a href="#2、创建“command-txt”文件，完成1和4需求" class="headerlink" title="2、创建“command.txt”文件，完成1和4需求"></a>2、创建“command.txt”文件，完成1和4需求</h3><pre><code class="hljs gams"><span class="hljs-keyword">display</span> <span class="hljs-built_in">power</span>
<span class="hljs-keyword">display</span> fan
<span class="hljs-keyword">display</span> lacp brief
<span class="hljs-keyword">display</span> cpu history <span class="hljs-number">1</span>hour
<span class="hljs-keyword">display</span> memory-usage
<span class="hljs-keyword">display</span> ospf peer brief</code></pre>

<h3 id="3、相关需求的Python程序"><a href="#3、相关需求的Python程序" class="headerlink" title="3、相关需求的Python程序"></a>3、相关需求的Python程序</h3><pre><code class="hljs py"><span class="hljs-keyword">from</span> paramiko <span class="hljs-keyword">import</span> SSHClient,AutoAddPolicy
<span class="hljs-keyword">from</span> ncclient <span class="hljs-keyword">import</span> manager
<span class="hljs-keyword">from</span> ncclient.xml_ <span class="hljs-keyword">import</span> to_ele
<span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> sleep
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime,timedelta


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Datacom</span>:

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,server,username,password</span>):

        <span class="hljs-variable language_">self</span>.server=server
        <span class="hljs-variable language_">self</span>.username=username
        <span class="hljs-variable language_">self</span>.password=password
        <span class="hljs-variable language_">self</span>.client=<span class="hljs-variable language_">self</span>._get_client()
        <span class="hljs-variable language_">self</span>.cli=<span class="hljs-variable language_">self</span>.client.invoke_shell()
        <span class="hljs-variable language_">self</span>.cli.send(<span class="hljs-string">&#x27;screen-length 0 temporary\n&#x27;</span>)
        sleep(<span class="hljs-number">6</span>)
        <span class="hljs-variable language_">self</span>.cli.recv(<span class="hljs-number">9999</span>)

    <span class="hljs-comment"># 创建一个SSH连接客户端</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_client</span>(<span class="hljs-params">self</span>):
        client=SSHClient() <span class="hljs-comment"># SSH客户端工具进行实例化</span>
        client.load_system_host_keys() <span class="hljs-comment"># 加载SSH的主机公钥</span>
        client.set_missing_host_key_policy(AutoAddPolicy) <span class="hljs-comment"># 当本地设备没有公钥时自动保存交换机的SSH公钥</span>
        client.connect(<span class="hljs-variable language_">self</span>.server,username=<span class="hljs-variable language_">self</span>.username,password=<span class="hljs-variable language_">self</span>.password) <span class="hljs-comment"># 使用地址，账号和密码进行SSH连接</span>
        <span class="hljs-keyword">return</span> client

    <span class="hljs-comment"># 发送命令的方法</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">command</span>(<span class="hljs-params">self,cmd</span>):
        <span class="hljs-variable language_">self</span>.cli.send(<span class="hljs-string">&#x27;&#123;&#125;\n&#x27;</span>.<span class="hljs-built_in">format</span>(cmd))
        sleep(<span class="hljs-number">6</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.cli.recv(<span class="hljs-number">9999</span>).decode() <span class="hljs-comment"># 回到cli函数读取回显结果9999字符，并使用decode进行解码</span>

    <span class="hljs-comment"># 检测风扇是否正常</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fan_info</span>(<span class="hljs-params">self</span>):
        fan_info=<span class="hljs-variable language_">self</span>.command(<span class="hljs-string">&#x27;display fan&#x27;</span>)
        <span class="hljs-keyword">return</span> fan_info.find(<span class="hljs-string">&#x27;Normal&#x27;</span>)==-<span class="hljs-number">1</span>

    <span class="hljs-comment"># sftp下载配置文件</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">download</span>(<span class="hljs-params">self,target,path=<span class="hljs-string">&#x27;/vrpcfg.zip&#x27;</span></span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;download staring...&#x27;</span>)
        client=<span class="hljs-variable language_">self</span>._get_client()
        sftp=client.open_sftp()
        sftp.get(path,target)
        <span class="hljs-variable language_">self</span>.client.close()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;download finish.&#x27;</span>)

    <span class="hljs-comment"># 关闭连接</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">close</span>(<span class="hljs-params">self</span>):
        <span class="hljs-variable language_">self</span>.client.close()

<span class="hljs-comment"># 定义使用ncclient并使用netconf方式进行设备配置，并在配置成功后输出成功提示</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">Netconf_by_rpc</span>(<span class="hljs-params">ip,username,password,rpc_netconf</span>):
    <span class="hljs-keyword">with</span> manager.connect_ssh(host=ip,
                             username=username,
                             password=password,
                             hostkey_verify=<span class="hljs-literal">False</span>,
                             device_params=&#123;<span class="hljs-string">&#x27;name&#x27;</span>:<span class="hljs-string">&quot;huaweiyang&quot;</span>&#125;)  <span class="hljs-keyword">as</span>  m:
        command=to_ele(rpc_netconf)
        rpc=m.__getattr__(<span class="hljs-string">&quot;rpc&quot;</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;get manager inner function rpc &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(rpc))
        rpc(command)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;netconf setting success!&#x27;</span>)

<span class="hljs-comment"># 定义使用netconf的方法进行设置设备日志主机的函数，并输出正在配置日志主机提示</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">Netconf_syslog_host</span>(<span class="hljs-params">ip,username,password,syslog</span>):
    rpc_netconf=<span class="hljs-string">&#x27;&#x27;&#x27;&lt;edit-config&gt;</span>
<span class="hljs-string">    &lt;target&gt;</span>
<span class="hljs-string">      &lt;running/&gt;</span>
<span class="hljs-string">    &lt;/target&gt;</span>
<span class="hljs-string">    &lt;config&gt;</span>
<span class="hljs-string">      &lt;syslog:syslog xmlns:syslog=&quot;urn:ietf:params:xml:ns:yang:ietf-syslog&quot;&gt;</span>
<span class="hljs-string">        &lt;syslog:log-actions&gt;</span>
<span class="hljs-string">          &lt;syslog:remote&gt;</span>
<span class="hljs-string">            &lt;syslog:destination&gt;</span>
<span class="hljs-string">              &lt;syslog:name&gt;syslog-host&lt;/syslog:name&gt;</span>
<span class="hljs-string">              &lt;syslog:udp&gt;</span>
<span class="hljs-string">                &lt;syslog:address&gt;&#123;&#125;&lt;/syslog:address&gt;</span>
<span class="hljs-string">                &lt;syslog:port&gt;43&lt;/syslog:port&gt;</span>
<span class="hljs-string">              &lt;/syslog:udp&gt;</span>
<span class="hljs-string">              &lt;syslog:destination-facility xmlns:ietf-syslog-types=&quot;urn:ietf:params:xml:ns:yang:ietf-syslog-types&quot;&gt;ietf-syslog-types:local0&lt;/syslog:destination-facility&gt;</span>
<span class="hljs-string">            &lt;/syslog:destination&gt;</span>
<span class="hljs-string">          &lt;/syslog:remote&gt;</span>
<span class="hljs-string">        &lt;/syslog:log-actions&gt;</span>
<span class="hljs-string">      &lt;/syslog:syslog&gt;</span>
<span class="hljs-string">    &lt;/config&gt;</span>
<span class="hljs-string">  &lt;/edit-config&gt;</span>
<span class="hljs-string">  &#x27;&#x27;&#x27;</span>.<span class="hljs-built_in">format</span>(syslog)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Using netconf configure syslog...&#x27;</span>)
    Netconf_by_rpc(ip,username,password,rpc_netconf)


<span class="hljs-comment"># 定义组装函数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">datacom_loop</span>(<span class="hljs-params">ip,username,password,name</span>):
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            datacom=Datacom(ip,username,password)
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;command.txt&#x27;</span>)  <span class="hljs-keyword">as</span> f:
             <span class="hljs-keyword">for</span> command <span class="hljs-keyword">in</span> f:
                <span class="hljs-built_in">print</span>(datacom.command(command))
            <span class="hljs-keyword">if</span> datacom.fan_info(): <span class="hljs-comment"># 判断风扇是否故障</span>
                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ALL fans are faultly&#x27;</span>)
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># 开始判断是不是保存配置超过24小时了, 则进行强行赋值，大于一天</span>
                than_one_day= datetime.now() - last_downloadtime&gt;=timedelta(days=<span class="hljs-number">1</span>)
            <span class="hljs-keyword">except</span> NameError:
                than_one_day=<span class="hljs-literal">True</span>
            <span class="hljs-keyword">if</span> than_one_day: <span class="hljs-comment"># 开始判断是不是保存配置超过24小时了</span>
                downloadtime=datetime.now() <span class="hljs-comment"># 记录下载时间</span>
                downloadtime_date=downloadtime.strftime(<span class="hljs-string">&#x27;%Y_%m_%d&#x27;</span>)
                config_filename=<span class="hljs-string">&#x27;&#123;&#125;_&#123;&#125;.zip&#x27;</span>.<span class="hljs-built_in">format</span>(downloadtime_date,name) <span class="hljs-comment"># 下载载的文件名字</span>
                backup_filename=<span class="hljs-string">&#x27;&#123;&#125;_&#123;&#125;.bak&#x27;</span>.<span class="hljs-built_in">format</span>(downloadtime_date,name) <span class="hljs-comment"># 保存的配置文件名字</span>
                datacom.command(<span class="hljs-string">&#x27;save force &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(config_filename))  <span class="hljs-comment"># 保存文件</span>
                datacom.download(backup_filename,config_filename) <span class="hljs-comment"># 下载函数下载文件</span>
                last_downloadtime=downloadtime <span class="hljs-comment"># 把最后一次的下载的时间设置成现在</span>
                datacom.close()
                sleep(<span class="hljs-number">5</span>*<span class="hljs-number">60</span>) <span class="hljs-comment"># 五分钟之后继续重复以上操作</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;stopped by &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(e))


ip = <span class="hljs-string">&#x27;10.1.0.6&#x27;</span> <span class="hljs-comment"># 设备IP地址</span>
name = <span class="hljs-string">&#x27;X_T1_AGG1&#x27;</span> <span class="hljs-comment"># 设备名</span>
syslog = <span class="hljs-string">&#x27;10.1.60.2&#x27;</span> <span class="hljs-comment"># 日志主机地址</span>
username = <span class="hljs-string">&#x27;python&#x27;</span> <span class="hljs-comment"># SSH的用户名</span>
password = <span class="hljs-string">&#x27;Huawei@123&#x27;</span> <span class="hljs-comment"># SSH的密码</span>
nc_username = <span class="hljs-string">&#x27;netconf&#x27;</span> <span class="hljs-comment"># 用于netconf的用户名</span>
nc_password = <span class="hljs-string">&#x27;Huawei@123&#x27;</span> <span class="hljs-comment"># 用于netconf的密码</span>


<span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:
    <span class="hljs-keyword">try</span>:
        Netconf_syslog_host(ip,nc_username,nc_password,syslog)
        datacom_loop(ip,username,password,name) <span class="hljs-comment"># 执行巡检调用，进行每5分钟一次的循环</span>
    <span class="hljs-keyword">except</span> KeyboardInterrupt:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;end of process!&#x27;</span>)
</code></pre>


<hr>
<h2 id="网络八股文"><a href="#网络八股文" class="headerlink" title="网络八股文"></a>网络八股文</h2><h3 id="1、内网攻击场景"><a href="#1、内网攻击场景" class="headerlink" title="1、内网攻击场景"></a>1、内网攻击场景</h3><blockquote>
<p>问题1 5’: 来自于外网的流量DDos攻击等，可以通过FW进行防御。来自于内部的流量，会有哪些?举出5 种内网攻击场景，并提供解决方案。(1 个场景1 分，5 个场景以上满分)</p>
</blockquote>
<pre><code class="hljs bash">答:
DDoS 攻击是指攻击者通过控制大量的僵尸主机，向被攻击目标发送大量精心构造的攻击报文， 造成被攻击者所在网络的链路拥塞、系统资源耗尽，从而使被攻击者产生拒绝向正常用户的请求提供服务的效果。来自外网流量的DDoS 攻击等，可以使用防火墙进行防御，而来自内部的流量也往往存在很多攻击行为，以下是关于内网流量攻击以及相应解决方案:

<span class="hljs-comment"># 1、LAND 攻击</span>
LAND 攻击是攻击者利用TCP 连接三次握手机制中的缺陷，向目标主机发送一个源地址和目的地址均为目标主机、源端口和目的端口相同的SYN 报文，目标主机接收到该报文后，将创建一个源地址和目的地址均为自己的TCP 空连接，直至连接超时。在这种攻击方式下，目标主机将会创建大量无用的TCP空连接，耗费大量资源，直至设备瘫痪。攻击者利用这个攻击原理攻击重要节点的网络设备， 例如服务器的网关设备，这样会导致设备资源使用率过高，影响网络服务。
<span class="hljs-comment"># 解决方式:</span>
可以在网关设备上启用畸形报文攻击防范，启用该防范后，设备采用检测TCP SYN 报文的源地址和目的地址的方法来避免LAND 攻击。如果TCP SYN 报文中的源地址和目的地址一致，则认为是畸形报文攻击，丢弃该报文。

<span class="hljs-comment"># 2、TC-BPDU 攻击</span>
交换设备在接收到TC BPDU 报文后，会执行MAC 地址表项和ARP 表项的删除操作。攻击者利用该原理伪造TC BPDU 报文恶意攻击交换设备，短时间内产生大量的TC BPDU 报文，导致交换设备会收到很多TC BPDU 报文，频繁的删除操作会给设备造成很大的负担，导致设备资源使用率过高，影响网络质量，也给网络的稳定带来很大隐患。解决方式:在交换设备上启用防TC-BPDU 报文攻击，启用该功能后，在单位时间内，交换设备处理TC BPDU 报文的次数可配置。如果在单位时间内，交换设备在收到TC BPDU 报文数量大于配置的阈值，那么设备只会处理阈值指定的次数。对于其他超出阈值的TC BPDU 报文，定时器到期后设备只对其统一处理一次。这样可以避免频繁的删除MAC 地址表项和ARP 表项，从而达到保护设备的目的。

<span class="hljs-comment"># 3、DHCP Server 仿冒攻击</span>
由于DHCP Server 和DHCP Client 之间没有认证机制，所以如果在网络上随意添加一台DHCP 服务器，它就可以为客户端分配IP 地址以及其他网络参数。如果该DHCP 服务器为用户分配错误的IP 地址和其他网络参数，导致用户上网异常等现象。解决方案:为了防止DHCP Server 仿冒者攻击，可配置设备接口的“信任(Trusted)/非信任(Untrusted)”工作模式，启用后接口默认为非信任模式，将与合法DHCP 服务器直接或间接连接的接口设置为信任接口。此后，从“非信任(Untrusted)”接口上收到的DHCP 回应报文将被直接丢弃，这样可以有效防止DHCP Server 仿冒者的攻击。

<span class="hljs-comment"># 4、IP 欺骗攻击</span>
随着网络规模越来越大，通过伪造源IP 地址实施的网络攻击(简称IP 地址欺骗攻击)也逐渐增多。攻击者通过伪造合法用户的IP 地址获取网络访问权限，非法访问网络，甚至造成合法用户无法访问网络，或者信息泄露。解决方案:可以在接入设备上启用IPSG，IPSG 利用绑定表(源IP 地址、源MAC 地址、所属VLAN、入接口的绑定关系)去匹配检查二层接口上收到的IP报文，只有匹配绑定表的报文才允许通过，其他报文将被丢弃。绑定表包括静态和动态两种。静态绑定表使用user-bind 命令手工配置。DHCP Snooping 动态绑定表在配置DHCP Snooping 功能后，DHCP 主机动态获取IP 地址时，设备根据DHCP 服务器发送的DHCP 回复报文动态生成。配置IPSG 技术结合DHCP Snooping 功能进行抵御。可以在交换机上接口或者VLAN 上配置IPSG功能，对入方向的IP 报文进行绑定表匹配检查，当设备在转发IP 报文时， 将此IP 报文中的源IP、源MAC、端口、VLAN 信息和绑定表的信息进行比较，如果信息匹配，说明是合法用户，则允许此用户正常转发，否则认为是攻击者，丢弃该用户发送的IP 报文。从而避免了IP 欺骗攻击。

<span class="hljs-comment"># 5、ARP 欺骗攻击</span>
ARP 欺骗是针对ARP 的一种攻击技术，通过使用错误的ARP 载荷信息欺骗局域网内访问者PC 的网关MAC 地址，使访问者PC 错以为攻击者更改后的MAC 地址是网关的MAC，</code></pre>

<h3 id="2、CloudCampus-全网业务随行原理"><a href="#2、CloudCampus-全网业务随行原理" class="headerlink" title="2、CloudCampus 全网业务随行原理"></a>2、CloudCampus 全网业务随行原理</h3><blockquote>
<p>问题2 3’：解释CloudCampus 解决方案的业务随行原理，如果有两个认证点(同时也是策略执行点)，用户分散在两个认证点，采用什么方案实现全网业务随行。给出两个方案。(3 分)</p>
</blockquote>
<pre><code class="hljs bash">答：
<span class="hljs-comment"># 业务随行的原理如下：</span>
传统园区网络主要通过ACL 对用户的策略进行控制。基于ACL 的策略配置依赖组网、IP 和VLAN 的规划，网络的拓扑改变、VLAN 规划改变、IP 地址规划改变以及用户的位置变化都会导致ACL 规则的变更，因此用户策略的配置无法与物理网络解耦，缺乏灵活性，可维护性差。
为了解决这个问题，使得用户不管身处何地、使用哪个IP 地址，都可以保证该用户在园区网络中获得一致性的访问策略，华为推出了基于用户身份进行策略控制的业务随行方案。
首先管理员在控制器中创建用户账号、定义UCL 组，同时将用户账号加入其所属的UCL 组，所有用户必须在认证通过后才可接入网络。然后为用户统一定义基于UCL 组的网络访问策略（即组策略）。
策略组配置完成后控制器将管理员配置的UCL 组下发给所有关联的交换机（执行点和认证点设备），从而实现交换机对用户所属UCL 组的识别。同时执行点设备向控制器发起建立IP-GROUP 通道。
当用户启动认证，在认证过程中，控制器根据用户的登录信息，将其与UCL组关联。认证成功后，控制器收集所有上线用户的IP 地址。
控制器通过IP-GROUP 通道向执行点设备推送UCL 组表项信息（该用户所属安全组作为授权结果），记录源/目的IP 与UCL 组的映射关系。
通过安全组完成了对网络对象的分类，通过安全组策略来定义该安全组能享受的网络服务。在iMaster NCE-Campus 中，管理员在二维矩阵上统一规划安全组所能享受的网络服务，包括访问权限、应用控制等。
业务随行方案：
<span class="hljs-comment"># （1） 场景1：虚拟化园区场景</span>
可以把汇聚设备部署为认证点和策略执行点，在虚拟化园区网场景下，同时把汇聚设备部署为Edge 节点,Edge 节点之间会部署VXLAN 隧道。当终端设备通过认证后，汇聚设备会拥有UCL 组信息，同时会拥有该汇聚节点下终端的IP-Group信息。
如果互访的终端都在同一个汇聚设备下，那么可以直接根据数据报文的源目的IP信息和IP-Group 表现来查找对应的源目安全组信息，之后再根据源目安全组执行组间策略，允许访问则转发，不允许则丢弃处理。
如果互访的目的终端不在该汇聚节点下，汇聚设备只有源终端的IP-Group 表项信息，没有目的终端的IP-Group 表项信息，所以不能直接执行组间策略。而此时汇聚节点同时是Edge 节点，会进行Vxlan 报文的封装，同时会将源安全组ID信息封装在VXLAN 报文中传递到对端的Edge 设备，对端设备再根据目的IP 查找目的的安全组。最后根据找到的目的安全组和VXLAN 报文中的源组ID 执行组间策略，如果禁止就丢弃，如果允许就通过。
<span class="hljs-comment"># （2） 场景2：非虚拟化园区网场景</span>
可以把汇聚设备部署为认证点和策略执行点。当终端设备通过认证后，汇聚设备会拥有UCL 组信息，同时会拥有该汇聚节点下终端的IP-Group 信息。
如果互访的终端都在通一个汇聚设备下，那么可以直接根据数据报文的源目IP信息和IP-Group 表项来查找对应的源目安全组信息，之后再根据源目安全组执行组间策略，允许访问则转发，不允许则进行丢弃处理。
如果互访的终端不在同一个汇聚设备下，汇聚设备只有源终端的IP-Group 表项信息，没有目的终端的IP-Group 表项信息，所以不能够直接执行组间策略。而普通的IP 报文无法携带安全组ID 信息，所以此时需要在控制器上配置IP-Group订阅，控制器需要把目的终端的IP-Group 表项信息推送到该汇聚设备上，拥有源目终端的IP-Group 信息，则可以根据数据报文的源目的IP 和IP-Group 表项来查找对应的源目阿全组信息，然后再执行策略，如果禁止就丢弃，允许就通过即可。</code></pre>

<h3 id="3、FRR-环路技术"><a href="#3、FRR-环路技术" class="headerlink" title="3、FRR 环路技术"></a>3、FRR 环路技术</h3><blockquote>
<p>问题3 5’：FRR 技术可以分为LFA、R-LFA、TI-LFA，FRR 的环路风险有哪些?(为什么会有环路)</p>
</blockquote>
<pre><code class="hljs bash">答：
1、LFA （Loop-Free Alternates）算法以可提供备份链路的邻居为根节点，利用SPF （Shortest Path First〉算法计算出到目的节点的最短距离。然后，按照以下不等式计算出一组开销最小且无环的备份链路。
LFA 不等式1：Distance_opt(N, D)＜ Distance_opt(N, S) + Distance_opt(S, D)。其中，Distance_opt(X,Y)是指节点X 到Y 之间的最短路径，N 是备份链路的节点，D 是流量转发的目的节点，S 是转发流量的源节点。
LFA 不等式2：Distance_opt(N, D)＜ Distance_opt(N, E) + Distance_opt(E，D)。其中，S 是转发流量的源节点，E 是发生故障的节点，N 是备份链路的节点，D是流量转发的目的节点。
满足以上两个公式，就避免了计算的备用路径产生环路的风险。但是并不意味部署1P FRR 的网络环境中就一定没有环路，可能会因为收敛不一致导致微环。
当主路径故障，流量切换到备份路径后，而后期原主路径恢复后，转发流量的源节点还未收敛完成，收到流量依旧向备份路径转发。此时备份链路的节点已经收敛完成，且该节点去往目的节点会经过源节点，则产生微环。
2、LFA FRR 对于某些大型组网，特别是环形组网，无法计算出备份路径，不能满足可靠性要求。在这种情况下，实现了Remote LFA FRR。Remote LFA 算法根据保护路径计算PQ 节点，并在源节点与PQ 节点之间建立tunnel 隧道形成备份下一跳保护。当保护链路发生故障时，流量自动切换到隧道备份路径，继续转发，从而提高网络可靠性。R-LFA 虽然提高了计算备用路径的覆盖率，但是同样会存在路由器拓扑变化的IGP 收敛先后不一致导致的微环。
3、LFA FRR 和Remote LFA 对于葉些场景中，扩展P 空间和Q 空间既没有交集，也没有直连的邻居，无法计算出备份路径，不能满足可靠性要求。在这种情况下，实现了T-LFA。TI-LFA 算法根据保护路径计算扩展P 空间，Q 空间，Post convergence 最短路径树，以及根据不同场景计算Repair List，并从源节点到。节点，再到Q 节点建立SegmentRouting 隧道形成备份下一跳保护。当保护链路发生故障时，流量自动切换到隧道备份路径，继续转发，从而提高网络可靠性。虽然T-LFA 拓扑无关，但是同样存在路由器收敛不一致导致的微环问题，T-LFA 可以通过算法来避免微环，主要的微环保护以下三个方面：
<span class="hljs-comment"># （1） SR-MPLS 本地正切防微环</span>
本地正切微环指的是紧邻故障节点的节点收敛后引发的环路。全网节点都部署TI-LFA，当主路径故障的时候，节点针对目的地址的收敛过程如下：源节点感知到故障，进入TI-LFA 的快速重路由切换流程，向报文插入Repair List，将报文转向TI-LFA 计算的PQ 节点。因此报文会先转发到下一跳备份节点。当源节点完成到目的地址的路由收敛，则直接查找目的节点的路由，将报文转发到下一跳备份节点，此时不再携带Repair List，而是直按转发。如果此时备份节点还未完成收敛，当源节点向备份节点转发报文时，备份节点的转发表中到目的节点的路由下一跳还是源节点，这样就在源节点和备份节点之间形成了环路。
解决方式：
在源节点部署正切防微环，部署正切防微环后的收敛流程如下：源节点感知到故障，进入T-LFA 流程，报文沿着备份路径转发，下一跳为备份节点，并封装Repair List，源节点启动一个定时器T1。在T_期间，源节点不响应拓扑变化，转发表不变，报文依旧按照TI-LFA 策略转发。网络中其他节点正常收敛。源节点的定时器T1 超时，这时网络中其他节点都己经完成收敛，源节点也正常收敛，退出TI-LFA 流程，按照正常收敛后的路径转发报文。
<span class="hljs-comment"># （2）本地回切防微环</span>
微环不但可能在路径正切时产生，也可能在故障恢复后路径回切时出现。下面介绍回切时产生环路：
主链路发生故障之后，报文按照重新收敛之后的备份路径发送到目的节点。
主链路故障恢复后，假设备份节点率先完成收敛。源节点收到报文，由于源节点未完成收敛，依然按照故障恢复前路径转发，转发给备份节点。备份节点已经完成收敛，所以备份节点按照故障恢复后的路径转发到源节点，这样就在源节点和备份节点之间形成了环路。
解决方式：
在备份节点部署回切防微环，部署回切防微环后的收敛流程如下：
主链路故障后恢复，备份节点率先完成收敛。备份节点启动定时器T1，在T1 超时前，备份节点针对访问目的节点的报文计算出防微环Segment List。源节点收到报文，由于源节点未完成收敛，依然按照故障恢复前路径转发，转发给备份节点。备份节点在报文中插入防微环Segment List，并转发到源节点。源节点根据Node SID 和Adjacency SID 指令执行转发动作，沿着Adjacency SiID 指定的出接口转发出去，最终转发至目的节点。
<span class="hljs-comment"># （3） 远端防微环</span>
前面介绍了本地正切防微环，实际上正切时不仅会导致本地微环，也可能引起远端节点之间形成环路，即沿着报文转发路径，如果离故障点更近的节点先于离故障点远的节点收敛，就可能会导致环路。下面描述远端微环产生过程：计算节点的非直连链路或节点故障，假设计算节点率先完成收敛，备份节点未完成收敛。备份节点沿着故障前路径将报文转发到计算节点，由于计算节点已经完成收敛，根据路由下一跳转发到备份节点。这样报文就在备份节点和计算节点之间形成了环路。
解决方式：
在计算节点使能远端防微环，使能远端防微环后的收敛流程如下：
计算节点的非直连链路或节点故障，假设计算节点率先完成收敛。计算节点启动定时器T1，在T1 超时前，算节点针对访问目的节点的报文计算出防微环Segment List。备份节点收到报文，由于备份节点未完成收敛，依然按照故障发生之前的路径将报文转发给计算节点。计算节点在报文中插入防微环Segment List，并转发到备份节点。备份节点根据Node SID 的指令执行转发动作，将报文转发给最远P 节点。最远P 节点根据AdjacencysD 的指令执行转发动作，沿着Adjacency SID 出接口转发出去，最后转发到目的节点。</code></pre>

<h3 id="4、FRR-TI-LFA环路风险"><a href="#4、FRR-TI-LFA环路风险" class="headerlink" title="4、FRR TI-LFA环路风险"></a>4、FRR TI-LFA环路风险</h3><blockquote>
<p>问题3 在部署FRR 时，开启TI-LFA 功能规避环路的风险,那么FRR 是否存在环路的风险？</p>
</blockquote>
<pre><code class="hljs bash">答：
LFA FRR 和Remote LFA 对于某些场景中，扩展P 空间和Q 空间既没有交集，也没有直连的邻居，无法计算出备份路径，不能满足可靠性要求。在这种情况下，实现了TI-LFA。TI-LFA 算法根据保护路径计算扩展P 空间，Q 空间，Post-convergence 最短路径树，以及根据不同场景计算Repair List，并从源节点到P 节点，再到Q 节点建立SegmentRouting 隧道形成备份下一跳保护。当保护链路发生故障时，流量自动切换到隧道备份路径，继续转发，从而提高网络可靠性。虽然TI-LFA 拓扑无关，但是同样存在路由器收敛不一致导致的微环问题，TI-LFA 可以通过算法来避免微环，主要的微环保护以下三个方面：
<span class="hljs-comment"># （1） SR-MPLS 本地正切防微环</span>
本地正切微环指的是紧邻故障节点的节点收敛后引发的环路。全网节点都部署TIHLFA，当主路径故障的时候，源节点针对目的地址的收敛过程如下：
源节点感知到故障，进入T-LFA 的快速重路由切换流程，向报文插入Repair List，将报文转向TH-LFA 计算的PQ 节点。因此报文会先转发到下一跳备份节点。当源节点完成到目的地址的路由收敛，则直接查找目的节点的路由，报文转发到下一跳备份节点，此时不再携带Repair List，而是直接转发。如果此时备份节点还未完成收敛，当源节点向备份节点转发报文时，备份节点的转发表中到目的节点的路由下一跳还是源节点，这样就在源节点和备份节点之间形成了环路。
解决方式：
在源节点部署正切防微环，部署正切防微环后的收敛流程如下：源节点感知到故障，进入T-LFA 流程，报文沿着备份路径转发，下一跳为备份节点，并封装RepairList。源节点启动一个定时器T1。在T1 期间，源节点不响应拓扑变化，转发表不变，报文依旧按照TI-LFA 策略转发。网络中其他节点正常收敛。源节点的定时器T1 超时，这时网络中其他节点都己经完成收敛，源节点也正常收敛，退出TI-LFA 流程，按照正常收敛后的路径转发报文。
<span class="hljs-comment"># （2）本地回切防微环</span>
微环不但可能在路径正切时产生，也可能在放障恢复后路径回切时出现。下面介绍回切时产生环路：
主链路发生故障之后，报文按照重新收敛之后的备份路径发送到目的节点。主链路故障恢复后，假设备份节点率先完成收敛。源节点收到报文，由于源节点未完成收敛，依然按照故障恢复前路径转发，转发给备份节点。备份节点已经完成收敛，所以备份节点按照故障恢复后的路径转发到源节点，这样就在源节点和备份节点之间形成了环路。
解决方式：
在备份节点部署回切防微环，部署回切防微环后的收敛流程如下：
主链路故障后恢复，备份节点率先完成收敛。备份节点启动定时器T1，在T1超时前，备份节点针对访问目的节点的报文计算出防微环Segment List。源节点收到报文，由于源节点未完成收敛，依然按照故障恢复前路径转发，转发给备份节点。备份节点在报文中插入防微环Segment List，并转发到源节点。源节点根据Node SID 和Adjacency SID 指令执行转发动作，沿着Adjacency SID 指定的出接口转发出去，最终转发至目的节点。
<span class="hljs-comment"># （3）远端防微环</span>
前面介绍了本地正切防微环，实际上正切时不仅会导致本地微环，也可能引起远端节点之间形成环路，即沿着报文转发路径，如果离放障点更近的节点先于离放障点远的节点收敛，就可能会导致环路。下面描述远端微环产生过程：
计算节点的非直连链路或节点故障，假设计算节点率先完成收敛，备份节点未完成收敛。备份节点沿着故障前路径将报文转发到计算节点，由于计算节点己经完成收敛，根据路由下一跳转发到备份节点。这样报文就在备份节点和计算节点之间闻形成了环路。
解决方式：
在计算节点使能远端防微环，使能远端防微环后的收敛流程如下：
计算节点的非直连链路或节点故障，假设计算节点率先完成收敛。计算节点启动定时器T1，在T1 超时前，计算节点针对访问目的节点的报文计算出防微环Segment List。备份节点收到报文，由于备份节点末完成收敛，依然按照故障发生之前的路径将报文转发给计算节点。计算节点在报文中插入防微环Segment List，并转发到备份节点。备份节点根据Node SID 的指令执行转发动作，将报文转发给最远P 节点。最远P 节点根据Adjacency SID 的指令执行转发动作，沿着Adjacency SID 出接口转发出去，最后转发到目的节点。</code></pre>

<h3 id="5、LDP、RSVP-TE-跟SR-比较"><a href="#5、LDP、RSVP-TE-跟SR-比较" class="headerlink" title="5、LDP、RSVP-TE 跟SR 比较"></a>5、LDP、RSVP-TE 跟SR 比较</h3><blockquote>
<p>问题4：LDP、RSVP-TE 跟SR 比，不好在哪里。(MPLS LDP 和RSVP-TE 与SR 相比较有不足之处，那么部署MPLS LDP 和RSVP-TE 有什么问题?)</p>
</blockquote>
<pre><code class="hljs bash">答:
MPLS LDP 和SR 相比MPLS LDP 建立LSP 需要同时使用IGP 和LDP 协议，IGP 用来通告路由和拓扑信息，形成路由表。LDP 用来分发标签，形成标签转发表。LDP 的LSP 需要依赖IGP 生成的路由表才能形成LSP。MPLS LDP 的两个主要缺点:
    (1)存在IGP 和LDP 同步的问题，某些场景，IGP 如果先收敛，LDP 后收敛会导致数据传递的路由黑洞问题。
    (2)LDP 不支持计算路径。SR 的路由信息的通告和计算全部使用IGP 协议单独完成，OSPF 通过LSA10 中的type7 来携带PrefixSID，ISIS 通过TLV235携带PrefixSID，那么就不存在MPLS LDP 中的IGP 和LDP 问题。
    (3)LDP 是为每条路由分配标签，而SR 只为节点和IGP 的邻居分配标签，在标签空间的使用上，SR 比LDP 少很多，SR 更适合大规模组网。
RSVP-TE 和SR 相比
    (1)控制平面:SR 信令控制也是IGP 的扩展，无需专门的MPLS 的控制协议，减少了协议的数量，而RSVP- TE 需要RSVP 作为控制协议，控制平面比较复杂。
    (2)可扩展性:SR 是源路由技术，通过控制器可以计算路径，隧道的信息有标签栈进行携带，也就是状态在数据包中。而RSVPTE 每台设备都需要维护隧道的状态信息，可扩展性差。
    (3)负载分担能力:RSVP 的隧道不支持负载分担，如果需要做负载必须创建多个隧道，而SR 的隧道很容易支持负载分担。</code></pre>

<h3 id="6、外网攻击场景"><a href="#6、外网攻击场景" class="headerlink" title="6、外网攻击场景"></a>6、外网攻击场景</h3><blockquote>
<p>论述题1.5 来自外网的流量攻击 DDos攻击等，可以通过FW进行防御。来自于内网的流量，会有哪些？举出5种内网攻击场景，并提供解决方案。（1个场景1分，5个场景以上满分）</p>
</blockquote>
<p>答：DDos攻击是指攻击者通过控制大量的僵尸主机，向被攻击目标发送大量精心构造的攻击报文，造成被攻击者所在网络的链路拥塞、系统资源耗尽，从而使被攻击者产生拒绝向正常用户的请求提供服务的效果。来自外网流量的DDos攻击等，可以使用防火墙进行防御，而来自内部的流量也往往存在很多攻击行为，以下是关于内网流量攻击以及相应的解决方案：</p>
<ol>
<li>LAND 攻击<br>LAND攻击是攻击者利用 TCP 连接三次握手机制中的缺陷，向目标主机发送一个源地址和目的地址均为目标主机、源端口和目的端口相同的 SYN 报文，目标主机接受到该报文后，将创建一个源地址和目的地址均为自己的 TCP 空连接，直至连接超时。在这种攻击方式下，目标主机将会创建大量无用的 TCP 空连接，耗费大量资源，直至设备瘫痪。攻击者利用这个攻击原理攻击重要节点的网络设备，例如服务器的网关设备，这样会导致设备资源使用率过高，影响网络服务。</li>
</ol>
<p>解决方式：</p>
<p>可以在网关设备上启用畸形报文攻击防范，启用该防范后，设备采用监测 TCP SYN 报文的源地址和目的地址的方式来避免LAND攻击。如果 TCP SYN 报文中的源地址和目的地址一致，则认为是畸形攻击，丢弃该报文。</p>
<ol start="2">
<li>TC-BPDU攻击</li>
</ol>
<p>交换设备在接受到TC BPDU 报文后，会执行 MAC 地址表项和 ARP 表项的删除操作。攻击者利用该原理伪造TC BPDU 报文而已攻击交换设备，短时间内产生大量的 TC BPDU 报文，<br>导致交换设备会收到很多 TC BPDU 报文，频繁的删除操作会给设备造成很大的负担，导致设备资源使用率过高，影响网络质量，也给网络的稳定带来很大隐患。</p>
<p>解决方式：</p>
<p>在交换设备上启用防 TC-BPDU 报文攻击，启用该功能后，在单位时间内，交换设备处理 TC BPDU 报文的次数可配置。如果在单位时间内，交换设备在收到 TC BPDU 报文数量大于配置的阈值，那么设备只会处理阈值指定的次数。对于其他超出阈值的 TC BPDU 报文，定时器到期后设备只对其统一处理一次。这样可以避免频繁的删 MAC 地址表象和 ARP 表项，从而达到保护设备的目的。</p>
<ol start="3">
<li>DHCP Server 仿冒攻击</li>
</ol>
<p>由于 DHCP Server 和 DHCP Client 之间没有认知机制，所以如果在网络上随意添加一台 DHCP 服务器，他就可以为客户端分配 IP 地址以及其他网络参数。如果该 DHCP 服务器为用户分配错误的 IP 地址和其他的网络参数，导致用户上网异常等现象。</p>
<p>解决方案：</p>
<p>为了防止 DHCP Server 放冒者攻击，可配置设备接口的“信任(Trusted)&#x2F;非信任(Untrusted)”工作模式，启用后接口默认为非信任模式，将与合法 DHCP 服务器直接或间接的连接的接口设置为信任接口。此后，从“非信任(Untrusted)”接口上收到的 DHCP 回应报文将被直接丢弃，这样可以有效防止 DHCP Server 放冒者的攻击。</p>
<ol start="4">
<li>IP 欺骗攻击</li>
</ol>
<p>随着网络规模越来越大，通过伪造源 IP 地址实施的网络攻击（简称 IP 地址欺骗攻击）也逐渐增多。攻击者通过伪造合法用户的 IP 地址获取网络访问权限，非法访问网络，甚至造成合法用户无法访问网络，或者信息渗漏。</p>
<p>解决方案：</p>
<p>可以在接入设备上启用 IPSG，IPSG 利用绑定表（源 IP 地址、源 MAC 地址、所属 VLAN、入接口的绑定关系）去匹配检查二层接口上收到的IP报文，只有匹配绑定表的报文才允许通过，其他报文将被丢弃。绑定表包括静态和动态两种。静态绑定表使用 user-bind 命令手动配置。 DHCP Snooping 动态绑定表在配置 DHCP Snooping 功能后， DHCP 主机动态获取IP地址时，设备根据 DHCP 服务器发送的 DHCP 回复报文动态生成。配置 IPSG 技术结合 DHCP Snooping 功能进行抵御。可以在交换机上接口或者 VLAN 上配置 IPSG 功能，对入方向的IP报文进行绑定表匹配检查，当设备在转发IP报文时，将此IP报文中的源IP、源MAC、端口、VLAN信息和绑定表的信息进行比较， 如果信息匹配，说明是合法用户，则允许此用户正常转发，否则认为是攻击者，丢弃该用户发送的IP报文。从而避免了IP欺骗报文。</p>
<ol start="5">
<li>ARP欺骗攻击</li>
</ol>
<p>ARP欺骗是针对ARP的一种攻击技术，通过使用错误的ARP 载荷信息欺骗局域网内访问者PC的网关MAC地址，使访问者PC错以为攻击者更改后的MAC地址是网关的MAC，导致网关不通。此种攻击可让攻击者获取局域网上的数据包甚至可以篡改数据包，且可让网络上特定计算机或所有计算机无法正常连通。</p>
<p>解决方案：</p>
<p>为了防御 ARP 欺骗攻击，可以在 Switch 上部署动态 ARP 监测 DAI(Dynamic ARP Inspection)功能。动态ARP监测是利用DHCP snooping绑定表来防御中间人攻击的。当设备收到ARP报文时，将此ARP报文对应的源IP、源MAC、VLAN以及接口信息和绑定表的信息进行比较，如果信息匹配，说明发送该ARP报文的用户是合法用户，允许此用户的ARP报文通过，否则就认为是攻击，丢弃该ARP报文。</p>
<h3 id="7、CloudCampus-解决方案的业务随行多认证点"><a href="#7、CloudCampus-解决方案的业务随行多认证点" class="headerlink" title="7、CloudCampus 解决方案的业务随行多认证点"></a>7、CloudCampus 解决方案的业务随行多认证点</h3><blockquote>
<p>论述题2.5 解释 CloudCampus 解决方案的业务随行原理，如果有两个认证点（同时也是策略执行点），用户分散在两个认证点，采用什么方案实现全网业务随行。给出两个方案。</p>
</blockquote>
<p>答：业务随行的原理如下：</p>
<p>传统园区网络主要通过 ACL 对用户的策略进行控制。基于 ACL 的策略配置依赖组网、IP和VLAN 的规划，网络的拓扑改变、VLAN规划改变、IP地址改变以及用户的位置变化都会导致ACL规则的变更，因此用户策略的配置无法与物理网络解耦，缺乏灵活性，可维护性差。</p>
<p>为了解决这个问题，使得用户不管身处何处、使用哪个IP地址，都可以保证该用户在园区网络中忽的一致性的访问策略</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="常用命令与技巧"><a href="#常用命令与技巧" class="headerlink" title="常用命令与技巧"></a>常用命令与技巧</h3><ol>
<li>检查命令</li>
</ol>
<pre><code class="hljs bash"><span class="hljs-comment"># 保持ssh会话</span>
sys
user-interface console 0
idle-timeout 0 0
<span class="hljs-comment"># 关闭日志</span>
undo info-center <span class="hljs-built_in">enable</span>
<span class="hljs-comment"># lldp</span>
system-view
lldp <span class="hljs-built_in">enable</span>
display lldp neighbor brief
<span class="hljs-comment"># 查看 IP 地址池</span>
display current-configuration configuration ip-pool
<span class="hljs-comment"># </span>
display ip interface brief
<span class="hljs-comment">#</span>
display port vlan
<span class="hljs-comment">#</span>
dis lldp neighbor brief
<span class="hljs-comment"># </span>
dis cur | include prefix
&gt; <span class="hljs-comment"># 清除配置，重启生效</span>
reset saved-configuration
<span class="hljs-comment"># 查看VPN实例</span>
dis cur config vpn-instance</code></pre>

<ol start="2">
<li>快捷键</li>
</ol>
<pre><code class="hljs bash">CTRL+X 删除光标左侧所有的字符
CTRL+Y 删除光标所在位置及其右侧所有的字符
CTRL+E 将光标移动到当前行的末尾
CTRL+A 将光标移动到当前行的第一个字符
CTRL+W 删除光标左侧的一个字
<span class="hljs-comment"># 组合键</span>
ESC+B 将光标向左移动一个字符串
ESC+D 删除光标右侧的一个字符串
<span class="hljs-comment"># 不常用</span>
ESC+F 将光标向右移动一个字符串
CTRL+B 将光标向左移动一个字符
CTRL+F 将光标向右移动一个字符
CTRL+D 删除当前光标所在位置的字符
CTRL+H 删除光标左侧的一个字符
CTRL+N 显示历史命令缓冲区中的后一条命令
CTRL+P 显示历史命令缓冲区中的前一条命令</code></pre>

<h2 id="排查命令"><a href="#排查命令" class="headerlink" title="排查命令"></a>排查命令</h2><pre><code class="hljs bash">display  ospf 65001 error
dis cu configuration  ospf  65001</code></pre>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以邮件至 hjxstart@126.com </span>
    </div>
</article>








    




    </div>
    <div class="copyright">
        <p class="footer-entry"><span class="miit">
                <img src="/img/gov.png" title="中华人民共和国工业和信息化部">
                <a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">粤ICP备2021170625号-1</a>
        </span>
    
    ©2019-2022 hjxstart
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("/img/article-list-bg-img.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
